{"id":"fdfd89cb-546c-4212-85f7-d848dc37a075","version":"1.0.66","icon":"other","splash":"other","splashdata":{"img":"Servelec hsc Logo - RGB.png","bg":"#ffffff"},"settings":{"router":{"mode":"single","animation":"off"},"theme":"","push-notifications":{"android":{"enabled":true,"id":"888020801908"},"ios":{"enabled":true},"wp":{"enabled":false}},"provisioning":{"enabled":false,"manifest":"","poll":2,"manual":false,"wifionly":true},"crashReporting":{"enabled":false,"androidEnabled":false,"iosEnabled":false,"splunkAndroidApiKey":"","splunkIosApiKey":"","splunkExtraData":""},"kioskMode":{"enabled":false},"loading-message":false,"encryption":true,"logging":{"enabled":false,"bufferFrequency":100,"defaultRootLogLevel":"error","defaultMaxFileSizeKilobyte":1000,"defaultMaxFiles":5,"appEnabled":true,"appUseDefault":true,"appRootLogLevel":"error","appMaxFileSizeKilobyte":1000,"appMaxFiles":5,"clientEnabled":true,"clientUseDefault":true,"clientRootLogLevel":"error","clientMaxFileSizeKilobyte":1000,"clientMaxFiles":5,"nativeEnabled":true,"nativeUseDefault":true,"nativeRootLogLevel":"error","nativeMaxFileSizeKilobyte":1000,"nativeMaxFiles":5},"plugins":{"builtIn":{"cordova-plugin-whitelist@1.2.2":{"override":false,"used":true,"enabled":true},"cordova-plugin-battery-status@1.2.4":{"override":false,"used":false,"enabled":false},"cordova-plugin-console@1.0.3":{"override":false,"used":true,"enabled":true},"cordova-plugin-contacts@2.1.0":{"override":false,"used":false,"enabled":false},"cordova-plugin-device@1.1.2":{"override":false,"used":true,"enabled":true},"cordova-plugin-device-motion@1.2.1":{"override":false,"used":false,"enabled":false},"cordova-plugin-device-orientation@1.0.3":{"override":false,"used":false,"enabled":false},"cordova-plugin-file@4.2.0":{"override":false,"used":true,"enabled":true},"cordova-plugin-geolocation@2.2.0":{"override":true,"used":false,"enabled":true},"cordova-plugin-globalization@1.0.3":{"override":false,"used":true,"enabled":true},"commontime-cordova-plugin-inappbrowser@1.6.2":{"override":false,"used":false,"enabled":false},"cordova-plugin-network-information@1.2.1":{"override":true,"used":false,"enabled":true},"cordova-plugin-splashscreen@3.2.2":{"override":false,"used":true,"enabled":true},"cordova-plugin-vibration@2.1.4":{"override":false,"used":false,"enabled":false},"cordova-plugin-statusbar@1.0.1":{"override":false,"used":true,"enabled":true},"cordova-plugin-camera@2.3.1":{"override":false,"used":true,"enabled":true},"phonegap-plugin-barcodescanner@6.0.4":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.thumbnail@1.4.8":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.fileimporter@1.0.0":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.file-opener@1.0.11":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.beacon@1.0.6":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.notification@1.0.12":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.audio@0.9.11":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.media-properties@1.2.11":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.splitscreen@1.1.0":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.preferences@1.0.0":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.authentication@1.0.8":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.urlhandler@1.1.0":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.securesettings@1.0.2":{"override":true,"used":true,"enabled":false},"com.commontime.cordova.geofence@0.5.0":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.file-transfer@1.5.5":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.public.provisioning@0.0.13":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.insomnia@0.0.15":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.splunk-mint@1.0.3":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.kiosk@1.0.11":{"override":false,"used":false,"enabled":false},"cordova-android-movetasktoback@0.1.3":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.logging@1.0.24":{"override":false,"used":true,"enabled":true},"cordova-plugin-email":{"override":false,"used":true,"enabled":true},"cordova-android-crosswalk-webview@2.3.0":{"override":false,"enabled":false},"cordova-plugin-emm-app-config@1.0.0":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.public.messaging@0.0.42":{"override":false,"used":true,"enabled":true},"cordova-plugin-battery-status@1.1.2":{"override":false,"used":false,"enabled":false},"cordova-plugin-vibration@2.1.1":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.file-opener@1.0.8":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.notification@1.0.11":{"override":true,"used":true,"enabled":false},"com.commontime.cordova.audio@0.9.10":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.insomnia@0.0.6":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.public.messaging@0.0.44":{"override":true,"used":true,"enabled":false},"cordova-plugin-vibration@2.1.6-dev-ct-0.0.1":{"override":false,"used":false,"enabled":false},"cordova-plugin-media-capture@1.4.1":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.fileimporter@1.0.2":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.file-opener@1.0.13":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.notification@1.0.14":{"override":false,"used":true,"enabled":true},"https://github.com/commontime/cordova-ios-voip-push@1.0.2":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.audio@0.9.22":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.media-properties@1.2.13":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.preferences@0.0.4":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.geofence@0.5.5":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.insomnia@0.0.30":{"override":false,"used":false,"enabled":false},"cordova-plugin-emm-app-config@1.0.2":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.public.messaging@0.0.47":{"override":false,"used":true,"enabled":true}},"customPlugins":{"cordova-plugin-touch-id":{"id":"cordova-plugin-touch-id","name":"cordova-plugin-touch-id","version":"3.2.0","description":"Scan the fingerprint of your user with the TouchID sensor (iPhone 5S, iPhone 6(S), ..)","spec":"3.2.0"},"cordova-plugin-android-fingerprint-auth":{"id":"cordova-plugin-android-fingerprint-auth","name":"cordova-plugin-android-fingerprint-auth","version":"1.3.1","description":"Cordova plugin to use Android fingerprint authentication API","spec":"1.3.1"},"cordova-plugin-media-capture":{"id":"cordova-plugin-media-capture","spec":"1.4.1","preferences":{},"variables":{"PHOTOLIBRARY_USAGE_DESCRIPTION":"This app would like to access your photo library.","CAMERA_USAGE_DESCRIPTION":"This app would like to use the camera.","MICROPHONE_USAGE_DESCRIPTION":"This app would like to record audio."}},"com.commontime.cordova.notification":{"id":"com.commontime.cordova.notification","spec":"https://github.com/commontime/com.commontime.cordova.notification#1.0.14","name":"CT Notification Plugin","description":"Override features for the Network Information Plugin","version":"1.0.14","preferences":{"inAppPush":"immediate"}},"Messaging":{"id":"Messaging","spec":"https://github.com/commontime/com.commontime.cordova.public.messaging#0.0.47","version":"0.0.47"}}},"minimise-on-back-button":true},"language":{"defaultLocale":"en_GB","initialLanguage":"","useDeviceLocale":true},"metadata":{"2e0f655a-2f3a-4dd8-bc8c-6925825a161e":"AIzaSyAMKVGS1wSBbEoAS4YHT6opiiu72ZKmPaU","f0d3a631-c15b-45f5-b725-0ed6a1e02f19":"dev","0ae850a5-abfb-421e-9d3d-a67ddd37301a":"false","3aa989b9-34b0-43e6-8866-362570aee918":"true","7bc7245e-12ed-491e-b63b-e8f2eeac57d1":"53.3125156","36c6cb48-ece6-4dd6-9e61-7656603be471":"-1.3461527"},"name":"Community_Worker","packageId":"com.commontime.infinity.communityworker","schemaVersion":28,"minimumStudioVersion":"3.2.0","pages":[{"start":true,"name":"Login","config":[{"name":"Page Loaded Event","type":"event","item-type":"onpageloaded","_auto_id_":"86b36f34-9434-4a6b-9a85-fd7be7d021f3","actions":[{"event":"onpageloaded","type":"inline-function","data":{"sync":true,"code":"// Grab and set current location\ncti.fn_get_location()\n$success()"},"_auto_id_":"c160d023-af2f-4659-9d6d-1e2a5143aa92"}]}],"content":[{"name":"header","type":"area","item-type":"static","_auto_id_":"eb4ef6f7-5251-4737-b6c8-b4327caf9a6f","content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"972066c9-5cf4-4625-8650-d0a0ff2293fe","attributes":{},"actions":[],"expressions":{}},{"name":"html_splash","type":"content","item-type":"html","_auto_id_":"326977e6-7019-48b8-afcb-784594ad8ec3","content":"<div class=\"header\">\n  <div class=\"logo\"/>\n</div>","expressions":{}}],"expressions":{}},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"html_instructions","type":"content","item-type":"html","_auto_id_":"9a9ae4e7-267d-43a8-bbe0-9a60a61d76fd","content":"<div class=\"splash\">\n  <div class=\"riologo\"/>\n</div>\n<h3>Log In</h3>\n<h5>Please enter your RiO username and password</h5>","expressions":{}},{"name":"group_login","type":"area","item-type":"group","_auto_id_":"675c1a4f-e26e-409f-90ba-a322f67f3f0a","content":[{"name":"username","type":"user-input","item-type":"text","_auto_id_":"0b3b342d-0ee0-494c-a3b6-e9b1f0a9b483","label":"","required":true,"multiline":false,"debounce":250,"placeholder":"Username","expressions":{"disabled":"$store.variables.v_isAuthenticated"},"message":"This is a required field","classes":"minimal","validators":[],"actions":[]},{"name":"password","type":"user-input","item-type":"password","_auto_id_":"0a37fb72-7545-4939-bb1e-5a73a29dfad0","label":"","required":true,"message":"This is a required field","expressions":{"disabled":"$store.variables.v_isAuthenticated"},"placeholder":"Password","classes":"minimal","actions":[]},{"name":"button_login","type":"button","item-type":"button","_auto_id_":"f5163535-ecd6-4868-87d0-5321a99c580f","content":"Login {{'$store.variables.online == \"online\" ? \"\" : \"(offline)\"' | store}}","theme":"minimal","expressions":{"disabled":"$form.invalid"},"actions":[{"type":"if","data":{},"_auto_id_":"889d6bad-0738-4ffb-bda3-babe9cd08188","operations":[{"type":"value","content":"{{($store.variables.v_isAuthenticated) ? 1 : 0}}","$selected":false},{"type":"operator","content":"==","$selected":false},{"type":"value","content":"0","$selected":false}]},{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_login - page Login', \n  'info'\n);\n\n//create base64 encoded string from username and password for the API\ncti.fn_toggle_spinner('open', 'Authenticating...');\n\nvar auth = window.btoa(cti.store.pages.Login.username + ':' + cti.store.pages.Login.password);\ncti.store.variables.auth_header = auth;\n$success();"},"_auto_id_":"62b277ef-3eff-4f3a-a0f9-cb2b23818198","actions":[]},{"event":"click","type":"call-api","data":{"sync":true,"name":"api_rio","operation":"authenticate","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}"}},"_auto_id_":"2b448e34-83c3-4700-898d-3e0a1b6bc6c3","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"cti.fn_toggle_spinner('close');\n\nif($data.$response.success) {\n  window.logManager.consoleLog(\n    'API CALL: /authenticate | SUCCESS', \n    'info'\n  );\n\n  cti.store.variables.v_isAuthenticated = true\n  cti.store.variables.firstLogin = true\n  \n  // Retain the username (we need it for registering for push initially but may require it elsewhere).\n  cti.store.variables.loggedInUser = cti.store.pages.Login.username\n\n  cti.utils.callAction(\"call-actionflow\", { name: \"RegisterPush\" });\n} else {\n  window.logManager.consoleLog(\n    'API CALL: /authenticate | FAIL: Reason - ' + $data.$response.message, \n    'error'\n  );\n\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Authentication failed\", \n    \"text\" : \"Please check your username and password are correct.\"\n  });\n  \n  cti.store.variables.v_isAuthenticated = false;\n}"},"_auto_id_":"8079bba7-954a-4185-8f7d-7e11ac44ada4","actions":[]},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"cti.fn_toggle_spinner('close');\ndebugger;\nwindow.logManager.consoleLog(\n  'API CALL: /authenticate | FAIL: Reason - ' + $data.$response.message, \n  'error');\n\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\", \n  \"text\" : \"Unable to connect to the server.\"\n});\n\ncti.store.variables.v_isAuthenticated = false;"},"_auto_id_":"727ea512-95a8-4f61-83e4-6dbe30e5ed3e"}]},{"type":"otherwise","data":{},"_auto_id_":"0207c4e6-5f20-46ca-a102-97b41b2b565e"},{"event":"click","type":"call-actionflow","data":{"name":"Login"},"_auto_id_":"6ab66fc5-69cd-42db-9fe9-99647977de68"},{"type":"end-if","data":{},"_auto_id_":"d1d251dd-19fb-4e45-bce6-9c3c37ef24f2"}],"classes":"default"},{"name":"button_revoke","type":"button","item-type":"button","_auto_id_":"ea3fcf91-c35c-4a83-9953-ccfac9d9f431","content":"Revoke Authentication","theme":"minimal","expressions":{"show":"$store.variables.v_isAuthenticated"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_revoke - page Login', \n  'info'\n)\n\ncti.store.variables.v_isAuthenticated = false\ncti.fn_revoke_cleardown()\ncti.store.pages.Login.password = \"\"\n\n// Store a temp copy of the username for use within the deregister push call.\ncti.store.variables.temp_user = cti.store.variables.loggedInUser\ncti.store.variables.loggedInUser = ''\n\n// Delete appointments from pouch\nwindow.pouchManager.loadFromDatabase('appointments', function (doc) {\n  // Reset appointments array\n  doc.data = []\n  \n  window.pouchManager.saveToDatabase(\n    \"appointments\", \n    doc.data, function(rev) {\n      window.logManager.consoleLog(\n        'Pouch DB: Successfully deleted Appointments Data from Pouch', \n        'info'\n      )\n    }, function(reason, e) {\n      window.logManager.consoleLog(\n        'Pouch DB - Failed to delete Appointment Data - ' + reason, e, \n        'error'\n      )\n    })\n}, function (reason, err) {\n  window.logManager.consoleLog(\n    'Pouch DB: Failed retriveing Appointments Data from Pouch - ' + reason + err, \n    'error'\n  )\n})\n\n$success()"},"_auto_id_":"bfbf9582-7bda-4224-b873-53a493774ab0","actions":[]},{"event":"click","type":"call-actionflow","data":{"name":"DeregisterPush"},"_auto_id_":"9aeb960d-4ac5-47cf-8014-f5dce772ca72"}]}],"repeat":false,"expressions":{}},{"name":"popupRetry","type":"component","item-type":"web-component","content":[{"name":"html_warnings","type":"content","item-type":"html","_auto_id_":"94685c59-c1c8-4c55-b89a-b2e39bf0474b","content":"<h2>Initial Download Data Failed</h2>\n<p>There was an issue downloading the patient information data on Login. Please try again or, if you continue to have problems, contact support.</p>","expressions":{},"classes":""},{"name":"button_bar_mobile","type":"area","item-type":"button-bar","_auto_id_":"1ae99f3d-de67-499d-8052-e5463a23b289","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_cancel","type":"button","item-type":"button","_auto_id_":"0d14bed0-90f4-4785-96f1-1a9cc1760b6b","content":"CANCEL","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Login","componentInstanceId":"723ae197-d492-49b6-bde1-ca129f5b4626","function":"toggle"},"_auto_id_":"09458a2a-229b-4de1-8f3b-a6ac304ecdcd"}]},{"name":"button_retry","type":"button","item-type":"button","_auto_id_":"df86052e-315e-400a-a936-665ce64e1596","content":"RETRY","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_end_visit_1 - page Login', \n  'info'\n);\n\ncti.fn_toggle_spinner('open', 'Downloading Application Data, please wait...');\ncti.utils.callAction(\"call-actionflow\", { name: \"GetStaticData\" });\n\n$success();"},"_auto_id_":"c15c4c66-c439-4423-9c5f-653ca48824fc"},{"event":"click","type":"call-component-function","data":{"page":"Login","componentInstanceId":"723ae197-d492-49b6-bde1-ca129f5b4626","function":"toggle"},"_auto_id_":"08f1f36a-56e2-4cf1-a9d6-39dc22898df8"}],"classes":"default"}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"723ae197-d492-49b6-bde1-ca129f5b4626","attributes":{},"expressions":{}}],"_auto_id_":"98632a55-d771-41a2-9012-3e96037f370e"},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"html_version","type":"content","item-type":"html","_auto_id_":"8e6768e1-c6d4-4e61-8241-d041b21b3068","content":"Version {{'$store.schema.version' | store}}","expressions":{}}],"_auto_id_":"eeb5ae3b-c6ec-47d8-8175-4bfa1047cf67","expressions":{}}]},{"start":false,"name":"Visits","config":[{"name":"Page Loaded Event","type":"event","item-type":"onpageloaded","_auto_id_":"6fc663b9-c23a-4d5e-bb23-8077031375bf","actions":[{"event":"onpageloaded","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'Page On-Loaded: Visits', \n  'info'\n)\n\n// Create and append slip js stuff to the Visits list\nvar ol = $('#Visits #list_visits ul')[0];\n\nol.addEventListener('slip:beforereorder', function(e){\n  if (/demo-no-reorder/.test(e.target.className)) {\n    e.preventDefault();\n  }\n}, false);\n\nol.addEventListener('slip:beforewait', function(e){\n  if (e.target.className.indexOf('instant') > -1) e.preventDefault();\n}, false);\n\nol.addEventListener('slip:reorder', function(e){\n  var ul = e.target.parentNode;\n  var apts = cti.store.variables.v_selectedDayAppointments;\n  \n  apts.splice(e.detail.spliceIndex, 0, apts.splice(e.detail.originalIndex, 1)[0]);\n  for (var i = 0; i < apts.length; i++) {\n    apts[i].index = i;\n  }\n  cti.utils.updatePage();\n\n  cti.utils.callAction(\"call-function\", {\"name\":\"fn_render_map\"});\n  \n  return false;\n}, false);\n\n// Initialise slip\nnew Slip(ol);\n\n// Clear down excess data\nif(cti.store.variables.clearDown) {\n  delete cti.store.variables.clearDown\n  \n  delete cti.store.variables.duration_hours\n  delete cti.store.variables.duration_minutes\n\n  delete cti.store.variables.selected_visit\n  delete cti.store.variables.timeline\n\n  delete cti.store.variables.v_appointmentSyncFromDate\n  delete cti.store.variables.v_appointmentSyncTomDate\n\n  delete cti.store.variables.v_planner\n  delete cti.store.variables.visit_view_mode\n}\n\n// Kick off the Google Maps initialisation process\n// Calls fn_init_google_maps to check that we have maps installed...\n// ... then we execute fn_render_map on the callback of that function\nvar setMaps = cti.fn_init_google_maps(\"cti.fn_render_map\")\n\n// Hack: The Google map URL callback does not execute if the map is already added in the header script tag\nif(!setMaps) {\n  cti.fn_render_map()\n}\n\nif(cti.store.variables.v_outcomePayload_clear) {\n  delete cti.store.variables.v_outcomePayload_clear\n  delete cti.store.variables.o_activities\n  cti.utils.destroyPageData('Outcome')\n}\n\nif(cti.store.variables.selected_visit_clear) {\n  delete cti.store.variables.selected_visit_clear\n  delete cti.store.variables.selected_visit\n  cti.fn_toggle_spinner('open', 'Refreshing Appointment list, please wait...')\n  cti.fn_toggle_spinner('close', '', 1000)\n}\n\nif(cti.store.variables.return) {\n  delete cti.store.variables.return\n  delete cti.store.variables.selected_visit\n}\n\n$success()"},"_auto_id_":"a2be9697-ce70-40e8-b0fc-70e2614b1306","actions":[]}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"title","type":"content","item-type":"title","content":"<h4>{{'$store.variables.v_appointmentDateText' | store}}'s Visit List</h4>","_auto_id_":"f95e7688-9b31-47ab-bf23-f683d5ecaf88"},{"name":"button_menu","type":"button","item-type":"button","_auto_id_":"78cb0cec-bd26-4eab-8701-d8d4a982ce5d","content":"","theme":"minimal","left-icon":"fa-bars","expressions":{},"actions":[{"event":"click","type":"call-function","data":{"name":"fn_openContentMenu"},"_auto_id_":"5bf303d4-c24c-4aeb-a305-564dd75035df"}]},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"d95e49a0-ea09-4de8-a62d-b9af8d01a5ea","attributes":{},"expressions":{}},{"name":"ct_context_menu","type":"component","item-type":"web-component","content":[{"name":"button_logout","type":"button","item-type":"button","_auto_id_":"d5786c20-01a3-40e0-87c7-b5027a415b63","content":"Logout","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"Login","isConditional":false},"_auto_id_":"02c01738-f8a5-47d0-a9af-00edf13f9f68"}],"expressions":{}},{"name":"button_bar_menu","type":"area","item-type":"button-bar","_auto_id_":"9cf662c3-603c-4b53-a18c-3392a027fff1","extends":{"type":"area","item-type":"row"},"content":[{"name":"html_menu_version","type":"content","item-type":"html","_auto_id_":"62cc84df-bc0c-43c2-8506-8b2c51bdbb91","content":"Version {{'$store.schema.version' | store}}","expressions":{}}],"expressions":{}}],"componentId":"1fa0aab1-7b03-413d-b3e0-433405059753","_auto_id_":"e1051f87-703d-407d-b374-d65a308c401c","attributes":{"Direction":"right","MinWidth":null,"Overlay":true},"actions":[],"expressions":{},"classes":""}],"_auto_id_":"ae63d670-add5-4018-b58a-92a093c4e1d7","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"5f284ea1-0c13-4bd8-bd74-028a6557ed14","content":[{"name":"row_date","type":"area","item-type":"row","_auto_id_":"e58f95bd-7b0a-49cd-b72a-1cec1b4c08e0","content":[{"name":"button_yesterday","type":"button","item-type":"button","_auto_id_":"5370bee1-2685-4076-932e-4cf3e6ada5a9","content":"","theme":"minimal","expressions":{"disabled":"$store.variables.v_appointmentDateText == \"Yesterday\""},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_yesterday - page Visits', \n  'info'\n)\n\ncti.fn_toggle_spinner('open', 'Loading Yesterday\\'s Appointment Data...')\n\nvar newDisplayDate = moment().subtract(1, 'days').format(\"YYYY-MM-DD\")\n\ncti.store.variables.v_appointmentDate = newDisplayDate\ncti.store.variables.v_appointmentDateText = 'Yesterday'\n\ncti.fn_load_appointments()\n\ncti.utils.updatePage()\n$success()"},"_auto_id_":"165a3058-8369-43e8-8a79-ce12a87c8787","actions":[]}],"left-icon":"fa-arrow-circle-o-left"},{"name":"button_today","type":"button","item-type":"button","_auto_id_":"7fb50f11-09d1-4cf6-a240-1b39f6e197fe","content":"","theme":"minimal","expressions":{"disabled":"$store.variables.v_appointmentDateText == \"Today\""},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_today - page Visits', \n  'info'\n)\n\ncti.fn_toggle_spinner('open', 'Loading Today\\'s Appointment Data...')\n\nvar newDisplayDate = moment().format(\"YYYY-MM-DD\")\ncti.store.variables.v_appointmentDate = newDisplayDate\ncti.store.variables.v_appointmentDateText = 'Today'\n\ncti.fn_load_appointments()\n\ncti.utils.updatePage()\n$success()"},"_auto_id_":"22cb2469-5c66-4712-86fe-47a48bef960a"}],"left-icon":"fa-calendar"},{"name":"button_tomorrow","type":"button","item-type":"button","_auto_id_":"5b0d3c41-ef09-4f01-a976-d07dfed18c53","content":"","theme":"minimal","expressions":{"disabled":"$store.variables.v_appointmentDateText == \"Tomorrow\""},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_tomorrow - page Visits', \n  'info'\n)\n\ncti.fn_toggle_spinner('open', 'Loading Tomorrow\\'s Appointment Data...')\n\nvar newDisplayDate = moment().add(1, 'days').format(\"YYYY-MM-DD\")\ncti.store.variables.v_appointmentDate = newDisplayDate\ncti.store.variables.v_appointmentDateText = 'Tomorrow'\n\ncti.fn_load_appointments()\n\ncti.utils.updatePage()\n$success()"},"_auto_id_":"9b78dd32-0fcb-4d81-8f83-2cb445b098e7","actions":[]}],"right-icon":"fa-arrow-circle-o-right"}],"expressions":{}}],"expressions":{}},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"row_no_appointments","type":"area","item-type":"row","_auto_id_":"5fd9f64d-a6d8-4405-b9f3-bf4572db3e49","content":[{"name":"html_no_appointments","type":"content","item-type":"html","_auto_id_":"9709fc88-c626-480e-b22e-72b52a64def0","content":"<div id=\"no-appointment\">No appointments</h3>","expressions":{"show":"$store.variables.v_selectedDayAppointments.length == 0;"}}],"expressions":{"show":"$store.variables.v_selectedDayAppointments.length == 0;"}},{"name":"list_visits","type":"content","item-type":"list","_auto_id_":"4842b5b6-e456-4892-8f25-2f8012ece499","search":"","classes":"","expressions":{"show":"$store.variables.orientation == 'landscape' || $store.variables.visit_list_view_mode == 'list'"},"model":"$store.variables.v_selectedDayAppointments","theme":"bootstrap","actions":[],"dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"name":"group_visit","type":"area","item-type":"group","_auto_id_":"48b3fc87-e73e-49f3-a901-a2bd2a57a918","content":[{"type":"content","item-type":"html","name":"list_visits_html","_auto_id_":"65b3fc79-73a4-4031-83e8-165a86270403","content":"<div onclick=\"cti.fn_toggle_visit_menu(this.id)\" id=\"{{$data}}\">\n  <div class=\"appointmentPinContainer {{$data.$item.status}}\">\n    <div class=\"pin\">{{$data.$item.index + 1}}</div>\n  </div>\n  <div class=\"listheading patientName\" id=\"collapsible-row-{{$data.$item.$index}}\">{{$data.$item.displayName}}</div>\n  <div class=\"nhsNumber\">NHS No. {{$data.$item.nhsNumFormatted}}</div>\n  <div class=\"subtle appointmentType\" id=\"collapsible-row-{{$data.$item.$index}}\">{{$data.$item.appointmentType.value}}</div>  <div class=\"appointmentTime\">{{$data.$item.shortTime}} - {{$data.$item.shortEndTime}}</div>\n  </div>\n</div>","expressions":{},"classes":"row-collapsed instant"},{"name":"group_row_buttons","type":"area","item-type":"group","_auto_id_":"2426fbee-7a6b-4a2a-99c4-bad6fe45ff5d","content":[{"name":"button_eta","type":"button","item-type":"button","_auto_id_":"dda01352-aaa6-419e-9074-aa377d76f64c","content":"Send ETA","theme":"default","expressions":{"show":"0"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_eta - page Visits', \n  'info'\n);\n\ncti.store.variables.v_selectedRowIndex = $data.$index;\n\nif($store.variables.appointments[$store.variables.v_selectedRowIndex].patientData.demographics.mobilePhoneNumber === undefined){\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Mobile Number Unavailable\", \n    \"text\" : \"The patient does not have a mobile phone number on record.\"\n  });\n} else {\n  cti.store.pages.Visits.txtEtaMessage = \"Estimated Time of Arrival is \" + cti.store.variables.appointments[$data.$index].appointmentEta; \n  $success();\n}"},"_auto_id_":"22db0330-01b7-4829-8b84-87591dda8244","actions":[]},{"event":"click","type":"call-component-function","data":{"page":"Visits","componentInstanceId":"1b59cf67-5dcf-4c48-8edd-6412937642aa","function":"toggle","params":{"containerid":"scrollable"}},"_auto_id_":"d1f42650-ca14-43b5-80a8-4428a327fa17"}],"classes":""},{"name":"button_call","type":"button","item-type":"button","_auto_id_":"4a16aef3-9fee-4a43-9ff9-33ecee299e03","content":"Call","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_call - page Visits', \n  'info'\n)\n\ncti.store.variables.v_selectedRowIndex = $data.$index\n$success()"},"_auto_id_":"7b65c3e9-3220-40cc-aad1-c8486ec43f8b","actions":[]},{"event":"click","type":"call-component-function","data":{"page":"Visits","componentInstanceId":"80c0444b-ee59-41fa-b77b-ce766a9303e3","function":"toggle","params":{"containerid":"scrollable"}},"_auto_id_":"d54c27bc-9e77-4930-80ae-3b53f193c02a"}]},{"name":"button_navigate","type":"button","item-type":"button","_auto_id_":"d47231d5-1cb8-45cf-a86d-9e3ca3564008","content":"Navigate","theme":"default","expressions":{},"classes":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_navigate - page Visits', \n  'info'\n)\n\ncti.fn_navigate($data.$item.postCode)"},"_auto_id_":"4923c521-3a34-4080-9c79-61f7848d0d2f"}]}],"repeat":false,"expressions":{},"classes":"group_row_buttons"},{"name":"button_open","type":"button","item-type":"button","_auto_id_":"8a4bad71-fef5-4923-a2ae-b0c72e766b71","content":"","theme":"minimal","right-icon":"fa-chevron-right","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_open - page Visits', \n  'info'\n)\n\ncti.fn_toggle_spinner('open', 'Loading Appointment...')\n\n// Check our orientation view\ncti.store.variables.visit_view_mode = 'Menu'\n\n// Set our selected_visit variables\ncti.store.variables.selected_visit = {\n  appointmentId : $data.$item.appointmentId,\n  nhsNumFormatted : $data.$item.nhsNumFormatted,\n  displayName : $data.$item.displayName\n}\n\n// Load appointments from pouch\nwindow.pouchManager.loadFromDatabase('appointments', function (doc) {\n  var appointments = doc.data\n  \n  var visitObj = JSON.parse(JSON.stringify(cti.store.variables.selected_visit))\n\n  // On a successful match append the patientData to the selected_visit\n  for(var i in appointments) {\n    if(appointments[i].appointmentId == cti.store.variables.selected_visit.appointmentId) {\n      cti.store.variables.selected_visit = appointments[i]\n      break\n    }\n  }\n  \n  cti.store.variables.selected_visit.displayName = visitObj.displayName\n  cti.store.variables.selected_visit.nhsNumFormatted = visitObj.nhsNumFormatted\n  \n  // Prepare the timeline and form variables\n  cti.fn_prep_timeline()\n  cti.fn_prep_forms(cti.store.variables.selected_visit)\n  \n  // Clear down all appointment stacks\n  delete cti.store.variables.v_selectedDayAppointments\n  delete cti.store.variables.v_appointments\n  \n  // Navigate to the Visit page\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Visit\"})\n  cti.fn_toggle_spinner('close')\n}, function (reason, err) {\n  window.logManager.consoleLog(\n    'Pouch DB: Failed retriveing Appointments Data from Pouch - ' + reason + err, \n    'info'\n  )\n  cti.fn_toggle_spinner('close')\n})"},"_auto_id_":"930f848c-6d99-48c5-b60c-ae6fcd8d6280"}],"classes":"button_open"}],"repeat":false,"expressions":{},"classes":"row-collapsed instant"}],"autoscroll":false,"searchFunctionExternal":""},{"name":"html_map_container","type":"content","item-type":"html","_auto_id_":"04139baa-3678-4c93-a46e-ec557c6969ad","content":"<div class=\"container-fluid\">\n    <div class=\"row\">\n      <div id=\"mapcontainer\" class=\"col-xs-12\">\n        <div id=\"layersmap\" class=\"embed-responsive\"></div>\n      </div>\n    </div>\n</div>","expressions":{"show":"$store.variables.orientation == 'landscape' || $store.variables.visit_list_view_mode == 'map'"}},{"name":"popupCall","type":"component","item-type":"web-component","content":[{"name":"html_call","type":"content","item-type":"html","_auto_id_":"eaf61f8f-54e3-414d-a5e7-f7f164fa3d27","content":"<h4>Call Patient</h4>\n<!--<p>Use one of the available contact numbers below</p>-->","expressions":{}},{"name":"html_no_numbers","type":"content","item-type":"html","_auto_id_":"63b4d8fb-685d-4188-89ae-340e0a34bff4","content":"<p>There are currently no valid contact numbers for this patient.</p>","expressions":{"show":"$store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].mobilePhoneNumber == undefined && $store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].officePhoneNumber == undefined && $store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].eveningPhoneNumber == undefined"}},{"name":"button_bar_mobile","type":"area","item-type":"button-bar","_auto_id_":"0997b133-34da-4a64-a8fb-081f025e2620","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_call_mobile","type":"button","item-type":"button","_auto_id_":"3d6f1caf-130e-4624-beed-802fd50deb7d","content":"Mobile - {{'$store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].mobilePhoneNumber' | store}}","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_call_mobile - page Visits', \n  'info'\n)\n\nvar mobilePhoneNumber = cti.store.variables.v_selectedDayAppointments[cti.store.variables.v_selectedRowIndex].mobilePhoneNumber\n\nif(window) {\n  window.open('tel:141'+mobilePhoneNumber.replace(/\\\\s/g,''),'_system')\n} else {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning\", \n    \"text\" : \"Cordova is not currently installed, so you may not be running the application on a mobile device.\"\n  })\n}\n\n$success()"},"_auto_id_":"23e58145-d707-4555-980a-6f78c95bc1a9"},{"event":"click","type":"call-component-function","data":{"page":"Visits","componentInstanceId":"80c0444b-ee59-41fa-b77b-ce766a9303e3","function":"toggle"},"_auto_id_":"5596121a-244a-4f1f-b468-01cfb8b8b736"}],"expressions":{"show":"$store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].mobilePhoneNumber !== undefined"},"classes":""}],"expressions":{"show":"$store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].mobilePhoneNumber !== undefined"}},{"name":"button_bar_evening","type":"area","item-type":"button-bar","_auto_id_":"4caf6100-0635-4995-8882-d154698fbbef","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_call_evening","type":"button","item-type":"button","_auto_id_":"b0ffe54f-6fd8-4dc3-8207-52cd6c9dcf32","content":"Evening - {{'$store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].eveningPhoneNumber' | store}}","theme":"default","expressions":{"show":"$store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].eveningPhoneNumber !== undefined"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_call_evening - page Visits', \n  'info'\n)\n\nvar eveningPhoneNumber = cti.store.variables.v_selectedDayAppointments[cti.store.variables.v_selectedRowIndex].eveningPhoneNumber\n\nif(window) {\n  window.open('tel:141'+eveningPhoneNumber.replace(/\\\\s/g,''),'_system')\n} else {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning\", \n    \"text\" : \"Cordova is not currently installed, so you may not be running the application on a mobile device.\"\n  })\n}\n\n$success()"},"_auto_id_":"1845d5a6-1101-4fcc-878a-16f6a3b966b8"},{"event":"click","type":"call-component-function","data":{"page":"Visits","componentInstanceId":"80c0444b-ee59-41fa-b77b-ce766a9303e3","function":"toggle","params":{"containerid":"scrollable"}},"_auto_id_":"43a184fa-25e6-4361-8b75-780aeac2fbae"}]}],"expressions":{"show":"$store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].eveningPhoneNumber !== undefined"}},{"name":"button_bar_office","type":"area","item-type":"button-bar","_auto_id_":"88a7b4e8-d1e7-4ad2-8015-608db5c93a3c","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_call_office","type":"button","item-type":"button","_auto_id_":"39401e70-e853-483b-9269-30193a923ae7","content":"Office - {{'$store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].officePhoneNumber' | store}}","theme":"default","expressions":{"show":"$store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].officePhoneNumber !== undefined"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_call_office - page Visits', \n  'info'\n)\n\nvar officePhoneNumber = cti.store.variables.v_selectedDayAppointments[cti.store.variables.v_selectedRowIndex].officePhoneNumber\n\nif(window) {\n  window.open('tel:141'+officePhoneNumber.replace(/\\\\s/g,''),'_system')\n} else {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning\", \n    \"text\" : \"Cordova is not currently installed, so you may not be running the application on a mobile device.\"\n  })\n}\n\n$success()"},"_auto_id_":"9c8e8fb5-4fcc-4a6c-93d5-1b9e2fdb4d5a"},{"event":"click","type":"call-component-function","data":{"page":"Visits","componentInstanceId":"80c0444b-ee59-41fa-b77b-ce766a9303e3","function":"toggle","params":{"containerid":"scrollable"}},"_auto_id_":"f64cfa6e-a2bc-48b0-a954-197b176efad0"}]}],"expressions":{"show":"$store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].officePhoneNumber !== undefined"}},{"name":"button_bar_call","type":"area","item-type":"button-bar","_auto_id_":"a81c4c69-c84a-4939-b5b7-0b9c84357593","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_cancel_call","type":"button","item-type":"button","_auto_id_":"c52fb70f-7c08-49ed-a73c-d66c82da4b5d","content":"CANCEL","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Visits","componentInstanceId":"80c0444b-ee59-41fa-b77b-ce766a9303e3","function":"toggle","params":{"containerid":"scrollable"}},"_auto_id_":"81b4c390-33d3-49e7-a1b8-808eb2598da4"}],"classes":"default"}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"80c0444b-ee59-41fa-b77b-ce766a9303e3","attributes":{"id":"popupCall"},"expressions":{}}],"_auto_id_":"ff4c2e02-f136-4e72-bc47-d734af2be8b8","expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_list","type":"button","item-type":"button","_auto_id_":"b08bf7fb-1cf2-46fa-8a60-4903c2ffed11","content":"LIST VIEW","theme":"default","actions":[{"event":"click","type":"set-variable","data":{"name":"visit_list_view_mode","value":"list"},"_auto_id_":"2046efe8-0be6-4259-b91f-d3ce6f585394"}],"expressions":{}},{"name":"button_map","type":"button","item-type":"button","_auto_id_":"5b89521f-0af7-4c32-9bbc-2f6e704fdbee","content":"MAP VIEW","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_map - page Visits', \n  'info'\n)\n\ncti.store.variables.visit_list_view_mode = \"map\"\n$success()"},"_auto_id_":"420fd3c4-7c9a-40c9-a6c7-f975022cdef1"},{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_map - page Visits', \n  'info'\n)\n\nsetTimeout(function(){\n  var center = window.mymap.getCenter()\n  var zoom = window.mymap.getZoom()\n  \n  if(screen.width <= 360) { zoom = 10 }\n  if(screen.width > 360 && screen.width <= 768) { zoom = 12 }\n  else { zoom = 11 }\n  \n  google.maps.event.trigger(window.mymap, \"resize\")\n  window.mymap.setCenter(center)\n  window.mymap.setZoom(zoom == 0 ? 8 : zoom)\n}, 500)\n\n$success()"},"_auto_id_":"72ff7915-9efe-4b0c-9c64-44a32d4c82c2"}],"expressions":{}}],"_auto_id_":"979c8b12-32cb-4386-b8c1-590472a00d0c","expressions":{}}]},{"start":false,"name":"Visit","config":[{"name":"Page Loaded Event","type":"event","item-type":"onpageloaded","_auto_id_":"dd295370-5c41-4ce5-805d-cd0b0a952891","actions":[{"event":"onpageloaded","type":"inline-function","data":{"sync":true,"code":"// Clear down checks: To avoid displaying the cleared down page, clear it here\nif(cti.store.variables.v_progressNoteToAdd_clear) {\n  delete cti.store.variables.v_progressNoteToAdd_clear\n  if(cti.store.media && cti.store.media.btnPhoto) {\n    cti.store.media.btnPhoto.images = []\n  }\n  delete cti.store.variables.note\n  delete cti.store.variables.uiSubNoteTypes\n  cti.utils.destroyPageData('Note')\n}\nif(cti.store.variables.v_alertToAdd_clear) {\n  delete cti.store.variables.v_alertToAdd_clear;\n  cti.utils.destroyPageData('Alert');\n}\nif(cti.store.variables.v_alertToRemove_clear) {\n  delete cti.store.variables.v_alertToRemove_clear;\n  delete cti.store.variables.alerts\n  cti.utils.destroyPageData('RemoveAlert');\n}\nif(cti.store.variables.v_teamplannerToAdd_clear) {\n  delete cti.store.variables.v_teamplannerToAdd_clear;\n  cti.utils.destroyPageData('Team_Planner');\n}\nif(cti.store.variables.v_appointmentToAdd_clear) {\n  delete cti.store.variables.v_appointmentToAdd_clear\n  cti.utils.destroyPageData('HCP_Diary');\n}\nif(cti.store.variables.v_submitOutcome_clear) {\n  delete cti.store.variables.v_submitOutcome_clear;\n  cti.utils.destroyPageData('Outcome');\n}\nif(cti.store.variables.v_submitDialogFormPayload_clear) {\n  delete cti.store.variables.v_submitDialogFormPayload_clear\n  cti.utils.destroyPageData('DialogFormPre')\n  cti.utils.destroyPageData('DialogFormOne')\n  cti.utils.destroyPageData('DialogFormTwo')\n  cti.utils.destroyPageData('DialogFormThree')\n  cti.utils.destroyPageData('DialogFormFour')\n  cti.utils.destroyPageData('DialogFormFive')\n  cti.utils.destroyPageData('DialogFormSix')\n  cti.utils.destroyPageData('DialogFormSeven')\n  cti.utils.destroyPageData('DialogFormEight')\n  cti.utils.destroyPageData('DialogFormNine')\n  cti.utils.destroyPageData('DialogFormTen')\n  cti.utils.destroyPageData('DialogFormEleven')\n  cti.utils.destroyPageData('DialogFormTwelve')\n  cti.utils.destroyPageData('DialogFormThirteen')\n  cti.utils.destroyPageData('DialogFormFourteen')\n}\nif(cti.store.variables.v_submitSafetyFormPayload_clear) {\n  delete cti.store.variables.v_submitSafetyFormPayload_clear\n  cti.utils.destroyPageData('SafetyForm')\n}\nif(cti.store.variables.v_submitlifestyleFormPayload_clear) {\n  delete cti.store.variables.v_submitlifestyleFormPayload_clear\n  cti.utils.destroyPageData('LifestyleFormOne')\n  cti.utils.destroyPageData('LifestyleFormTwo')\n  cti.utils.destroyPageData('LifestyleFormThree')\n  cti.utils.destroyPageData('LifestyleFormFour')\n  cti.utils.destroyPageData('LifestyleFormFive')\n  cti.utils.destroyPageData('LifestyleFormSix')\n  cti.store.repeater.LifestyleFormThree = {}\n  cti.store.repeater.LifestyleFormFive = {}\n}\nif(cti.store.variables.lifeStyleForm_View_clear) {\n  delete cti.store.variables.lifeStyleForm_View_clear\n  delete cti.store.variables.v_lifestyleForms\n  delete cti.store.variables.lifestyleHideFlags\n  cti.utils.destroyPageData('LifestyleForm_View')\n}\nif(cti.store.variables.dialogForm_View_clear) {\n  delete cti.store.variables.dialogForm_View_clear\n  delete cti.store.variables.v_dialogForms\n  delete cti.store.variables.dialogHideFlags\n  cti.utils.destroyPageData('DialogForm_View')\n}\nif(cti.store.variables.safetyForm_View_clear) {\n  delete cti.store.variables.safetyForm_View_clear\n  delete cti.store.variables.v_safetyForms\n  cti.utils.destroyPageData('SafetyForm_View')\n}\n\nif(cti.store.variables.visit_view_mode == \"Patient Demographics\") {\n  delete cti.store.variables.selected_visit.patientData.patient\n} else if(cti.store.variables.visit_view_mode == \"Alerts\") {\n  delete cti.store.variables.selected_visit.patientData.displayAlerts\n}\n\ncti.store.variables.visit_view_mode = \"Menu\"\n$success()"},"_auto_id_":"e8a966eb-7f7e-407c-9e37-d20391c8a37f","actions":[]}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"495f4883-ae58-40dd-8ea0-9ca028ae13ea","content":"","theme":"minimal","left-icon":"fa-home","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_back - page Visit', \n  'info'\n)\n\ncti.fn_save_appointment()"},"_auto_id_":"6f206d2d-301a-42fa-9652-f31a80e6327c"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Patient Summary</h4>","_auto_id_":"b387b333-5787-45db-8d2f-2bdf3db8dc0f"},{"name":"button_menu","type":"button","item-type":"button","_auto_id_":"b7e10801-894a-4a63-afa2-942ced4f8027","content":"","theme":"minimal","expressions":{},"left-icon":"fa-bars","actions":[{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"6d19a3c7-8376-455f-a48f-a509df9ebc3a","function":"toggle"},"_auto_id_":"dfa7ecc7-24a5-452b-a273-050841d7e922"}]},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"1556ae38-2e09-47e3-8db1-4295824f03f6","attributes":{},"expressions":{}},{"name":"ct_context_menu","type":"component","item-type":"web-component","content":[{"name":"button_logout","type":"button","item-type":"button","_auto_id_":"8fe1ea84-3d97-46cd-a98f-4ec3a24d9573","content":"Logout","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"Login","isConditional":false},"_auto_id_":"1e280b88-ab30-41a6-9304-ded49c132db2"}],"expressions":{}},{"name":"button_bar_menu","type":"area","item-type":"button-bar","_auto_id_":"8a32bee1-d820-488c-acf7-cbed2693abc3","extends":{"type":"area","item-type":"row"},"content":[{"name":"html_menu_version","type":"content","item-type":"html","_auto_id_":"a14f9ef2-ae9d-4ee7-b6d8-dda319124005","content":"Version {{'$store.schema.version' | store}}","expressions":{}}],"expressions":{}}],"componentId":"1fa0aab1-7b03-413d-b3e0-433405059753","_auto_id_":"6d19a3c7-8376-455f-a48f-a509df9ebc3a","attributes":{"Direction":"right","Overlay":true},"expressions":{},"actions":[]}],"_auto_id_":"d31270e8-8cfa-43e2-b195-4566f1854265","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"c154bfac-abaa-495a-b685-49c2182207b4","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"ecdf6a96-3f19-43e4-9fe6-096e962515f7","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"3ecc9b9f-141f-4ac0-8266-295b0bb57d44","content":"{{'$store.variables.selected_visit.appointmentType.value + \" (\" + $store.variables.selected_visit.shortTime + \" - \" + $store.variables.selected_visit.shortEndTime + \")\"'|store}}","theme":"minimal","expressions":{},"actions":[{"event":"click","type":"set-variable","data":{"name":"visit_view_mode","value":"Menu"},"_auto_id_":"05c2a15a-b9ba-4fe7-9da0-3a5009d2d6fd"}],"classes":""},{"name":"popupWarning","type":"component","item-type":"web-component","content":[{"name":"html_warning","type":"content","item-type":"html","_auto_id_":"52bfc3e4-a7e2-41bf-9e93-567e68bf9f3f","content":"<h3 style=\"color:black\">Warning: Outstanding Form Data</h3>\n<p style=\"color:black\">The following forms have either outstanding data or have failed to send to RiO: {{'$store.variables.formStatus' | store}}. If you continue then this information will be lost.</p>\n<p style=\"color:black\">Do you want to continue? </p>","expressions":{}},{"name":"button_bar_yesno","type":"area","item-type":"button-bar","_auto_id_":"5c2db082-74ce-48b5-bb9d-f55d468eb232","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_yes","type":"button","item-type":"button","_auto_id_":"a0dd73fa-432e-4b5f-8552-2755c4267e29","content":"YES","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"delete cti.store.variables.formStatus\ncti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n$success()"},"_auto_id_":"579fae38-6534-4fae-b3fe-96a69a75a2ed"},{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"1a81bb93-2844-48a1-a881-e41756ea0b67","function":"toggle"},"_auto_id_":"955ee78c-fc35-4eb3-99d1-b330281e4635"}],"classes":"default"},{"name":"button_no","type":"button","item-type":"button","_auto_id_":"84e17387-f701-4419-b7ec-a49d4ba669f8","content":"NO","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"1a81bb93-2844-48a1-a881-e41756ea0b67","function":"toggle"},"_auto_id_":"1d9098f4-e4e4-467e-81f9-d44b5eca7952"}]}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"1a81bb93-2844-48a1-a881-e41756ea0b67","attributes":{"id":"popupWarning"},"expressions":{}}],"expressions":{},"classes":"relative"},{"name":"scrollable_menu","type":"area","item-type":"scrollable","content":[{"name":"group_tasks","type":"area","item-type":"group","_auto_id_":"5af178d7-f16d-4f5d-99ec-280ef4e871ca","content":[{"name":"html_dialog","type":"content","item-type":"html","_auto_id_":"7a2ae6c7-cacd-4780-a3ea-deb133ddfc59","content":"<div onclick=\"cti.fn_load_form('dialogplus')\">\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon dialog\"></div>\n    <div class=\"{{'$store.variables.selected_visit.dialog_form_status' | store}}\">\n      <h5>Dialog+</h5>\n      <i class=\"arrow fa fa-chevron-right {{'$store.variables.selected_visit.dialog_form_status != \\'notcomplete\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <i class=\"arrow fa fa-hourglass-half {{'$store.variables.selected_visit.dialog_form_status != \\'inprogress\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <i class=\"arrow fa fa-check {{'$store.variables.selected_visit.dialog_form_status != \\'complete\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <i class=\"arrow fa fa-refresh {{'$store.variables.selected_visit.dialog_form_status != \\'failed\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <i class=\"arrow fa fa-file-text-o {{'$store.variables.selected_visit.dialog_form_status != \\'outcomed\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <div class=\"subtle {{'$store.variables.selected_visit.dialog_form_status' | store}}\">{{'$store.variables.selected_visit.dialog_form_status_text' | store}}\n        <span style=\"opacity:0.5\" class=\"{{'$store.variables.selected_visit.patientData.dialogPlusForms.length > 0 && $store.variables.selected_visit.dialog_form_status == \\'outcomed\\' ? \\'\\' : \\'display-none\\'' | store}}\">, Last {{'$store.variables.selected_visit.patientData.dialogPlusForms[0].assessmentDate.displayDate' | store}}\n        </span>\n      </div>\n    </div>\n  </div>\n</div>","expressions":{"show":"$store.variables.selected_visit.dialog_form"}},{"name":"html_lifestyle","type":"content","item-type":"html","_auto_id_":"181be314-540b-40a3-8ec7-e6d8fa2a9cc3","content":"<div onclick=\"cti.fn_load_form('phlifestyl')\">\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon lifestyle\"></div>\n    <div class=\"{{'$store.variables.selected_visit.lifestyle_form_status' | store}}\">\n      <h5>Lifestyle</h5>\n      <i class=\"arrow fa fa-chevron-right {{'$store.variables.selected_visit.lifestyle_form_status != \\'notcomplete\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <i class=\"arrow fa fa-hourglass-half {{'$store.variables.selected_visit.lifestyle_form_status != \\'inprogress\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <i class=\"arrow fa fa-check {{'$store.variables.selected_visit.lifestyle_form_status != \\'complete\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <i class=\"arrow fa fa-refresh {{'$store.variables.selected_visit.lifestyle_form_status != \\'failed\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <i class=\"arrow fa fa-file-text-o {{'$store.variables.selected_visit.lifestyle_form_status != \\'outcomed\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <div class=\"subtle {{'$store.variables.selected_visit.lifestyle_form_status' | store}}\">{{'$store.variables.selected_visit.lifestyle_form_status_text' | store}}\n        <span style=\"opacity:0.5\" class=\"{{'$store.variables.selected_visit.patientData.lifestyleAssessmentForms.length > 0 && $store.variables.selected_visit.lifestyle_form_status == \\'outcomed\\' ? \\'\\' : \\'display-none\\'' | store}}\">, Last {{'$store.variables.selected_visit.patientData.lifestyleAssessmentForms[0].assessmentDate.displayDate' | store}}\n        </span>\n      </div>\n    </div>\n  </div>\n</div>","expressions":{"show":"$store.variables.selected_visit.lifestyle_form"}},{"name":"html_safety","type":"content","item-type":"html","_auto_id_":"e27fc242-a72e-4683-ad96-3067182ce3cb","content":"<div onclick=\"cti.fn_load_form('msp')\">\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon safety\"></div>\n    <div class=\"{{'$store.variables.selected_visit.safety_form_status' | store}}\">\n      <h5>My Safety Plan</h5>\n      <i class=\"arrow fa fa-chevron-right {{'$store.variables.selected_visit.safety_form_status != \\'notcomplete\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <i class=\"arrow fa fa-hourglass-half {{'$store.variables.selected_visit.safety_form_status != \\'inprogress\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <i class=\"arrow fa fa-check {{'$store.variables.selected_visit.safety_form_status != \\'complete\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <i class=\"arrow fa fa-refresh {{'$store.variables.selected_visit.safety_form_status != \\'failed\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <i class=\"arrow fa fa-file-text-o {{'$store.variables.selected_visit.safety_form_status != \\'outcomed\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <div class=\"subtle {{'$store.variables.selected_visit.safety_form_status' | store}}\">{{'$store.variables.selected_visit.safety_form_status_text' | store}}\n        <span style=\"opacity:0.5\" class=\"{{'$store.variables.selected_visit.patientData.mySafetyPlanForms.length > 0 && $store.variables.selected_visit.safety_form_status == \\'outcomed\\' ? \\'\\' : \\'display-none\\'' | store}}\">, Last {{'$store.variables.selected_visit.patientData.mySafetyPlanForms[0].assessmentDate.displayDate' | store}}\n        </span>\n      </div>\n    </div>\n  </div>\n</div>","expressions":{"show":"$store.variables.selected_visit.safety_form"}},{"name":"html_noforms","type":"content","item-type":"html","_auto_id_":"7d573e08-320c-4630-bb41-28cc34af54d4","content":"<div>\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon task\"></div>\n    <div class=\"complete\">\n      <h5>No Forms to Complete for this Visit</h5>\n      <div class=\"subtle\">Not Applicable</div>\n    </div>\n  </div>\n</div>","expressions":{"show":"$store.variables.selected_visit.dialog_form === false && $store.variables.selected_visit.lifestyle_form === false && $store.variables.selected_visit.safety_form === false"}},{"name":"html_patient_record_head","type":"content","item-type":"html","_auto_id_":"d00640ef-415f-4a47-a669-5e33df09d592","content":"Patient Record","expressions":{}}],"repeat":false,"expressions":{}},{"name":"html_button_timeline","type":"content","item-type":"html","_auto_id_":"3cf09456-6589-4ccc-8454-2651b81f3773","content":"<div onclick='cti.utils.callAction(\"call-function\", {\"name\":\"fn_set_view\",\"params\":{\"view_name\":\"Timeline\"}});'>\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon timeline\"></div>\n    <div>\n      <h5>Timeline</h5>\n      <i class=\"arrow fa fa-chevron-right\" aria-hidden=\"true\"></i>\n      <div class=\"subtle\">{{'$store.variables.timeline.length' | store}} Events</div>\n    </div>\n  </div>\n</div>","expressions":{}},{"name":"html_button_patient","type":"content","item-type":"html","_auto_id_":"95a15968-6f86-47e9-970b-05e81e853ff4","content":"<div onclick='cti.utils.callAction(\"call-function\", {\"name\":\"fn_set_view\",\"params\":{\"view_name\":\"Patient Demographics\"}});'>\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon patient\"></div>\n    <div>\n      <h5>Demographics</h5>\n      <i class=\"arrow fa fa-chevron-right\" aria-hidden=\"true\"></i>\n      <div class=\"subtle\">{{'$store.variables.selected_visit.displayName'|store}}</div>\n    </div>\n  </div>\n</div>","expressions":{}},{"name":"html_button_alerts","type":"content","item-type":"html","_auto_id_":"12cf7bd2-9d77-49c9-b3ce-63b90b4c13a0","content":"<div onclick='cti.utils.callAction(\"call-function\", {\"name\":\"fn_set_view\",\"params\":{\"view_name\":\"Alerts\",\"manual_filter\":\"true\"}});' class=\"{{'$store.variables.selected_visit.hasAlerts == true ? \\'hasAlerts\\' : \\'\\'' |store }}\">\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon alerts-added\"></div>\n    <div>\n      <h5>Alerts</h5>\n      <i class=\"arrow fa fa-chevron-right\" aria-hidden=\"true\"></i>\n      <div class=\"subtle\">{{'$store.variables.selected_visit.openAlerts' | store}} Alerts\n        <span style=\"opacity:0.5\" class=\"{{'$store.variables.selected_visit.hasAlerts == false ? \\'display-none\\' : \\'\\'' | store}}\">, Last {{'$store.variables.selected_visit.patientData.alerts[0].date' | store | date:'d MMM y HH:mm'}}\n        </span>\n    </div>\n  </div>\n</div>","expressions":{}},{"name":"html_button_appointments","type":"content","item-type":"html","_auto_id_":"e2d4baca-f9a6-4630-a959-9f76c6921c64","content":"<div onclick='cti.utils.callAction(\"call-function\", {\"name\":\"fn_set_view\",\"params\":{\"view_name\":\"Appointments\"}});'>\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon appointments\"></div>\n    <div>\n      <h5>Appointments</h5>\n      <i class=\"arrow fa fa-chevron-right\" aria-hidden=\"true\"></i>\n      <div class=\"subtle\">{{'$store.variables.selected_visit.patientData.appointmentHistory.length' | store}} Appointments\n        <span style=\"opacity:0.5\" class=\"{{'$store.variables.selected_visit.patientData.appointmentHistory.length == 0 ? \\'display-none\\' : \\'\\'' | store}}\">, Last {{'$store.variables.selected_visit.patientData.appointmentHistory[0].date' | store | date:'d MMM y HH:mm'}}\n        </span>\n    </div>\n  </div>\n</div>","expressions":{}},{"name":"html_button_referrals","type":"content","item-type":"html","_auto_id_":"28a7a0ba-11d9-448f-995a-444a4820a4a3","content":"<div onclick='cti.utils.callAction(\"call-function\", {\"name\":\"fn_set_view\",\"params\":{\"view_name\":\"Referrals\"}});'>\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon referral\"></div>\n    <div>\n      <h5>Referrals</h5>\n      <i class=\"arrow fa fa-chevron-right\" aria-hidden=\"true\"></i>\n      <div class=\"subtle\">{{'$store.variables.selected_visit.patientData.referrals.length' | store}} Referrals\n        <span style=\"opacity:0.5\" class=\"{{'$store.variables.selected_visit.patientData.referrals.length == 0 ? \\'display-none\\' : \\'\\'' | store}}\">, Last {{'$store.variables.selected_visit.patientData.referrals[0].referralDate' | store | date:'d MMM y HH:mm'}}\n        </span>\n    </div>\n  </div>\n</div>","expressions":{}},{"name":"html_button_dialog","type":"content","item-type":"html","_auto_id_":"f1660403-e71a-47ae-974c-63c234890155","content":"<div onclick=\"cti.fn_view_dialog(false)\">\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon dialog\"></div>\n    <div>\n      <h5>Dialog+ Forms</h5>\n      <i class=\"arrow fa fa-chevron-right\" aria-hidden=\"true\"></i>\n      <div class=\"subtle\">{{'$store.variables.selected_visit.patientData.dialogPlusForms.length'|store}} Forms\n        <span style=\"opacity:0.5\" class=\"{{'$store.variables.selected_visit.patientData.dialogPlusForms.length == 0 ? \\'display-none\\' : \\'\\'' | store}}\">, Last {{'$store.variables.selected_visit.patientData.dialogPlusForms[0].assessmentDate.displayDate' | store}}\n        </span>\n    </div>\n  </div>\n</div>","expressions":{}},{"name":"html_button_lifestyle","type":"content","item-type":"html","_auto_id_":"6dee6b5f-9c0c-4695-a969-19737c3fb1a8","content":"<div onclick=\"cti.fn_view_lifestyle(false)\">\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon lifestyle\"></div>\n    <div>\n      <h5>Lifesyle Assessment Forms</h5>\n      <i class=\"arrow fa fa-chevron-right\" aria-hidden=\"true\"></i>\n      <div class=\"subtle\">{{'$store.variables.selected_visit.patientData.lifestyleAssessmentForms.length'|store}} Forms\n        <span style=\"opacity:0.5\" class=\"{{'$store.variables.selected_visit.patientData.lifestyleAssessmentForms.length == 0 ? \\'display-none\\' : \\'\\'' | store}}\">, Last {{'$store.variables.selected_visit.patientData.lifestyleAssessmentForms[0].assessmentDate.displayDate' | store}}\n        </span>\n    </div>\n  </div>\n</div>","expressions":{}},{"name":"html_button_safety","type":"content","item-type":"html","_auto_id_":"9eb41e27-c4e2-4bbc-968a-b2d1700cc781","content":"<div onclick=\"cti.fn_view_safety(false)\">\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon safety\"></div>\n    <div>\n      <h5>My Safety Plan Forms</h5>\n      <i class=\"arrow fa fa-chevron-right\" aria-hidden=\"true\"></i>\n      <div class=\"subtle\">{{'$store.variables.selected_visit.patientData.mySafetyPlanForms.length'|store}} Forms\n        <span style=\"opacity:0.5\" class=\"{{'$store.variables.selected_visit.patientData.mySafetyPlanForms.length == 0 ? \\'display-none\\' : \\'\\'' | store}}\">, Last {{'$store.variables.selected_visit.patientData.mySafetyPlanForms[0].assessmentDate.displayDate' | store}}\n        </span>\n    </div>\n  </div>\n</div>","expressions":{}},{"name":"html_button_progress_note","type":"content","item-type":"html","_auto_id_":"5f711f4d-51d3-4f05-bd47-d84f0df65602","content":"<div onclick='cti.utils.callAction(\"call-function\", {\"name\":\"fn_set_view\",\"params\":{\"view_name\":\"Progress Notes\"}});'>\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon notes\"></div>\n    <div>\n      <h5>Progress Notes</h5>\n      <i class=\"arrow fa fa-chevron-right\" aria-hidden=\"true\"></i>\n      <div class=\"subtle\">{{'$store.variables.selected_visit.patientData.progressNotes.length' | store}} Notes\n        <span style=\"opacity:0.5\" class=\"{{'$store.variables.selected_visit.patientData.progressNotes.length == 0 ? \\'display-none\\' : \\'\\'' | store}}\">, Last {{'$store.variables.selected_visit.patientData.progressNotes[0].dateTime' | store | date:'d MMM y HH:mm'}}\n        </span>\n      </div>\n    </div>\n  </div>\n</div>","expressions":{}},{"name":"html_button_documents","type":"content","item-type":"html","_auto_id_":"ed5cb934-9c78-496c-8cc3-6aa19be08c25","content":"<div onclick='cti.utils.callAction(\"call-function\", {\"name\":\"fn_set_view\",\"params\":{\"view_name\":\"Documents\"}});'>\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon documents\"></div>\n    <div>\n      <h5>Documents</h5>\n      <i class=\"arrow fa fa-chevron-right\" aria-hidden=\"true\"></i>\n      <div class=\"subtle\">{{'$store.variables.selected_visit.patientData.documents.length' | store}} Documents\n        <span style=\"opacity:0.5\" class=\"{{'$store.variables.selected_visit.patientData.documents.length == 0 ? \\'display-none\\' : \\'\\'' | store}}\">, Last {{'$store.variables.selected_visit.patientData.documents[0].documentDate' | store | date:'d MMM y HH:mm'}}\n        </span>\n      </div>\n    </div>\n  </div>\n</div>","expressions":{}},{"name":"html_button_allergies","type":"content","item-type":"html","_auto_id_":"74b6dcf6-3de7-4af9-9278-5a17ff6a8149","content":"<div onclick='cti.utils.callAction(\"call-function\", {\"name\":\"fn_set_view\",\"params\":{\"view_name\":\"Allergies\"}});'>\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon allergies\"></div>\n    <div>\n      <h5>Allergies</h5>\n      <i class=\"arrow fa fa-chevron-right\" aria-hidden=\"true\"></i>\n      <div class=\"subtle\">{{'$store.variables.selected_visit.patientData.allergies.length' | store}} Allergies\n        <span style=\"opacity:0.5\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length == 0 ? \\'display-none\\' : \\'\\'' | store}}\">, Last {{'$store.variables.selected_visit.patientData.allergies[0].dateTime' | store | date:'d MMM y'}}\n        </span>\n      </div>\n    </div>\n  </div>\n</div>","expressions":{}},{"name":"html_button_contacts","type":"content","item-type":"html","_auto_id_":"a0fd5dde-5301-4f46-b026-f468ec5af06b","content":"<div onclick='cti.utils.callAction(\"call-function\", {\"name\":\"fn_set_view\",\"params\":{\"view_name\":\"Contacts\"}});'>\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon contacts\"></div>\n    <div>\n      <h5>Contacts</h5>\n      <i class=\"arrow fa fa-chevron-right\" aria-hidden=\"true\"></i>\n      <div class=\"subtle\">{{'$store.variables.selected_visit.patientData.contacts.length' | store}} Contacts</div>\n    </div>\n  </div>\n</div>","expressions":{}}],"_auto_id_":"ab428813-0ad2-402f-a609-fc58a4c00e14","expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_start_visit","type":"button","item-type":"button","_auto_id_":"80c283cb-764f-4015-b9b2-9624c7936cf0","content":"START VISIT","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.selected_visit.arrivalTime = new Date()\ncti.store.variables.selected_visit.status = 'started'\ncti.utils.updatePage()"},"_auto_id_":"1a999863-7e4c-4d54-934d-594c462d2de5","actions":[]}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime == undefined && $store.variables.visit_view_mode != 'Appointments') && $store.variables.selected_visit.status != \"complete\""},"classes":"default"},{"name":"button_add_note","type":"button","item-type":"button","_auto_id_":"3d4a8938-2b3d-4918-acb8-83e706c2611e","content":"ADD NOTE","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') || $store.variables.selected_visit.status == \"complete\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Note","isConditional":false},"_auto_id_":"274b90b9-6705-4a28-9f49-896153bc2eb7"}]},{"name":"button_add_alert","type":"button","item-type":"button","_auto_id_":"c17af3d4-d8ea-4271-9032-02af2792ca04","content":"ADD ALERT","theme":"default","expressions":{"show":"$store.variables.selected_visit.arrivalTime != undefined && $store.variables.selected_visit.status != \"new\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Alert","isConditional":false},"_auto_id_":"0cc4ce77-fbe9-40e2-a742-d07bdf022c81"}]},{"name":"button_end_visit","type":"button","item-type":"button","_auto_id_":"d51a2646-b835-4fd4-8d25-494dcd2e058f","content":"END VISIT","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') && $store.variables.selected_visit.status != \"complete\""},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var dialog = cti.store.variables.selected_visit.dialog_form_status\nvar safety = cti.store.variables.selected_visit.safety_form_status\nvar lifestyle = cti.store.variables.selected_visit.lifestyle_form_status\n\ncti.store.variables.formStatus = undefined\ncti.store.variables.o_activities = []\n\nif(dialog == \"failed\" || dialog == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Dialog+\"\n  } else {\n    cti.store.variables.formStatus += \", Dialog+\"\n  }\n} else if(dialog == \"complete\") {\n  var dialogObj = {\n    group : undefined,\n    value : \"dialogplus\",\n    label : \"DIALOG+\"\n  }\n    \n  cti.store.variables.o_activities.push(dialogObj)\n}\n\nif(safety == \"failed\" || safety == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"My Safety Plan\"\n  } else {\n    cti.store.variables.formStatus += \", My Safety Plan\"\n  }\n} else if(safety == \"complete\") {\n  var safetyObj = {\n    group : undefined,\n    value : \"msp\",\n    label : \"My Safety Plan\"\n  }\n    \n  cti.store.variables.o_activities.push(safetyObj)\n}\n\nif(lifestyle == \"failed\" || lifestyle == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Lifestyle Assessment Form\"\n  } else {\n    cti.store.variables.formStatus += \", Lifestyle Assessment Form\"\n  }\n} else if(lifestyle == \"complete\") {\n  var lifestyleObj = {\n    group : undefined,\n    value : \"phlifestyl\",\n    label : \"Lifestyle Assessment Form\"\n  }\n    \n  cti.store.variables.o_activities.push(lifestyleObj)\n}\n\nif(cti.store.variables.formStatus == undefined) {\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n} else {\n  $success()\n}"},"_auto_id_":"3a2971c4-b961-497f-acf6-1caeee7c9b2c","actions":[{"event":"success","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"1a81bb93-2844-48a1-a881-e41756ea0b67","function":"toggle"},"_auto_id_":"d4e48fb7-a908-498d-a733-14ae6571a857"}]}],"classes":"default"},{"name":"button_end_date_alert","type":"button","item-type":"button","_auto_id_":"9f8c107e-c954-4dda-8e79-60165bb0cfba","content":"END DATE ALERT","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"RemoveAlert","isConditional":false},"_auto_id_":"87493912-2849-4866-9e47-c884795d3081"}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode === 'Alerts') || $store.variables.selected_visit.status == \"complete\"","disabled":"$store.variables.alerts === undefined || $store.variables.alerts.length === 0"}}],"_auto_id_":"6a2151df-ed54-4163-9974-8fa5950a3fe1","expressions":{"show":"$store.variables.visit_view_mode != \"Appointments\""}}]},{"start":false,"name":"Note","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"ffb5abe6-2b96-403d-92b9-7814b82ca327","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"574ae9fa-e98d-4f0c-9b13-8f9c39ed63d8","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline function - button_back - page: Note', \n  'info'\n)\n\nvar view_name = cti.store.variables.visit_view_mode\nvar page = \"Visit\"\n\nif(view_name == \"Timeline\") {\n  page = \"Timeline\"\n} else if(view_name == \"Patient Demographics\") {\n  page = \"Patient\"\n} else if(view_name == \"Alerts\") {\n  page = \"Alerts\"\n} else if(view_name == \"Appointments\") {\n  page = \"Appointments\"\n} else if(view_name == \"Referrals\") {\n  page = \"Referrals\"\n} else if(view_name == \"Progress Notes\") {\n  page = \"Notes\"\n} else if(view_name == \"Documents\") {\n  page = \"Documents\"\n} else if(view_name == \"Allergies\") {\n  page = \"Allergies\"\n} else if(view_name == \"Contacts\") {\n  page = \"Contacts\"\n}\n\ncti.utils.callAction(\"go-to-page\", { \"name\" : page })"},"_auto_id_":"219ef27f-381b-4dbb-9de3-6083733cfee0"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>New Progress Note</h4>","_auto_id_":"8e7121ed-8185-4c7e-a977-d7d697f3f201"}],"_auto_id_":"aedd7dab-f725-478d-b806-71246d3f4056","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"43d28d6e-9dad-416f-a9c3-acab5308a4ed","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"142364dd-4c2c-4a97-b153-75403576119c","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}}],"expressions":{}},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"noteType","type":"choice","item-type":"select","_auto_id_":"4d218db5-fcad-4818-8715-fedc398e3fca","label":"Note Type: ","required":false,"options":[{"label":"TypeA - *** USE FOR DEMO ***","value":"nt1"},{"label":"Child Health Administration","value":"CH"},{"label":"Child Development Services","value":"CHDEVSER"},{"label":"Community Paediatrics","value":"COMPAED"},{"label":"CPA Review","value":"CPA"},{"label":"Child Protection","value":"CS"},{"label":"Diabetics","value":"DIABN"},{"label":"Dietetics","value":"DIET"},{"label":"District Nursing","value":"DN"},{"label":"EPathways Manual Completion Reason","value":"EPATHWAY"},{"label":"Geriatric Medicine","value":"GM"},{"label":"General Medical Services","value":"GMP"},{"label":"Health Visiting","value":"HV"},{"label":"Community Beds","value":"INP"},{"label":"Intermediate Care","value":"INTCARE"},{"label":"Looked after Children","value":"LACN"},{"label":"LAC Review","value":"LACReview"},{"label":"MDT Meeting","value":"MDT"},{"label":"Occupational Therapy","value":"OT"},{"label":"Paediatrics","value":"PAED"}],"message":"This is a required field","expressions":{},"description":"","validators":[],"actions":[{"event":"change","type":"inline-function","data":{"sync":true,"code":"var config = cti.store.api.api_rio.getnoteconfig.data.progressNoteConfiguration\nvar noteTypes = cti.store.api.api_rio.getnotetypes.data.progressNoteTypes.uiNoteTypes\nvar code = cti.store.pages.Note.noteType\n\nif(code) {\n  var hasSubNotes = false\n  \n  for(var i in noteTypes) {\n    if(noteTypes[i].code === code.value) {\n      cti.store.variables.uiSubNoteTypes = noteTypes[i].subNoteType\n      cti.store.variables.note = noteTypes[i]\n      hasSubNotes = true\n      break\n    }\n  }\n  \n  if(!hasSubNotes) {\n    cti.store.variables.uiSubNoteTypes = undefined\n  }\n} else {\n  cti.store.variables.uiSubNoteTypes = undefined\n  cti.store.variables.note = undefined\n}\n\nif(cti.store.variables.note && cti.store.variables.note.canValidateOwn == \"0\") {\n  cti.store.pages.Note.isValidated = {\n    label : \"Not Validated\",\n    value : \"0\"\n  }\n} else if(cti.store.variables.note && config.validatedByDefault == \"1\") {\n  cti.store.pages.Note.isValidated = {\n    label : \"Validated\",\n    value : \"1\"\n  }\n} else {\n  cti.store.pages.Note.isValidated = undefined\n}\n\ncti.utils.updatePage()"},"_auto_id_":"e0b7f991-52cf-4bb9-947f-eadba092efd8"}],"option-source":"$store.api.api_rio.getnotetypes.data.progressNoteTypes.uiNoteTypes","label-property":"value","value-property":"code"},{"name":"subType","type":"choice","item-type":"select","_auto_id_":"2cd6b280-5e60-41ad-86a1-50184351fe5d","label":"Sub Note Type:","required":false,"options":[{"label":"Option 1","value":1},{"label":"Option 2","value":2},{"label":"Option 3","value":3}],"expressions":{"show":"$store.pages.Note.noteType != undefined"},"actions":[],"option-source":"$store.variables.uiSubNoteTypes","label-property":"value","value-property":"code"},{"name":"isValidated","type":"choice","item-type":"select","_auto_id_":"dcec651d-9db0-46a5-bb85-23c8249159dd","label":"Is Validated?","required":false,"options":[{"label":"Validated","value":"1"},{"label":"Not Validated","value":"0"}],"expressions":{"show":"$store.variables.note != undefined","disabled":"$store.variables.note.canValidateOwn == \"0\""},"actions":[],"message":"This is a required field"},{"name":"specialty","type":"choice","item-type":"select","_auto_id_":"42141468-e96b-4aae-8d1c-0f990dc8d399","label":"Specialty:","required":false,"options":[{"label":"General Surgery","value":"100"},{"label":"General Medical Practice","value":"600"},{"label":"Community Medicine","value":"900"}],"expressions":{},"option-source":"$store.api.api_rio.getnotespecialites.data.userSpecialties.userSpecialty","label-property":"value","value-property":"code"},{"name":"noteText","type":"user-input","item-type":"text","_auto_id_":"09bada34-11ae-4ac8-9268-084fc607bf70","label":"Note: ","required":true,"multiline":true,"debounce":1000,"message":"This is a required field","expressions":{},"validators":[],"actions":[]},{"name":"row_media","type":"area","item-type":"row","_auto_id_":"8d80ecca-3cc1-46e2-a57e-a5808501cba5","content":[{"name":"button_take_photo","type":"button","item-type":"take-photo-button","_auto_id_":"54bc98ec-1a34-45e0-92bb-7fbd55878a8f","extends":{"type":"button","item-type":"button"},"content":"Take photo","actions":[{"event":"click","type":"take-photo","data":{"quality":50,"multiple":false,"mediaId":"btnPhoto","direction":"back","encoding":"jpeg","allowEdit":false,"saveToPhotoAlbum":false}}],"left-icon":"fa-camera","theme":"minimal","expressions":{"show":"($store.media.btnPhoto == undefined || $store.media.btnPhoto.images.length == 0) && ($store.media.btnAudio == undefined || $store.media.btnAudio.audio.length == 0)"}},{"name":"image_viewer","type":"media","item-type":"image-viewer","_auto_id_":"1d2f3e49-13d6-4fa7-a94d-9acbc6716e32","scaleImage":true,"maxWidth":150,"maxHeight":80,"model":"$store.media.btnPhoto.images[0]","actions":[{"event":"click","type":"delete-media","data":{"model":"$store.media.btnPhoto.images[{{0}}]"},"_auto_id_":"832b0877-4245-489e-bb7e-5f82c11a085e"}],"expressions":{"show":"$store.media.btnPhoto != undefined && $store.media.btnPhoto.images != undefined && $store.media.btnPhoto.images.length > 0"}},{"name":"button_delete_photo","type":"button","item-type":"button","_auto_id_":"b8810e2c-f3f6-4ffb-9bf8-0f80e3b39ee9","content":"","theme":"minimal","left-icon":"fa-trash","actions":[{"event":"click","type":"delete-media","data":{"model":"$store.media.btnPhoto.images[{{0}}]"},"_auto_id_":"c4cef8f2-7c17-462f-b158-1d94501521bf"}],"expressions":{"show":"$store.media.btnPhoto != undefined && $store.media.btnPhoto.images != undefined && $store.media.btnPhoto.images.length > 0"}},{"name":"record_audio","type":"capture","item-type":"record-audio","_auto_id_":"c54a0586-dd04-4526-b17e-374ea5b5c47e","label":"Record Audio: ","required":false,"smallRecorder":false,"multiple":false,"mediaId":"btnAudio","actions":[],"expressions":{"show":"0 && ($store.media.btnPhoto == undefined || $store.media.btnPhoto.images.length == 0) && ($store.media.btnAudio == undefined || $store.media.btnAudio.audio.length == 0)"}},{"name":"audio_player","type":"media","item-type":"audio","_auto_id_":"219c3468-9822-486e-b301-798f12e2012f","actions":[],"model":"$store.media.btnAudio.audio[0]","expressions":{"show":"0 &&  ($store.media.btnAudio != undefined && $store.media.btnAudio.audio != undefined && $store.media.btnAudio.audio.length > 0)"}},{"name":"button_delete_audio","type":"button","item-type":"button","_auto_id_":"b4fc083f-0b8f-46c4-ba2c-389cb764aed2","content":"","theme":"minimal","actions":[{"event":"click","type":"delete-media","data":{"model":"$store.media.btnAudio.audio[{{0}}]"},"_auto_id_":"d6fbb8e1-433a-4483-862c-da47bebea8a3"}],"expressions":{"show":"0 && ($store.media.btnAudio != undefined && $store.media.btnAudio.audio != undefined && $store.media.btnAudio.audio.length > 0)"},"left-icon":"fa-trash"}],"expressions":{}},{"name":"button_advanced","type":"button","item-type":"button","_auto_id_":"fcca4009-6088-4f6d-9c8d-5fd4bbc39b5c","content":"{{'$store.variables.show_advanced_note == false ? \"Show Advanced...\" : \"Hide Advanced\"' | store}}","theme":"default","actions":[{"type":"if","data":{},"_auto_id_":"7116dd7e-e8a9-40e8-ac4e-6b89879c7908","operations":[{"type":"value","content":"{{$store.variables.show_advanced_note}}","$selected":false},{"type":"operator","content":"==","$selected":false},{"type":"value","content":"{{true}}","$selected":false}]},{"event":"click","type":"set-variable","data":{"name":"show_advanced_note","value":"{{false}}"},"_auto_id_":"6849c85a-c9e7-4313-acd6-653076a146a4"},{"type":"otherwise","data":{},"_auto_id_":"998e33a7-a010-41ce-a1e2-51b4fcc48170"},{"event":"click","type":"set-variable","data":{"name":"show_advanced_note","value":"{{true}}"},"_auto_id_":"97fc2265-d9e5-4de7-a6ae-5b38249785c0"},{"type":"end-if","data":{},"_auto_id_":"8e59ce99-6e9c-4429-85b5-8ac3510e17a7"}],"expressions":{}},{"name":"group_advanced","type":"area","item-type":"group","_auto_id_":"b442d6ae-9df3-4a2d-8bc1-8714121ce4be","content":[{"name":"flagSignificantEvent","type":"choice","item-type":"switch","_auto_id_":"8c82bed5-6c9c-4d50-a6cb-fff9cb9d9704","label":" Significant Event:","required":false,"on-text":"YES","off-text":"NO","expressions":{},"validators":[],"actions":[]},{"name":"flagThirdParty","type":"choice","item-type":"switch","_auto_id_":"fdedb618-eab1-4e79-9c09-f99298feb915","label":"Contains third party information:","required":false,"on-text":"YES","off-text":"NO","expressions":{}},{"name":"flagClientConceal","type":"choice","item-type":"switch","_auto_id_":"e0f14df2-96a1-4fbb-89de-2f07f464fb56","label":"Conceal from Client:","required":false,"on-text":"YES","off-text":"NO","expressions":{}}],"repeat":false,"expressions":{"show":"$store.variables.show_advanced_note == true"}},{"name":"group_riskType","type":"area","item-type":"group","_auto_id_":"3171b3a2-5054-4f05-a757-f7cb890cba93","content":[{"name":"riskType","type":"choice","item-type":"select","_auto_id_":"ff5c8da3-775d-4f1b-9e1c-fb046339d3f2","label":"Risk Type:","required":false,"options":[{"label":"Allergy","value":"AL"},{"label":"Child on Register","value":"CPR"},{"label":"Do Not Divulge Address","value":"DNDA"}],"expressions":{},"validators":[],"actions":[],"option-source":"$store.api.api_rio.getnoterisktypes.data.riskTypes.riskType","label-property":"value","value-property":"code"}],"repeat":true,"expressions":{"show":"$store.variables.show_advanced_note == true"}},{"name":"list_riskType","type":"content","item-type":"list","_auto_id_":"92d67849-20d0-416f-ad04-fbf662050e6c","search":"","classes":"","expressions":{"show":"$store.variables.show_advanced_note == true"},"model":"$store.repeater.Note.group_riskType","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.repeater.Note.group_riskType.splice( $data.$item.$index, 1);"},"_auto_id_":"c45fd1c6-0e22-4f6e-b383-fb21788bd144","actions":[]}],"dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_riskType_html","_auto_id_":"33d670e0-fbe3-440d-8616-387fa672d650","content":"<i class=\"fa fa-trash\"></i> {{$data.$item.riskType.label}}"}]}],"_auto_id_":"64340310-2804-4c93-b044-39494e2dcfc1"},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_save","type":"button","item-type":"button","_auto_id_":"fa853d0d-0c16-4a8b-9ab9-4465aa9a606f","content":"SAVE","theme":"default","expressions":{"disabled":"$form.invalid;"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"// gotFile callback function \n//\n// Success callback function to use the fileEntry data to convert the\n// raw image file to base64\nfunction gotFile(fileEntry) {\n  window.logManager.consoleLog(\n    'Photo Load: Converting file store to base64...', \n    'info'\n  )\n\n  // Gain access to the root file URL\n  fileEntry.file(function (file) {\n    // Set new FileReader\n    var reader = new FileReader()\n    // Attach callback function\n    reader.onloadend = function (e) {\n      // ... on success generate API friendly data\n      window.logManager.consoleLog(\n        'Photo Load: File converted to Base64', \n        'info'\n      )\n\n      // Convert the binary back into a string\n      var dataURL = window.btoa(e.target.result)\n\n      // Set the base64 string\n      var base64 = dataURL.replace(/^data:image\\/[a-z]+;base64,/, \"\")\n\n      // Split down the detail so that we can catch the file type\n      /*\n      var detail = \"\"\n      if(this.result.indexOf(\"base64,\") != -1) {\n        detail = this.result.split(\"base64,\")\n      }\n      var fileType = \"\"\n      if(detail[0].indexOf(\"/\") != -1) {\n        fileType = detail[0].split(\"/\")\n      }\n      var extension = \"\"\n      if(fileType[1].indexOf(\";\") != -1) {\n        extension = fileType[1].split(\";\")\n      }\n      */\n      var fileExtension = \"jpg\"\n\n      // RiO does not accept jpeg so split out the e to\n      // pass as jpg\n      if(fileExtension == \"jpeg\") {\n        fileExtension = fileExtension.replace(\"e\", \"\")\n      }\n\n      // Set the local variables\n      cti.store.media.btnPhoto.base64 = base64\n      cti.store.media.btnPhoto.fileExtension = fileExtension\n\n      // Call success to kick off action flow\n      $success()\n    }\n\n    // Convert the file to base64 string...\n    reader.readAsBinaryString(file)\n  });\n}\n\n// fail callback function \n//\n// Fail callback function to inform the user that the file has failed to\n// resolve from the local file system\nfunction fail(error) {\n  window.logManager.consoleLog(\n    'Photo Load: Failed - Reason: ' + error, \n    'error'\n  )\n\n  // Remove any corrupt trace of the file\n  if(cti.store.media && \n     cti.store.media.btnPhoto && \n     cti.store.media.btnPhoto.images &&\n     cti.store.media.btnPhoto.images.length === 1) \n  {\n    delete cti.store.media.btnPhoto\n  }\n\n  // Notify the user\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Error Locating Image\", \n    \"text\" : \"The application was unable to locate the image. Please retake the photo and try again.\"\n  });  \n\n  // Close the spinner\n  cti.fn_toggle_spinner('close', '')\n}\n\n// Show spinner message\ncti.fn_toggle_spinner('open', 'Submitting Progress Note...')\n\n// If a medical note type is entered then make sure we have a sub note type\nif(cti.store.pages.Note.noteType && (cti.store.variables.uiSubNoteTypes != undefined && cti.store.variables.uiSubNoteTypes.length > 0)) {\n  if(!cti.store.pages.Note.subType) {\n    cti.utils.callAction(\"show-notification\", {\n      \"name\": \"notification_error\", \n      \"title\" : \"Warning: No Sub Type Selected\", \n      \"text\" : \"You must enter a Sub Note Type before continuing.\"\n    })\n\n    cti.fn_toggle_spinner('close', '')\n    return false\n  } else if(cti.store.pages.Note.isValidated == undefined || cti.store.pages.Note.isValidated == null) {\n    cti.utils.callAction(\"show-notification\", {\n      \"name\": \"notification_error\", \n      \"title\" : \"Warning: Validated Error\", \n      \"text\" : \"You must select a validation option for this Note Type.\"\n    })\n\n    cti.fn_toggle_spinner('close', '')\n    return false\n  }\n}\n\n\n// Check that we have a valid image to upload\nif(cti.store.media && \n   cti.store.media.btnPhoto && \n   cti.store.media.btnPhoto.images &&\n   cti.store.media.btnPhoto.images.length === 1) \n{\n  // Check that we are running  on a device compatible with image to \n  // base64 conversion...\n  if(cordova && window && window.resolveLocalFileSystemURL) {\n    // Grab the image in a local variable\n    var photo = cti.store.media.btnPhoto.images[0] \n    // Then pass it to resolveLocalFileSystemURL to convert it as base64\n    window.resolveLocalFileSystemURL(photo, gotFile, fail)\n  } else {\n    // ... otherwise we ignore the file and process the submission\n    // without any documents\n    window.logManager.consoleLog(\n      'Photo Load: Ignoring file upload as we\\'re in studio.', \n      'info'\n    )\n\n    // Remove any trace of the photo\n    delete cti.store.media.btnPhoto\n\n    // Call success to kick off action flow\n    $success()\n  }\n} else {\n  // Call success to kick off action flow\n  $success()\n}"},"_auto_id_":"e54b72c2-e243-4cfa-b415-c3d7c95e0a1d"},{"event":"click","type":"call-actionflow","data":{"name":"AddProgressNote"},"_auto_id_":"6f9df8b6-10cf-49ea-96da-019aca8edd5c"}],"classes":"default"}],"_auto_id_":"2da640d2-c23a-422c-b66a-61037c061ef0","expressions":{}}]},{"start":false,"name":"Alert","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"cfa45b78-d92d-4a2a-bb10-6d36c196cc99","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"c6e2fa5d-ee91-436a-b0e4-03d24818fcd0","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline function - button_back - page: Alert', \n  'info'\n)\n\nvar view_name = cti.store.variables.visit_view_mode\nvar page = \"Visit\"\n\nif(view_name == \"Timeline\") {\n  page = \"Timeline\"\n} else if(view_name == \"Patient Demographics\") {\n  page = \"Patient\"\n} else if(view_name == \"Alerts\") {\n  page = \"Alerts\"\n} else if(view_name == \"Appointments\") {\n  page = \"Appointments\"\n} else if(view_name == \"Referrals\") {\n  page = \"Referrals\"\n} else if(view_name == \"Progress Notes\") {\n  page = \"Notes\"\n} else if(view_name == \"Documents\") {\n  page = \"Documents\"\n} else if(view_name == \"Allergies\") {\n  page = \"Allergies\"\n} else if(view_name == \"Contacts\") {\n  page = \"Contacts\"\n}\n\ncti.utils.callAction(\"go-to-page\", { \"name\" : page })"},"_auto_id_":"71ef6425-d846-4dbe-ad68-be8996476129"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>New Alert</h4>","_auto_id_":"9ca4c0ad-35ca-43ac-a202-a4b73d793b9a"}],"_auto_id_":"8c162f27-11fe-44a6-af57-6f80a3f71751"},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"4e166671-4c1e-45ea-b640-24abc0f6a06a","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"ca69cb99-ca2a-4fdd-ad3d-c636ec79111b","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}}],"expressions":{}},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"type","type":"choice","item-type":"select","_auto_id_":"37d9d790-a909-4bd0-aef7-edd5e66c1da1","label":"Type:","required":true,"options":[],"expressions":{},"option-source":"$store.api.api_rio.alerttypes.data","label-property":"value","value-property":"code","message":"This is a required field"},{"name":"priority","type":"choice","item-type":"select","_auto_id_":"973cfe47-0984-4b8c-a57b-48fce8bfc06f","label":"Priority:","required":true,"options":[],"expressions":{},"label-property":"value","value-property":"code","option-source":"$store.api.api_rio. alertpriorities.data","validators":[],"actions":[],"message":"This is a required field"},{"name":"description","type":"user-input","item-type":"text","_auto_id_":"244258f7-6554-44b0-aaaa-40190a3bb565","label":"Description:","required":true,"multiline":true,"debounce":1000,"message":"This is a required field","expressions":{},"maxlength":500,"validators":[]}],"_auto_id_":"0a6cdff1-761e-4d35-87f6-b482d0e8decd","expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_save","type":"button","item-type":"button","_auto_id_":"9310bbc6-a2b2-4834-9a58-c6f86445beaf","content":"SAVE","theme":"default","expressions":{"disabled":"$form.invalid;"},"actions":[{"event":"click","type":"call-actionflow","data":{"name":"AddAlert"},"_auto_id_":"4a8e29ac-a8e9-4fa5-8e7d-d3671dba6777"}],"classes":"default"}],"_auto_id_":"9eddd62a-53bb-4a7a-8898-fec5ab8d4ccf","expressions":{}}]},{"start":false,"name":"Outcome","config":[{"name":"Page Loaded Event","type":"event","item-type":"onpageloaded","_auto_id_":"fc3ca296-c8bf-4b48-92b4-ef79ed7d1675","actions":[{"event":"onpageloaded","type":"inline-function","data":{"sync":true,"code":"cti.fn_populate_duration_dl()\ncti.fn_calc_visit_duration()\n\n$success()"},"_auto_id_":"6e899ada-8966-49a3-a41c-f4fbcf4d4ea2"}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"ad5a2655-c465-4713-b88c-025144d56e86","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"7655f35f-28f4-4d0b-9d6b-e82c411de8bf","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Outcome","componentInstanceId":"934dc2c9-8ceb-4c95-9028-84b6a629479e","function":"toggle"},"_auto_id_":"40999e63-f8f2-48da-b245-b35dbf98535d"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>End Visit<h4>","_auto_id_":"b56b6549-6d87-4ce9-8aaf-53e8e43cc6dd"}],"_auto_id_":"bfa4fc5e-4017-4ee8-a775-6d18820e8a6d"},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"f6785ce4-30a0-4bc2-ab57-7be3d928a029","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"c341bde3-ec7c-4a17-b9cb-450d5155e578","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}}],"expressions":{}},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"arrivalTime","type":"user-input","item-type":"time","_auto_id_":"13fd198a-4cc0-45fb-bd03-d2ed86b0b23b","label":"Arrived At: ","required":true,"options":{"interval":15,"min":"07:00","max":"22:00"},"left-icon":"fa-clock-o","expressions":{},"validators":[],"actions":[{"event":"change","type":"inline-function","data":{"sync":true,"code":"function setTime() {\n  var startDate = cti.store.variables.selected_visit.arrivalTime;\n  var arrivalTime = moment(startDate).format(\"HH:mm\");\n  var arrivalTimeHours = moment(arrivalTime, \"HH:mm\").format(\"HH\");\n  var arrivalTimeMinutes = moment(arrivalTime, \"HH:mm\").format(\"mm\");\n  var minsArrivalTime = parseInt(arrivalTimeMinutes);\n  var arrivalTimeLabel = \"\";\n\n  if(minsArrivalTime < 15) { arrivalTimeLabel = arrivalTimeHours+\":00\"; }\n  else if(minsArrivalTime >= 15 && minsArrivalTime < 30) { arrivalTimeLabel = arrivalTimeHours+\":15\"; }\n  else if(minsArrivalTime >= 30 && minsArrivalTime < 45) { arrivalTimeLabel = arrivalTimeHours+\":30\"; } \n  else if(minsArrivalTime >= 45 && minsArrivalTime < 60) { arrivalTimeLabel = arrivalTimeHours+\":45\"; }\n\n  cti.store.pages.Outcome.arrivalTime = arrivalTimeLabel;\n}\n\nvar arrivalTime = cti.store.pages.Outcome.arrivalTime;\nvar currentTime = moment().format(\"HH:mm\");\n\nif(currentTime < arrivalTime) {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning: Time Error.\", \n    \"text\" : \"The Patient Arrival Time can not be after the current time.\"\n  });\n  setTime();\n}\n\ncti.utils.updatePage();"},"_auto_id_":"8a9866d1-9056-4cad-a16c-9252ae2fff5a"}],"message":"This is a required field"},{"name":"actualTime","type":"user-input","item-type":"time","_auto_id_":"9cb1a369-f743-448a-aa91-df3dbbc46647","label":"Seen At: ","required":true,"options":{"interval":15,"min":"07:00","max":"22:00"},"left-icon":"fa-clock-o","expressions":{},"actions":[{"event":"change","type":"inline-function","data":{"sync":true,"code":"function setTime() {\n  var startDate = cti.store.pages.Outcome.arrivalTime;\n  var arrivalTime = moment(startDate, \"HH:mm\").format(\"HH:mm\");\n  var arrivalTimeHours = moment(arrivalTime, \"HH:mm\").format(\"HH\");\n  var arrivalTimeMinutes = moment(arrivalTime, \"HH:mm\").format(\"mm\");\n  var minsArrivalTime = parseInt(arrivalTimeMinutes);\n  var arrivalTimeLabel = \"\";\n\n  if(minsArrivalTime < 15) { arrivalTimeLabel = arrivalTimeHours+\":00\"; }\n  else if(minsArrivalTime >= 15 && minsArrivalTime < 30) { arrivalTimeLabel = arrivalTimeHours+\":15\"; }\n  else if(minsArrivalTime >= 30 && minsArrivalTime < 45) { arrivalTimeLabel = arrivalTimeHours+\":30\"; } \n  else if(minsArrivalTime >= 45 && minsArrivalTime < 60) { arrivalTimeLabel = arrivalTimeHours+\":45\"; }\n\n  cti.store.pages.Outcome.actualTime = arrivalTimeLabel;\n}\n\nvar arrivalTime = cti.store.pages.Outcome.arrivalTime;\nvar actualTime = cti.store.pages.Outcome.actualTime;\nvar currentTime = moment().format(\"HH:mm\");\n\nif(actualTime < arrivalTime) {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning: Time Error.\", \n    \"text\" : \"The Patients Seen At Time can not be before the Patients Arrival Time.\"\n  });\n  setTime();\n} else if(actualTime > currentTime) {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning: Time Error.\", \n    \"text\" : \"The Patients Seen At Time can not be after the current time.\"\n  });\n  setTime();\n} else {\n  var now = moment().format(\"HH:mm\");\n  var time = moment.utc(moment(now,\"HH:mm\").diff(moment(actualTime,\"HH:mm\"))).format(\"HH:mm\");\n  var mins = moment(time, \"HH:mm\").format(\"m\");\n  var hours = moment(time, \"HH:mm\").format(\"H\");\n\n  cti.store.pages.Outcome.duration_hours = {\"label\": hours, \"value\": hours };\n  cti.store.pages.Outcome.duration_minutes = {\"label\": mins, \"value\": mins };\n}\n\ncti.utils.updatePage();"},"_auto_id_":"df3415dc-af99-45af-bf4f-9a0c093e26ae"}],"message":"This is a required field"},{"name":"html_duration_label","type":"content","item-type":"html","_auto_id_":"db6b40af-0a7b-4b68-9f9e-7656502786bf","content":"<label>Duration:</label>","expressions":{}},{"name":"row_duration","type":"area","item-type":"row","_auto_id_":"5c6a6db0-d81d-4eed-a1e6-42aa3a50553a","content":[{"name":"duration_hours","type":"choice","item-type":"select","_auto_id_":"035cdab9-df86-4900-a01c-2a36e5c542de","label":"Hours:","required":true,"options":[],"searchable":false,"expressions":{},"option-source":"$store.variables.duration_hours","label-property":"label","value-property":"value","message":"This is a required field"},{"name":"duration_minutes","type":"choice","item-type":"select","_auto_id_":"36ffe205-2954-481a-a452-7bcbb02c63cc","label":"Minutes:","required":true,"options":[],"expressions":{},"searchable":false,"option-source":"$store.variables.duration_minutes","label-property":"label","value-property":"value","message":"This is a required field"}],"expressions":{}},{"name":"group_activities","type":"area","item-type":"group","_auto_id_":"b7266429-c3a6-42a9-bd44-4ffa5c451437","content":[{"name":"activity","type":"choice","item-type":"select","_auto_id_":"8087e4d3-a4a3-45ae-af06-2bf70f6d9293","label":"Activity:","required":false,"options":[{"label":"Activity A","value":"activitya"},{"label":"Activity B","value":"activityb"}],"expressions":{},"validators":[],"actions":[],"option-source":"$store.variables.selected_visit.attendees.attendee.possibleActivities.possibleActivity","label-property":"value","value-property":"code","message":"This is a required field","searchable":true},{"name":"button_add_activity","type":"button","item-type":"button","_auto_id_":"60969fb4-08f5-490f-8ff3-912ff480dc41","content":"Add","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var outcome = cti.store.pages.Outcome\n\nif(outcome == undefined || outcome.activity == undefined) {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning: You must select a valid Activity.\", \n    \"text\" : \"You must select a valid activity from the Activities drop down list.\"\n  })\n} else {\n  if(cti.store.variables.o_activities == undefined) {\n    cti.store.variables.o_activities = []\n  }\n\n  for(var i in cti.store.variables.o_activities) {\n    if(cti.store.variables.o_activities[i].value == outcome.activity.value) {\n      cti.utils.callAction(\"show-notification\", {\n        \"name\": \"notification_warning\", \n        \"title\" : \"Warning: You must select a valid Activity.\", \n        \"text\" : \"You must select a valid activity from the Activities drop down list.\"\n      })\n      return false\n    }\n  }\n  \n  cti.store.variables.o_activities.push(outcome.activity)\n  outcome.activity = undefined\n}\n\ncti.utils.updatePage();"},"_auto_id_":"7109c067-a6a9-46b6-90cb-376633f142c6"}],"expressions":{},"classes":"button-add-activity"}],"repeat":false,"expressions":{}},{"name":"list_activities","type":"content","item-type":"list","_auto_id_":"9d9dba26-3ecf-4cb8-8e6d-b94eb1368043","search":"","classes":"","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.o_activities.splice( $data.$item.$index, 1);"},"_auto_id_":"bbe4fc5c-f452-46fc-a4af-7bf5461c5d7e"}],"expressions":{},"model":"$store.variables.o_activities","dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_activities_html","_auto_id_":"adcfe111-3f87-4025-a94d-8226ad8bcf05","content":"<i class=\"fa fa-times-circle-o\"></i> {{$data.$item.label}}","expressions":{}}]},{"name":"outcome","type":"choice","item-type":"select","_auto_id_":"bf5c40c5-cea0-409d-962c-cc683cd8cfcd","label":"Outcome:","required":true,"options":[{"label":"Outcome A","value":"outcomea"},{"label":"Outcome B","value":"outcomeb"},{"label":"Did Not Attend","value":"dna"}],"expressions":{},"message":"This is a required field","option-source":"$store.variables.selected_visit.attendees.attendee.possibleOutcomes.possibleOutcome","label-property":"value","value-property":"code"},{"name":"comments","type":"user-input","item-type":"text","_auto_id_":"798cc828-4f58-4383-928a-e5ce261bfba7","label":"Comments:","required":false,"multiline":true,"debounce":1000,"message":"This is a required field","expressions":{},"maxlength":500,"validators":[]},{"name":"popupBack","type":"component","item-type":"web-component","content":[{"name":"html_warning","type":"content","item-type":"html","_auto_id_":"23f8d005-924d-47b1-b772-2e9e61ee467f","content":"<h2>Cancel Outcome</h2>\n<p>You are about to cancel the outcome for this appointment. Any information you have entered will be lost.</p>\n<p>Do you want to continue? </p>","expressions":{}},{"name":"button_bar_mobile","type":"area","item-type":"button-bar","_auto_id_":"4279672c-7c31-478f-ae0c-a2a5f1ff9142","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_yes","type":"button","item-type":"button","_auto_id_":"4e441df0-eada-44dc-a9b2-501e191c4854","content":"YES","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.v_submitOutcome_clear = true\n\nwindow.logManager.consoleLog(\n  'inline function - button_back - page: Outcome', \n  'info'\n)\n\nvar view_name = cti.store.variables.visit_view_mode\nvar page = \"Visit\"\n\nif(view_name == \"Timeline\") {\n  page = \"Timeline\"\n} else if(view_name == \"Patient Demographics\") {\n  page = \"Patient\"\n} else if(view_name == \"Alerts\") {\n  page = \"Alerts\"\n} else if(view_name == \"Appointments\") {\n  page = \"Appointments\"\n} else if(view_name == \"Referrals\") {\n  page = \"Referrals\"\n} else if(view_name == \"Progress Notes\") {\n  page = \"Notes\"\n} else if(view_name == \"Documents\") {\n  page = \"Documents\"\n} else if(view_name == \"Allergies\") {\n  page = \"Allergies\"\n} else if(view_name == \"Contacts\") {\n  page = \"Contacts\"\n}\n\ncti.utils.callAction(\"go-to-page\", { \"name\" : page })\n\n$success()"},"_auto_id_":"9b42511c-ff6e-4f78-8642-b0c866c28a9f"},{"event":"click","type":"call-component-function","data":{"page":"Outcome","componentInstanceId":"934dc2c9-8ceb-4c95-9028-84b6a629479e","function":"toggle"},"_auto_id_":"5ccfee4f-0d52-4983-b2b2-c33e41ef69a9"}],"classes":"default"},{"name":"button_no","type":"button","item-type":"button","_auto_id_":"7c1a516f-3f77-4c80-9021-ae9a61def75b","content":"NO","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Outcome","componentInstanceId":"934dc2c9-8ceb-4c95-9028-84b6a629479e","function":"toggle"},"_auto_id_":"dbe0b83a-ace4-4a7a-935a-5dec433d2853"}]}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"934dc2c9-8ceb-4c95-9028-84b6a629479e","attributes":{"id":"popupBack"},"expressions":{},"actions":[]}],"_auto_id_":"28bd24ea-93a2-4a58-b565-eccd5ab9b85b"},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_save","type":"button","item-type":"button","_auto_id_":"bf92feb7-0674-4b0d-80c6-9337c64c705d","content":"SAVE","theme":"default","expressions":{"disabled":"$form.invalid"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"if(cti.store.variables.o_activities == undefined || cti.store.variables.o_activities.length == 0) {\n  // Users can submit a DNA outcome with activities, so logic check for that here ...\n  if(cti.store.pages.Outcome.outcome.label.indexOf('DNA') === -1) {\n    cti.utils.callAction(\"show-notification\", {\n      \"name\": \"notification_warning\", \n      \"title\" : \"Warning: No Activities Selected.\", \n      \"text\" : \"You must select at least 1 activity from the Activities drop down list.\"\n    });\n  } else {\n    // ... and trigger the embedded actionflow call if valid\n  \t$success();\n  }\n} else {\n  // Success triggers the embedded actionflow call on this inline function\n  $success();\n}"},"_auto_id_":"1f178f4f-6b31-4bd5-8c5b-7b9711b83ef6","actions":[{"event":"success","type":"call-actionflow","data":{"name":"SubmitOutcome"},"_auto_id_":"9eedc773-1575-4717-9a28-23c6aaeb119c"}]}],"classes":"default"}],"_auto_id_":"c68b7cfa-b3c7-4bbd-806b-f293ed966490","expressions":{}}]},{"start":false,"name":"Wound_Care","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"f1750afd-e9e7-4ad1-a56f-e399cc7a4987","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"8ae226d7-21c2-4496-ac42-cf705407d96c"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Wound Care Assessment</h4>","_auto_id_":"a2792d41-6105-46d8-9c0a-5e1c6226346b"}],"_auto_id_":"899c80d3-7a37-470e-8134-5a38b218beb4","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"8319b7a3-10ca-49c4-83aa-08a63a45798e","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"6281bab0-52a3-4721-a104-ca3461770b03","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.patientData.demographics.surname' | store}}, &nbsp;{{'$store.variables.selected_visit.patientData.demographics.firstname' | store}}&nbsp;({{'$store.variables.selected_visit.patientData.demographics.title' | store}})</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.patientData.alerts.length > 0 ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}}],"expressions":{}},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"select_wound_location","type":"choice","item-type":"select","_auto_id_":"4445ed77-23d4-4ba1-8c60-8ef91d16d9cf","label":"Where is the wound located?","required":false,"options":[{"label":"Abdomen","value":"Abdomen"},{"label":"Arms","value":"Arms"},{"label":"Back","value":"Back"},{"label":"Feet","value":"Feet"},{"label":"Groin","value":"Groin"},{"label":"Hands","value":"Hands"},{"label":"Head / Neck","value":"Head / Neck"},{"label":"Legs","value":"Legs"},{"label":"Shoulders","value":"Shoulders"},{"label":"Torso","value":"Torso"}],"expressions":{}},{"name":"radio_wound_new","type":"choice","item-type":"radio","_auto_id_":"8fc42263-9b39-4451-bf67-f14b4affd849","label":"Is the wound new?","required":false,"options":[{"label":"Yes","value":"Yes"},{"label":"No","value":"No"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{},"actions":[]},{"name":"select_wound_type","type":"choice","item-type":"select","_auto_id_":"04eaa08f-e60c-47cb-b62f-b43680a13b2b","label":"Wound Type:","required":false,"options":[{"label":"Burn / Scald","value":"Burn / Scald"},{"label":"Diabetic Foot Ulcer","value":"Diabetic Foot Ulcer"},{"label":"Skin Tear / Laceration","value":"Skin Tear / Laceration"}],"expressions":{},"actions":[]},{"name":"select_skin_condition","type":"choice","item-type":"select","_auto_id_":"b2e27278-faac-4bbe-82b5-b319addbfa85","label":"Condition of surrounding skin:","required":false,"options":[{"label":"Dry / Cracked","value":"Dry / Cracked"},{"label":"Healthy / Intact","value":"Healthy / Intact"},{"label":"Oedematous","value":"Oedematous"},{"label":"Macerated","value":"Macerated"}],"expressions":{},"actions":[]}],"_auto_id_":"2178ba7d-baea-4e26-89c2-160f308da1d4"},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_save","type":"button","item-type":"button","_auto_id_":"55bd13a2-eaaf-4fe4-a32b-fc724b992d90","content":"SAVE","theme":"default","expressions":{"disabled":"$form.invalid;"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.selected_visit.wound_care = true;\n$success();"},"_auto_id_":"068fa947-2223-468f-8f04-5c9369d2d5bb"},{"event":"click","type":"go-back","data":{},"_auto_id_":"8c47b001-7354-4ea4-80f6-fbb5832377e8"}],"classes":"default"}],"_auto_id_":"558324fb-aca6-448f-a12d-52d48eecb472","expressions":{}}]},{"start":false,"name":"Team_Planner","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"d0f89f6b-a405-4730-bf85-076ce0d00208","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"222d30ac-82a7-46ca-8ab7-f44728f18d7e"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Team Planner</h4>","_auto_id_":"707563f9-7dd4-460d-a6ae-726e102fb88c"}],"_auto_id_":"d34672e4-5581-4347-935c-26626ac655c3","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"5dc4f407-e2f4-4d8c-92da-9a7a978b3476","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"721d54ce-667a-4132-9b8a-3034b01bbdf1","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.patientData.demographics.surname' | store}}, &nbsp;{{'$store.variables.selected_visit.patientData.demographics.firstname' | store}}&nbsp;({{'$store.variables.selected_visit.patientData.demographics.title' | store}})</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.patientData.alerts.length > 0 ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}}],"expressions":{}},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"select_team","type":"choice","item-type":"select","_auto_id_":"d9110ef6-3efb-41c3-845a-44e064c27986","label":"Team: ","required":true,"options":[],"expressions":{},"validators":[],"classes":"compact silver","message":"This is a required field","option-source":"$store.api.api_rio.authenticate.profile.userProfile.teams.team","label-property":"value","value-property":"code","actions":[{"event":"change","type":"inline-function","data":{"sync":true,"code":"var selectedTeam = cti.store.pages.Team_Planner.select_team.value;\n\nfor(var i in cti.store.api.api_rio.teamplannerreferencedata.data) {\n  if(cti.store.api.api_rio.teamplannerreferencedata.data[i].code === selectedTeam) {\n    cti.store.variables.v_teamActivities = cti.store.api.api_rio.teamplannerreferencedata.data[i].activities.activity;\n    break;\n  }\n}\n\nvar referrals = cti.store.variables.selected_visit.patientData.referrals;\nvar referralsList = [];\n\nfor(var i in referrals) {\n  if(referrals[i].team.code === selectedTeam) {\n    var obj = {\n      \"id\" : referrals[i].referralId,\n      \"referrer\" : referrals[i].referrer,\n      \"referralCode\" : referrals[i].referralSource.code,\n      \"referralValue\" : referrals[i].referralSource.value\n    }\n\n    referralsList.push(obj);\n  }\n}\n\ncti.store.variables.referrals = referralsList;\n\nif(cti.store.variables.referrals.length === 0) {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning: No Referrals Available\", \n    \"text\" : \"There are no Referrals available for the selected team.\"\n  }); \n}\n\ncti.utils.updatePage();"},"_auto_id_":"aa7c37cf-2cb7-477c-a3af-99715f5fcef7"}]},{"name":"select_referral","type":"choice","item-type":"select","_auto_id_":"27c15797-b1b1-40a7-9a62-bb8a85d1b893","label":"Referral:","required":true,"options":[{"label":"Distring Nursing referral","value":"Distring Nursing referral"}],"expressions":{},"classes":"compact silver","validators":[],"option-source":"$store.variables.referrals","label-property":"referralValue","value-property":"id","message":"This is a required field"},{"name":"date_planner","type":"user-input","item-type":"date","_auto_id_":"b44f09df-97b7-4131-8806-16f85a05dff6","label":"Date: ","required":true,"expressions":{},"classes":"compact silver date_icon_left","message":"This is a required field"},{"name":"radio_time","type":"choice","item-type":"radio","_auto_id_":"449c4a2b-3372-4696-889f-4b3938ce5a33","label":"Time: ","required":true,"options":[{"label":"AM","value":"AM"},{"label":"PM","value":"PM"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{},"classes":"compact silver","message":"This is a required field"},{"name":"button_repeat","type":"button","item-type":"button","_auto_id_":"d34c2afe-2373-4810-b603-56747b35a6cd","content":"{{'$store.variables.selected_visit.repeat == undefined ? \"Repeat: No Repeat\" : $store.variables.selected_visit.repeat'|store}}","theme":"minimal","right-icon":"fa-plus-circle","actions":[{"event":"click","type":"call-component-function","data":{"page":"Team_Planner","componentInstanceId":"a6484396-13a0-4914-b523-f69b985e2650","function":"toggle","params":{"containerid":"scrollable"}},"_auto_id_":"969d0ea9-5b1e-4c4f-ac4b-ed2f8ba017ff"}],"expressions":{},"classes":"compact silver"},{"name":"group_activities","type":"area","item-type":"group","_auto_id_":"12a87f02-b3ae-432a-a191-9c18758c3b47","content":[{"name":"activity","type":"choice","item-type":"select","_auto_id_":"faa7f1a2-3f1f-4d62-a669-2860d6cb920c","label":"Activities: ","required":true,"options":[],"expressions":{},"searchable":true,"validators":[],"actions":[],"message":"This is a required field","option-source":"$store.variables.v_teamActivities","label-property":"value","value-property":"code"}],"repeat":true,"expressions":{}},{"name":"list_activities","type":"content","item-type":"list","_auto_id_":"a486b601-249d-4f89-aaa9-2959148f085a","search":"","classes":"","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.repeater.Team_Planner.group_activities.splice( $data.$item.$index, 1);"},"_auto_id_":"17792c9b-65c3-4929-b572-a3a95e2af42e"}],"expressions":{},"model":"$store.repeater.Team_Planner.group_activities","dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_activities_html","_auto_id_":"40609651-2cd6-4e69-8950-0eb558d6e80a","content":"<i class=\"fa fa-times-circle-o\"></i> {{$data.$item.activity.label}}","expressions":{}}]},{"name":"comments","type":"user-input","item-type":"text","_auto_id_":"bd01fe18-dc58-432b-835b-4d1ef6748f35","label":"Comments: ","required":true,"multiline":true,"debounce":1000,"expressions":{},"message":"This is a required field"},{"name":"popup_repeat_visit","type":"component","item-type":"web-component","content":[{"name":"html_heading","type":"content","item-type":"html","_auto_id_":"0075cfc8-d0ac-4659-9244-8f0482111c02","content":"<h4>Repeat Visit</h4><p>When do you want the visit to repeat?</p>","expressions":{}},{"name":"number_appointments","type":"user-input","item-type":"number","_auto_id_":"fa5e1bdc-b429-4e10-8f9d-a371fe6d2d97","label":"Number of appointments: ","required":false,"decimals":2,"expressions":{},"message":"This is a required field"},{"name":"radio_repeat","type":"choice","item-type":"radio","_auto_id_":"78408653-893b-49c4-9ba1-bc85b1bb1d6c","label":"","required":false,"options":[{"label":"Daily","value":"Daily"},{"label":"Weekly","value":"Weekly"},{"label":"Monthly","value":"Monthly"},{"label":"Yearly","value":"Yearly"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"default":"\"Daily\""},"validators":[],"classes":""},{"name":"radio_daily","type":"choice","item-type":"radio","_auto_id_":"13996756-5a55-41d2-97e2-1f0cb4c9c6c0","label":"","required":false,"options":[{"label":"Every weekday","value":"Every weekday"},{"label":"Daily every...","value":"Daily every"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"show":"$store.pages.Team_Planner.radio_repeat === \"Daily\"","default":"\"Every weekday\""}},{"name":"radio_monthly","type":"choice","item-type":"radio","_auto_id_":"eaf12008-4169-493b-bdc8-cb30d8b04a79","label":"","required":false,"options":[{"label":"Day","value":"Day"},{"label":"The","value":"The"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"show":"$store.pages.Team_Planner.radio_repeat === \"Monthly\"","default":"\"Day\""}},{"name":"radio_yearly","type":"choice","item-type":"radio","_auto_id_":"fe6cbea4-8d78-4b43-a32f-fc1ae8d86b4d","label":"","required":false,"options":[{"label":"Every","value":"Every"},{"label":"The","value":"The"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"default":"\"Every\"","show":"$store.pages.Team_Planner.radio_repeat === \"Yearly\""}},{"name":"select_daily_interval","type":"choice","item-type":"select","_auto_id_":"64a66abe-8606-4651-b622-357fda892a2b","label":"","required":false,"options":[{"label":"1 day","value":1},{"label":"2 days","value":2},{"label":"3 days","value":3},{"label":"4 days","value":"4"},{"label":"5 days","value":"5"},{"label":"6 days","value":"6"}],"expressions":{"show":"$store.pages.Team_Planner.radio_repeat === \"Daily\" && $store.pages.Team_Planner.radio_daily === \"Daily every\""}},{"name":"select_weekly_interval","type":"choice","item-type":"select","_auto_id_":"23fc1ed7-7cd4-47ae-be1c-7274433b63c6","label":"","required":false,"options":[{"label":"Recur every 1 week on","value":1},{"label":"Recur every 2 weeks on","value":2},{"label":"Recur every 3 weeks on","value":3}],"expressions":{"show":"$store.pages.Team_Planner.radio_repeat === \"Weekly\"","default":"1"}},{"name":"checkbox_weekly_days","type":"choice","item-type":"checkbox","_auto_id_":"bf592956-222c-4a90-86ff-4033941161f0","label":"","required":false,"options":[{"label":"Monday","id":1},{"label":"Tuesday","id":2},{"label":"Wednesday","id":3},{"label":"Thursday","id":"4"},{"label":"Friday","id":"5"},{"label":"Saturday","id":"6"},{"label":"Sunday","id":"7"}],"icon-selected":"fa-check-square-o","icon-unselected":"fa-square-o","expressions":{"default":"{}","show":"$store.pages.Team_Planner.radio_repeat === \"Weekly\""},"validators":[]},{"name":"select_month_day","type":"choice","item-type":"select","_auto_id_":"7f01e51f-652c-4812-9a28-ae5b5002143a","label":"","required":false,"options":[{"label":"1 of","value":1},{"label":"2 of","value":2},{"label":"3 of","value":3},{"label":"4 of","value":"4"},{"label":"5 of","value":"5"},{"label":"6 of","value":"6"},{"label":"7 of","value":"7"},{"label":"8 of","value":"8"},{"label":"9 of","value":"9"},{"label":"10 of","value":"10"},{"label":"11 of","value":"11"},{"label":"12 of","value":"12"},{"label":"13 of","value":"13"},{"label":"14 of","value":"14"},{"label":"15 of","value":"15"},{"label":"16 of","value":"16"},{"label":"17 of","value":"17"},{"label":"18 of","value":"18"},{"label":"19 of","value":"19"},{"label":"20 of","value":"20"},{"label":"21 of","value":"21"},{"label":"22 of","value":"22"},{"label":"23 of","value":"23"},{"label":"24 of","value":"24"},{"label":"25 of","value":"25"},{"label":"26 of","value":"26"},{"label":"27 of","value":"27"},{"label":"28 of","value":"28"}],"expressions":{"show":"$store.pages.Team_Planner.radio_repeat === \"Monthly\" && $store.pages.Team_Planner.radio_monthly === \"Day\""}},{"name":"select_position","type":"choice","item-type":"select","_auto_id_":"30744e65-894f-48a7-8e00-9be900289f06","label":"","required":false,"options":[{"label":"First","value":"First"},{"label":"Second","value":"Second"},{"label":"Third","value":"Third"},{"label":"Fourth","value":"Fourth"},{"label":"Last","value":"Last"}],"expressions":{"show":"($store.pages.Team_Planner.radio_repeat === \"Monthly\" && $store.pages.Team_Planner.radio_monthly === \"The\") || ($store.pages.Team_Planner.radio_repeat === \"Yearly\" && $store.pages.Team_Planner.radio_yearly === \"The\")"}},{"name":"select_weekday","type":"choice","item-type":"select","_auto_id_":"b71893a0-2d8a-4e9e-b208-c82dfcb80cce","label":"","required":false,"options":[{"label":"Monday of","value":1},{"label":"Tuesday of","value":2},{"label":"Wednesday of","value":3},{"label":"Thursday of","value":"4"},{"label":"Friday of","value":"5"},{"label":"Saturday of","value":"6"},{"label":"Sunday of","value":"7"}],"expressions":{"show":"($store.pages.Team_Planner.radio_repeat === \"Monthly\" && $store.pages.Team_Planner.radio_monthly === \"The\") || ($store.pages.Team_Planner.radio_repeat === \"Yearly\" && $store.pages.Team_Planner.radio_yearly === \"The\")"}},{"name":"select_month_interval","type":"choice","item-type":"select","_auto_id_":"911cbcad-dc9c-401d-b12f-4e2f6907307b","label":"","required":false,"options":[{"label":"every month","value":1},{"label":"every 2 months","value":2},{"label":"every 3 months","value":3},{"label":"every 4 months","value":"4"},{"label":"every 5 months","value":"5"},{"label":"every 6 months","value":"6"},{"label":"every 7 months","value":"7"},{"label":"every 8 months","value":"8"},{"label":"every 9 months","value":"9"},{"label":"every 10 months","value":"10"},{"label":"every 11 months","value":"11"}],"expressions":{"show":"$store.pages.Team_Planner.radio_repeat === \"Monthly\""}},{"name":"select_month","type":"choice","item-type":"select","_auto_id_":"48fc4146-bf5c-444a-bc13-8c8acafde6bc","label":"","required":false,"options":[{"label":"January","value":"1"},{"label":"February","value":2},{"label":"March","value":"3"},{"label":"April","value":"4"},{"label":"May","value":"5"},{"label":"June","value":"6"},{"label":"July","value":"7"},{"label":"August","value":"8"},{"label":"September","value":"9"},{"label":"October","value":"10"},{"label":"November","value":"11"},{"label":"December","value":"12"}],"expressions":{"show":"$store.pages.Team_Planner.radio_repeat === \"Yearly\""}},{"name":"select_year_month_day","type":"choice","item-type":"select","_auto_id_":"171cefa7-e81f-45a0-ad4d-37337c46faa4","label":"","required":false,"options":[{"label":"1st","value":1},{"label":"2nd","value":2},{"label":"3rd","value":3},{"label":"4th","value":"4"},{"label":"5th","value":"5"},{"label":"6th","value":"6"},{"label":"7th","value":"7"},{"label":"8th","value":"8"},{"label":"9th","value":"9"},{"label":"10th","value":"10"},{"label":"11th","value":"11"},{"label":"12th","value":"12"},{"label":"13th","value":"13"},{"label":"14th","value":"14"},{"label":"15th","value":"15"},{"label":"16th","value":"16"},{"label":"17th","value":"17"},{"label":"18th","value":"18"},{"label":"19th","value":"19"},{"label":"20th","value":"20"},{"label":"21st","value":"21"},{"label":"22nd","value":"22"},{"label":"23rd","value":"23"},{"label":"24th","value":"24"},{"label":"25th","value":"25"},{"label":"26th","value":"26"},{"label":"27th","value":"27"},{"label":"28th","value":"28"}],"expressions":{"show":"$store.pages.Team_Planner.radio_repeat === \"Yearly\" && $store.pages.Team_Planner.radio_yearly === \"Every\""}},{"name":"button_bar","type":"area","item-type":"button-bar","_auto_id_":"d066fe0a-0996-420b-9e11-399273b30dd2","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_cancel","type":"button","item-type":"button","_auto_id_":"aae66a09-826d-426a-b65f-ad0b30b174da","content":"CANCEL","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Team_Planner","componentInstanceId":"a6484396-13a0-4914-b523-f69b985e2650","function":"toggle","params":{"containerid":"scrollable"}},"_auto_id_":"a3494145-38a4-4c88-9178-4a2019aaa331"},{"event":"click","type":"inline-function","data":{"sync":true,"code":"delete cti.store.variables.selected_visit.repeat;"},"_auto_id_":"3343c6ad-505e-43ee-8800-12ed6b92464a"}]},{"name":"button_add","type":"button","item-type":"button","_auto_id_":"79acb490-8350-4439-b9a3-48bf3f972fc8","content":"ADD REPEAT","theme":"default","expressions":{},"classes":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var p = cti.store.pages.Team_Planner;\nvar s = p.radio_repeat + \": \";\nvar validationError = false;\nvar validationErrorMessage = \"\";\n\nif (p.radio_repeat === \"Daily\") {\n  s += p.radio_daily;\n  if (p.radio_daily != undefined) {\n    if (p.radio_daily === \"Daily every\") {\n      if(p.select_daily_interval != undefined) {\n        s += \" \" + p.select_daily_interval.label;\n      } else {\n        validationError = true;\n        validationErrorMessage = \"Please select a Daily Interval value.\"\n      }\n    }\n  } else {\n    validationError = true;\n    validationErrorMessage = \"Please select a Daily Interval type.\"\n  }\n} else if (p.radio_repeat === \"Weekly\") {\n  if(p.select_weekly_interval != undefined) {\n    if(p.checkbox_weekly_days != undefined) {\n      var mon = true, \n          tue = true,\n          wed = true, \n          thu = true,\n          fri = true,\n          sat = true,\n          sun = true;\n\n      s += p.select_weekly_interval.label + \" \";\n\n      if (p.checkbox_weekly_days[1]) {\n        s += \"Monday, \";\n      } else { mon = false; }\n      if (p.checkbox_weekly_days[2]) {\n        s += \"Tuesday, \";\n      } else { tue = false; }\n      if (p.checkbox_weekly_days[3]) {\n        s += \"Wednesday, \";\n      } else { wed = false; }\n      if (p.checkbox_weekly_days[4]) {\n        s += \"Thursday, \";\n      } else { thu = false; }\n      if (p.checkbox_weekly_days[5]) {\n        s += \"Friday, \";\n      } else { fri = false; }\n      if (p.checkbox_weekly_days[6]) {\n        s += \"Saturday, \";\n      } else { sat = false; }\n      if (p.checkbox_weekly_days[7]) {\n        s += \"Sunday, \";\n      } else { sun = false; }\n\n      if(!mon && !tue && !wed && !thu && !fri && !sat && !sun) {\n        validationError = true;\n        validationErrorMessage = \"Please select the days in which you would like the Weekly Interval to occur.\"\n      } else {\n        s = s.substring(0, s.length - 2);\n      }\n    } else {\n      validationError = true;\n      validationErrorMessage = \"Please select the days in which you would like the Weekly Interval to occur.\"\n    }\n  } else {\n    validationError = true;\n    validationErrorMessage = \"Please select a Weekly Recurring type.\"\n  }\n} else if (p.radio_repeat === \"Monthly\") {\n  if(p.radio_monthly != undefined) {\n  \ts += p.radio_monthly + \" \";\n    \n  \tif(p.radio_monthly === \"Day\") {\n      if(p.select_month_day != undefined) {\n    \ts += p.select_month_day.label + \" \";\n        \n        if(p.select_month_interval != undefined) {\n          s += p.select_month_interval.label + \" \";\n        } else {\n          validationError = true;\n          validationErrorMessage = \"Please select a Monthly Interval value.\"\n        }\n      } else {\n        validationError = true;\n        validationErrorMessage = \"Please select a Day in the Month.\"\n      }\n    } else {\n      if(p.select_position != undefined) {\n      \ts += p.select_position.label + \" \";\n        if(p.select_weekday != undefined) {\n          s += p.select_weekday.label + \" \";\n          if(p.select_month_interval != undefined) {\n      \t\ts += p.select_month_interval.label + \" \";\n          } else {\n            validationError = true;\n            validationErrorMessage = \"Please select a Monthly Interval value.\"\n          }\n        } else {\n          validationError = true;\n          validationErrorMessage = \"Please select a Day value.\"\n        }\n      } else {\n        validationError = true;\n        validationErrorMessage = \"Please select a Position value.\"\n      }\n    }\n  } else {\n    validationError = true;\n    validationErrorMessage = \"Please select a Monthly Interval type.\"\n  }\n} else if (p.radio_repeat === \"Yearly\") {\n  if(p.radio_yearly != undefined) {\n  \ts += p.radio_yearly + \" \";\n    \n  \tif(p.radio_yearly === \"Every\") {\n      if(p.select_month != undefined) {\n    \ts += p.select_month.label + \" \";\n        if(p.select_year_month_day != undefined) {\n    \t  s += p.select_year_month_day.label + \" \";\n        } else {\n          validationError = true;\n          validationErrorMessage = \"Please select a Year/Month value.\"\n        }\n      } else {\n        validationError = true;\n        validationErrorMessage = \"Please select a Month value.\"\n      }\n    } else {\n      if(p.select_position != undefined) {\n      \ts += p.select_position.label + \" \";\n        if(p.select_weekday != undefined) {\n          s += p.select_weekday.label + \" \";\n          if(p.select_month != undefined) {\n      \t\ts += p.select_month.label + \" \";\n          } else {\n            validationError = true;\n            validationErrorMessage = \"Please select a Month value.\"\n          }\n        } else {\n          validationError = true;\n          validationErrorMessage = \"Please select a Day value.\"\n        }\n      } else {\n        validationError = true;\n        validationErrorMessage = \"Please select a Position value.\"\n      }\n    }\n  } else {\n    validationError = true;\n    validationErrorMessage = \"Please select a Yearly Interval type.\"\n  }\n} else {\n  validationError = true;\n  validationErrorMessage = \"Please select a type of Interval Appointment.\"\n}\n\nif(cti.store.pages.Team_Planner.number_appointments === undefined) {\n  validationError = true;\n  validationErrorMessage = \"Please enter a number of Repeat Appointments.\"\n}\n\nif(validationError) {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Validation Error on Team Planner\", \n    \"text\" : validationErrorMessage\n  }); \n} else {\n  cti.store.variables.selected_visit.repeat = s;\n  $success();\n}"},"_auto_id_":"90ca09e2-537e-40e4-802b-1fa119f691e8"},{"event":"click","type":"call-component-function","data":{"page":"Team_Planner","componentInstanceId":"a6484396-13a0-4914-b523-f69b985e2650","function":"toggle","params":{"containerid":"scrollable"}},"_auto_id_":"1a952d46-e3b2-4700-8a71-f670af0da5ab"}]}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"a6484396-13a0-4914-b523-f69b985e2650","attributes":{"id":"popup_repeat_visit"},"expressions":{},"actions":[]}],"_auto_id_":"c56178e8-9fa2-49db-b0fd-a05df5713434"},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_save","type":"button","item-type":"button","_auto_id_":"d29cf0d6-8d8a-4ce8-a652-4d557e6f6878","content":"SAVE TO TEAM PLANNER","theme":"default","expressions":{"disabled":"$form.invalid"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"if(cti.store.repeater.Team_Planner.group_activities.length === 0) {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Validation Error on Team Planner\", \n    \"text\" : \"Please select at least 1 valid Activity from the list above.\"\n  }); \n} else {\n  $success();\n}"},"_auto_id_":"51e41175-81c4-4360-9262-37141a35573f"},{"event":"click","type":"call-actionflow","data":{"name":"AddTPAppointment"},"_auto_id_":"f01585b1-8278-420d-b4ab-144a15fbe2f5"}],"classes":"default"}],"_auto_id_":"cd297035-6794-4b13-b0dd-030ec5ad3076","expressions":{}}]},{"start":false,"name":"HCP_Diary","config":[{"name":"Page Loaded Event","type":"event","item-type":"onpageloaded","_auto_id_":"0796e390-7d76-4413-b7c5-4e6e9cec4b80","actions":[{"event":"onpageloaded","type":"inline-function","data":{"sync":true,"code":"//Set a default for the switch questions\n\nif(cti.store.pages.HCP_Diary.switch_carer_appointment === undefined){\n  cti.store.pages.HCP_Diary.switch_carer_appointment = false;\n}\n\nif(cti.store.pages.HCP_Diary.switch_proxy_contact === undefined){\n  cti.store.pages.HCP_Diary.switch_proxy_contact = false;\n}\n\nif(cti.store.pages.HCP_Diary.switch_f2f_contact === undefined){\n  cti.store.pages.HCP_Diary.switch_f2f_contact = false;\n}\n\n\nif(cti.store.pages.HCP_Diary.switch_non_client === undefined){\n  cti.store.pages.HCP_Diary.switch_non_client = false;\n}\n\n//Set a default for the duration slider\n\nif(cti.store.pages.HCP_Diary.slider_duration === undefined){\n  cti.store.pages.HCP_Diary.slider_duration = 15;\n}\n\n$success()"},"_auto_id_":"79759872-eda5-458d-900b-4d8ec44f1388","actions":[]}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"e46de49c-ea60-476d-9c9d-3e2fc9da0ab3","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"749c0ada-3a78-4699-a7a1-f364dd6b750a"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>HCP DIARY</h4>","_auto_id_":"414eb33d-be0c-4a45-9816-de509ac6d68b"}],"_auto_id_":"63897979-b131-4154-bb64-61aff683f8ac","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"ffc31e25-e0f8-4403-9959-0d2842910192","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"abb54e77-979f-49f0-846a-e3f7be62d552","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.patientData.demographics.surname' | store}}, &nbsp;{{'$store.variables.selected_visit.patientData.demographics.firstname' | store}}&nbsp;({{'$store.variables.selected_visit.patientData.demographics.title' | store}})</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.patientData.alerts.length > 0 ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}}],"expressions":{}},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"date_planner","type":"user-input","item-type":"date","_auto_id_":"ec4c4665-1887-4438-9751-a2f3149414b8","label":"Date: ","required":true,"left-icon":"fa-calendar","expressions":{},"classes":"compact silver date_icon_left","message":"This is a required field","validators":[],"actions":[{"event":"change","type":"inline-function","data":{"sync":true,"code":"if (cti.store.pages.HCP_Diary.date_planner === null) {\n  cti.store.variables.v_availableSlots = null\n  return false\n}\n\n// Get the selected date from the date question and record the selected day of the week\ncti.store.variables.v_selectedAppointmentDate = moment(cti.store.pages.HCP_Diary.date_planner)\n\ncti.store.variables.v_selectedDayOfWeek = cti.store.variables.v_selectedAppointmentDate.day() - 1 // moment defaults to a Sunday start of week, which I disagree with.\n\nvar fourWeeks = moment()\n  .add(4, 'weeks')\n  .format('YYYY-MM-DD')\nvar maxDaysFromNow = moment(fourWeeks).diff(moment(), 'days')\nvar selectedDaysFromNow = cti.store.variables.v_selectedAppointmentDate.diff(moment(), 'days')\n\nif (selectedDaysFromNow < maxDaysFromNow && selectedDaysFromNow >= 0) {\n  cti.store.variables.v_isValidAppointmentDate = true\n} else {\n  cti.store.variables.v_isValidAppointmentDate = false\n  cti.utils.callAction('show-notification', { name: 'notification_error', title: 'Invalid Date Selection', text: 'Appointments cannot be booked for past dates and can only be booked up to 4 weeks from the current date.' })\n  return false;\n}\n\nvar selectedDayBusySlots = cti.store.api.api_rio.busydiaryslots.data.filter(e => {\n  return e.startDateTime.substr(0, 10) === cti.store.variables.v_selectedAppointmentDate.format('YYYY-MM-DD')\n})\n\ncti.store.variables.v_availableSlots = cti.fn_merge_busy_slots(selectedDayBusySlots, cti.store.variables.v_selectedDayOfWeek)\n\n// Check to see if we have any valid slots and warn user if we do\nif(cti.store.variables.v_availableSlots.length === 0) {\n  cti.store.variables.v_isValidAppointmentDate = false\n  cti.utils.callAction('show-notification', { \n    name: 'notification_error', \n    title: 'No Diary Slots Available', \n    text: 'You have selected a date that does not contain any valid Diary slots. Please select an alternative date and try again.' \n  })\n}\n\n// Reset the intended duration value as each time the date changes the time will do also\ncti.store.pages.HCP_Diary.select_intended_duration = undefined;\ncti.store.variables.v_intended_durations = undefined;\n\n// Reset start time as we have a new date value\ncti.store.pages.HCP_Diary.select_start_time = undefined;\n\n$success()"},"_auto_id_":"b4724479-6b3d-4a3c-bda3-a9b9a4ba045e"}]},{"name":"select_start_time","type":"choice","item-type":"select","_auto_id_":"1fe024fe-df36-4258-bbe3-aa23be9b0987","label":"Start Time:","required":true,"options":[],"expressions":{"disabled":"$store.variables.v_isValidAppointmentDate === false || $store.variables.v_isValidAppointmentDate === undefined"},"classes":"compact silver","option-source":"$store.variables.v_availableSlots","label-property":"value","value-property":"code","message":"This is a required field","actions":[{"event":"change","type":"inline-function","data":{"sync":true,"code":"var startTime = cti.store.pages.HCP_Diary.select_start_time.value;\nvar templates = cti.store.variables.v_diary_template;\n\nvar weekday = new Array(7);\nweekday[1]=\"Monday\";\nweekday[2]=\"Tuesday\";\nweekday[3]=\"Wednesday\";\nweekday[4]=\"Thursday\";\nweekday[5]=\"Friday\";\nweekday[6]=\"Saturday\";\nweekday[0]=\"Sunday\";\n\nvar day = weekday[cti.store.variables.v_selectedDayOfWeek];\n\nfor(var i in templates) {\n  if(templates[i].name == day) {\n    var sessions = templates[i].sessions;\n    break;\n  }\n}\n\nfor(var x in sessions) {\n  var sessionStartHours = moment(sessions[x].startTime, 'HH:mm:ss').format('HH');\n  \n  var sessionEndHours = moment(sessions[x].endTime, 'HH:mm:ss').format('HH');\n  var sessionEndMins = moment(sessions[x].endTime, 'HH:mm:ss').format('mm');\n\n  var hours = moment(startTime, 'HH:mm:ss').format('HH');\n  var mins = moment(startTime, 'HH:mm:ss').format('mm');\n\n  if(hours >= sessionStartHours && (hours < sessionEndHours || hours === sessionEndHours && sessionEndMins <= 30)) {\n    var obj = {\n      label: sessions[x].slotLength + ' minutes',\n      value: sessions[x].slotLength\n    };\n    cti.store.variables.v_intended_durations = []\n    cti.store.variables.v_intended_durations.push(obj);\n    break;\n  }\n}\n\nif(cti.store.pages.HCP_Diary.select_intended_duration === undefined) {\n  cti.store.pages.HCP_Diary.select_intended_duration = {\n    code: cti.store.variables.v_intended_duration.label,\n    value: cti.store.variables.v_intended_duration.value\n  }\n}\n\ncti.utils.updatePage();"},"_auto_id_":"4faa6586-9974-4dfa-a4ce-f9333acd15c4"}]},{"name":"select_intended_duration","type":"choice","item-type":"select","_auto_id_":"57ac3028-9122-4191-a269-56069235550f","label":"Duration: ","required":true,"options":[{"label":"Option 1","value":1},{"label":"Option 2","value":2},{"label":"Option 3","value":3}],"message":"This is a required field","expressions":{"disabled":"$store.pages.HCP_Diary.select_start_time === undefined"},"classes":"compact silver","option-source":"$store.variables.v_intended_durations","label-property":"label","value-property":"value","actions":[]},{"name":"select_location","type":"choice","item-type":"select","_auto_id_":"7f5e325d-c5e7-4b90-85c9-e533c7a2aceb","label":"Location:","required":true,"options":[],"expressions":{"show":"$store.pages.HCP_Diary.select_intended_duration != undefined"},"validators":[],"classes":"compact silver","message":"This is a required field","option-source":"$store.api.api_rio.getbookingrefdata.data.appointmentBookingReferenceData.locations.location","label-property":"value","value-property":"code"},{"name":"select_urgency","type":"choice","item-type":"select","_auto_id_":"820223ea-5af0-45b4-a713-fc8165fc16b9","label":"Urgency:","required":true,"options":[],"expressions":{"default":"\"Routine\"","show":"$store.pages.HCP_Diary.select_intended_duration != undefined"},"validators":[],"classes":"compact silver","message":"This is a required field","option-source":"$store.api.api_rio.getbookingrefdata.data.appointmentBookingReferenceData.urgencies.urgency","label-property":"value","value-property":"code"},{"name":"select_type","type":"choice","item-type":"select","_auto_id_":"fd529a25-703c-4a55-a5c8-9f89674ece85","label":"Type:","required":true,"options":[],"expressions":{"show":"$store.pages.HCP_Diary.select_intended_duration != undefined"},"validators":[],"classes":"compact silver","message":"This is a required field","option-source":"$store.api.api_rio.getbookingrefdata.data.appointmentBookingReferenceData.types.type","label-property":"value","value-property":"code"},{"name":"group_activities","type":"area","item-type":"group","_auto_id_":"29123cd3-d854-4b85-8b30-cb0687e6cf9c","content":[{"name":"activity","type":"choice","item-type":"select","_auto_id_":"098dcae3-f51c-4865-a6d7-a43fb194fadb","label":"Activities: ","required":true,"options":[],"expressions":{},"searchable":true,"validators":[],"actions":[],"message":"This is a required field","option-source":"$store.variables.selected_visit.attendees.attendee.possibleActivities.possibleActivity","label-property":"value","value-property":"code"}],"repeat":true,"expressions":{"show":"$store.pages.HCP_Diary.select_intended_duration != undefined"}},{"name":"list_activities","type":"content","item-type":"list","_auto_id_":"f97601e9-ee34-483f-ad1f-024a65fd1dc2","search":"","classes":"","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.repeater.HCP_Diary.group_activities.splice( $data.$item.$index, 1);"},"_auto_id_":"f8d1265d-a944-449b-bbb9-320d526218de","actions":[]}],"expressions":{"show":"$store.pages.HCP_Diary.select_intended_duration != undefined"},"model":"$store.repeater.HCP_Diary.group_activities","dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_activities_html","_auto_id_":"8fb67b88-ac1b-41fb-8dc2-3cfd46e82e05","content":"<i class=\"fa fa-times-circle-o\"></i> {{$data.$item.activity.label}}","expressions":{}}]},{"name":"text_comment","type":"user-input","item-type":"text","_auto_id_":"91982ce5-ef12-431c-9c2e-3fb8143cc28b","label":"Comments: ","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$store.pages.HCP_Diary.select_intended_duration != undefined"}},{"name":"button_advanced","type":"button","item-type":"button","_auto_id_":"1055d6ca-a7b0-4706-a5a6-95aab987720e","content":"{{'$store.variables.show_advanced_appt == false ? \"Show Advanced...\" : \"Hide Advanced\"' | store}}","theme":"default","actions":[{"type":"if","data":{},"_auto_id_":"bc9c4786-b2d5-4f33-8113-ef5652a5910e","operations":[{"type":"value","content":"{{$store.variables.show_advanced_appt}}","$selected":false},{"type":"operator","content":"==","$selected":false},{"type":"value","content":"{{true}}","$selected":false}]},{"event":"click","type":"set-variable","data":{"name":"show_advanced_appt","value":"{{false}}"},"_auto_id_":"7979911a-2851-4ee6-b0ec-5c4c892c8a2b"},{"type":"otherwise","data":{},"_auto_id_":"edd0d113-0f3d-4d86-bf14-f08d38163a7c"},{"event":"click","type":"set-variable","data":{"name":"show_advanced_appt","value":"{{true}}"},"_auto_id_":"c976359b-6965-44a4-9420-c9286b6b82c0"},{"type":"end-if","data":{},"_auto_id_":"4534722a-7c81-4e51-8460-bee47d988d3c"}],"expressions":{"show":"$store.pages.HCP_Diary.select_intended_duration != undefined"}},{"name":"group_advanced","type":"area","item-type":"group","_auto_id_":"cce59bce-a4c1-4095-971c-9853a7c3f4e7","content":[{"name":"switch_carer_appointment","type":"choice","item-type":"switch","_auto_id_":"aa366737-95e9-4ac9-afe9-3ef5ba4932f7","label":"Carer appointment:","required":false,"on-text":"YES","off-text":"NO","expressions":{},"classes":"","actions":[]},{"name":"switch_proxy_contact","type":"choice","item-type":"switch","_auto_id_":"bdbf1e50-dfc6-4f6d-98c5-4fdf6ad3e9f9","label":"Proxy Contact:","required":false,"on-text":"YES","off-text":"NO","expressions":{}},{"name":"switch_f2f_contact","type":"choice","item-type":"switch","_auto_id_":"5af96a2a-d8a0-4fa5-a931-9736a9be6f6d","label":"Face to face contact:","required":false,"on-text":"YES","off-text":"NO","expressions":{},"validators":[],"actions":[]},{"name":"switch_non_client","type":"choice","item-type":"switch","_auto_id_":"fd4cd68c-2762-4b15-8e2b-798579502465","label":"Non Client Appointment","required":false,"on-text":"YES","off-text":"NO","expressions":{},"validators":[]},{"name":"contact_comment","type":"user-input","item-type":"text","_auto_id_":"ed14366a-046a-4ea9-93a9-02050eb303ab","label":"Comments for Contact:","required":false,"multiline":true,"debounce":1000,"expressions":{}},{"name":"select_transport_required","type":"choice","item-type":"select","_auto_id_":"fade7e55-9ad1-4a8f-a0c8-c9c1a61d5dad","label":"Transport:","required":false,"options":[],"expressions":{"default":"\"Not Required\""},"validators":[],"classes":"compact","option-source":"$store.api.api_rio.getbookingrefdata.data.appointmentBookingReferenceData.transportRequired.transport","label-property":"value","value-property":"code"},{"name":"transport_comment","type":"user-input","item-type":"text","_auto_id_":"c168d5a9-fd6d-4022-9e9e-15cb8882421d","label":"Comments for Transport:","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$store.pages.HCP_Diary.select_transport_required.label !== 'Not Required' && $store.pages.HCP_Diary.select_transport_required !== null && $store.pages.HCP_Diary.select_transport_required !== undefined"}},{"name":"select_interpret_required","type":"choice","item-type":"select","_auto_id_":"50894af2-2dc6-4b64-a1dd-461197f1d4f5","label":"Interpreter:","required":false,"options":[],"expressions":{"default":"\"Not Required\""},"validators":[],"actions":[],"classes":"compact","option-source":"$store.api.api_rio.getbookingrefdata.data.appointmentBookingReferenceData.interpreterRequired.interpreter","label-property":"value","value-property":"code"},{"name":"select_interpret_language","type":"choice","item-type":"select","_auto_id_":"0dcead91-42d6-49a9-a2d1-421758209b8d","label":"Language:","required":false,"options":[],"option-source":"$store.api.api_rio.getbookingrefdata.data.appointmentBookingReferenceData.interpreterLanguages.interpreterLanguage","label-property":"value","value-property":"code","validators":[],"actions":[],"expressions":{"show":"$store.pages.HCP_Diary.select_interpret_required.label !== \"Not Required\" && $store.pages.HCP_Diary.select_interpret_required !== null && $store.pages.HCP_Diary.select_interpret_required !== undefined"},"classes":"compact"},{"name":"interpreter_comment","type":"user-input","item-type":"text","_auto_id_":"0d624bc6-7dd2-4583-bb93-35b3e325af15","label":"Comments for Interpreter:","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$store.pages.HCP_Diary.select_interpret_required.label !== \"Not Required\" && $store.pages.HCP_Diary.select_interpret_required !== null && $store.pages.HCP_Diary.select_interpret_required !== undefined"}}],"repeat":false,"expressions":{"show":"$store.variables.show_advanced_appt"}}],"_auto_id_":"c6133f8c-6bc5-49d7-b81e-bbd9411b4ab9"},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_save","type":"button","item-type":"button","_auto_id_":"2a01b0b5-af5f-4a05-8a63-b41ec2051d0f","content":"SAVE TO HCP DIARY","theme":"default","expressions":{"disabled":"$form.invalid || $store.repeater.HCP_Diary == undefined || $store.repeater.HCP_Diary.group_activities == undefined || $store.repeater.HCP_Diary.group_activities.length == 0"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.v_appointmentToAdd_clear = true\n$success();"},"_auto_id_":"91023662-d736-4d28-8413-af9801f0693c"},{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"ac2bfbcb-cd49-4ca2-bdd2-8320b8f6897a"}],"classes":"default"}],"_auto_id_":"4d751443-d3d0-4883-a9ee-332ccc895bbc","expressions":{}}]},{"start":false,"name":"Document","config":[{"name":"Page Loaded Event","type":"event","item-type":"onpageloaded","_auto_id_":"91062a97-05ac-49c4-b7ef-afd3501891f5","actions":[{"event":"onpageloaded","type":"inline-function","data":{"sync":true,"code":"var userAssetLocation = cti.store.schema.assetDir || 'user-assets/';\nvar base64Data = \"data:\" + cti.store.variables.v_selectedDocument.fileType + \";base64,\" + cti.store.variables.v_selectedDocument.base64;\n\n// Check fileType of document...\nif(cti.store.variables.v_selectedDocument.fileType == \"image/jpeg\") {\n  // Load Spinner\n  cti.fn_toggle_spinner('open', 'Loading Image...');\n  \n  // ... if type of jpeg process under the embed tag\n  // Grab the page div element for display\n  var imageDiv = document.getElementById('image');\n  imageDiv.classList.add(\"doc-image-class\");\n\n  var img = document.createElement('img');\n  img.id = \"embed-doc\";\n  img.style.width = \"100%\"\n  img.style.height = \"100%\"\n  img.src = base64Data;\n  img.type = cti.store.variables.v_selectedDocument.fileType;\n  imageDiv.appendChild(img);\n  \n  // Close Spinner\n  cti.fn_toggle_spinner('close', '', 1000);\n} else if(cti.store.variables.v_selectedDocument.fileType == \"image/png\") {\n  // Load Spinner\n  cti.fn_toggle_spinner('open', 'Loading Image...');\n  \n  // ... if type of jpeg process under the embed tag\n  // Grab the page div element for display\n  var imageDiv = document.getElementById('image');\n  imageDiv.classList.add(\"doc-image-class\");\n\n  var img = document.createElement('img');\n  img.id = \"embed-doc\";\n  img.style.width = \"100%\"\n  img.style.height = \"100%\"\n  img.src = base64Data;\n  img.type = cti.store.variables.v_selectedDocument.fileType;\n  imageDiv.appendChild(img);\n  \n  // Close Spinner\n  cti.fn_toggle_spinner('close', '', 1000);\n} else if(cti.store.variables.v_selectedDocument.fileType == \"application/pdf\") {\n  // Load Spinner\n  cti.fn_toggle_spinner('open', 'Loading PDF...');\n  \n  var pdfDiv = document.getElementById('pdf');\n  pdfDiv.classList.add(\"doc-image-class\");\n  \n  base64Data = base64Data.replace(/^[^,]+,/, '');\n  var pdfData = atob(base64Data);\n\n  PDFJS.workerSrc = userAssetLocation+'pdf.worker.js'\n  \n  var loadingTask = PDFJS.getDocument({data: pdfData});\n  loadingTask.promise.then(function(pdf) {\n    var pageNumber = 1;\n    pdf.getPage(pageNumber).then(function(page) {\n      // Customised viewport setting\n      var desiredWidth = screen.width - 20;\n      var viewport = page.getViewport(1);\n      var scale = desiredWidth / viewport.width;\n      var scaledViewport = page.getViewport(scale);\n\n      // Prepare canvas using PDF page dimensions\n      var canvas = document.getElementById('the-canvas');\n      var context = canvas.getContext('2d');\n      canvas.height = scaledViewport.height;\n      canvas.width = scaledViewport.width;\n\n      // Render PDF page into canvas context\n      var renderContext = {\n        canvasContext: context,\n        viewport: scaledViewport\n      };\n      var renderTask = page.render(renderContext);\n      renderTask.then(function () {\n        // Close Spinner\n        cti.fn_toggle_spinner('close', '', 500);\n      });\n    });\n  }, function (reason) {\n    // PDF loading error\n    console.error(reason);\n    // Close Spinner\n    cti.fn_toggle_spinner('close', '', 500);\n  });\n}\n\ncti.utils.updatePage();\n$success()"},"_auto_id_":"2255c66d-69d1-4f42-a198-87595f970bbc"}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"6ea69e86-a655-4e4f-add6-0ec2b428552e","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline function - button_back - page: Document', \n  'info'\n)\n\nif(cti.store.variables.v_selectedDocument && cti.store.variables.v_selectedDocument.fileType == \"application/pdf\") {\n  var canvas = document.getElementById('the-canvas');\n  var context = canvas.getContext('2d');\n  context.clearRect(0, 0, canvas.width, canvas.height);\n} else if(cti.store.variables.v_selectedDocument && cti.store.variables.v_selectedDocument.fileType == \"image/jpeg\") {\n  var imageDiv = document.getElementById('image');\n  var embed = document.getElementById('embed-doc');\n  \n  if(embed != null) {\n    imageDiv.removeChild(embed);\n  }\n} else if(cti.store.variables.v_selectedDocument && cti.store.variables.v_selectedDocument.fileType == \"image/jpg\") {\n  var imageDiv = document.getElementById('image');\n  var embed = document.getElementById('embed-doc');\n  \n  if(embed != null) {\n    imageDiv.removeChild(embed);\n  }\n} else if(cti.store.variables.v_selectedDocument && cti.store.variables.v_selectedDocument.fileType == \"image/png\") {\n  var imageDiv = document.getElementById('image');\n  var embed = document.getElementById('embed-doc');\n  \n  if(embed != null) {\n    imageDiv.removeChild(embed);\n  }\n}\n\ndelete cti.store.variables.v_selectedDocument\ndelete cti.store.variables.v_documentGetPayload\n\nvar view_name = cti.store.variables.visit_view_mode\nvar page = \"Visit\"\n\nif(view_name == \"Timeline\") {\n  page = \"Timeline\"\n} else if(view_name == \"Patient Demographics\") {\n  page = \"Patient\"\n} else if(view_name == \"Alerts\") {\n  page = \"Alerts\"\n} else if(view_name == \"Appointments\") {\n  page = \"Appointments\"\n} else if(view_name == \"Referrals\") {\n  page = \"Referrals\"\n} else if(view_name == \"Progress Notes\") {\n  page = \"Notes\"\n} else if(view_name == \"Documents\") {\n  page = \"Documents\"\n} else if(view_name == \"Allergies\") {\n  page = \"Allergies\"\n} else if(view_name == \"Contacts\") {\n  page = \"Contacts\"\n}\n\ncti.utils.callAction(\"go-to-page\", { \"name\" : page })"},"_auto_id_":"df0f1085-9cdc-46a2-816d-04444f992339"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Document Display</h4>","_auto_id_":"39f47d4d-1c7b-4f68-bc0a-95cd7a6bfc4e"},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"1566a102-c62b-4c13-9c8a-b03beceb4474","attributes":{},"expressions":{}}],"_auto_id_":"ef48c7c0-14ce-4d25-9167-727ecd297244"},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"79a2680a-94a6-4c5b-989f-7ca610d96f22","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"dee23685-9558-46c5-975b-44bb7a5b105a","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}}],"expressions":{}},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"html_pdf_area","type":"content","item-type":"html","_auto_id_":"aa2d1039-c696-4a54-9867-8fa69caa5f8a","content":"<div id=\"pdf\">\n  <canvas id=\"the-canvas\"></canvas>\n</div>","expressions":{"show":"$store.variables.v_selectedDocument.fileType == \"application/pdf\""}},{"name":"html_image_area","type":"content","item-type":"html","_auto_id_":"4745da57-c104-4470-85dc-1af1ca810a81","content":"<div id=\"image\"></div>","expressions":{"show":"$store.variables.v_selectedDocument.fileType == \"image/jpeg\" || $store.variables.v_selectedDocument.fileType == \"image/jpg\" || $store.variables.v_selectedDocument.fileType == \"image/png\""}}],"_auto_id_":"e80131df-c65a-44f3-ac50-78ca4d645b81"}]},{"start":false,"name":"Enter_PIN","config":[],"content":[{"name":"header","type":"area","item-type":"static","_auto_id_":"9464c549-196e-4755-909d-053346e36dd7","content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"2d5e8e92-2c5a-4788-bbe8-652b26531d85","attributes":{},"expressions":{}},{"name":"html_splash","type":"content","item-type":"html","_auto_id_":"5bb67f4c-a423-4270-9de7-9f140c22ca83","content":"<div class=\"header\">\n  <div class=\"logo\"/>\n</div>","expressions":{}}],"expressions":{}},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"html_instructions","type":"content","item-type":"html","_auto_id_":"96c2a1d5-5c2b-41ca-80c2-0f2db09dad12","content":"<div class=\"splash\">\n  <div class=\"riologo\"/>\n</div>\n<h3>Enter App Pin</h3>\n<h5>Please enter your app PIN below</h5>","expressions":{}},{"name":"group_login","type":"area","item-type":"group","_auto_id_":"9d696345-8cf6-462d-ae3e-526bb53b3abf","content":[{"name":"pwdUserPIN","type":"user-input","item-type":"password","_auto_id_":"175e85e9-f629-40c1-b432-999dde3c857c","label":"","required":false,"message":"This is a required field","expressions":{},"placeholder":"Enter your app PIN","actions":[],"validators":[],"classes":"minimal"},{"name":"button_submit_pin","type":"button","item-type":"button","_auto_id_":"e5cd7fbe-6b75-41f9-a786-f474d8907da6","content":"Enter Pin","theme":"minimal","expressions":{"disabled":"$store.pages.Enter_PIN.pwdUserPIN === undefined || $store.pages.Enter_PIN.pwdUserPIN === \"\""},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"if(cti.store.pages.Enter_PIN.pwdUserPIN == cti.store.variables.v_userPIN){\n  cti.store.pages.Enter_PIN.pwdUserPIN = \"\";\n  cti.store.variables.pin_login = true\n  \n  cti.store.variables.v_appointmentDate = moment().format(\"YYYY-MM-DD\");\n  cti.store.variables.v_appointmentDateText = 'Today';\n  \n  if(cti.store.variables.online == \"online\") {\n    cti.fn_toggle_spinner('open', 'Fetching Appointments, please wait...')\n    cti.utils.callAction(\"call-actionflow\", { name: \"GetVisitList\" })\n  } else {\n    cti.fn_load_appointments()\n  }\n} else {\n  cti.store.pages.Enter_PIN.pwdUserPIN = \"\";\n  cti.store.variables.v_pinAttempts = cti.store.variables.v_pinAttempts + 1;\n\n  if(cti.store.variables.v_pinAttempts >= 3){\n    delete cti.store.variables.v_userPIN;\n    delete cti.store.variables.v_isAuthenticated;\n    cti.store.variables.v_pinAttempts = 0; \n    cti.store.pages.Login.password = \"\";\n    cti.utils.callAction(\"go-to-page\", {\"name\" : \"Login\"});\n  }\n}"},"_auto_id_":"aa2149ec-a8cb-4cc7-a595-9a3448b2dbbb"}],"classes":"default"},{"name":"button_revoke","type":"button","item-type":"button","_auto_id_":"a90d7c36-ce47-4d55-a4ce-8579d6875aa9","content":"Revoke Authentication","theme":"minimal","expressions":{"show":"$store.variables.v_isAuthenticated"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_revoke - page Enter_PIN', \n  'info'\n)\n\ncti.store.variables.v_isAuthenticated = false\ncti.fn_revoke_cleardown()\ncti.store.pages.Login.password = \"\"\n\n// Store a temp copy of the username for use within the deregister push call.\ncti.store.variables.temp_user = cti.store.variables.loggedInUser\ncti.store.variables.loggedInUser = ''\n\n// Delete appointments from pouch\nwindow.pouchManager.loadFromDatabase('appointments', function (doc) {\n  // Reset appointments array\n  doc.data = []\n\n  window.pouchManager.saveToDatabase(\n    \"appointments\", \n    doc.data, function(rev) {\n      window.logManager.consoleLog(\n        'Pouch DB: Successfully deleted Appointments Data from Pouch', \n        'info'\n      )\n      cti.utils.callAction(\"go-to-page\", {\"name\":\"Login\"})\n    }, function(reason, e) {\n      window.logManager.consoleLog(\n        'Pouch DB - Failed to delete Appointment Data - ' + reason, e, \n        'error'\n      )\n    })\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Login\"})\n}, function (reason, err) {\n  window.logManager.consoleLog(\n    'Pouch DB: Failed retriveing Appointments Data from Pouch - ' + reason + err, \n    'error'\n  )\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Login\"})\n})\n\n$success()"},"_auto_id_":"8225e185-6162-41a5-a762-cb55e10ebd94","actions":[]},{"event":"click","type":"call-actionflow","data":{"name":"DeregisterPush"},"_auto_id_":"c5b4b594-be34-41c7-b63a-8099c4335d3a"}]}],"repeat":false,"expressions":{}}],"_auto_id_":"2773108f-bfd8-42ae-aafe-20fd771e60e9"}]},{"start":false,"name":"Set_PIN","config":[],"content":[{"name":"header","type":"area","item-type":"static","_auto_id_":"b1b736a7-4de4-4294-9dfb-b073f331c718","content":[{"name":"html_splash","type":"content","item-type":"html","_auto_id_":"9a9f552f-09f5-452f-92d2-58d9d7d11b71","content":"<div class=\"header\">\n  <div class=\"logo\"/>\n</div>","expressions":{}},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"1a907fa4-f69f-4651-a0a5-32ea4b407d24","attributes":{},"expressions":{}}],"expressions":{}},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"html_instructions","type":"content","item-type":"html","_auto_id_":"62697f54-a4ae-48b7-93b8-0ca17c4473d9","content":"<div class=\"splash\">\n  <div class=\"riologo\"/>\n</div>\n<h3>Set App Pin</h3>\n<h5>Set a PIN code for this app below</h5>","expressions":{}},{"name":"group_login","type":"area","item-type":"group","_auto_id_":"6c155373-9bcd-4d1d-bf38-5249d78e2d43","content":[{"name":"txtPIN","type":"user-input","item-type":"text","_auto_id_":"b67fd058-2955-4fb7-a7e3-a50f9d4eae4e","label":"","required":false,"multiline":false,"debounce":250,"expressions":{},"validators":[],"actions":[],"classes":"minimal"},{"name":"button_set_pin","type":"button","item-type":"button","_auto_id_":"db5bf87b-fd89-47f2-b8d5-9c3e417bd5e7","content":"Set Pin","theme":"minimal","expressions":{"disabled":"$store.pages.Set_PIN.txtPIN === undefined"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"if(cti.store.pages.Set_PIN.txtPIN != \"\"){\n  cti.store.variables.v_userPIN = cti.store.pages.Set_PIN.txtPIN;\n  cti.store.pages.Set_PIN.txtPIN = \"\";\n\n  cti.store.variables.v_pinAttempts = 0;\n  \n  if(cti.store.variables.getVisitListStatus) {\n    cti.fn_load_appointments()\n  } else {\n    cti.store.variables.v_appointmentDate = moment().format(\"YYYY-MM-DD\")\n    cti.store.variables.v_appointmentDateText = 'Today'\n    \n    cti.fn_toggle_spinner('open', 'Fetching Appointments, please wait...')\n    cti.utils.callAction(\"call-actionflow\", { name: \"GetVisitList\" })\n  }\n}"},"_auto_id_":"17233199-44e8-4745-81a4-ba194a920062","actions":[]}],"classes":"default"},{"name":"button_revoke","type":"button","item-type":"button","_auto_id_":"2c75a3ce-cc61-42b9-b266-ba024369e6b5","content":"Revoke Authentication","theme":"minimal","expressions":{"show":"$store.variables.v_isAuthenticated"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_revoke - page Set_PIN', \n  'info'\n)\n\ncti.store.variables.v_isAuthenticated = false\ncti.fn_revoke_cleardown()\ncti.store.pages.Login.password = \"\"\n\n// Store a temp copy of the username for use within the deregister push call.\ncti.store.variables.temp_user = cti.store.variables.loggedInUser\ncti.store.variables.loggedInUser = ''\n\n// Delete appointments from pouch\nwindow.pouchManager.loadFromDatabase('appointments', function (doc) {\n  // Reset appointments array\n  doc.data = []\n\n  window.pouchManager.saveToDatabase(\n    \"appointments\", \n    doc.data, function(rev) {\n      window.logManager.consoleLog(\n        'Pouch DB: Successfully deleted Appointments Data from Pouch', \n        'info'\n      )\n      cti.utils.callAction(\"go-to-page\", {\"name\":\"Login\"})\n    }, function(reason, e) {\n      window.logManager.consoleLog(\n        'Pouch DB - Failed to delete Appointment Data - ' + reason, e, \n        'error'\n      )\n    })\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Login\"})\n}, function (reason, err) {\n  window.logManager.consoleLog(\n    'Pouch DB: Failed retriveing Appointments Data from Pouch - ' + reason + err, \n    'error'\n  )\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Login\"})\n})\n\n$success()"},"_auto_id_":"12d1afb3-ad4f-40e2-9e0f-281a8846c967","actions":[]},{"event":"click","type":"call-actionflow","data":{"name":"DeregisterPush"},"_auto_id_":"19c7cc4a-d32c-43e2-bc2b-fb8d64327e9f"}]}],"repeat":false,"expressions":{}}],"_auto_id_":"ec836e81-9291-4beb-bc57-26ebe2f31adb"}]},{"start":false,"name":"RemoveAlert","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"ee2d7609-4df1-4b58-86af-25d67b5b8d8e","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"RemoveAlert","componentInstanceId":"e7fa22a5-a954-4f24-9001-44e2be773bfb","function":"toggle"},"_auto_id_":"2a12690b-7f17-4b72-9f0e-d591b5c46726"}]},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"a5effb9b-1fa7-48a0-97be-2f2e784a06b1","attributes":{},"expressions":{}},{"name":"title","type":"content","item-type":"title","content":"<h4>Remove Alert</h4>","_auto_id_":"40d763ce-8915-4d04-8ef2-ae9b18db581f"}],"_auto_id_":"7e576a4c-d9a9-4bee-8cfc-68aa99ae95c1"},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"69d4943d-2475-4c13-be88-b959b1dbfbaa","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"17cba1a3-ff9b-4425-ba97-cce5d4566d67","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}}],"expressions":{}},{"name":"scrollable_results","type":"area","item-type":"scrollable","content":[{"name":"list_alerts","type":"content","item-type":"list","_auto_id_":"32056676-01de-4ce5-b64e-02f85d1bc957","search":"","classes":"","expressions":{},"model":"$store.variables.alerts","dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_alerts_html","_auto_id_":"24f2a90c-afe2-455e-a6fb-0cd33b3688d2","content":"<!-- HTML Template for tablet size devices and above -->\n<div class=\"row hidden-xs hidden-top-row\">   \n  <div class=\"floatLeft\">\n    <strong>Date:</strong> <span class=\"highlight\">{{$data.$item.date | date:'yyyy-MM-dd HH:mm'}}</span>\n  </div>\n  <div class=\"floatRight\">\n    <strong>Priority:</strong> {{$data.$item.priority.value }}\n  </div>\n</div>\n<div class=\"row hidden-xs hidden-middle-row\">   \n  <div class=\"floatLeft\">\n    <strong>Type:</strong> {{$data.$item.type.value}}\t\n  </div>\n  <div class=\"floatRight\">\n    <strong>Ended:</strong> {{$data.$item.removalDate == undefined ? \"No\" : \"Yes\"}}\t\n  </div>\n</div>\n<div class=\"row hidden-xs hidden-middle-row {{$data.$item.removalDate == undefined ? 'display-none' : 'Yes'}}\">   \n  <div class=\"floatLeft\">\n    <strong>Removal Date:</strong> {{$data.$item.date | date:mediumDate}}\n  </div>\n  <div class=\"floatRight\">\n    <strong>Removal Comment:</strong> {{$data.$item.removalComment == \"\" ? \"No Comment\" : $data.$item.removalComment}}\t\n  </div>\n</div>\n<div class=\"row hidden-xs hidden-bottom-row\">   \n  <div class=\"floatLeft\">\n    {{$data.$item.text}}\n  </div>\n</div>\n\n<!-- HTML Template for smaller mobile devices -->\n<div class=\"row visible-xs visible-top-row\">   \n  <div class=\"floatLeft\">\n    <strong>Date:</strong> <span class=\"highlight\">{{$data.$item.date | date:'yyyy-MM-dd HH:mm'}}</span>\n  </div>\n  <div class=\"floatRight\">\n    <strong>Priority:</strong> {{$data.$item.priority.value }}\n  </div>\n</div>\n<div class=\"row visible-xs visible-middle-row\">   \n  <div class=\"floatLeft\">\n    <strong>Type:</strong> {{$data.$item.type.value}}\t\n  </div>\n</div>\n<div class=\"row visible-xs visible-middle-row\">   \n  <div class=\"floatLeft\">\n    <strong>Ended:</strong> {{$data.$item.removalDate == undefined ? \"No\" : \"Yes\"}}\t\n  </div>\n</div>\n<div class=\"row visible-xs visible-middle-row {{$data.$item.removalDate == undefined ? 'display-none' : 'Yes'}}\">   \n  <div class=\"floatLeft\">\n    <strong>Removal Date:</strong> {{$data.$item.date | date:mediumDate}}\n  </div>\n</div>\n<div class=\"row visible-xs visible-middle-row {{$data.$item.removalDate == undefined ? 'display-none' : 'Yes'}}\">   \n  <div class=\"floatLeft\">\n    <strong>Removal Comment:</strong> {{$data.$item.removalComment == \"\" ? \"No Comment\" : $data.$item.removalComment}}\t\n  </div>\n</div>\n<div class=\"row visible-xs visible-bottom-row\">   \n  <div class=\"floatLeft\">\n    {{$data.$item.text}}\n  </div>\n</div>","expressions":{"show":"$store.variables.selected_visit.patientData.displayAlerts.length > 0"}}],"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"if(cti.store.variables.alertToRemove) {\n  var visibleString = 'alertRowVisible-' + cti.store.variables.alertToRemove.id;\n  var hiddenString = 'alertRowHidden-' + cti.store.variables.alertToRemove.id;\n\n  var visible = document.getElementById(visibleString);\n  var hidden = document.getElementById(hiddenString);\n\n  if(visible == null) {\n    delete cti.store.variables.alertToRemove;\n    return false;\n  }\n  if(hidden == null) {\n    delete cti.store.variables.alertToRemove;\n    return false;\n  }\n\n  visible.classList.remove('selected');\n  hidden.classList.remove('selected');\n  \n  if($data.$item.id != cti.store.variables.alertToRemove.id) {\n    cti.store.variables.alertToRemove = $data.$item;\n\n    var visibleString = 'alertRowVisible-' + {{$data.$item.id}};\n    var hiddenString = 'alertRowHidden-' + {{$data.$item.id}};\n\n    var visible = document.getElementById(visibleString);\n    var hidden = document.getElementById(hiddenString);\n\n    visible.classList.add('selected');\n    hidden.classList.add('selected');\n  } else {\n    delete cti.store.variables.alertToRemove;\n  }\n} else {\n    cti.store.variables.alertToRemove = $data.$item;\n\n  var visibleString = 'alertRowVisible-' + {{$data.$item.id}};\n  var hiddenString = 'alertRowHidden-' + {{$data.$item.id}};\n\n  var visible = document.getElementById(visibleString);\n  var hidden = document.getElementById(hiddenString);\n\n  visible.classList.add('selected');\n  hidden.classList.add('selected');\n}\n\ncti.utils.updatePage();"},"_auto_id_":"3f279233-c78a-4c4c-8871-432771f6bfae"}]}],"_auto_id_":"e88b14df-d716-44bf-ac0d-716c8e0dcccf","expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"77818705-adf6-4fa1-a65a-3785927a523f","content":[{"name":"date","type":"user-input","item-type":"date","_auto_id_":"34a9c373-2012-44aa-b5ea-f0da85e88ec4","label":"End Date: ","required":true,"left-icon":"fa-calendar","expressions":{},"message":"This is a required field","validators":[]},{"name":"description","type":"user-input","item-type":"text","_auto_id_":"91de92e7-4531-4cec-882d-395d5fa371e6","label":"Comment:","required":true,"multiline":true,"debounce":1000,"message":"This is a required field","expressions":{},"maxlength":500,"validators":[]},{"name":"popupBack","type":"component","item-type":"web-component","content":[{"name":"html_warning","type":"content","item-type":"html","_auto_id_":"f634de34-4a62-4105-9f22-63b8149450bf","content":"<h2>Cancel Alert Removal</h2>\n<p>You are about to cancel the Alert Removal for this Alert. Any information entered on this page will be cleared down.</p>\n<p>Are you sure you want to continue? </p>","expressions":{}},{"name":"button_bar_mobile","type":"area","item-type":"button-bar","_auto_id_":"d72f0b67-951e-40e6-83ef-28201c80a0de","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_no","type":"button","item-type":"button","_auto_id_":"27d9b7ac-2c2e-4f38-b170-db4b747155d4","content":"CANCEL ALERT","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.v_alertToRemove_clear = true\n\nwindow.logManager.consoleLog(\n  'inline function - button_back - page: RemoveAlert', \n  'info'\n)\n\ncti.utils.callAction(\"go-to-page\", { \"name\" : \"Alerts\" })\n\n$success()"},"_auto_id_":"62ec4d93-ee85-42de-81ec-1f76b32bdfb6"},{"event":"click","type":"call-component-function","data":{"page":"RemoveAlert","componentInstanceId":"e7fa22a5-a954-4f24-9001-44e2be773bfb","function":"toggle"},"_auto_id_":"31fc3747-52a2-42c2-acd1-cd31315f41de"}],"classes":"default"},{"name":"button_yes","type":"button","item-type":"button","_auto_id_":"554d55db-7d4e-466d-9996-5907b55b14c6","content":"BACK","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"RemoveAlert","componentInstanceId":"e7fa22a5-a954-4f24-9001-44e2be773bfb","function":"toggle"},"_auto_id_":"e4ef41d2-5def-46ab-b553-02c526662755"}]}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"e7fa22a5-a954-4f24-9001-44e2be773bfb","attributes":{},"expressions":{}}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_save","type":"button","item-type":"button","_auto_id_":"0d4dead3-fdd3-4b55-a095-01e3d96b9f3f","content":"SAVE","theme":"default","expressions":{"disabled":"$form.invalid;"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var alert = cti.store.variables.alerts[0]\n\nif(alert) {\n  var createdDate = moment(alert.date).format(\"YYYY-MM-DD\");\n  var removeDate = moment(cti.store.pages.RemoveAlert.date).format(\"YYYY-MM-DD\");\n  if(createdDate > removeDate) {\n      cti.utils.callAction(\n        \"show-notification\", {\n          \"name\": \"notification_warning\",\n          \"title\": \"Incorrect Date Entered\",\n          \"text\": \"Please select an End Date that is not older than the Alert's created date.\"\n        }\n      );\n  } else {\n    // Calls embedded CallActionFlow attached to this inline-function\n    delete cti.store.variables.alerts\n    cti.store.variables.alertToRemove = alert\n    $success();\n  }\n} else {\n  cti.utils.callAction(\n    \"show-notification\", {\n      \"name\": \"notification_warning\",\n      \"title\": \"No Alert Selected\",\n      \"text\": \"Please select the Alert you wish to remove from the list above.\"\n    }\n  );\n}"},"_auto_id_":"7ec838b7-0288-47a3-8571-75755a6a74b6","actions":[{"event":"success","type":"call-actionflow","data":{"name":"RemoveAlert"},"_auto_id_":"451aa864-21e9-40a7-a77d-b08d88d6152b"}]}],"classes":"default"}],"_auto_id_":"bf77a799-9db0-4319-b305-0f12d4a658f4","expressions":{}}]},{"start":false,"name":"SafetyForm","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"3d9a24c7-c098-4159-b1b0-7a6e23226496","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"568d4edd-3bf9-4576-9ea6-54db2df16336","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"1df89465-4282-4741-b424-f0acb2def786"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>My Safety Plan</h4>","_auto_id_":"4d685c20-2ab5-49dd-ac46-128c7970b2a3"}],"_auto_id_":"791a1753-ff6e-41c2-8773-9c72a6fe299b"},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"e72735bc-e836-4634-bd89-d9916caf06c5","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"5e7cd98a-191f-485e-8e32-9536e16b2cf4","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"80ff9a54-1fd2-489a-ac1a-beaa34e72a75","content":"Appointment Type: {{'$store.variables.selected_visit.appointmentType.value '|store}}","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""}],"expressions":{}},{"name":"scrollable_results","type":"area","item-type":"scrollable","content":[{"name":"sf_triggers","type":"user-input","item-type":"text","_auto_id_":"c35442a7-cf26-478a-9f7d-10de8a846e21","label":"Triggers: ","required":false,"multiline":true,"debounce":1000,"expressions":{}},{"name":"sf_triggers_actionplan","type":"user-input","item-type":"text","_auto_id_":"570e08e0-9173-44bb-8ca2-c3b779219525","label":"Triggers action plan:","required":false,"multiline":true,"debounce":1000,"expressions":{}},{"name":"sf_earlyws","type":"user-input","item-type":"text","_auto_id_":"86ae04bf-eafa-4f56-8160-859f2fd567af","label":"How do I know when things are getting worse? (Early warning signs)","required":false,"multiline":true,"debounce":1000,"expressions":{}},{"name":"sf_earlyws_actionplan","type":"user-input","item-type":"text","_auto_id_":"44de0f59-9abc-4d23-b01b-f87ee17ea557","label":"When things are getting worse action plan:","required":false,"multiline":true,"debounce":1000,"expressions":{}},{"name":"sf_getworse","type":"user-input","item-type":"text","_auto_id_":"53124c75-ab69-49d1-b907-854a74fb892e","label":"How do I know when things have got worse? (e.g. in crisis, feeling unsafe)","required":false,"multiline":true,"debounce":1000,"expressions":{}},{"name":"sf_getworse_actionplan","type":"user-input","item-type":"text","_auto_id_":"aca2518d-9956-4b5e-a4b7-fd8fd3cefb51","label":"When things have got worse action plan:","required":false,"multiline":true,"debounce":1000,"expressions":{}},{"name":"sf_assisteddecision","type":"user-input","item-type":"text","_auto_id_":"91d3046a-0075-4604-8eba-2be07d3393e6","label":"What I would like you to do for me when I am unable to make decisions for myself?","required":false,"multiline":true,"debounce":1000,"expressions":{}},{"name":"sf_advancedirective","type":"choice","item-type":"switch","_auto_id_":"c8c89b0c-cea9-45e2-8b94-d00ca9b9ffdd","label":"This is my Advance Directive: ","required":false,"on-text":"Yes","off-text":"No","expressions":{},"validators":[],"actions":[]},{"name":"sf_contact","type":"user-input","item-type":"text","_auto_id_":"1e55f629-399b-4192-bbae-444ac8dd1fd6","label":"How can I best be contacted?","required":false,"multiline":true,"debounce":1000,"expressions":{}},{"name":"sf_contactreach","type":"user-input","item-type":"text","_auto_id_":"f0c91a66-eb1e-443b-a79a-ceee93fc2341","label":"Who can be contacted if I can't be reached?","required":false,"multiline":true,"debounce":1000,"expressions":{}},{"name":"sf_crisisnumber","type":"user-input","item-type":"text","_auto_id_":"432ac1c2-ed67-4f41-bdf5-354c285325ec","label":"My local crisis line number is:","required":false,"multiline":true,"debounce":1000,"expressions":{}},{"name":"sf_outofcrisis","type":"user-input","item-type":"text","_auto_id_":"c176c369-97b0-4b3d-8766-2436fb6d38c3","label":"How will I know when I am out of crisis?","required":false,"multiline":true,"debounce":1000,"expressions":{}},{"name":"sf_serviceuseragreedplan","type":"choice","item-type":"switch","_auto_id_":"62629de2-deff-4809-b2be-8f82eadb0fac","label":"Service user agreed plan? ","required":false,"on-text":"Yes","off-text":"No","expressions":{},"validators":[],"actions":[]}],"_auto_id_":"37cc478e-f7ac-42a6-b178-e0cebdad579d","expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_save","type":"button","item-type":"button","_auto_id_":"4fea0139-dcdc-44af-a1e4-7282b9cc8b6b","content":"SAVE","theme":"default","expressions":{"disabled":"$form.invalid;"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"//cti.store.variables.selected_visit.safety_form_status = true;\n//cti.store.variables.selected_visit.safety_form_object.status = \"complete\";\n//cti.utils.callAction(\"go-to-page\", {\"name\":\"Visit\"});\n// TODO: Tidy up expired code\ncti.utils.callAction(\"call-actionflow\", { name: \"SubmitSafetyForm\" })"},"_auto_id_":"902b36f3-dcb8-463c-940f-a9536cb9e3d2","actions":[]}],"classes":"default"}],"_auto_id_":"00c11f50-00d9-4d4a-88cf-121e9ae04c5f","expressions":{}}]},{"start":false,"name":"SafetyForm_View","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"6ad46cb5-0d6a-40f0-876b-460317a46dab","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"a6f7fea7-9cec-4c9d-a804-c3ff7a885ebf","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.safetyForm_View_clear = true\n$success()"},"_auto_id_":"e4654bfa-5252-418c-82de-e4db8f082c0c"},{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"c9e7073e-381d-4b43-a623-266723c423e4"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>My Safety Plans</h4>","_auto_id_":"95e2cc7e-a377-4991-9da8-0d65007e39f1"}],"_auto_id_":"3cd3a3f2-597f-4674-b949-87f38c0f6c64"},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"4c085f67-050a-4631-860a-213c6a72bccd","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"3fa19fd3-1a43-4442-b178-9a85a75f5f43","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"966d1bce-f617-4be7-ba71-7d3888866057","content":"Appointment Type: {{'$store.variables.selected_visit.appointmentType.value '|store}}","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""}],"expressions":{}},{"name":"scrollable_results","type":"area","item-type":"scrollable","content":[{"name":"list_safety_forms","type":"content","item-type":"list","_auto_id_":"65362235-f12b-4782-8d03-3a539f56b878","static":false,"model":"$store.variables.v_safetyForms","data":"[]","autoscroll":false,"search":"","order":false,"pagination":true,"content":[{"name":"button_back_to_date","type":"button","item-type":"button","_auto_id_":"a1ca3cd7-78cb-4f54-9112-e2ac5a1442e9","content":"Completed On: {{$data.$item.sf_assessmentdate}}","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""},{"name":"sf_triggers","type":"user-input","item-type":"text","_auto_id_":"93dcbc92-2745-4012-b7b9-251b9bc674b0","label":"Triggers: ","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"1"},"validators":[],"actions":[]},{"name":"sf_triggers_actionplan","type":"user-input","item-type":"text","_auto_id_":"dafefb91-ae73-4490-aeb1-4221c5253ea3","label":"Triggers action plan:","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"1"}},{"name":"sf_earlyws","type":"user-input","item-type":"text","_auto_id_":"de2971d5-150c-47be-a603-9ff1793e67ce","label":"How do I know when things are getting worse? (Early warning sings)","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"1"}},{"name":"sf_earlyws_actionplan","type":"user-input","item-type":"text","_auto_id_":"e865f373-a3d1-46d8-846e-04b8175c25fb","label":"When things are getting worse action plan:","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"1"}},{"name":"sf_getworse","type":"user-input","item-type":"text","_auto_id_":"74d30bb3-c757-4b46-8dc4-3fc00a038001","label":"How do I know when things have got worse? (e.g. in crisis, feeling unsafe)","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"1"}},{"name":"sf_getworse_actionplan","type":"user-input","item-type":"text","_auto_id_":"dbed890b-557f-4c45-8092-0deced0a9efd","label":"When things have got worse action plan:","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"1"}},{"name":"sf_assisteddecision","type":"user-input","item-type":"text","_auto_id_":"66155052-9c57-41ed-b5f4-571eb267ce2d","label":"What I would like you to do for me when I am unable to make decisions for myself?","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"1"}},{"name":"sf_advancedirective","type":"choice","item-type":"switch","_auto_id_":"35a9f26e-0de0-43fe-a77f-c5dfc944ef34","label":"This is my Advance Directive: ","required":false,"on-text":"Yes","off-text":"No","expressions":{"disabled":"1"},"validators":[],"actions":[]},{"name":"sf_contact","type":"user-input","item-type":"text","_auto_id_":"d6d8b17f-2e78-43b0-bf87-0695d61ca57c","label":"How can I best be contacted?","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"1"}},{"name":"sf_contactreach","type":"user-input","item-type":"text","_auto_id_":"51e32879-a449-42fe-820a-801e11a37c36","label":"Who can be contacted if I can't be reached?","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"1"}},{"name":"sf_crisisnumber","type":"user-input","item-type":"text","_auto_id_":"542877b1-a25d-4c40-a5d7-d8a6786b8891","label":"My local crisis line number is:","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"1"}},{"name":"sf_outofcrisis","type":"user-input","item-type":"text","_auto_id_":"8f3268d5-45e9-424b-add6-665533cc694a","label":"How will I know when I am out of crisis?","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"1"}},{"name":"sf_serviceuseragreedplan","type":"choice","item-type":"switch","_auto_id_":"2e6ce833-1bae-4a3e-8340-07a996549a53","label":"Service user agreed plan? ","required":false,"on-text":"Yes","off-text":"No","expressions":{"disabled":"1"},"validators":[],"actions":[]}],"dataSource":"dynamic","expressions":{},"paginationItemsPerPage":1,"paginationBelow":true,"paginationFirstLabel":"First","paginationPrevLabel":"Prev","paginationNextLabel":"Next","paginationLastLabel":"Last","paginationPrevNext":false,"paginationShowOnePage":false,"paginationAbove":false}],"_auto_id_":"94912d65-d56c-4bc2-83f5-d6cc577d55ff","expressions":{}}]},{"start":false,"name":"DialogForm_View","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"c0cc8e12-850e-4417-bcfe-142d759d8f75","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"251c4f58-f832-4e96-8b2f-f77f391b521d","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.dialogForm_View_clear = true\n$success()"},"_auto_id_":"984d10d9-f38e-4eab-9031-5a5fff5ec56a"},{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"4b957d04-020f-4778-b845-b215dc438aff"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Dialog Forms</h4>","_auto_id_":"e8401da0-307a-4e65-9e13-524c1389c78f"}],"_auto_id_":"4358352d-4db3-40d8-9808-14db5b2e4472","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"21efffc3-4efd-40f0-9a50-ff46dd611265","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"a62d47c1-d51e-4bcd-9e53-ccd21b7271b1","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"6b3c2dd8-16cf-4a2e-944e-bc3128dd579e","content":"Appointment Type: {{'$store.variables.selected_visit.appointmentType.value '|store}}","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""}],"expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"c1927ba0-8e41-4c14-86b0-ac4dc81a1dcc","content":[{"name":"list_dialogForms","type":"content","item-type":"list","_auto_id_":"a5507de0-883a-4d9c-b9dc-6b6b59c90671","static":false,"model":"$store.variables.v_dialogForms","data":"[]","autoscroll":false,"search":"","order":false,"pagination":true,"content":[{"name":"button_back_to_date","type":"button","item-type":"button","_auto_id_":"3f957a38-dd3a-42e7-90b5-81207679e6fd","content":"Completed On: {{$data.$item.AssessmentDate}}","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""},{"name":"preAssessmentQuestions","type":"content","item-type":"html","_auto_id_":"ba3b3600-7dc2-4eb5-8a21-78e105d4f3c1","content":"<div onclick=\"cti.fn_toggle_dialog('assessment')\" style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Pre Assessment Questions</h4>\n  <i id=\"assessment\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{},"classes":""},{"name":"StageTreat","type":"choice","item-type":"select","_auto_id_":"086ef281-9b99-4594-b57f-eba93a44fa60","label":"Is this a CPA Review?","required":false,"options":[{"label":"Yes","value":"03CRP"},{"label":"No","value":"05"}],"expressions":{"disabled":"1","show":"$store.variables.dialogHideFlags.assessment == false"},"message":"This is a required field"},{"name":"StageTreat1","type":"choice","item-type":"select","_auto_id_":"960345ba-73f2-4101-bf9f-df54f7ee0ed9","label":"Stage of Treatment:","required":false,"options":[{"label":"Assessment","value":"01ASS"},{"label":"Review","value":"02Rev"},{"label":"Discharge (from CPA or Trust)","value":"03Dis"}],"expressions":{"disabled":"1","show":"$store.variables.dialogHideFlags.assessment == false"},"message":"This is a required field"},{"name":"InCareDec","type":"choice","item-type":"select","_auto_id_":"6cb6d6c4-0cd1-45cb-ba77-3cd0cebaabe0","label":"Initial Care Decision:","required":false,"options":[{"label":"Short term support to max independence","value":"01az"},{"label":"Long term support -  nursing care","value":"02az"},{"label":"Long term support - residential care","value":"03az"},{"label":"Long term support - community / prison","value":"04az"},{"label":"100% NHS funded care","value":"05az"},{"label":"End of life","value":"06az"},{"label":"Ongoing low level support","value":"07az"},{"label":"Short term support (other)","value":"08az"},{"label":"Signposted to other services","value":"09az"},{"label":"No services provided - deceased","value":"10az"},{"label":"No services provided - other reason","value":"11az"}],"expressions":{"disabled":"1","show":"$store.variables.dialogHideFlags.assessment == false"},"message":"This is a required field"},{"name":"SUCap","type":"choice","item-type":"select","_auto_id_":"fba12422-8157-477a-8c7a-a7fd7eebca98","label":"Service User response:","required":false,"options":[{"label":"Service user agreed assessment","value":"01SUA"},{"label":"Service user declined assessment","value":"02SUDA"},{"label":"SU lacks capacity - carer completed","value":"03SULCCARE"},{"label":"SU lacks capacity - clinician completed","value":"04SULCCLIN"},{"label":"SU declined-carer completed(CAMHS only)","value":"05SUDCAMHS"}],"expressions":{"disabled":"1","show":"$store.variables.dialogHideFlags.assessment == false"},"message":"This is a required field"},{"name":"MHRecovery","type":"user-input","item-type":"text","_auto_id_":"0884e1fc-0a82-40d5-9902-cdd4d52c0927","label":"What recovery means to me? My long term goals.  What I would like to achieve in 12 months time.","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"1","show":"$store.variables.dialogHideFlags.assessment == false"},"message":"This is a required field"},{"name":"MHMatters","type":"user-input","item-type":"text","_auto_id_":"88b54831-eec8-4afe-bca2-2e83ee2e0ffb","label":"What matters to me?","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"1","show":"$store.variables.dialogHideFlags.assessment == false"},"message":"This is a required field"},{"name":"MHSkills","type":"user-input","item-type":"text","_auto_id_":"e0960e20-28e6-4329-82cb-543cc79d014c","label":"My skills, strengths and experiences that will help me achieve my goals?","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"1","show":"$store.variables.dialogHideFlags.assessment == false"},"message":"This is a required field"},{"name":"mentalHealthTitle","type":"content","item-type":"html","_auto_id_":"d73ee4b0-f8e5-47a7-abb0-51c6074f60e8","content":"<hr/>\n<div onclick=\"cti.fn_toggle_dialog('mental')\" style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Mental Health</h4>\n  <i id=\"mental\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{},"classes":""},{"name":"MHSat1","type":"choice","item-type":"slider","_auto_id_":"68506a89-566f-481b-9a61-bccf5b12996e","label":"How satisfied are you with your mental health? ","required":false,"dual":false,"default":0,"min":1,"max":7,"step":1,"message":"This is a required field","validators":[],"actions":[],"expressions":{"disabled":"1","show":"$store.variables.dialogHideFlags.mental == false"}},{"name":"MHSatHelp","type":"choice","item-type":"radio","_auto_id_":"52ddbd2e-1235-411c-ac26-f9ec2aedc5df","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"1","show":"$store.variables.dialogHideFlags.mental == false"},"actions":[],"validators":[]},{"name":"MHSatActions","type":"user-input","item-type":"text","_auto_id_":"0ee04782-5e1b-46df-80de-65cec3b36c73","label":"Mental health goals and actions:","required":false,"multiline":true,"debounce":1000,"validators":[],"actions":[],"expressions":{"show":"$data.$item.MHSatHelp == '1' && $store.variables.dialogHideFlags.mental == false","disabled":"1"},"placeholder":""},{"name":"physicalHealthTitle","type":"content","item-type":"html","_auto_id_":"43b1553a-2eda-4c2f-98f6-f38d4a6b73ae","content":"<hr/>\n<div onclick=\"cti.fn_toggle_dialog('physical')\" style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Physical Health</h4>\n  <i id=\"physical\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{},"classes":""},{"name":"PHSatPL","type":"choice","item-type":"slider","_auto_id_":"79c20e72-ca25-4a15-addc-98db440a6963","label":"How satisfied are you with your physical health?","required":false,"dual":false,"default":0,"min":1,"max":7,"step":1,"expressions":{"disabled":"1","show":"$store.variables.dialogHideFlags.physical == false"}},{"name":"PHSatHelp","type":"choice","item-type":"radio","_auto_id_":"0ddfb910-2b53-41ad-8236-2130de5c5425","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"1","show":"$store.variables.dialogHideFlags.physical == false"}},{"name":"PHSatActions","type":"user-input","item-type":"text","_auto_id_":"6a5d24b5-0c18-46ca-8543-b1122ce89bcd","label":"Physical health goals and actions:","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$data.$item.PHSatHelp == '1' && $store.variables.dialogHideFlags.physical == false","disabled":"1"},"validators":[]},{"name":"jobSituationTitle","type":"content","item-type":"html","_auto_id_":"7f8591c3-ad6c-4e22-909b-0001148a2d66","content":"<hr/>\n<div onclick=\"cti.fn_toggle_dialog('job')\" style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Job Situation</h4>\n  <i id=\"job\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{},"classes":""},{"name":"JSSatPL","type":"choice","item-type":"slider","_auto_id_":"b56e34d2-f566-43df-a689-d3d0c24bd78e","label":"How satisfied are you with your job situation?","required":false,"dual":false,"default":0,"min":1,"max":7,"step":1,"expressions":{"disabled":"1","show":"$store.variables.dialogHideFlags.job == false"}},{"name":"JSSatHelp","type":"choice","item-type":"radio","_auto_id_":"64c9cb88-0cc8-4b16-a1c8-8683cd055ec6","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"1","show":"$store.variables.dialogHideFlags.job == false"},"validators":[]},{"name":"JSSatActions","type":"user-input","item-type":"text","_auto_id_":"d589f3c8-fdb9-4269-a4c4-5d90b9673e01","label":"Job situation goals and actions:","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$data.$item.JSSatHelp == '1' && $store.variables.dialogHideFlags.job == false","disabled":"1"},"validators":[]},{"name":"accommodationTitle","type":"content","item-type":"html","_auto_id_":"f4006084-36d6-4e0c-b8fe-a96f1048b24e","content":"<hr/>\n<div onclick=\"cti.fn_toggle_dialog('accommodation')\" style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Accommodation</h4>\n  <i id=\"accommodation\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{},"classes":""},{"name":"ACSatPL","type":"choice","item-type":"slider","_auto_id_":"00e5e549-d5a6-4273-8631-4112e0e5eb7d","label":"How satisfied are you with your accommodation?","required":false,"dual":false,"default":0,"min":1,"max":7,"step":1,"expressions":{"disabled":"1","show":"$store.variables.dialogHideFlags.accommodation == false"}},{"name":"ACSatHelp","type":"choice","item-type":"radio","_auto_id_":"6a07f63e-2c07-4388-8374-cb4e0fbaecb8","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"1","show":"$store.variables.dialogHideFlags.accommodation == false"}},{"name":"ACSatActions","type":"user-input","item-type":"text","_auto_id_":"225cce94-6da7-400d-8c2e-b36500484ce4","label":"Accomodation goals and actions:","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$data.$item.ACSatHelp == '1' && $store.variables.dialogHideFlags.accommodation == false","disabled":"1"},"validators":[]},{"name":"leisureActivitiesTitle","type":"content","item-type":"html","_auto_id_":"d046c22b-b772-4e5b-84cf-f5cb843a22d9","content":"<hr/>\n<div onclick=\"cti.fn_toggle_dialog('leisure')\" style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Leisure Activities</h4>\n  <i id=\"leisure\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{},"classes":""},{"name":"LASatPL","type":"choice","item-type":"slider","_auto_id_":"eead0fe0-8003-49ec-a71d-5d7f3874ba27","label":"How satisfied are you with your leisure activities?","required":false,"dual":false,"default":0,"min":1,"max":7,"step":1,"expressions":{"disabled":"1","show":"$store.variables.dialogHideFlags.leisure == false"}},{"name":"LASatHelp","type":"choice","item-type":"radio","_auto_id_":"abb5ed88-1651-448f-b11a-b0e5fa83817f","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"1","show":"$store.variables.dialogHideFlags.leisure == false"}},{"name":"LASatActions","type":"user-input","item-type":"text","_auto_id_":"be307fbd-4a00-42f7-8d6f-60fbc96382f5","label":"Leisure activity goals and actions:","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$data.$item.LASatHelp == '1' && $store.variables.dialogHideFlags.leisure == false","disabled":"1"},"validators":[]},{"name":"partnerFamilyTitle","type":"content","item-type":"html","_auto_id_":"dc6e46f4-461f-4a1e-912e-7e07b8bbcf36","content":"<hr/>\n<div onclick=\"cti.fn_toggle_dialog('family')\" style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Partner / Family</h4>\n  <i id=\"family\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{},"classes":""},{"name":"RSSatPL","type":"choice","item-type":"slider","_auto_id_":"d07645b7-01e4-4120-85a0-c95f7271495b","label":"How satisfied are you with your relationship with your partner / family?","required":false,"dual":false,"default":0,"min":1,"max":7,"step":1,"expressions":{"disabled":"1","show":"$store.variables.dialogHideFlags.family == false"}},{"name":"RSSatHelp","type":"choice","item-type":"radio","_auto_id_":"6726bf2a-1db5-4834-ae98-34eb3445cf77","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"1","show":"$store.variables.dialogHideFlags.family == false"}},{"name":"RSSatActions","type":"user-input","item-type":"text","_auto_id_":"20ae46c3-adb6-4d81-90f9-df36778065cc","label":"Relationship with partner/family goals and actions:","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$data.$item.RSSatHelp == '1' && $store.variables.dialogHideFlags.family == false","disabled":"1"},"validators":[]},{"name":"friendshipsTitle","type":"content","item-type":"html","_auto_id_":"eeb57397-e89e-4450-a498-b06c63a653d2","content":"<hr/>\n<div onclick=\"cti.fn_toggle_dialog('friendships')\" style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Friendships</h4>\n  <i id=\"friendships\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{},"classes":""},{"name":"FSSatPL","type":"choice","item-type":"slider","_auto_id_":"760ee9db-6bd2-42e4-a4e4-f67d3d801d3c","label":"How satisfied are you with your friendships?","required":false,"dual":false,"default":0,"min":1,"max":7,"step":1,"expressions":{"disabled":"1","show":"$store.variables.dialogHideFlags.friendships == false"}},{"name":"FSSatHelp","type":"choice","item-type":"radio","_auto_id_":"e2aea24e-998f-47f8-96b7-0b76335e5f87","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"1","show":"$store.variables.dialogHideFlags.friendships == false"}},{"name":"FSSatActions","type":"user-input","item-type":"text","_auto_id_":"223ea0bf-53ca-4f2d-96e3-d3712232e398","label":"Friendship goals and actions:","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$data.$item.FSSatHelp == '1' && $store.variables.dialogHideFlags.friendships == false","disabled":"1"},"validators":[]},{"name":"personalSafetyTitle","type":"content","item-type":"html","_auto_id_":"280f81d6-2ed8-4c93-9c26-152dddcca109","content":"<hr/>\n<div onclick=\"cti.fn_toggle_dialog('personal')\" style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Personal Safety</h4>\n  <i id=\"personal\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{},"classes":""},{"name":"PSSatPL","type":"choice","item-type":"slider","_auto_id_":"fbc0df0d-c760-428a-852c-f64eeb581fe2","label":"How satisfied are you with your personal safety?","required":false,"dual":false,"default":0,"min":1,"max":7,"step":1,"expressions":{"disabled":"1","show":"$store.variables.dialogHideFlags.personal == false"}},{"name":"PSSatHelp","type":"choice","item-type":"radio","_auto_id_":"444f1d3b-d36d-4e93-84e4-cda01ccb225d","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"1","show":"$store.variables.dialogHideFlags.personal == false"}},{"name":"PSSatActions","type":"user-input","item-type":"text","_auto_id_":"0e5979ab-149d-4d3e-ae89-71e5394318f9","label":"Personal safety goals and actions:","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$data.$item.PSSatHelp == '1' && $store.variables.dialogHideFlags.personal == false","disabled":"1"},"validators":[]},{"name":"financesTitle","type":"content","item-type":"html","_auto_id_":"fcb92c95-0888-4e35-a5f3-a0d4f8ad2a0e","content":"<hr/>\n<div onclick=\"cti.fn_toggle_dialog('finances')\" style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Finances</h4>\n  <i id=\"finances\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{},"classes":""},{"name":"FISatPL","type":"choice","item-type":"slider","_auto_id_":"fc87a1b3-5c6e-4664-8b23-75dad72efe15","label":"How satisfied are you with your finances?","required":false,"dual":false,"default":0,"min":1,"max":7,"step":1,"expressions":{"disabled":"1","show":"$store.variables.dialogHideFlags.finances == false"}},{"name":"FISatHelp","type":"choice","item-type":"radio","_auto_id_":"6d1575b7-c9e1-41ad-acb6-adb54813e309","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"1","show":"$store.variables.dialogHideFlags.finances == false"}},{"name":"FISatActions","type":"user-input","item-type":"text","_auto_id_":"e3f7891e-d08e-4fa0-8be9-14c455e983dc","label":"Finance goals and actions:","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$data.$item.FISatHelp == '1' && $store.variables.dialogHideFlags.finances == false","disabled":"1"},"validators":[]},{"name":"identityTitle","type":"content","item-type":"html","_auto_id_":"1e2fa998-c725-48c8-ba95-547250641761","content":"<hr/>\n<div onclick=\"cti.fn_toggle_dialog('identity')\" style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Identity</h4>\n  <i id=\"identity\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{},"classes":""},{"name":"CNSatPL","type":"choice","item-type":"slider","_auto_id_":"6f37f8d6-28a0-4c16-b8e3-4e918a62905f","label":"How satisfied are you with your expression of identitiy?","required":false,"dual":false,"default":0,"min":1,"max":7,"step":1,"expressions":{"disabled":"1","show":"$store.variables.dialogHideFlags.identity == false"}},{"name":"CNSatHelp","type":"choice","item-type":"radio","_auto_id_":"85b25942-555c-4b00-8fc8-ec720ab38252","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"1","show":"$store.variables.dialogHideFlags.identity == false"}},{"name":"CNSatActions","type":"user-input","item-type":"text","_auto_id_":"08bfa270-a3df-4f03-a16f-193fdabcfc5b","label":"Identity goals and actions:","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$data.$item.CNSatHelp == '1' && $store.variables.dialogHideFlags.identity == false","disabled":"1"},"validators":[]},{"name":"substanceAlcoholTitle","type":"content","item-type":"html","_auto_id_":"021e892e-6dec-4c4d-b8a8-c6ef60cf4f26","content":"<hr/>\n<div onclick=\"cti.fn_toggle_dialog('substance')\" style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Substance / Alcohol</h4>\n  <i id=\"substance\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{},"classes":""},{"name":"SUSatPL","type":"choice","item-type":"slider","_auto_id_":"994f85f4-54d8-49a7-a5fe-8316c283d7ec","label":"How satisfied are you with your alcohol / substance use?","required":false,"dual":false,"default":0,"min":1,"max":7,"step":1,"expressions":{"disabled":"1","show":"$store.variables.dialogHideFlags.substance == false"}},{"name":"SUSatHelp","type":"choice","item-type":"radio","_auto_id_":"948e0d8c-2f91-44f6-b39c-2047fd15ed06","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"1","show":"$store.variables.dialogHideFlags.substance == false"}},{"name":"SUSatActions","type":"user-input","item-type":"text","_auto_id_":"b08d9a0a-ce6c-4bf8-af5d-f105558d6cf9","label":"Substance/alcohol goals and actions:","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$data.$item.SUSatHelp == '1' && $store.variables.dialogHideFlags.substance == false","disabled":"1"},"validators":[]},{"name":"medicationTitle","type":"content","item-type":"html","_auto_id_":"bb4695d4-20fa-42b8-86df-49a32bd99eb0","content":"<hr/>\n<div onclick=\"cti.fn_toggle_dialog('medication')\" style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Medication</h4>\n  <i id=\"medication\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{},"classes":""},{"name":"MDSatPL","type":"choice","item-type":"slider","_auto_id_":"788dd495-9962-4437-81c5-a0312ca9ef54","label":"How satisfied are you with your medication?","required":false,"dual":false,"default":0,"min":1,"max":7,"step":1,"expressions":{"disabled":"1","show":"$store.variables.dialogHideFlags.medication == false"}},{"name":"MDSatHelp","type":"choice","item-type":"radio","_auto_id_":"00838551-8848-4afe-a07a-e548e8a0375a","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"1","show":"$store.variables.dialogHideFlags.medication == false"}},{"name":"MDSatActions","type":"user-input","item-type":"text","_auto_id_":"7f8bab00-d98d-4f51-bf67-37f7ce1352e9","label":"Medication goals and actions:","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$data.$item.MDSatHelp == '1' && $store.variables.dialogHideFlags.medication == false","disabled":"1"},"validators":[]},{"name":"practicalHelpTitle","type":"content","item-type":"html","_auto_id_":"dd8e7ea7-312e-4108-8a8c-7714b9824a87","content":"<hr/>\n<div onclick=\"cti.fn_toggle_dialog('practical')\" style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Practical Help</h4>\n  <i id=\"practical\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{},"classes":""},{"name":"PRSatPL","type":"choice","item-type":"slider","_auto_id_":"3eddbee8-4d67-457d-aef9-4855ceeca2c3","label":"How satisfied are you with the practical help you receive?","required":false,"dual":false,"default":0,"min":1,"max":7,"step":1,"expressions":{"disabled":"1","show":"$store.variables.dialogHideFlags.practical == false"}},{"name":"PRSatHelp","type":"choice","item-type":"radio","_auto_id_":"b84867ea-71fb-4f3d-9ce8-4af79c8d2603","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"1","show":"$store.variables.dialogHideFlags.practical == false"}},{"name":"PRSatActions","type":"user-input","item-type":"text","_auto_id_":"9c63ebee-be23-45ed-b14f-06b91ef2b11b","label":"Practical help goals and actions:","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$data.$item.PRSatHelp == '1' && $store.variables.dialogHideFlags.practical == false","disabled":"1"},"validators":[]},{"name":"mhpMeetingsTitle","type":"content","item-type":"html","_auto_id_":"3ce28dfe-a6ff-46e1-b956-93884027b0ac","content":"<hr/>\n<div onclick=\"cti.fn_toggle_dialog('meetings')\" style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Meetings</h4>\n  <i id=\"meetings\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{},"classes":""},{"name":"MPSatPL","type":"choice","item-type":"slider","_auto_id_":"93009368-ce92-48ae-b127-6c5d70259c9e","label":"How satisfied are you with your meetings with mental health professionals?","required":false,"dual":false,"default":0,"min":1,"max":7,"step":1,"expressions":{"disabled":"1","show":"$store.variables.dialogHideFlags.meetings == false"},"validators":[],"actions":[]},{"name":"MPSatHelp","type":"choice","item-type":"radio","_auto_id_":"adcea985-cba7-4e8d-9328-6fb56a4b7b60","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"1","show":"$store.variables.dialogHideFlags.meetings == false"}},{"name":"MPSatActions","type":"user-input","item-type":"text","_auto_id_":"990f958b-b3e7-43ef-a954-119a65b16935","label":"Meetings with mental health professionals goals and actions:","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$data.$item.MPSatHelp == '1' && $store.variables.dialogHideFlags.meetings == false","disabled":"1"},"validators":[],"actions":[]}],"dataSource":"dynamic","expressions":{},"paginationItemsPerPage":1,"paginationBelow":true,"paginationFirstLabel":"First","paginationPrevLabel":"Prev","paginationNextLabel":"Next","paginationLastLabel":"Last","paginationAbove":false}],"expressions":{}}]},{"start":false,"name":"LifestyleForm_View","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"7f56f42e-4346-4eff-8cfd-28690d9f02f3","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"518b7dc8-b077-4d2e-97d3-799b3cdf94e8","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.lifeStyleForm_View_clear = true\n$success()"},"_auto_id_":"af715ec5-19c9-467b-a6c4-97b2a9641ca0"},{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"7002a1aa-65cc-4079-9019-ab08aa3f7c30"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Lifestyle Forms</h4>","_auto_id_":"6dff6bce-fda1-4d8a-8bd6-32f40a5fb054"}],"_auto_id_":"0d2a25d4-111c-47fa-9646-9b0cd633cdc9","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"57d5244c-dbdd-4c89-b48d-f6ee6e8ea4e7","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"403b1542-a0c8-4138-95ce-da9d71cb348e","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"answerAccuratelyBanner","type":"content","item-type":"html","_auto_id_":"8c895906-b75c-4b58-afcd-14c48bc0cd3c","content":"<p>Appointment Type: {{'$store.variables.selected_visit.appointmentType.value '|store}}</p>","expressions":{},"classes":"banner-dark"}],"expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"d47a27ab-aa6a-42b4-8463-a643415ffff1","content":[{"name":"list_lifestyleforms","type":"content","item-type":"list","_auto_id_":"e1f58103-8d6b-4aea-81e6-850c93cccbbc","static":false,"model":"$store.variables.v_lifestyleForms","data":"[]","autoscroll":false,"search":"","order":false,"pagination":true,"content":[{"name":"button_back_to_date","type":"button","item-type":"button","_auto_id_":"1cf5aa06-0d9c-41d2-b8f8-d246a0f607fd","content":"Completed On: {{$data.$item.assessmentDate}}","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""},{"name":"html_smoking","type":"content","item-type":"html","_auto_id_":"0053c77b-7017-4cc1-a605-049467b547e2","content":"<div onclick=\"cti.fn_toggle_lifestyle('smoking')\" style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Smoking</h4>\n  <i id=\"smoking\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\" ></i>\n</div>","expressions":{}},{"name":"lssmoked","type":"choice","item-type":"select","_auto_id_":"a0090a6e-333e-491f-a25d-14ac503fea42","label":"Have you ever smoked?","required":false,"options":[{"label":"Not assessed","value":"SS01"},{"label":"No","value":"SS02"},{"label":"Ex-smoker","value":"SS03"},{"label":"Current smoker","value":"SS04"}],"expressions":{"disabled":"1","show":"$store.variables.lifestyleHideFlags.smoking == false"},"classes":"question_primary"},{"name":"lscigperday","type":"user-input","item-type":"number","_auto_id_":"5160b407-1b69-4494-b080-736c3bd3a508","label":"Cigarettes per day","required":false,"decimals":2,"expressions":{"show":"$data.$item.lssmoked.value == \"SS04\" && $store.variables.lifestyleHideFlags.smoking == false","disabled":"1"}},{"name":"smokeadvice","type":"choice","item-type":"select","_auto_id_":"1c1ebcbc-af64-44b9-adcb-2355b2679ce1","label":"Very brief advice given?","required":false,"options":[{"label":"Yes","value":"01"},{"label":"No","value":"02"}],"expressions":{"disabled":"1","show":"$data.$item.lssmoked.value == \"SS04\" && $store.variables.lifestyleHideFlags.smoking == false"}},{"name":"Refsmoke","type":"choice","item-type":"select","_auto_id_":"65a58f1a-7587-4fae-b4dc-f538219785eb","label":"Referred to smoking cessation services?","required":false,"options":[{"label":"Intervention not offered","value":"01"},{"label":"Intervention not required","value":"02"},{"label":"Offered and accepted","value":"03"},{"label":"Offered but rejected","value":"04"}],"expressions":{"show":"$data.$item.lssmoked.value == \"SS04\" && $store.variables.lifestyleHideFlags.smoking == false","disabled":"1"},"description":""},{"name":"StopSmoke","type":"choice","item-type":"select","_auto_id_":"660b292d-4984-430d-8ce0-1a207c9dd6c1","label":"Stop smoking medication given?","required":false,"options":[{"label":"Medication not offered","value":"01az"},{"label":"Medication offered & accepted","value":"02az"},{"label":"Medication offered but declined","value":"03az"},{"label":"Not medically appropriate","value":"04az"}],"expressions":{"show":"$data.$item.lssmoked.value == \"SS04\" && $store.variables.lifestyleHideFlags.smoking == false","disabled":"1"}},{"name":"smokeintoffer","type":"choice","item-type":"select","_auto_id_":"224393b7-7493-438c-888f-a16aa2ae5e0c","label":"Other intervention offered?","required":false,"options":[{"label":"Intervention not offered","value":"01"},{"label":"Intervention not required","value":"02"},{"label":"Offered and accepted","value":"03"},{"label":"Offered but declined","value":"04"}],"expressions":{"show":"$data.$item.lssmoked.value == \"SS04\" && $store.variables.lifestyleHideFlags.smoking == false","disabled":"1"}},{"name":"smokefreetext1","type":"user-input","item-type":"text","_auto_id_":"ead77734-e514-4486-9d83-aefc7a3219bc","label":"Details of any other intervention offered","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$data.$item.lssmoked.value == \"SS04\" && ($store.pages.LifestyleForm_View.smokeintoffer.value == \"03\" || $store.pages.LifestyleForm_View.smokeintoffer.value == \"04\") && $store.variables.lifestyleHideFlags.smoking == false"},"validators":[],"actions":[]},{"name":"html_diet","type":"content","item-type":"html","_auto_id_":"6cddd3e0-89aa-4e7d-897b-537ed15cf20c","content":"<hr/>\n<div onclick=\"cti.fn_toggle_lifestyle('diet')\" style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Diet</h4>\n  <i id=\"diet\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{}},{"name":"diethealthy","type":"choice","item-type":"select","_auto_id_":"6fd72ad6-d522-4eb3-977f-483ec18116df","label":"Do you think you eat a healthy diet?","required":false,"options":[{"label":"Not assessed","value":"01"},{"label":"Not at all","value":"02"},{"label":"Some of the time","value":"03"},{"label":"Most of the time","value":"04"},{"label":"Nearly all the time","value":"05"}],"expressions":{"disabled":"1","show":"$store.variables.lifestyleHideFlags.diet == false"},"classes":"question_primary"},{"name":"lsdietcomment","type":"user-input","item-type":"text","_auto_id_":"bcc7b789-69d1-4c0d-a49c-e384e624d70a","label":"Please give more detail","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"1","show":"$store.variables.lifestyleHideFlags.diet == false"},"validators":[],"actions":[]},{"name":"dietintervention","type":"choice","item-type":"select","_auto_id_":"1dc272ed-0770-48b7-a0f7-90ec4cb0f5ce","label":"Intervention offered?","required":false,"options":[{"label":"Intervention not offered","value":"01"},{"label":"Intervention not required","value":"02"},{"label":"Offered and accepted","value":"03"},{"label":"Offered but rejected","value":"04"}],"expressions":{"disabled":"1","show":"$store.variables.lifestyleHideFlags.diet == false"}},{"name":"dietintdetails","type":"user-input","item-type":"text","_auto_id_":"8173a662-7fdc-48fd-9f96-75aaf417dc97","label":"Details of intervention offered","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"($data.$item.dietintervention.value == \"03\" || $data.$item.dietintervention.value == \"04\") && $store.variables.lifestyleHideFlags.diet == false","disabled":"1"}},{"name":"html_exercise","type":"content","item-type":"html","_auto_id_":"b5adc6a2-3a29-428e-bf11-c6b4f0d2e79a","content":"<hr/>\n<div onclick=\"cti.fn_toggle_lifestyle('exercise')\" style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Exercise</h4>\n  <i id=\"exercise\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{}},{"name":"regularexercise","type":"choice","item-type":"select","_auto_id_":"bc1048d6-443d-42b8-96f8-215fd48af9de","label":"Do you exercise regularly?","required":false,"options":[{"label":"Not assessed","value":"00"},{"label":"Yes","value":"01"},{"label":"No","value":"02"}],"expressions":{"disabled":"1","show":"$store.variables.lifestyleHideFlags.exercise == false"},"classes":"question_primary"},{"name":"exercise_repeat_displayer","type":"content","item-type":"list","_auto_id_":"af3a117b-9471-4a9a-be10-e66674db622f","static":false,"model":"$data.$item.regularexercise.repeater","data":"[]","autoscroll":false,"search":"","order":false,"pagination":false,"content":[{"name":"exercise_displayer","type":"content","item-type":"html","_auto_id_":"3d6ee133-11e9-49c7-96c2-e87a78ac3a34","content":"<div id=\"{{ $data.$index }}\" class=\"excercise_item\">\n  <div class=\"node\">{{ $data.$item.intensity.resultString}} intensity</div>\n  <div class=\"node\">{{ $data.$item.misperweek.result}} minutes</div>\n</div>","expressions":{},"classes":"flex_row"}],"dataSource":"dynamic","expressions":{"show":"$data.$item.regularexercise.value == \"01\" && $store.variables.lifestyleHideFlags.exercise == false"},"actions":[],"classes":"repeater"},{"name":"exintoffer","type":"choice","item-type":"select","_auto_id_":"fa2c5e2e-2ba8-4b39-858f-dcfb21a18b04","label":"Intervention offered","required":false,"options":[{"label":"Intervention not offered","value":"01"},{"label":"Intervention not required","value":"02"},{"label":"Offered and accepted","value":"03"},{"label":"Offered but declined","value":"04"}],"expressions":{"disabled":"1","show":"$store.variables.lifestyleHideFlags.exercise == false"}},{"name":"intdetails","type":"user-input","item-type":"text","_auto_id_":"771627bb-cc1a-4a51-9420-74f853fa0c9d","label":"Details of intervention offered","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"($data.$item.exintoffer == \"03\" || $data.$item.exintoffer == \"04\") && $store.variables.lifestyleHideFlags.exercise == false","disabled":"1"},"validators":[],"actions":[]},{"name":"html_alcohol","type":"content","item-type":"html","_auto_id_":"c92cdbde-865a-47f8-a200-1a9568f51d32","content":"<hr/>\n<div onclick=\"cti.fn_toggle_lifestyle('alcohol')\" style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Alcohol</h4>\n  <i id=\"alcohol\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{}},{"name":"alcCurrentUser","type":"choice","item-type":"select","_auto_id_":"d32e569e-ac99-425c-ac47-1ef02e3e79c3","label":"Are you a current alcohol user? ","required":false,"options":[{"label":"Yes","value":"01"},{"label":"No","value":"02"}],"expressions":{"disabled":"1","show":"$store.variables.lifestyleHideFlags.alcohol == false"},"actions":[],"validators":[]},{"name":"withdrawal","type":"choice","item-type":"select","_auto_id_":"d48fa8fb-8915-434a-ba46-6948fb2b6d51","label":"Is there evidence of alcohol withdrawal?","required":false,"options":[{"label":"Yes","value":1},{"label":"No","value":2}],"expressions":{"disabled":"1","show":"$data.$item.alcCurrentUser.value != \"02\" && $store.variables.lifestyleHideFlags.alcohol == false"}},{"name":"alcHowOften","type":"choice","item-type":"select","_auto_id_":"f1a16ef9-2797-485b-9a49-8eb140896c66","label":"How often do you have an alcoholic drink?","required":false,"options":[{"label":"Never","value":"0"},{"label":"Monthly or less","value":"1"},{"label":"2-4 times per month","value":"2"},{"label":"2-3 times per week","value":"3"},{"label":"4+ per week","value":"4"}],"expressions":{"disabled":"1","show":"$data.$item.alcCurrentUser.value != \"02\" && $store.variables.lifestyleHideFlags.alcohol == false"}},{"name":"alcHowManyUnits","type":"choice","item-type":"select","_auto_id_":"2e248ef8-3ce6-49d9-ad79-66a1e80c39b7","label":"How many units of alcohol do you consume on a typical day when drinking?","required":false,"options":[{"label":"1-2","value":"0"},{"label":"3-4","value":"1"},{"label":"5-6","value":"2"},{"label":"7-9","value":"3"},{"label":"10+","value":"4"}],"expressions":{"disabled":"1","show":"$data.$item.alcCurrentUser.value != \"02\" && $store.variables.lifestyleHideFlags.alcohol == false"}},{"name":"alcExceedUnits","type":"choice","item-type":"select","_auto_id_":"2e4d7838-f6d2-4c05-9615-30c78fdc3279","label":"How often do you exceed 6 or more units on a single occasion?","required":false,"options":[{"label":"Never","value":"0"},{"label":"Less than monthly","value":"1"},{"label":"Monthly","value":"2"},{"label":"Weekly","value":"3"},{"label":"Daily or almost daily","value":"4"}],"validators":[],"expressions":{"show":"$data.$item.alcCurrentUser.value != \"02\" && $store.variables.lifestyleHideFlags.alcohol == false","disabled":"1"}},{"name":"alcIntervention","type":"choice","item-type":"select","_auto_id_":"5548b56a-de87-440b-adde-1792464fae0f","label":"Intervention","required":false,"options":[{"label":"None required","value":"01az"},{"label":"Brief advice given","value":"02az"},{"label":"Self-referred to alcohol services","value":"03az"},{"label":"Referral to alcohol services made","value":"04az"},{"label":"Referral offered but declined","value":"05az"}],"validators":[],"expressions":{"disabled":"1","show":"$data.$item.alcCurrentUser.value != \"02\" && $store.variables.lifestyleHideFlags.alcohol == false"},"actions":[]},{"name":"alcintdetail","type":"user-input","item-type":"text","_auto_id_":"904a5db5-6510-4500-baa2-2443d37c047c","label":"Details of service offered","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"1","show":"$data.$item.alcCurrentUser.value != \"02\" && $store.variables.lifestyleHideFlags.alcohol == false"},"validators":[],"actions":[]},{"name":"html_drugs","type":"content","item-type":"html","_auto_id_":"c8b8de8b-92ea-4e9a-889c-eff1008246e3","content":"<hr/>\n<div onclick=\"cti.fn_toggle_lifestyle('drugs')\" style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Drugs</h4>\n  <i id=\"drugs\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{}},{"name":"recdruguse","type":"choice","item-type":"select","_auto_id_":"b8208ee8-0cce-41d4-86e5-ae5c5cad0ca3","label":"Have you ever used recreational drugs?","required":false,"options":[{"label":"Not assessed","value":"1na"},{"label":"No","value":"2no"},{"label":"In the past","value":"3tp"},{"label":"Current user","value":"4cu"}],"expressions":{"disabled":"1","show":"$store.variables.lifestyleHideFlags.drugs == false"},"classes":"question_primary"},{"name":"drugs_repeat_displayer","type":"content","item-type":"list","_auto_id_":"405b58b2-c922-4a9b-8827-53175de3cee5","static":false,"model":"$data.$item.recdruguse.repeater","data":"[]","autoscroll":false,"search":"","order":false,"pagination":false,"content":[{"name":"drug_displayer","type":"content","item-type":"html","_auto_id_":"726c465f-779d-4cae-91c4-20d776b426d2","content":"<div class=\"repeater_item\">\n  <div class=\"node\">Currently Using: {{ $data.$item.currentuse.resultString }}</div>\n  <div class=\"node\">Drug name: {{ $data.$item.drugname.resultString }}</div>\n  <div class=\"node\">Other drug: {{ $data.$item.otherdrug.resultString }}</div>\n  <div class=\"node\">Used per week: {{ $data.$item.useperweek.resultString }}</div>\n  <div class=\"node\">Mode of use: {{ $data.$item.modeofuse.resultString }}</div>\n</div>","expressions":{}}],"dataSource":"dynamic","expressions":{"show":"$data.$item.recdruguse.value == \"4cu\" && $store.variables.lifestyleHideFlags.drugs == false"},"actions":[],"classes":"repeater"},{"name":"drugintoffer","type":"choice","item-type":"select","_auto_id_":"67b7d3b2-ac72-4a0b-bac0-4cebe757739a","label":"Intervention offered?","required":false,"options":[{"label":"Intervention not offered","value":"01"},{"label":"Intervention not required","value":"02"},{"label":"Offered and accepted","value":"03"},{"label":"Offered but declined","value":"04"}],"expressions":{"disabled":"1","show":"$data.$item.recdruguse.value == \"4cu\" && $store.variables.lifestyleHideFlags.drugs == false"}},{"name":"drugintdetails","type":"user-input","item-type":"text","_auto_id_":"3673693e-7ace-4617-8ae5-8f43c548db54","label":"Details of interventions offered","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$data.$item.recdruguse.value == \"4cu\" && ($data.$item.drugintoffer.value == \"03\" || $data.$item.drugintoffer.value == \"04\") && $store.variables.lifestyleHideFlags.drugs == false","disabled":"1"}},{"name":"html_other","type":"content","item-type":"html","_auto_id_":"59fcfd4d-9e8f-486c-a3e7-fcd497ecef59","content":"<hr/>\n<div onclick=\"cti.fn_toggle_lifestyle('other')\" style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Other</h4>\n  <i id=\"other\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{}},{"name":"menwellbeing","type":"choice","item-type":"select","_auto_id_":"fcbeaf54-730a-4cfc-957b-47033b8de502","label":"5 Ways to Mental Wellbeing","required":false,"options":[{"label":"Intervention not offered","value":"01"},{"label":"Offered and accepted","value":"02"},{"label":"Offered but declined","value":"03"}],"expressions":{"disabled":"1","show":"$store.variables.lifestyleHideFlags.other == false"}},{"name":"signpost","type":"choice","item-type":"select","_auto_id_":"4df867cc-41f3-44c4-b9cd-03d0b8f9f2a0","label":"Signposting for support with debt or housing","required":false,"options":[{"label":"Intervention not offered","value":"01"},{"label":"Intervention not required","value":"02"},{"label":"Offered and accepted","value":"03"},{"label":"Offered but declined","value":"04"}],"expressions":{"disabled":"1","show":"$store.variables.lifestyleHideFlags.other == false"}},{"name":"signdetail","type":"user-input","item-type":"text","_auto_id_":"c05da18f-11c8-4110-adfd-243718bc2c00","label":"Details of intervention offered","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"1","show":"$store.variables.lifestyleHideFlags.other == false"}},{"name":"addcomm","type":"user-input","item-type":"text","_auto_id_":"9b0ea7a5-c340-414a-8024-a64472d499c0","label":"Comments:","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"1","show":"$store.variables.lifestyleHideFlags.other == false"}},{"name":"YNPresent","type":"choice","item-type":"radio","_auto_id_":"1e89ac8f-c54d-43d0-9c24-26b3125137da","label":"Present?","required":false,"options":[{"label":"Yes","value":"v8aa"},{"label":"No","value":"v8ab"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"1","show":"$data.$item.YNPresent != \"\" && $store.variables.lifestyleHideFlags.other == false"}},{"name":"admissionassess","type":"choice","item-type":"radio","_auto_id_":"56d1e4bb-230b-4111-b2d6-df996a6ce3e6","label":"Admission assesment: ","required":false,"options":[{"label":"Yes","value":1},{"label":"No","value":2}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"1","show":"$store.variables.lifestyleHideFlags.other == false"}},{"name":"SentCopy","type":"choice","item-type":"radio","_auto_id_":"3713b529-1650-419b-9c20-8beffba5b6ae","label":"Copy of CPA sent?","required":false,"options":[{"label":"Yes","value":"V8aa"},{"label":"No","value":"V8ab"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"1","show":"$data.$item.YNPresent != \"\" && $store.variables.lifestyleHideFlags.other == false"}},{"name":"assessmentstatus","type":"choice","item-type":"select","_auto_id_":"f8390b35-8323-4006-8c12-349aa4ec8252","label":"Status","required":false,"options":[{"label":"Assessment complete","value":"01"},{"label":"Patient declined entire assessment","value":"02"},{"label":"Patient declined part of assessment","value":"03"},{"label":"Unsafe to conduct assessment","value":"04"},{"label":"Assessment incomplete","value":"01a"},{"label":"Form Entered in Error","value":"99"}],"expressions":{"disabled":"1","show":"$store.variables.lifestyleHideFlags.other == false"}}],"dataSource":"dynamic","expressions":{},"paginationItemsPerPage":1,"paginationBelow":true,"paginationFirstLabel":"First","paginationPrevLabel":"Prev","paginationNextLabel":"Next","paginationLastLabel":"Last","paginationAbove":false}],"expressions":{}}]},{"start":false,"name":"Timeline","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"7d2056c4-429b-42c7-9231-3c90861e3fc0","content":"","theme":"minimal","left-icon":"fa-home","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_back - page Timeline', \n  'info'\n)\n\ncti.fn_save_appointment()"},"_auto_id_":"0ba58eb2-64c8-49a9-a29d-dbb8b506712c"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Timeline</h4>","_auto_id_":"f5d30881-56e4-47e8-8105-3aadfc3cbf69"},{"name":"button_menu","type":"button","item-type":"button","_auto_id_":"e53ea1cd-7b1a-4e95-acb6-d26e2f9801f1","content":"","theme":"minimal","expressions":{},"left-icon":"fa-bars","actions":[{"event":"click","type":"call-component-function","data":{"page":"Timeline","componentInstanceId":"fa1660f3-7064-4096-bd3f-29b24b78be53","function":"toggle"},"_auto_id_":"41e6da5e-17e0-423c-a5b4-bbe7930fbf59"}]},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"5e822781-6d86-489a-9918-14ec30e56f1f","attributes":{},"expressions":{}},{"name":"ct_context_menu","type":"component","item-type":"web-component","content":[{"name":"button_logout","type":"button","item-type":"button","_auto_id_":"fa2e6759-9c7b-418e-ad87-2a5bb14c0e27","content":"Logout","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"Login","isConditional":false},"_auto_id_":"bfc92a5e-088d-493d-a540-80c5f29606f9"}],"expressions":{}},{"name":"button_bar_menu","type":"area","item-type":"button-bar","_auto_id_":"9987a384-f30d-4c14-8f86-d140df8cacc4","extends":{"type":"area","item-type":"row"},"content":[{"name":"html_menu_version","type":"content","item-type":"html","_auto_id_":"c9d5cb46-42cd-45f5-91db-ab59642c2bbb","content":"Version {{'$store.schema.version' | store}}","expressions":{}}],"expressions":{}}],"componentId":"1fa0aab1-7b03-413d-b3e0-433405059753","_auto_id_":"fa1660f3-7064-4096-bd3f-29b24b78be53","attributes":{"Direction":"right","Overlay":true},"expressions":{},"actions":[]}],"_auto_id_":"2199e0df-fa01-408e-9af5-e19154754504","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"c86468db-506b-4f6a-a7c9-c19389028663","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"fa0b11b0-71d5-4073-967a-eec75c95bbac","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"c183c3fc-86a2-4997-b49e-ad693d17f355","content":"Back to Summary","theme":"minimal","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"981bad5d-ab64-4f1b-a361-e2c9680dd039"}],"classes":""},{"name":"html_view_mode","type":"content","item-type":"html","_auto_id_":"25a0492e-4342-4fe4-ab06-5f2f0add77f4","content":"{{'$store.variables.visit_view_mode' | store}}","expressions":{},"classes":"infoBanner"},{"name":"popupWarning","type":"component","item-type":"web-component","content":[{"name":"html_warning","type":"content","item-type":"html","_auto_id_":"e18cd8d1-9890-4d78-826d-900686b8983b","content":"<h3 style=\"color:black\">Warning: Outstanding Form Data</h3>\n<p style=\"color:black\">The following forms have either outstanding data or have failed to send to RiO: {{'$store.variables.formStatus' | store}}. If you continue then this information will be lost.</p>\n<p style=\"color:black\">Do you want to continue? </p>","expressions":{}},{"name":"button_bar_yesno","type":"area","item-type":"button-bar","_auto_id_":"0d8f6d9b-4a97-4023-83c2-c2568997e276","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_yes","type":"button","item-type":"button","_auto_id_":"f236e09d-cbd5-467f-959c-b130970df5d3","content":"YES","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"delete cti.store.variables.formStatus\ncti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n$success()"},"_auto_id_":"819e8986-be5c-4ebc-ad83-6fc5aaa843dd"},{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"27943add-ee00-4674-a201-fe7c8cb734f9","function":"toggle"},"_auto_id_":"ee58476f-b82a-4d76-99da-9f80ccb91bc7"}],"classes":"default"},{"name":"button_no","type":"button","item-type":"button","_auto_id_":"b0cd7b6b-cf01-4824-96b3-6ca57b0a0032","content":"NO","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"27943add-ee00-4674-a201-fe7c8cb734f9","function":"toggle"},"_auto_id_":"43b8e4e5-23fd-48a2-9584-5f7ca1e84fab"}]}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"27943add-ee00-4674-a201-fe7c8cb734f9","attributes":{"id":"popupWarning"},"expressions":{}}],"expressions":{},"classes":"relative"},{"name":"scrollable_results","type":"area","item-type":"scrollable","_auto_id_":"b6992d04-7b4c-4d85-be17-180ff12ff4d7","content":[{"name":"list_timeline","type":"content","item-type":"list","_auto_id_":"436f2e32-4ac1-4afd-9929-94c4f53ef268","search":"","classes":"","model":"$store.variables.timeline","expressions":{},"actions":[],"dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_timeline_html","_auto_id_":"be4e2dc9-cfbe-448c-bd65-e08cbbc76d49","content":"<div class=\"icon {{$data.$item.eventType}}\"></div>\n<div class=\"event\">\n    <div class=\"eventType\">\n        {{$data.$item.eventType == \"admission\" ? \"Admission\" : \"\"}}\n        {{$data.$item.eventType == \"documents\" ? \"Document Added: \" + $data.$item.title : \"\"}}\n        {{$data.$item.eventType == \"referral\" ? \"Referred to \" + $data.$item.referredToDisplay + \" by \" + $data.$item.referrer + \", \" + $data.$item.referralSource.value : \"\"}}\n        {{$data.$item.eventType == \"notes\" ? \"Progress Note: \" + $data.$item.progressNoteType.value + \", \" + $data.$item.progressNoteSubType.value : \"\"}}\n        {{$data.$item.eventType == \"appointments\" ? \"Appointment: \" + $data.$item.type + \" with \" + $data.$item.hcpSurname + \", \" + $data.$item.hcpForename + \" \" + $data.$item.hcpTitle : \"\"}}\n        {{$data.$item.eventType == \"alerts-added\" ? \"Alert Added\" : \"\"}}\n      \t{{$data.$item.eventType == \"alerts-removed\" ? \"Alert Removed\" : \"\"}}\n      \t{{$data.$item.eventType == \"allergies\" ? \"Allergy Added by \" + $data.$item.reportedBy : \"\"}}\n    </div>\n    <div class=\"date\">\n      {{$data.$item.eventType == \"allergies\" ? $data.$item.eventDateDisplay : $data.$item.eventDate | date:'dd MMM yyyy HH:mm'}}\n    </div>\n    <div class=\"eventDescription\">\n        {{$data.$item.eventType == \"admission\" ? \"Admitted to \" + $data.$item.admittedWard : \"\"}}\n        {{$data.$item.eventType == \"documents\" ? \"Type: \" + $data.$item.documentType.value : \"\"}}\n        {{$data.$item.eventType == \"referral\" ? $data.$item.urgency.value + \" referral to service \" + $data.$item.specialty.value : \"\"}}\n        {{$data.$item.eventType == \"alerts-added\" ?  $data.$item.type.value : \"\"}}\n        {{$data.$item.eventType == \"alerts-removed\" ?  $data.$item.displayText : \"\"}}\n      \t{{$data.$item.eventType == \"allergies\" ?  $data.$item.substance : \"\"}}\n    </div>\n    <div ng-bind-html=\"$data.$item.timeLineDisplay\" class=\"eventDescription\" >\n        {{$data.$item.eventType == \"notes\" || $data.$item.eventType == \"appointments\" ? $data.$item.timeLineDisplay : \"\"}}\t\n    </div>\n</div>"}]}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_start_visit","type":"button","item-type":"button","_auto_id_":"67ed9f63-343d-401f-9051-594af5d0fe8a","content":"START VISIT","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.selected_visit.arrivalTime = new Date()\ncti.store.variables.selected_visit.status = 'started'\ncti.utils.updatePage()"},"_auto_id_":"95313c68-97dc-42ba-90eb-b5bbb20f0d89","actions":[]}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime == undefined && $store.variables.visit_view_mode != 'Appointments') && $store.variables.selected_visit.status != \"complete\""},"classes":"default"},{"name":"button_add_note","type":"button","item-type":"button","_auto_id_":"efcebf7d-5603-4cfc-8e88-6bdadae00c39","content":"ADD NOTE","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') || $store.variables.selected_visit.status == \"complete\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Note","isConditional":false},"_auto_id_":"dc6e20ed-c9b4-4271-8520-c70b42d7cb02"}]},{"name":"button_add_alert","type":"button","item-type":"button","_auto_id_":"7d6c2e43-eff9-45e3-b68f-0a3d50bdc885","content":"ADD ALERT","theme":"default","expressions":{"show":"$store.variables.selected_visit.arrivalTime != undefined && $store.variables.selected_visit.status != \"new\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Alert","isConditional":false},"_auto_id_":"b78b1aaa-1ef0-46c2-a9b4-17191ea65248"}]},{"name":"button_end_visit","type":"button","item-type":"button","_auto_id_":"0863f1bd-0708-48cd-9e17-5042afb03f25","content":"END VISIT","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') && $store.variables.selected_visit.status != \"complete\""},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var dialog = cti.store.variables.selected_visit.dialog_form_status\nvar safety = cti.store.variables.selected_visit.safety_form_status\nvar lifestyle = cti.store.variables.selected_visit.lifestyle_form_status\n\ncti.store.variables.formStatus = undefined\ncti.store.variables.o_activities = []\n\nif(dialog == \"failed\" || dialog == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Dialog+\"\n  } else {\n    cti.store.variables.formStatus += \", Dialog+\"\n  }\n} else if(dialog == \"complete\") {\n  var dialogObj = {\n    group : undefined,\n    value : \"dialogplus\",\n    label : \"DIALOG+\"\n  }\n    \n  cti.store.variables.o_activities.push(dialogObj)\n}\n\nif(safety == \"failed\" || safety == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"My Safety Plan\"\n  } else {\n    cti.store.variables.formStatus += \", My Safety Plan\"\n  }\n} else if(safety == \"complete\") {\n  var safetyObj = {\n    group : undefined,\n    value : \"msp\",\n    label : \"My Safety Plan\"\n  }\n    \n  cti.store.variables.o_activities.push(safetyObj)\n}\n\nif(lifestyle == \"failed\" || lifestyle == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Lifestyle Assessment Form\"\n  } else {\n    cti.store.variables.formStatus += \", Lifestyle Assessment Form\"\n  }\n} else if(lifestyle == \"complete\") {\n  var lifestyleObj = {\n    group : undefined,\n    value : \"phlifestyl\",\n    label : \"Lifestyle Assessment Form\"\n  }\n    \n  cti.store.variables.o_activities.push(lifestyleObj)\n}\n\nif(cti.store.variables.formStatus == undefined) {\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n} else {\n  $success()\n}"},"_auto_id_":"deaeefb1-9fdc-4f63-b339-dbdf2dddb495","actions":[{"event":"success","type":"call-component-function","data":{"page":"Timeline","componentInstanceId":"27943add-ee00-4674-a201-fe7c8cb734f9","function":"toggle"},"_auto_id_":"0f581657-271a-4a00-bde6-fa894842d15f"}]}],"classes":"default"},{"name":"button_end_date_alert","type":"button","item-type":"button","_auto_id_":"9aeed149-bc5a-4491-856d-1e57bf2587d1","content":"END DATE ALERT","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"RemoveAlert","isConditional":false},"_auto_id_":"728c4fa3-b835-4866-a67e-f1c334cc3735"}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode === 'Alerts') || $store.variables.selected_visit.status == \"complete\"","disabled":"$store.variables.alerts === undefined || $store.variables.alerts.length === 0"}}],"_auto_id_":"ad1515dd-f2a7-4994-b432-0c40f1fe22d9","expressions":{"show":"$store.variables.visit_view_mode != \"Appointments\""}}]},{"start":false,"name":"Patient","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"717472c6-4f34-4dc0-9caa-557c029f69fe","content":"","theme":"minimal","left-icon":"fa-home","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_back - page Patient', \n  'info'\n)\n\ncti.fn_save_appointment()"},"_auto_id_":"a7331064-2801-45a5-904a-7c52dd039586","actions":[]}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Demographics</h4>","_auto_id_":"ea31fd76-eff3-492f-84dd-657bfe31ffea"},{"name":"button_menu","type":"button","item-type":"button","_auto_id_":"5f3c0544-607f-42a4-ab8a-067c2c97c47e","content":"","theme":"minimal","expressions":{},"left-icon":"fa-bars","actions":[{"event":"click","type":"call-component-function","data":{"page":"Patient","componentInstanceId":"709baacd-0046-4549-9f00-368a741e7b1a","function":"toggle"},"_auto_id_":"7c9ec62a-648d-4491-ad4d-fa8f6930abe2"}]},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"6588fc13-84ce-40ed-bc3d-80518afa31ea","attributes":{},"expressions":{},"actions":[]},{"name":"ct_context_menu","type":"component","item-type":"web-component","content":[{"name":"button_logout","type":"button","item-type":"button","_auto_id_":"481480fc-297d-4301-872c-f0a91eb18fe4","content":"Logout","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"Login","isConditional":false},"_auto_id_":"151f8a72-6695-4a67-888e-1c826aae8b0d"}],"expressions":{}},{"name":"button_bar_menu","type":"area","item-type":"button-bar","_auto_id_":"0e73c081-ab79-4146-9e04-70298b747d94","extends":{"type":"area","item-type":"row"},"content":[{"name":"html_menu_version","type":"content","item-type":"html","_auto_id_":"d56c26e6-13ea-4e1a-81a3-6afd3bc01018","content":"Version {{'$store.schema.version' | store}}","expressions":{}}],"expressions":{}}],"componentId":"1fa0aab1-7b03-413d-b3e0-433405059753","_auto_id_":"709baacd-0046-4549-9f00-368a741e7b1a","attributes":{"Direction":"right","Overlay":true},"expressions":{},"actions":[]}],"_auto_id_":"28118220-840a-4a6d-bbbd-e64886f40846","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"3f667723-8030-483b-963f-733777e2d48a","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"a298e42c-3fe1-483f-b8eb-4789e6a89bcd","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"ed514be5-599b-4c62-9965-4cd3832a2caf","content":"Back to Summary","theme":"minimal","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"3881f880-b386-4371-96b7-b7e33e3f440c"}],"classes":""},{"name":"html_view_mode","type":"content","item-type":"html","_auto_id_":"4ddb2c08-2a89-4562-b78b-419f9764f7eb","content":"{{'$store.variables.visit_view_mode' | store}}","expressions":{},"classes":"infoBanner"},{"name":"popupWarning","type":"component","item-type":"web-component","content":[{"name":"html_warning","type":"content","item-type":"html","_auto_id_":"c8c06d08-0d9c-4b25-a5f3-01acf84d3a9b","content":"<h3 style=\"color:black\">Warning: Outstanding Form Data</h3>\n<p style=\"color:black\">The following forms have either outstanding data or have failed to send to RiO: {{'$store.variables.formStatus' | store}}. If you continue then this information will be lost.</p>\n<p style=\"color:black\">Do you want to continue? </p>","expressions":{}},{"name":"button_bar_yesno","type":"area","item-type":"button-bar","_auto_id_":"5fe2c235-6dcd-4ffb-af53-c4ddd18bbff7","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_yes","type":"button","item-type":"button","_auto_id_":"4cd420eb-fa88-4821-9c6f-250c28f498d0","content":"YES","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"delete cti.store.variables.formStatus\ncti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n$success()"},"_auto_id_":"aa612ceb-bd4c-4910-9477-6d7935f6aab2"},{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"4f722bc4-cb7e-481b-8566-164ddd9b9197","function":"toggle"},"_auto_id_":"0b521ae0-d731-4771-8dce-82377f468a39"}],"classes":"default"},{"name":"button_no","type":"button","item-type":"button","_auto_id_":"16d9893a-87e3-4461-9f88-ca6850e5d687","content":"NO","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"4f722bc4-cb7e-481b-8566-164ddd9b9197","function":"toggle"},"_auto_id_":"a1f68b77-761c-48cb-8457-c043f0f4dda0"}]}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"4f722bc4-cb7e-481b-8566-164ddd9b9197","attributes":{"id":"popupWarning"},"expressions":{}}],"expressions":{},"classes":"relative"},{"name":"scrollable_results","type":"area","item-type":"scrollable","_auto_id_":"35a44807-d28e-4411-9ae5-3c85de41bf73","content":[{"name":"list_patient","type":"content","item-type":"list","_auto_id_":"aa8db50d-5486-465f-b31b-faf52aa3f4bd","search":"","classes":"","model":"$store.variables.selected_visit.patientData.patient","theme":"","expressions":{},"actions":[],"dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_patient_html","_auto_id_":"0957883b-c7a9-40b6-b094-a8619cdf0820","content":"<div class=\"card_holder\">\n  <div class=\"line_after\">\n    <div class=\"contact_name\">\n      {{$data.$item.surname}}, {{$data.$item.firstname}}  {{$data.$item.title != '' ? '(' : ''}}{{$data.$item.title}}{{$data.$item.title != '' ? ')' : ''}}\n    </div>\n    <div class=\"dob\">\n      <span>DOB</span>{{$data.$item.birthDate}} (aged {{$data.$item.age}})\n    </div>\n    <div class=\"gp\"><span>Current GP</span>{{$data.$item.gpDetails}}</div>\n    <div class=\"nhs\"><span>NHS Number</span>{{$data.$item.nhsNumFormatted}}</div>\n    <div class=\"client_id\"><span>Client ID</span>{{$data.$item.clientId.value}}</div>\n  </div>\n  <div class=\"line_after icon location\" onclick=\"cti.fn_navigate(this.id)\" id=\"{{$data.$item.postCode}}\">\n    <div class=\"short_address\">{{$data.$item.addressFormatted}}</div>\n    <div class=\"p_code\">{{$data.$item.postCode}}</div>\n  </div>\n  <div class=\"{{$data.$item.eveningPhoneNumber != undefined || $data.$item.officePhoneNumber != undefined || $data.$item.mobilePhoneNumber != undefined ? 'line_after' : ''}}\">\n    <div class=\"gender\"><span>Gender</span>{{$data.$item.gender.value}}</div>\n    <div class=\"ethnic\"><span>Ethnicity</span>{{$data.$item.ethnicity.value}}</div>\n    <div class=\"language\"><span>Language</span>{{$data.$item.language.value != undefined ? $data.$item.language.value : \"Not Specified\"}}</div>\n    <div class=\"nationality\"><span>Nationality</span>{{$data.$item.nationality.value != undefined ? $data.$item.nationality.value : \"Not Specified\"}}</div>\n  </div>\n  <div ng-if=\"$data.$item.eveningPhoneNumber != undefined || $data.$item.officePhoneNumber != undefined || $data.$item.mobilePhoneNumber != undefined\" class=\"phones icon\">\n    <div class=\"mobile\" ng-if=\"$data.$item.mobilePhoneNumber != ''\" onclick=\"cti.fn_call_contact()\"><span>Mob</span>{{$data.$item.mobilePhoneNumber}}</div>\n    <div class=\"office\" ng-if=\"$data.$item.officePhoneNumber != ''\" onclick=\"cti.fn_call_contact()\"><span>Day</span>{{$data.$item.officePhoneNumber}}</div>\n    <div class=\"evening\" ng-if=\"$data.$item.eveningPhoneNumber != ''\" onclick=\"cti.fn_call_contact()\"><span>Eve</span>{{$data.$item.eveningPhoneNumber}}</div>\n  </div>\n</div>","expressions":{}}]},{"name":"popupCall","type":"component","item-type":"web-component","content":[{"name":"html_call","type":"content","item-type":"html","_auto_id_":"e523b1b6-847b-4d82-876a-eeef2b172a9f","content":"<h4>Call Patient</h4>\n<!--<p>Use one of the available contact numbers below</p>-->","expressions":{}},{"name":"html_no_numbers","type":"content","item-type":"html","_auto_id_":"cc3c1aa0-4428-4f04-96ef-663e08110135","content":"<p>There are currently no valid contact numbers for this patient.</p>","expressions":{"show":"$store.variables.selected_visit.patientData.demographics.mobilePhoneNumber == undefined && $store.variables.selected_visit.patientData.demographics.officePhoneNumber == undefined && $store.variables.selected_visit.patientData.demographics.eveningPhoneNumber == undefined"}},{"name":"button_bar_mobile","type":"area","item-type":"button-bar","_auto_id_":"64453c5d-d818-48d6-8a0e-57b53e3dc559","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_call_mobile","type":"button","item-type":"button","_auto_id_":"ec1a5db9-931b-45c8-bd2f-bb915ecce237","content":"Mobile - {{'$store.variables.selected_visit.patientData.demographics.mobilePhoneNumber' | store}}","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_call_mobile - page Visit', \n  'info'\n)\n\nvar demographics = cti.store.variables.selected_visit.patientData.demographics\n\nif(window) {\n  window.open('tel:141'+demographics.mobilePhoneNumber.replace(/\\\\s/g,''),'_system')\n} else {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning\", \n    \"text\" : \"Cordova is not currently installed, so you may not be running the application on a mobile device.\"\n  }) \n}\n\n$success()"},"_auto_id_":"d8017353-fef4-41fd-81f1-be92011ea171"},{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"62c798d7-1ba3-458c-a07a-5caefcb56a63","function":"toggle"},"_auto_id_":"6c5db674-f14a-4ebc-b098-04ee09c7f9d4"}],"expressions":{"show":"$store.variables.selected_visit.patientData.demographics.mobilePhoneNumber !== undefined"},"classes":""}],"expressions":{"show":"$store.variables.selected_visit.patientData.demographics.mobilePhoneNumber !== undefined"}},{"name":"button_bar_evening","type":"area","item-type":"button-bar","_auto_id_":"5b7c61f5-9b8a-4220-8365-7b5778b6e4c4","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_call_evening","type":"button","item-type":"button","_auto_id_":"4f521a6d-07c7-40f8-a8d7-ff5598030016","content":"Evening - {{'$store.variables.selected_visit.patientData.demographics. eveningPhoneNumber' | store}}","theme":"default","expressions":{"show":"$store.variables.selected_visit.patientData.demographics.eveningPhoneNumber !== undefined"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_call_evening - page Visit', \n  'info'\n)\n\nvar demographics = cti.store.variables.selected_visit.patientData.demographics\n\nif(window) {\n  window.open('tel:141'+demographics.eveningPhoneNumber.replace(/\\\\s/g,''),'_system')\n} else {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning\", \n    \"text\" : \"Cordova is not currently installed, so you may not be running the application on a mobile device.\"\n  })\n}\n\n$success()"},"_auto_id_":"4ab3e36f-3304-4340-bb24-71383c654b28"},{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"62c798d7-1ba3-458c-a07a-5caefcb56a63","function":"toggle","params":{"containerid":"scrollable"}},"_auto_id_":"35d62ea4-d4bb-464d-8f6d-5aedf003fe25"}]}],"expressions":{"show":"$store.variables.selected_visit.patientData.demographics.eveningPhoneNumber !== undefined"}},{"name":"button_bar_office","type":"area","item-type":"button-bar","_auto_id_":"c79d27a8-1679-4909-905e-95fe73e8db49","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_call_office","type":"button","item-type":"button","_auto_id_":"c99e4200-1bf3-43e3-a03d-4a1a5fead483","content":"Office - {{'$store.variables.selected_visit.patientData.demographics. officePhoneNumber' | store}}","theme":"default","expressions":{"show":"$store.variables.selected_visit.patientData.demographics.officePhoneNumber !== undefined"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_call_office - page Visits', \n  'info'\n)\n\nvar demographics = cti.store.variables.selected_visit.patientData.demographics\n\nif(window) {\n  window.open('tel:141'+demographics.officePhoneNumber.replace(/\\\\s/g,''),'_system')\n} else {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning\", \n    \"text\" : \"Cordova is not currently installed, so you may not be running the application on a mobile device.\"\n  })\n}\n\n$success()"},"_auto_id_":"ebdd95d3-5ff0-4a9a-b8a3-3511383f96ca"},{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"62c798d7-1ba3-458c-a07a-5caefcb56a63","function":"toggle","params":{"containerid":"scrollable"}},"_auto_id_":"f610cfa7-9f51-488b-aefa-dcc1c5e20f9e"}]}],"expressions":{"show":"$store.variables.selected_visit.patientData.demographics.officePhoneNumber !== undefined"}},{"name":"button_bar_call","type":"area","item-type":"button-bar","_auto_id_":"21ed6d4d-0e84-4ff6-b1b6-6032442d759f","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_cancel_call","type":"button","item-type":"button","_auto_id_":"1927ba22-05c8-4f54-a0a3-a0b220f55b24","content":"CANCEL","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"62c798d7-1ba3-458c-a07a-5caefcb56a63","function":"toggle","params":{"containerid":"scrollable"}},"_auto_id_":"47c1b907-0d4f-40ae-a96e-bd20c1b2d87e"}],"classes":"default"}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"62c798d7-1ba3-458c-a07a-5caefcb56a63","attributes":{"id":"popupCall"},"expressions":{}}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_start_visit","type":"button","item-type":"button","_auto_id_":"2732eb01-70e6-4150-ad8f-d963d65e58ef","content":"START VISIT","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.selected_visit.arrivalTime = new Date()\ncti.store.variables.selected_visit.status = 'started'\ncti.utils.updatePage()"},"_auto_id_":"4abe1e69-cc83-4fe3-8575-3291c7d5595c","actions":[]}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime == undefined && $store.variables.visit_view_mode != 'Appointments') && $store.variables.selected_visit.status != \"complete\""},"classes":"default"},{"name":"button_add_note","type":"button","item-type":"button","_auto_id_":"11de6e80-ae4d-481c-a8ef-80cc2e8efee9","content":"ADD NOTE","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') || $store.variables.selected_visit.status == \"complete\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Note","isConditional":false},"_auto_id_":"6c829297-8413-4d99-b40c-8351e9e36b15"}]},{"name":"button_add_alert","type":"button","item-type":"button","_auto_id_":"fcd1cbfb-f2d5-4d99-b24e-e242069edd4a","content":"ADD ALERT","theme":"default","expressions":{"show":"$store.variables.selected_visit.arrivalTime != undefined && $store.variables.selected_visit.status != \"new\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Alert","isConditional":false},"_auto_id_":"2358196e-c423-45ec-8cc3-dddb510c82a0"}]},{"name":"button_end_visit","type":"button","item-type":"button","_auto_id_":"2947242a-243b-46e6-bd27-b4f9cea32ebe","content":"END VISIT","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') && $store.variables.selected_visit.status != \"complete\""},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var dialog = cti.store.variables.selected_visit.dialog_form_status\nvar safety = cti.store.variables.selected_visit.safety_form_status\nvar lifestyle = cti.store.variables.selected_visit.lifestyle_form_status\n\ncti.store.variables.formStatus = undefined\ncti.store.variables.o_activities = []\n\nif(dialog == \"failed\" || dialog == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Dialog+\"\n  } else {\n    cti.store.variables.formStatus += \", Dialog+\"\n  }\n} else if(dialog == \"complete\") {\n  var dialogObj = {\n    group : undefined,\n    value : \"dialogplus\",\n    label : \"DIALOG+\"\n  }\n    \n  cti.store.variables.o_activities.push(dialogObj)\n}\n\nif(safety == \"failed\" || safety == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"My Safety Plan\"\n  } else {\n    cti.store.variables.formStatus += \", My Safety Plan\"\n  }\n} else if(safety == \"complete\") {\n  var safetyObj = {\n    group : undefined,\n    value : \"msp\",\n    label : \"My Safety Plan\"\n  }\n    \n  cti.store.variables.o_activities.push(safetyObj)\n}\n\nif(lifestyle == \"failed\" || lifestyle == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Lifestyle Assessment Form\"\n  } else {\n    cti.store.variables.formStatus += \", Lifestyle Assessment Form\"\n  }\n} else if(lifestyle == \"complete\") {\n  var lifestyleObj = {\n    group : undefined,\n    value : \"phlifestyl\",\n    label : \"Lifestyle Assessment Form\"\n  }\n    \n  cti.store.variables.o_activities.push(lifestyleObj)\n}\n\nif(cti.store.variables.formStatus == undefined) {\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n} else {\n  $success()\n}"},"_auto_id_":"32936ead-5b1e-4aa0-9ed9-c713a0d51773","actions":[{"event":"success","type":"call-component-function","data":{"page":"Patient","componentInstanceId":"4f722bc4-cb7e-481b-8566-164ddd9b9197","function":"toggle"},"_auto_id_":"9af88341-30df-4165-a280-5697fd19d319"}]}],"classes":"default"},{"name":"button_end_date_alert","type":"button","item-type":"button","_auto_id_":"d3ec8de7-dc1c-46ad-8717-3e8bcf694b4f","content":"END DATE ALERT","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"RemoveAlert","isConditional":false},"_auto_id_":"2197d535-6cde-4824-900d-4982ddd7bd91"}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode === 'Alerts') || $store.variables.selected_visit.status == \"complete\"","disabled":"$store.variables.alerts === undefined || $store.variables.alerts.length === 0"}}],"_auto_id_":"5af5c4b5-a4bb-4d94-8cae-94e9fc425459","expressions":{"show":"$store.variables.visit_view_mode != \"Appointments\""}}]},{"start":false,"name":"Alerts","config":[{"name":"Page Loaded Event","type":"event","item-type":"onpageloaded","_auto_id_":"45772126-059e-4ad3-bf3f-fe08f9079d44","actions":[{"event":"onpageloaded","type":"inline-function","data":{"sync":true,"code":"if(cti.store.variables.v_alertToRemove_clear) {\n  delete cti.store.variables.v_alertToRemove_clear;\n  delete cti.store.variables.alerts\n  cti.utils.destroyPageData('RemoveAlert');\n}\n\n$success()"},"_auto_id_":"a7f43a5e-954a-480e-9c80-448ad83b9c5d"}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"f5c214e8-0f5d-4ed9-8fdb-84f6066264c6","content":"","theme":"minimal","left-icon":"fa-home","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_back - page Alerts', \n  'info'\n)\n\ncti.fn_save_appointment()"},"_auto_id_":"5f0a3a05-a9e2-4966-8f92-b8c1ee076b99"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Alerts</h4>","_auto_id_":"cc4cf2cf-f089-4795-868e-48a636777031"},{"name":"button_menu","type":"button","item-type":"button","_auto_id_":"a4b83997-774e-4629-b889-3cf1d207cb1b","content":"","theme":"minimal","expressions":{},"left-icon":"fa-bars","actions":[{"event":"click","type":"call-component-function","data":{"page":"Alerts","componentInstanceId":"5c418554-e258-40fc-9bc5-10ab5a029954","function":"toggle"},"_auto_id_":"500361a1-ca17-4c81-9430-9b3b02afa402"}]},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"eda0caf1-80e3-4867-afc2-b12d44106e08","attributes":{},"expressions":{}},{"name":"ct_context_menu","type":"component","item-type":"web-component","content":[{"name":"button_logout","type":"button","item-type":"button","_auto_id_":"7f232c16-2708-4269-b0a0-fe541b41b9a4","content":"Logout","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"Login","isConditional":false},"_auto_id_":"f2759cae-cc36-4323-b899-ed02f6fe9f29"}],"expressions":{}},{"name":"button_bar_menu","type":"area","item-type":"button-bar","_auto_id_":"52541dc1-ae36-4003-b001-5c2410b00239","extends":{"type":"area","item-type":"row"},"content":[{"name":"html_menu_version","type":"content","item-type":"html","_auto_id_":"a06a1f89-0bc0-4929-a94c-aeb7f37caed1","content":"Version {{'$store.schema.version' | store}}","expressions":{}}],"expressions":{}}],"componentId":"1fa0aab1-7b03-413d-b3e0-433405059753","_auto_id_":"5c418554-e258-40fc-9bc5-10ab5a029954","attributes":{"Direction":"right","Overlay":true},"expressions":{},"actions":[]}],"_auto_id_":"6d371d45-6328-4930-b6e5-1a25a857b368","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"cc876489-70bc-48b8-98ac-42191b1a9293","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"e0d0966b-7db6-4991-8833-11beea95f0d4","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"b10cfa63-ae81-466c-a67b-507797b59e45","content":"Back to Summary","theme":"minimal","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"7fca66c5-d5db-4897-b955-2d80b8253a46"}],"classes":""},{"name":"button_filter","type":"button","item-type":"button","_auto_id_":"3b5b0359-bbca-46a7-bbb5-449f556309c7","content":"{{'$store.variables.filter == undefined || $store.variables.filter == \"open\" ? \"Open\" : \"All\"' | store}} Alerts ({{'$store.variables.selected_visit.patientData.displayAlerts.length' | store}})","theme":"minimal","expressions":{"show":"$store.variables.visit_view_mode == \"Alerts\""},"actions":[{"event":"click","type":"call-function","data":{"name":"fn_set_view","params":{"view_name":"Alerts","manual_filter":""}},"_auto_id_":"945557a9-88f1-49b2-950d-350ff80d6351"}],"right-icon":"fa-filter","classes":"infoBanner"},{"name":"popupWarning","type":"component","item-type":"web-component","content":[{"name":"html_warning","type":"content","item-type":"html","_auto_id_":"ca094605-07b1-4d50-869e-d6872970774e","content":"<h3 style=\"color:black\">Warning: Outstanding Form Data</h3>\n<p style=\"color:black\">The following forms have either outstanding data or have failed to send to RiO: {{'$store.variables.formStatus' | store}}. If you continue then this information will be lost.</p>\n<p style=\"color:black\">Do you want to continue? </p>","expressions":{}},{"name":"button_bar_yesno","type":"area","item-type":"button-bar","_auto_id_":"f38fcda6-e249-487d-af47-22ca294481a2","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_yes","type":"button","item-type":"button","_auto_id_":"5456fad9-99dc-4fa8-a3e6-6b971561150a","content":"YES","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"delete cti.store.variables.formStatus\ncti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n$success()"},"_auto_id_":"2d62ff7e-c67b-47f8-be37-9b6b5a36e892"},{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"f04b2d0f-1121-4be8-a03b-1f027cd6c8e7","function":"toggle"},"_auto_id_":"fb8aebaf-5aaa-452d-b16c-05ddefbd8efd"}],"classes":"default"},{"name":"button_no","type":"button","item-type":"button","_auto_id_":"923c1d65-2d55-4095-9d1d-784c1d49894f","content":"NO","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"f04b2d0f-1121-4be8-a03b-1f027cd6c8e7","function":"toggle"},"_auto_id_":"a0694fbe-4a26-459e-a0ba-a395bc1e516c"}]}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"f04b2d0f-1121-4be8-a03b-1f027cd6c8e7","attributes":{"id":"popupWarning"},"expressions":{}}],"expressions":{},"classes":"relative"},{"name":"scrollable_results","type":"area","item-type":"scrollable","_auto_id_":"0bcd3c29-bbaa-4b2f-a15b-af0d114cca40","content":[{"name":"list_alerts","type":"content","item-type":"list","_auto_id_":"721edcfe-6459-4edf-b30b-328e4a24d79f","search":"","classes":"","expressions":{},"model":"$store.variables.selected_visit.patientData.displayAlerts","dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_alerts_html","_auto_id_":"4aba1b41-c32e-4835-a3ab-276c048f18a6","content":"<!-- HTML Template for tablet size devices and above -->\n<div id=\"alertRowHidden-{{$data.$item.id}}\" class=\"card_holder\">\n  <div class=\"alert_type\">{{$data.$item.type.value}}</div>\n  <div class=\"date\"><span>Date</span>{{$data.$item.date | date:'d MMM y h:mm'}}</div>\n  <div class=\"flex_row line_after\">\n    <div class=\"priority\"><span>Priority</span>{{$data.$item.priority.value }}</div>\n    <div class=\"ended\"><span>Ended</span>{{$data.$item.removalDate == undefined ? \"No\" : \"Yes\"}}</div>\n  </div> \n  <div class=\"line_after {{$data.$item.removalDate == undefined ? 'display-none' : 'Yes'}}\">   \n    <div class=\"removal_date\"><span>Removal date</span>{{$data.$item.removalDate | date:'d MMM y h:mm'}}</div>\n    <div class=\"removal_comment\"><span>Comment</span>{{$data.$item.removalComment == \"\" ? \"No Comment\" : $data.$item.removalComment}}</div>    \n  </div>\n  <div class=\"alert_text\">{{$data.$item.text}}</div>\n</div>","expressions":{"show":"$store.variables.selected_visit.patientData.displayAlerts.length > 0"}}],"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"if(cti.store.variables.alerts === undefined) {\n  cti.store.variables.alerts = []\n}\n\nvar alert = cti.store.variables.alerts[0]\n\nif(alert) {\n  //var visibleString = 'alertRowVisible-' + cti.store.variables.alertToRemove.id;\n  var hiddenString = 'alertRowHidden-' + alert.id;\n\n  //var visible = document.getElementById(visibleString);\n  var hidden = document.getElementById(hiddenString);\n\n  if(hidden == null) {\n    cti.store.variables.alerts = []\n    return false;\n  }\n\n  //visible.classList.remove('selected');\n  hidden.classList.remove('selected');\n  \n  if($data.$item.id != alert.id) {\n    var alertToRemove = $data.$item;\n\n    //var visibleString = 'alertRowVisible-' + {{$data.$item.id}};\n    var hiddenString = 'alertRowHidden-' + {{$data.$item.id}};\n\n    //var visible = document.getElementById(visibleString);\n    var hidden = document.getElementById(hiddenString);\n\n    //visible.classList.add('selected');\n    hidden.classList.add('selected');\n\n\tcti.store.variables.alerts = [];\n\tcti.store.variables.alerts.push(alertToRemove);\n  } else {\n    cti.store.variables.alerts = []\n  }\n} else {\n  var alertToRemove = $data.$item;\n\n  //var visibleString = 'alertRowVisible-' + {{$data.$item.id}};\n  var hiddenString = 'alertRowHidden-' + {{$data.$item.id}};\n\n  //var visible = document.getElementById(visibleString);\n  var hidden = document.getElementById(hiddenString);\n\n  //visible.classList.add('selected');\n  hidden.classList.add('selected');\n\n  cti.store.variables.alerts = [];\n  cti.store.variables.alerts.push(alertToRemove);\n}\n\ncti.utils.updatePage();"},"_auto_id_":"a191f4d6-57e3-4ebc-be16-0a16900da430"}]},{"name":"image_alerts","type":"media","item-type":"image-viewer","_auto_id_":"09577ae8-b857-4c99-adc9-85e068698bdb","scaleImage":true,"maxWidth":50,"maxHeight":50,"expressions":{"show":"$store.variables.selected_visit.patientData.alerts.length == 0"},"fileName":"thin-0550_attention_error_alert_caution.png","actions":[],"classes":"no-data-image"},{"type":"content","item-type":"html","name":"list_alerts_nodata_html","_auto_id_":"02e4fa1e-d274-4f27-9f9c-d4a72a482dc0","content":"<!-- HTML Template for tablet size devices and above -->\n<div class=\"row hidden-xs hidden-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Patient Alerts</strong>\n  </div>\n</div>\n\n<!-- HTML Template for smaller mobile devices -->\n<div class=\"row visible-xs visible-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Patient Alerts</strong>\n  </div>\n</div>","expressions":{"show":"$store.variables.selected_visit.patientData.alerts.length == 0"}}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_start_visit","type":"button","item-type":"button","_auto_id_":"e568550e-23a4-4fea-aeb1-3058944d502c","content":"START VISIT","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.selected_visit.arrivalTime = new Date()\ncti.store.variables.selected_visit.status = 'started'\ncti.utils.updatePage()"},"_auto_id_":"65389f59-065b-46f6-b2bb-fbeb06e9b9df","actions":[]}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime == undefined && $store.variables.visit_view_mode != 'Appointments') && $store.variables.selected_visit.status != \"complete\""},"classes":"default"},{"name":"button_add_note","type":"button","item-type":"button","_auto_id_":"87e2cfd7-91a8-4039-bd7c-82983f22d567","content":"ADD NOTE","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') || $store.variables.selected_visit.status == \"complete\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Note","isConditional":false},"_auto_id_":"3aa54983-9731-4a0d-904c-bd51b7f34f53"}]},{"name":"button_add_alert","type":"button","item-type":"button","_auto_id_":"f1383da4-78d5-41c2-9983-9368b478c611","content":"ADD ALERT","theme":"default","expressions":{"show":"$store.variables.selected_visit.arrivalTime != undefined && $store.variables.selected_visit.status != \"new\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Alert","isConditional":false},"_auto_id_":"3afa0585-87b2-40ed-8056-d3a1ee70e991"}]},{"name":"button_end_visit","type":"button","item-type":"button","_auto_id_":"cf39fcd8-176e-4988-8938-1d9da9b1473b","content":"END VISIT","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') && $store.variables.selected_visit.status != \"complete\""},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var dialog = cti.store.variables.selected_visit.dialog_form_status\nvar safety = cti.store.variables.selected_visit.safety_form_status\nvar lifestyle = cti.store.variables.selected_visit.lifestyle_form_status\n\ncti.store.variables.formStatus = undefined\ncti.store.variables.o_activities = []\n\nif(dialog == \"failed\" || dialog == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Dialog+\"\n  } else {\n    cti.store.variables.formStatus += \", Dialog+\"\n  }\n} else if(dialog == \"complete\") {\n  var dialogObj = {\n    group : undefined,\n    value : \"dialogplus\",\n    label : \"DIALOG+\"\n  }\n    \n  cti.store.variables.o_activities.push(dialogObj)\n}\n\nif(safety == \"failed\" || safety == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"My Safety Plan\"\n  } else {\n    cti.store.variables.formStatus += \", My Safety Plan\"\n  }\n} else if(safety == \"complete\") {\n  var safetyObj = {\n    group : undefined,\n    value : \"msp\",\n    label : \"My Safety Plan\"\n  }\n    \n  cti.store.variables.o_activities.push(safetyObj)\n}\n\nif(lifestyle == \"failed\" || lifestyle == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Lifestyle Assessment Form\"\n  } else {\n    cti.store.variables.formStatus += \", Lifestyle Assessment Form\"\n  }\n} else if(lifestyle == \"complete\") {\n  var lifestyleObj = {\n    group : undefined,\n    value : \"phlifestyl\",\n    label : \"Lifestyle Assessment Form\"\n  }\n    \n  cti.store.variables.o_activities.push(lifestyleObj)\n}\n\nif(cti.store.variables.formStatus == undefined) {\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n} else {\n  $success()\n}"},"_auto_id_":"1351b980-fca5-4ecd-a76b-c54027259ece","actions":[{"event":"success","type":"call-component-function","data":{"page":"Alerts","componentInstanceId":"f04b2d0f-1121-4be8-a03b-1f027cd6c8e7","function":"toggle"},"_auto_id_":"06beae6b-5e18-4402-8eb3-245fa9a37285"}]}],"classes":"default"},{"name":"button_end_date_alert","type":"button","item-type":"button","_auto_id_":"b9e95c43-c715-45e0-a930-59eb7981da8e","content":"END DATE ALERT","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"RemoveAlert","isConditional":false},"_auto_id_":"fa36d335-b5dd-47d0-9f21-809d4f11e4a5"}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode === 'Alerts') || $store.variables.selected_visit.status == \"complete\"","disabled":"$store.variables.alerts === undefined || $store.variables.alerts.length === 0"}}],"_auto_id_":"dc9eabe1-c3bd-4b16-94ae-5bdd63fb329b","expressions":{"show":"$store.variables.visit_view_mode != \"Appointments\""}}]},{"start":false,"name":"Appointments","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"0b2364a7-445e-4fbf-bc1f-8e64c7b4e193","content":"","theme":"minimal","left-icon":"fa-home","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_back - page Appointments', \n  'info'\n)\n\ncti.fn_save_appointment()"},"_auto_id_":"5613fc83-143e-491a-a0b2-b70063aed8ba"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Appointments</h4>","_auto_id_":"08410803-be29-4dd8-967b-e234eeb20742"},{"name":"button_menu","type":"button","item-type":"button","_auto_id_":"58f70d31-1244-46c9-859e-83beeaac7b11","content":"","theme":"minimal","expressions":{},"left-icon":"fa-bars","actions":[{"event":"click","type":"call-component-function","data":{"page":"Appointments","componentInstanceId":"be3441c2-d021-4ecb-95ef-53ede6798530","function":"toggle"},"_auto_id_":"7040b633-c98b-4255-a452-08afdddb8267"}]},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"0027f18b-8a5c-423f-9c51-74b78bf90c33","attributes":{},"expressions":{}},{"name":"ct_context_menu","type":"component","item-type":"web-component","content":[{"name":"button_logout","type":"button","item-type":"button","_auto_id_":"37e6837c-9c25-4d6b-be50-55efaef623dd","content":"Logout","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"Login","isConditional":false},"_auto_id_":"90bc65d3-d890-4983-89ae-5bed0926af64"}],"expressions":{}},{"name":"button_bar_menu","type":"area","item-type":"button-bar","_auto_id_":"e41165c7-b456-4d74-85ba-83186a225207","extends":{"type":"area","item-type":"row"},"content":[{"name":"html_menu_version","type":"content","item-type":"html","_auto_id_":"1b19c7c4-324e-4f4e-ba08-f42f50f0e4ca","content":"Version {{'$store.schema.version' | store}}","expressions":{}}],"expressions":{}}],"componentId":"1fa0aab1-7b03-413d-b3e0-433405059753","_auto_id_":"be3441c2-d021-4ecb-95ef-53ede6798530","attributes":{"Direction":"right","Overlay":true},"expressions":{},"actions":[]}],"_auto_id_":"a4d878d9-1383-43f0-9080-3eb96518ead7","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"3f30634a-ea1e-4326-be5e-98a2d6d21aea","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"472bbb10-05ca-4094-b140-dd77b9a4823c","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"e6faf995-c887-48b1-a8b6-75808ce56b15","content":"Back to Summary","theme":"minimal","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"0fe777cc-025b-49f5-ac9e-87a260308ae1"}],"classes":""},{"name":"html_view_mode","type":"content","item-type":"html","_auto_id_":"1558bde3-adf2-4558-84ca-16079104d89a","content":"{{'$store.variables.visit_view_mode' | store}}","expressions":{},"classes":"infoBanner"},{"name":"popupWarning","type":"component","item-type":"web-component","content":[{"name":"html_warning","type":"content","item-type":"html","_auto_id_":"f8d78df3-a0d2-41fd-bb81-e0425b741c10","content":"<h3 style=\"color:black\">Warning: Outstanding Form Data</h3>\n<p style=\"color:black\">The following forms have either outstanding data or have failed to send to RiO: {{'$store.variables.formStatus' | store}}. If you continue then this information will be lost.</p>\n<p style=\"color:black\">Do you want to continue? </p>","expressions":{}},{"name":"button_bar_yesno","type":"area","item-type":"button-bar","_auto_id_":"ebf17bfb-0c09-49e8-9996-a72600737c30","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_yes","type":"button","item-type":"button","_auto_id_":"07fb790d-592c-43d5-8a80-c52767aa9a36","content":"YES","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"delete cti.store.variables.formStatus\ncti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n$success()"},"_auto_id_":"c795567f-8775-4ba8-8491-991b26b8ea28"},{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"997b39e8-2ffa-45ff-9c49-b3b6d74d9a6f","function":"toggle"},"_auto_id_":"a10b09a0-5085-499a-9970-394ecfa91354"}],"classes":"default"},{"name":"button_no","type":"button","item-type":"button","_auto_id_":"e6e0639c-db72-4282-90f3-b8fc44e6f741","content":"NO","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"997b39e8-2ffa-45ff-9c49-b3b6d74d9a6f","function":"toggle"},"_auto_id_":"9f3f42d8-0989-4795-bb44-2bb227048b92"}]}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"997b39e8-2ffa-45ff-9c49-b3b6d74d9a6f","attributes":{"id":"popupWarning"},"expressions":{}}],"expressions":{},"classes":"relative"},{"name":"scrollable_results","type":"area","item-type":"scrollable","_auto_id_":"cd1c066c-db0e-4655-8396-f96e974346af","content":[{"name":"list_appointments","type":"content","item-type":"list","_auto_id_":"9f0fe365-c9c7-46d5-a2a2-8dae6fb72c07","search":"","classes":"","expressions":{},"model":"$store.variables.selected_visit.patientData.appointmentHistory","dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_appointments_html","_auto_id_":"01ecff0d-c585-46f8-aeeb-67cad663707a","content":"<div class=\"card_holder\">\n  <div class=\"line_after\">\n    <div class=\"appt_type\">{{$data.$item.type}}</div>\n    <div >{{$data.$item.hcpSurname}}, {{$data.$item.hcpForename}}  {{$data.$item.hcpTitle != '' ? '(' : ''}}{{$data.$item.hcpTitle}}{{$data.$item.hcpTitle != '' ? ')' : ''}}</div>\n  </div>\n  <div class=\"{{$data.$item.comment == '' ? '' : 'line_after'}}\">\n    <div class=\"date\"><span>Date</span>{{$data.$item.date | date:'d MMM y h:mm'}} ({{$data.$item.intendedDuration}} Minutes)</div>\n    <div><span>Setting</span>{{$data.$item.clinic}}</div>\n    <div><span>Location</span>{{$data.$item.location}}</div>\n    <div class=\"{{$data.$item.cancellationReason == '' ? 'display-none' : 'Yes'}}\">\n      <span>Cancellation</span>{{$data.$item.cancellationReason != \"\" ? $data.$item.cancellationReason : \"Not Applicable\"}}\n    </div>\n    <div class=\"{{$data.$item.outcome == '' ? 'display-none' : 'Yes'}}\">\n      <span>Outcome</span>{{$data.$item.outcome != \"\" ? $data.$item.outcome : \"Not Applicable\"}}\n    </div>\n  </div>\n  <div class=\"{{$data.$item.comment == '' ? 'display-none' : 'Yes'}}\">   \n    <span>Comments</span>{{$data.$item.comment != \"\" ? $data.$item.comment : \"Not Applicable\"}}\t\t\n  </div>\n</div> "}],"actions":[]},{"name":"image_appointments","type":"media","item-type":"image-viewer","_auto_id_":"36344772-036b-4b1f-bed6-f6b0e766c711","scaleImage":true,"maxWidth":50,"maxHeight":50,"expressions":{"show":"$store.variables.selected_visit.patientData.appointmentHistory.length == 0"},"fileName":"thin-0023_calendar_month_day_planner_events.png","actions":[],"classes":"no-data-image"},{"type":"content","item-type":"html","name":"list_apps_nodata_html","_auto_id_":"70b7fb44-ea0a-4ce3-be5c-13f78ab9e4be","content":"<!-- HTML Template for tablet size devices and above -->\n<div class=\"row hidden-xs hidden-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Appointment History</strong>\n  </div>\n</div>\n\n<!-- HTML Template for smaller mobile devices -->\n<div class=\"row visible-xs visible-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Appointment History</strong>\n  </div>\n</div>","expressions":{"show":"$store.variables.selected_visit.patientData.appointmentHistory.length == 0"}}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_start_visit","type":"button","item-type":"button","_auto_id_":"67326254-385e-49a9-ad36-77c4742753f7","content":"START VISIT","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.selected_visit.arrivalTime = new Date()\ncti.store.variables.selected_visit.status = 'started'\ncti.utils.updatePage()"},"_auto_id_":"b29ede63-b5eb-4044-934c-cfd2f4687128","actions":[]}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime == undefined && $store.variables.visit_view_mode != 'Appointments') && $store.variables.selected_visit.status != \"complete\""},"classes":"default"},{"name":"button_add_note","type":"button","item-type":"button","_auto_id_":"c610bb7e-856a-4928-a100-c68788fb4fc0","content":"ADD NOTE","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') || $store.variables.selected_visit.status == \"complete\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Note","isConditional":false},"_auto_id_":"2711fb76-c2ae-4b91-803f-4d79cc71cdb3"}]},{"name":"button_add_alert","type":"button","item-type":"button","_auto_id_":"86f50cae-7881-4a44-adbe-c4c8a79643e5","content":"ADD ALERT","theme":"default","expressions":{"show":"$store.variables.selected_visit.arrivalTime != undefined && $store.variables.selected_visit.status != \"new\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Alert","isConditional":false},"_auto_id_":"e7cc8adc-98fa-423d-a591-4c4b70a4c049"}]},{"name":"button_end_visit","type":"button","item-type":"button","_auto_id_":"f2829c7f-2033-44a8-968e-3ded19ce0386","content":"END VISIT","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') && $store.variables.selected_visit.status != \"complete\""},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var dialog = cti.store.variables.selected_visit.dialog_form_status\nvar safety = cti.store.variables.selected_visit.safety_form_status\nvar lifestyle = cti.store.variables.selected_visit.lifestyle_form_status\n\ncti.store.variables.formStatus = undefined\ncti.store.variables.o_activities = []\n\nif(dialog == \"failed\" || dialog == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Dialog+\"\n  } else {\n    cti.store.variables.formStatus += \", Dialog+\"\n  }\n} else if(dialog == \"complete\") {\n  var dialogObj = {\n    group : undefined,\n    value : \"dialogplus\",\n    label : \"DIALOG+\"\n  }\n    \n  cti.store.variables.o_activities.push(dialogObj)\n}\n\nif(safety == \"failed\" || safety == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"My Safety Plan\"\n  } else {\n    cti.store.variables.formStatus += \", My Safety Plan\"\n  }\n} else if(safety == \"complete\") {\n  var safetyObj = {\n    group : undefined,\n    value : \"msp\",\n    label : \"My Safety Plan\"\n  }\n    \n  cti.store.variables.o_activities.push(safetyObj)\n}\n\nif(lifestyle == \"failed\" || lifestyle == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Lifestyle Assessment Form\"\n  } else {\n    cti.store.variables.formStatus += \", Lifestyle Assessment Form\"\n  }\n} else if(lifestyle == \"complete\") {\n  var lifestyleObj = {\n    group : undefined,\n    value : \"phlifestyl\",\n    label : \"Lifestyle Assessment Form\"\n  }\n    \n  cti.store.variables.o_activities.push(lifestyleObj)\n}\n\nif(cti.store.variables.formStatus == undefined) {\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n} else {\n  $success()\n}"},"_auto_id_":"2347e7a0-87eb-4dfa-ac08-973fa34fab6c","actions":[{"event":"success","type":"call-component-function","data":{"page":"Appointments","componentInstanceId":"997b39e8-2ffa-45ff-9c49-b3b6d74d9a6f","function":"toggle"},"_auto_id_":"e75b96e3-c81c-4827-8009-6c88e0794a28"}]}],"classes":"default"},{"name":"button_end_date_alert","type":"button","item-type":"button","_auto_id_":"2729d2bf-a5ae-4698-98b3-d7cd86e47a2a","content":"END DATE ALERT","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"RemoveAlert","isConditional":false},"_auto_id_":"519a96d4-7541-4a3f-9977-43a5b4b8125b"}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode === 'Alerts') || $store.variables.selected_visit.status == \"complete\"","disabled":"$store.variables.alerts === undefined || $store.variables.alerts.length === 0"}}],"_auto_id_":"2a76babd-95ce-45d3-81ba-4175d9464cdf","expressions":{"show":"$store.variables.visit_view_mode != \"Appointments\""}}]},{"start":false,"name":"Referrals","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"2d178d33-0660-4a71-89ec-9ee9230c08db","content":"","theme":"minimal","left-icon":"fa-home","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_back - page Referrals', \n  'info'\n)\n\ncti.fn_save_appointment()"},"_auto_id_":"c7258470-7c16-45eb-bd35-fd139c97c1b5"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Referrals</h4>","_auto_id_":"722eb5bc-d774-402d-bae4-dce6c6135b1f","expressions":{}},{"name":"button_menu","type":"button","item-type":"button","_auto_id_":"976960d8-c2f2-40f6-948a-24f192c41fae","content":"","theme":"minimal","expressions":{},"left-icon":"fa-bars","actions":[{"event":"click","type":"call-component-function","data":{"page":"Referrals","componentInstanceId":"807bd023-848f-4039-83d3-c5e3b0b303d3","function":"toggle"},"_auto_id_":"693a4432-54d4-4a43-a688-b2ef1e66c40a"}]},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"0a2164d9-e85c-4913-b0fa-35f69d2496a9","attributes":{},"expressions":{}},{"name":"ct_context_menu","type":"component","item-type":"web-component","content":[{"name":"button_logout","type":"button","item-type":"button","_auto_id_":"500f4d52-0781-45c7-bd7b-da5277928214","content":"Logout","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"Login","isConditional":false},"_auto_id_":"e25878e1-d135-4817-b497-ac9b9502107e"}],"expressions":{}},{"name":"button_bar_menu","type":"area","item-type":"button-bar","_auto_id_":"9dca6494-8eb5-4b2d-aac9-b4e4c38afe4f","extends":{"type":"area","item-type":"row"},"content":[{"name":"html_menu_version","type":"content","item-type":"html","_auto_id_":"5081a067-366f-498f-866e-85c8ee634dec","content":"Version {{'$store.schema.version' | store}}","expressions":{}}],"expressions":{}}],"componentId":"1fa0aab1-7b03-413d-b3e0-433405059753","_auto_id_":"807bd023-848f-4039-83d3-c5e3b0b303d3","attributes":{"Direction":"right","Overlay":true},"expressions":{},"actions":[]}],"_auto_id_":"480fe3ef-c182-425b-bbbe-80fffaced491","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"752be6c5-75e1-4cff-b1cc-81a070204f3a","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"9d4d6b50-8566-401d-87cb-117739744a7c","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"a4bf5046-66a3-40f2-be3a-9b2bd495306f","content":"Back to Summary","theme":"minimal","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"72198cc2-20a5-4dc2-a532-4b8b31413b58"}],"classes":""},{"name":"html_view_mode","type":"content","item-type":"html","_auto_id_":"65c12dd6-6609-4776-a2ea-385a1b6bb36c","content":"{{'$store.variables.visit_view_mode' | store}}","expressions":{},"classes":"infoBanner"},{"name":"popupWarning","type":"component","item-type":"web-component","content":[{"name":"html_warning","type":"content","item-type":"html","_auto_id_":"ed0351c7-3e44-472a-82e2-46bf307d0009","content":"<h3 style=\"color:black\">Warning: Outstanding Form Data</h3>\n<p style=\"color:black\">The following forms have either outstanding data or have failed to send to RiO: {{'$store.variables.formStatus' | store}}. If you continue then this information will be lost.</p>\n<p style=\"color:black\">Do you want to continue? </p>","expressions":{}},{"name":"button_bar_yesno","type":"area","item-type":"button-bar","_auto_id_":"9d163ca3-5339-4eeb-93b0-ce1176a8c7ac","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_yes","type":"button","item-type":"button","_auto_id_":"cafeb6ac-394c-4695-a1de-7f5a7cd0183c","content":"YES","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"delete cti.store.variables.formStatus\ncti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n$success()"},"_auto_id_":"74b638c7-a658-4f3b-bf2a-7cfb68dfa668"},{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"787f54ec-b9a2-42cd-b30b-d3bc045ce3f2","function":"toggle"},"_auto_id_":"4bd0517c-948f-471c-8867-ec3472251269"}],"classes":"default"},{"name":"button_no","type":"button","item-type":"button","_auto_id_":"f9f95d2e-a915-4e16-bcc3-e8be4ed9d5c4","content":"NO","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"787f54ec-b9a2-42cd-b30b-d3bc045ce3f2","function":"toggle"},"_auto_id_":"c3da1906-5a27-46bc-9a6c-069082cf0139"}]}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"787f54ec-b9a2-42cd-b30b-d3bc045ce3f2","attributes":{"id":"popupWarning"},"expressions":{}}],"expressions":{},"classes":"relative"},{"name":"scrollable_results","type":"area","item-type":"scrollable","_auto_id_":"778745e2-00d3-4e5a-b397-b34179ddb987","content":[{"name":"list_referrals","type":"content","item-type":"list","_auto_id_":"2b275acd-6e1e-457b-980a-4db3dc5c0428","search":"","classes":"","model":"$store.variables.selected_visit.patientData.referrals","theme":"","expressions":{},"actions":[],"dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_referrals_html","_auto_id_":"3590d27d-ce35-4860-bdaf-56bcf95f64a8","content":"<div class=\"card_holder\">\n  <div class=\"flex_row\">\n    <div class=\"referral\">Referred to {{$data.$item.specialty.value}}</div>\n    <div ng-if=\"$data.$item.associatedDocuments.associatedDocument.fileType\" class=\"doc_link_holder fa {{$data.$item.associatedDocuments.associatedDocument.fileType == 'image/jpeg' ? 'fa-camera' : 'fa-file-text-o'}}\" onclick=\"cti.fn_load_document(this.id)\" id=\"{{$data.$item.associatedDocuments.associatedDocument}}\"></div>\n  </div>  \n    <div class=\"service\"><span>Date</span>{{$data.$item.referralDate | date:'d MMM y h:mm'}}</div>\n    <div class=\"service\"><span>Team/HCP</span>{{$data.$item.team.value}}</div>\n    <div class=\"referrer\"><span>By</span>{{$data.$item.referrer}}</div>\n    <div class=\"referrer\"><span>Source</span>{{$data.$item.source}}</div>   \n</div>"}]},{"name":"image_referrals","type":"media","item-type":"image-viewer","_auto_id_":"1a1458fb-7bef-4ac2-bab7-c7f4e366b8ef","scaleImage":true,"maxWidth":50,"maxHeight":50,"expressions":{"show":"$store.variables.selected_visit.patientData.referrals.length == 0"},"fileName":"thin-0825_stetoscope_doctor_hospital_ill.png","actions":[],"classes":"no-data-image"},{"type":"content","item-type":"html","name":"list_referral_nodata_html","_auto_id_":"54a86689-4905-42f0-af43-02ed10b4619d","content":"<!-- HTML Template for tablet size devices and above -->\n<div class=\"row hidden-xs hidden-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Referral Information</strong>\n  </div>\n</div>\n\n<!-- HTML Template for smaller mobile devices -->\n<div class=\"row visible-xs visible-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Referral Information</strong>\n  </div>\n</div>","expressions":{"show":"$store.variables.selected_visit.patientData.referrals.length == 0"}}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_start_visit","type":"button","item-type":"button","_auto_id_":"9c62db8e-a6e4-4552-b2af-125e4ec58c96","content":"START VISIT","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.selected_visit.arrivalTime = new Date()\ncti.store.variables.selected_visit.status = 'started'\ncti.utils.updatePage()"},"_auto_id_":"e31e3b1c-3996-442b-a687-cd2cd63bb2e2","actions":[]}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime == undefined && $store.variables.visit_view_mode != 'Appointments') && $store.variables.selected_visit.status != \"complete\""},"classes":"default"},{"name":"button_add_note","type":"button","item-type":"button","_auto_id_":"d33ae743-8089-4d36-adcc-b1e8a0267331","content":"ADD NOTE","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') || $store.variables.selected_visit.status == \"complete\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Note","isConditional":false},"_auto_id_":"7f546471-1926-4db1-b0c9-e1bde36a7730"}]},{"name":"button_add_alert","type":"button","item-type":"button","_auto_id_":"923ef33a-0058-4c8f-83d4-175b1ce5c2ce","content":"ADD ALERT","theme":"default","expressions":{"show":"$store.variables.selected_visit.arrivalTime != undefined && $store.variables.selected_visit.status != \"new\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Alert","isConditional":false},"_auto_id_":"f84ff2cb-714d-46bd-b734-19461a401f99"}]},{"name":"button_end_visit","type":"button","item-type":"button","_auto_id_":"0f41dfd3-0994-47c2-b173-d048142ae17e","content":"END VISIT","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') && $store.variables.selected_visit.status != \"complete\""},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var dialog = cti.store.variables.selected_visit.dialog_form_status\nvar safety = cti.store.variables.selected_visit.safety_form_status\nvar lifestyle = cti.store.variables.selected_visit.lifestyle_form_status\n\ncti.store.variables.formStatus = undefined\ncti.store.variables.o_activities = []\n\nif(dialog == \"failed\" || dialog == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Dialog+\"\n  } else {\n    cti.store.variables.formStatus += \", Dialog+\"\n  }\n} else if(dialog == \"complete\") {\n  var dialogObj = {\n    group : undefined,\n    value : \"dialogplus\",\n    label : \"DIALOG+\"\n  }\n    \n  cti.store.variables.o_activities.push(dialogObj)\n}\n\nif(safety == \"failed\" || safety == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"My Safety Plan\"\n  } else {\n    cti.store.variables.formStatus += \", My Safety Plan\"\n  }\n} else if(safety == \"complete\") {\n  var safetyObj = {\n    group : undefined,\n    value : \"msp\",\n    label : \"My Safety Plan\"\n  }\n    \n  cti.store.variables.o_activities.push(safetyObj)\n}\n\nif(lifestyle == \"failed\" || lifestyle == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Lifestyle Assessment Form\"\n  } else {\n    cti.store.variables.formStatus += \", Lifestyle Assessment Form\"\n  }\n} else if(lifestyle == \"complete\") {\n  var lifestyleObj = {\n    group : undefined,\n    value : \"phlifestyl\",\n    label : \"Lifestyle Assessment Form\"\n  }\n    \n  cti.store.variables.o_activities.push(lifestyleObj)\n}\n\nif(cti.store.variables.formStatus == undefined) {\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n} else {\n  $success()\n}"},"_auto_id_":"d698a169-8f4c-4eb1-bf6d-21e4e7bba61a","actions":[{"event":"success","type":"call-component-function","data":{"page":"Referrals","componentInstanceId":"787f54ec-b9a2-42cd-b30b-d3bc045ce3f2","function":"toggle"},"_auto_id_":"8b8bd311-cd30-4d9e-b870-3bf11c86cac2"}]}],"classes":"default"},{"name":"button_end_date_alert","type":"button","item-type":"button","_auto_id_":"0f9ec088-0eea-4d63-9bb1-92377275ccac","content":"END DATE ALERT","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"RemoveAlert","isConditional":false},"_auto_id_":"70c53b58-df58-4f62-899a-3eacb338ba32"}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode === 'Alerts') || $store.variables.selected_visit.status == \"complete\"","disabled":"$store.variables.alerts === undefined || $store.variables.alerts.length === 0"}}],"_auto_id_":"9d7ed4a7-68e5-4874-ae4e-2fb48d71d312","expressions":{"show":"$store.variables.visit_view_mode != \"Appointments\""}}]},{"start":false,"name":"Notes","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"3564c6e1-6cf9-4c8d-ab48-993a7cd10507","content":"","theme":"minimal","left-icon":"fa-home","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_back - page Notes', \n  'info'\n)\n\ncti.fn_save_appointment()"},"_auto_id_":"0bb8a9b4-bc16-4922-9176-2497c0fb3026"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Progress Notes</h4>","_auto_id_":"df42ca00-685b-4b15-b5df-d1fa982622b5"},{"name":"button_menu","type":"button","item-type":"button","_auto_id_":"aab75360-7c56-48d3-8479-1810b458fe6c","content":"","theme":"minimal","expressions":{},"left-icon":"fa-bars","actions":[{"event":"click","type":"call-component-function","data":{"page":"Notes","componentInstanceId":"a15c2d02-1094-48d1-87da-34bcbe8ca586","function":"toggle"},"_auto_id_":"9910b1e4-192d-4276-a889-1e8ad683a074"}]},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"190f406e-da6d-46c8-b979-66b5fa2d42cd","attributes":{},"expressions":{}},{"name":"ct_context_menu","type":"component","item-type":"web-component","content":[{"name":"button_logout","type":"button","item-type":"button","_auto_id_":"bfdb56ad-9f20-45c6-b24d-a853385d841d","content":"Logout","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"Login","isConditional":false},"_auto_id_":"26562d97-5aca-4f65-9f57-ac81549b32c0"}],"expressions":{}},{"name":"button_bar_menu","type":"area","item-type":"button-bar","_auto_id_":"6f9149d5-b10e-4ce5-873e-57a429fc3fe6","extends":{"type":"area","item-type":"row"},"content":[{"name":"html_menu_version","type":"content","item-type":"html","_auto_id_":"e6895147-2d99-4188-8bb9-47a8543aa96b","content":"Version {{'$store.schema.version' | store}}","expressions":{}}],"expressions":{}}],"componentId":"1fa0aab1-7b03-413d-b3e0-433405059753","_auto_id_":"a15c2d02-1094-48d1-87da-34bcbe8ca586","attributes":{"Direction":"right","Overlay":true},"expressions":{},"actions":[]}],"_auto_id_":"309b6ff8-4a2d-48d4-b8c1-c32de6ba1254","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"c0679c29-d88a-4fdb-a99d-afb73f698c6c","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"f104e7cc-82e2-477a-9213-094ba744357d","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"5f44ceb3-aa5a-40a4-a432-5f20cf54e262","content":"Back to Summary","theme":"minimal","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"f0e749db-3531-4a93-9e13-337ad9dc8690"}],"classes":""},{"name":"html_view_mode","type":"content","item-type":"html","_auto_id_":"90592838-b883-4924-bafb-552a4bee7dd1","content":"{{'$store.variables.visit_view_mode' | store}}","expressions":{},"classes":"infoBanner"},{"name":"popupWarning","type":"component","item-type":"web-component","content":[{"name":"html_warning","type":"content","item-type":"html","_auto_id_":"6719df86-9acd-428a-b573-0a87ad26aba3","content":"<h3 style=\"color:black\">Warning: Outstanding Form Data</h3>\n<p style=\"color:black\">The following forms have either outstanding data or have failed to send to RiO: {{'$store.variables.formStatus' | store}}. If you continue then this information will be lost.</p>\n<p style=\"color:black\">Do you want to continue? </p>","expressions":{}},{"name":"button_bar_yesno","type":"area","item-type":"button-bar","_auto_id_":"bd6523ac-6af5-463f-b7c7-8505b3721244","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_yes","type":"button","item-type":"button","_auto_id_":"c0e2cb98-6778-4c5f-b914-6f1e9105fe06","content":"YES","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"delete cti.store.variables.formStatus\ncti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n$success()"},"_auto_id_":"76e6c898-54dc-4448-bbbe-459c809f9d8d"},{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"b37de555-68b0-46ed-aca0-a540075a9651","function":"toggle"},"_auto_id_":"5f12032b-8c57-47f0-b621-2e280a8d8569"}],"classes":"default"},{"name":"button_no","type":"button","item-type":"button","_auto_id_":"9b9498db-01c4-476a-b0c1-39200533a2dc","content":"NO","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"b37de555-68b0-46ed-aca0-a540075a9651","function":"toggle"},"_auto_id_":"6c894198-fbd7-4ef4-9594-01c320d9148f"}]}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"b37de555-68b0-46ed-aca0-a540075a9651","attributes":{"id":"popupWarning"},"expressions":{}}],"expressions":{},"classes":"relative"},{"name":"scrollable_results","type":"area","item-type":"scrollable","_auto_id_":"2cdeaea7-a1c9-4369-805b-a8e1f8f6e1bc","content":[{"name":"list_notes","type":"content","item-type":"list","_auto_id_":"36bb8344-be73-4a26-888c-4cb447fde43f","search":"","classes":"","expressions":{},"model":"$store.variables.selected_visit.patientData.progressNotes","actions":[],"dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_notes_html","_auto_id_":"09494d14-f9a5-4db0-9c87-973b62762750","content":"<div class=\"card_holder\">\n    <div class=\"line_after flex_row\">\n        <div class=\"note_type left half\">{{$data.$item.progressNoteType.value}}</div>\n        <div class=\"sub_type right half\">{{$data.$item.progressNoteSubType.value}}</div>\n        <div class=\"speciality full\"><span>Specialty</span>{{$data.$item.specialty.value}}</div>\n    </div>\n    <div class=\"line_after\">\n        <div class=\"{{$data.$item.associatedDocuments != undefined ? 'documents' : 'hide'}}\">\n            <p class=\"fa {{$data.$item.associatedDocuments.associatedDocument.fileType != 'application/pdf' ? 'fa-camera' : 'fa-file-text-o'}}\" onclick=\"cti.fn_load_document(this.id)\" id=\"{{$data.$item.associatedDocuments.associatedDocument}}\"></p>\n        </div>\n        <div class=\"date\"><span>Date</span>{{$data.$item.dateTime | date:'dd MMM yyyy HH:mm'}}</div>\n        <div class=\"hcp\"><span>HCP</span>{{$data.$item.enteredBy.value}}</div>\n        <div class=\"validated\"><span>Validated</span>{{$data.$item.verifyDate == undefined ? \"Not Validated\" : \"Validated\"}}</div>\n        <div class=\"significant\"><span>Significant</span>{{$data.$item.isSignificant == \"0\" ? \"No\" : \"Yes\"}}</div>\n        <div class=\"third_party\"><span>Third party</span>{{$data.$item.isThirdParty == undefined ? \"No\" : \"Yes\"}}</div>\n        <div class=\"risk\"><span>Risk</span>{{$data.$item.isRiskRelated == \"0\" ? \"No\" : \"Yes\"}}</div>\n    </div>\n        <div class=\"note\">{{$data.$item.noteText}}</div>\n</div>","expressions":{}}]},{"name":"image_notes","type":"media","item-type":"image-viewer","_auto_id_":"01a5af19-0f1f-4d57-b1a4-f826ed7ac2b2","scaleImage":true,"maxWidth":50,"maxHeight":50,"expressions":{"show":"$store.variables.selected_visit.patientData.progressNotes.length == 0"},"fileName":"thin-0003_write_pencil_new_edit.png","actions":[],"classes":"no-data-image"},{"type":"content","item-type":"html","name":"list_notes_nodata_html","_auto_id_":"a2648ebe-e0af-4db8-a2fb-936996bd05c8","content":"<!-- HTML Template for tablet size devices and above -->\n<div class=\"row hidden-xs hidden-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Progress Notes</strong>\n  </div>\n</div>\n\n<!-- HTML Template for smaller mobile devices -->\n<div class=\"row visible-xs visible-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Progress Notes</strong>\n  </div>\n</div>","expressions":{"show":"$store.variables.selected_visit.patientData.progressNotes.length == 0"}}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_start_visit","type":"button","item-type":"button","_auto_id_":"590081b5-c94c-4eab-a93e-90f9d357ab48","content":"START VISIT","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.selected_visit.arrivalTime = new Date()\ncti.store.variables.selected_visit.status = 'started'\ncti.utils.updatePage()"},"_auto_id_":"cc4f201c-00a7-483c-b221-2dea69f13667","actions":[]}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime == undefined && $store.variables.visit_view_mode != 'Appointments') && $store.variables.selected_visit.status != \"complete\""},"classes":"default"},{"name":"button_add_note","type":"button","item-type":"button","_auto_id_":"c487271e-33f6-4e48-81b8-3c3f461e5eaf","content":"ADD NOTE","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') || $store.variables.selected_visit.status == \"complete\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Note","isConditional":false},"_auto_id_":"b30d8644-135b-48be-98ed-0d50a67cb551"}]},{"name":"button_add_alert","type":"button","item-type":"button","_auto_id_":"951f76c9-9caa-4f37-8b98-85d8eb509085","content":"ADD ALERT","theme":"default","expressions":{"show":"$store.variables.selected_visit.arrivalTime != undefined && $store.variables.selected_visit.status != \"new\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Alert","isConditional":false},"_auto_id_":"2d2031f0-ad3e-4a6b-b94f-33368c563fa4"}]},{"name":"button_end_visit","type":"button","item-type":"button","_auto_id_":"263f5e42-961c-4677-a9f9-e8aff48a6dc5","content":"END VISIT","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') && $store.variables.selected_visit.status != \"complete\""},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var dialog = cti.store.variables.selected_visit.dialog_form_status\nvar safety = cti.store.variables.selected_visit.safety_form_status\nvar lifestyle = cti.store.variables.selected_visit.lifestyle_form_status\n\ncti.store.variables.formStatus = undefined\ncti.store.variables.o_activities = []\n\nif(dialog == \"failed\" || dialog == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Dialog+\"\n  } else {\n    cti.store.variables.formStatus += \", Dialog+\"\n  }\n} else if(dialog == \"complete\") {\n  var dialogObj = {\n    group : undefined,\n    value : \"dialogplus\",\n    label : \"DIALOG+\"\n  }\n    \n  cti.store.variables.o_activities.push(dialogObj)\n}\n\nif(safety == \"failed\" || safety == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"My Safety Plan\"\n  } else {\n    cti.store.variables.formStatus += \", My Safety Plan\"\n  }\n} else if(safety == \"complete\") {\n  var safetyObj = {\n    group : undefined,\n    value : \"msp\",\n    label : \"My Safety Plan\"\n  }\n    \n  cti.store.variables.o_activities.push(safetyObj)\n}\n\nif(lifestyle == \"failed\" || lifestyle == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Lifestyle Assessment Form\"\n  } else {\n    cti.store.variables.formStatus += \", Lifestyle Assessment Form\"\n  }\n} else if(lifestyle == \"complete\") {\n  var lifestyleObj = {\n    group : undefined,\n    value : \"phlifestyl\",\n    label : \"Lifestyle Assessment Form\"\n  }\n    \n  cti.store.variables.o_activities.push(lifestyleObj)\n}\n\nif(cti.store.variables.formStatus == undefined) {\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n} else {\n  $success()\n}"},"_auto_id_":"092402c5-45b2-41ae-89d2-e616142c1cd7","actions":[{"event":"success","type":"call-component-function","data":{"page":"Notes","componentInstanceId":"b37de555-68b0-46ed-aca0-a540075a9651","function":"toggle"},"_auto_id_":"7cc7b007-3fbb-4809-a055-e816a543a635"}]}],"classes":"default"},{"name":"button_end_date_alert","type":"button","item-type":"button","_auto_id_":"a2fc4df2-69e1-4592-a547-2decdf92f060","content":"END DATE ALERT","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"RemoveAlert","isConditional":false},"_auto_id_":"8c466899-002f-4875-a703-95fbe6abbcb0"}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode === 'Alerts') || $store.variables.selected_visit.status == \"complete\"","disabled":"$store.variables.alerts === undefined || $store.variables.alerts.length === 0"}}],"_auto_id_":"e013b204-e444-4596-ad09-a49e2e31d8c2","expressions":{"show":"$store.variables.visit_view_mode != \"Appointments\""}}]},{"start":false,"name":"Documents","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"7eb9ba53-fa1d-45d2-a07a-4f28392a06ec","content":"","theme":"minimal","left-icon":"fa-home","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_back - page Documents', \n  'info'\n)\n\ncti.fn_save_appointment()"},"_auto_id_":"6aff23f9-4fcf-4207-94e1-86a7a2d62304"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Documents</h4>","_auto_id_":"a1d4e30b-3962-4e40-9ed6-e037dbd4eff9"},{"name":"button_menu","type":"button","item-type":"button","_auto_id_":"052ae5f7-acb6-4f3c-91d0-059d486439b3","content":"","theme":"minimal","expressions":{},"left-icon":"fa-bars","actions":[{"event":"click","type":"call-component-function","data":{"page":"Documents","componentInstanceId":"ec65e10b-b7b7-49ac-9476-a7157f816ae7","function":"toggle"},"_auto_id_":"802441d0-7f93-4022-86ae-754942671b28"}]},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"15dd3cf6-2d5d-472d-931e-8c2b454a1e1a","attributes":{},"expressions":{}},{"name":"ct_context_menu","type":"component","item-type":"web-component","content":[{"name":"button_logout","type":"button","item-type":"button","_auto_id_":"0f619fe7-15fc-4586-bf49-12e59e24e8de","content":"Logout","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"Login","isConditional":false},"_auto_id_":"b99e1e6c-2e18-41fe-8e30-70f0165d2c9b"}],"expressions":{}},{"name":"button_bar_menu","type":"area","item-type":"button-bar","_auto_id_":"7f64dcf5-c2b8-4526-b73c-807eb8f5429c","extends":{"type":"area","item-type":"row"},"content":[{"name":"html_menu_version","type":"content","item-type":"html","_auto_id_":"2bf1ac08-fc7f-4c98-be1a-484f663520cc","content":"Version {{'$store.schema.version' | store}}","expressions":{}}],"expressions":{}}],"componentId":"1fa0aab1-7b03-413d-b3e0-433405059753","_auto_id_":"ec65e10b-b7b7-49ac-9476-a7157f816ae7","attributes":{"Direction":"right","Overlay":true},"expressions":{},"actions":[]}],"_auto_id_":"e44956cc-f8fa-4223-b28e-02da92459c6f","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"cd481f4b-6738-4702-baac-1296d29a1baa","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"93c51d09-de67-40ca-890b-a79d4d3ae603","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"7a5d8d88-b79d-4a23-92d5-7295e1388b7b","content":"Back to Summary","theme":"minimal","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"02c79d63-8617-4b3b-82bf-2b0fc1126b13"}],"classes":""},{"name":"html_view_mode","type":"content","item-type":"html","_auto_id_":"ca21e341-fb4a-493b-b15c-b80f64efd779","content":"{{'$store.variables.visit_view_mode' | store}}","expressions":{},"classes":"infoBanner"},{"name":"popupWarning","type":"component","item-type":"web-component","content":[{"name":"html_warning","type":"content","item-type":"html","_auto_id_":"9b55ec4b-e3a7-4ae1-8fcd-f4e6e1b9b771","content":"<h3 style=\"color:black\">Warning: Outstanding Form Data</h3>\n<p style=\"color:black\">The following forms have either outstanding data or have failed to send to RiO: {{'$store.variables.formStatus' | store}}. If you continue then this information will be lost.</p>\n<p style=\"color:black\">Do you want to continue? </p>","expressions":{}},{"name":"button_bar_yesno","type":"area","item-type":"button-bar","_auto_id_":"4941eb3f-46b9-4c26-ae65-4be99ef3e67d","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_yes","type":"button","item-type":"button","_auto_id_":"5684c735-28e2-4bfc-85ca-62bf4a9e76e0","content":"YES","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"delete cti.store.variables.formStatus\ncti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n$success()"},"_auto_id_":"4d2f6c9c-085c-416d-80e3-3abca3806ea5"},{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"9da08882-90a6-46fe-914d-e6458e97c868","function":"toggle"},"_auto_id_":"e68bd2c8-67b2-4e9d-84a5-aa5aeacf798d"}],"classes":"default"},{"name":"button_no","type":"button","item-type":"button","_auto_id_":"a94e7a8e-80ca-4ba9-bdb9-68a57c0b0444","content":"NO","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"9da08882-90a6-46fe-914d-e6458e97c868","function":"toggle"},"_auto_id_":"6104b22a-d222-44c1-9410-6f4f0a7cd282"}]}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"9da08882-90a6-46fe-914d-e6458e97c868","attributes":{"id":"popupWarning"},"expressions":{}}],"expressions":{},"classes":"relative"},{"name":"scrollable_results","type":"area","item-type":"scrollable","_auto_id_":"bfc16a2e-8edf-4bec-9461-fdb291844e8f","content":[{"name":"list_documents","type":"content","item-type":"list","_auto_id_":"a5cf673c-e0d0-4d85-bfbf-6bdf965b5107","search":"","classes":"","model":"$store.variables.selected_visit.patientData.documents","theme":"","expressions":{},"actions":[],"dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_documents_html","_auto_id_":"131a5f8f-7657-4f77-af05-1379d8976287","content":"<div class=\"card_holder\" onclick=\"cti.fn_load_document(this.id)\" id=\"{{$data.$item}}\"> \n    <div class=\"contact_name\">{{$data.$item.title}}\n      <div class=\"doc_link_holder fa fa-file-text-o {{$data.$item.fileType == 'application/pdf' ? '' : 'display-none'}}\" ></div>\n      <div class=\"doc_link_holder fa fa-camera {{$data.$item.fileType == 'image/jpeg' || $data.$item.fileType == 'image/png' ? '' : 'display-none'}}\" ></div>\n      <div class=\"doc_link_holder fa fa-file-text-o {{$data.$item.fileType != 'image/jpeg' && $data.$item.fileType != 'application/pdf' && $data.$item.fileType != 'image/png' ? '' : 'display-none'}}\" ></div>\n    </div>\n    <div class=\"relationship\"><span>Date</span>{{$data.$item.documentDate | date:'d MMM y h:mm'}}</div>\n    <div class=\"type\"><span>Type</span>{{$data.$item.documentType.value}}</div>\n</div>","expressions":{}}]},{"name":"image_documents","type":"media","item-type":"image-viewer","_auto_id_":"1d6e062c-8eff-45c5-b163-6e24324c9812","scaleImage":true,"maxWidth":50,"maxHeight":50,"expressions":{"show":"$store.variables.selected_visit.patientData.documents.length == 0"},"fileName":"thin-0073_documents_files_paper_text_archive_copy.png","actions":[],"classes":"no-data-image"},{"type":"content","item-type":"html","name":"list_docs_nodata_html","_auto_id_":"a9bf8157-2ef7-4749-98a9-10570ff29234","content":"<!-- HTML Template for tablet size devices and above -->\n<div class=\"row hidden-xs hidden-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Documents Available</strong>\n  </div>\n</div>\n\n<!-- HTML Template for smaller mobile devices -->\n<div class=\"row visible-xs visible-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Documents Available</strong>\n  </div>\n</div>","expressions":{"show":"$store.variables.selected_visit.patientData.documents.length == 0"}}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_start_visit","type":"button","item-type":"button","_auto_id_":"eb48dfc6-c2a4-420f-8ad9-04db1390bed7","content":"START VISIT","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.selected_visit.arrivalTime = new Date()\ncti.store.variables.selected_visit.status = 'started'\ncti.utils.updatePage()"},"_auto_id_":"63fe1998-81cc-4f51-ab67-d585d7ac055d","actions":[]}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime == undefined && $store.variables.visit_view_mode != 'Appointments') && $store.variables.selected_visit.status != \"complete\""},"classes":"default"},{"name":"button_add_note","type":"button","item-type":"button","_auto_id_":"5a5ab683-ad58-42b8-bb11-6faa60c0f2f8","content":"ADD NOTE","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') || $store.variables.selected_visit.status == \"complete\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Note","isConditional":false},"_auto_id_":"29844dc1-4600-434f-9c7b-a2d1cf508d61"}]},{"name":"button_add_alert","type":"button","item-type":"button","_auto_id_":"418205fd-8e51-429b-aedc-e16074e3b4bd","content":"ADD ALERT","theme":"default","expressions":{"show":"$store.variables.selected_visit.arrivalTime != undefined && $store.variables.selected_visit.status != \"new\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Alert","isConditional":false},"_auto_id_":"1112d78f-e8c2-4bb3-a294-403fc17410cb"}]},{"name":"button_end_visit","type":"button","item-type":"button","_auto_id_":"26c4f489-86aa-4789-a7c8-e273a9599fd6","content":"END VISIT","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') && $store.variables.selected_visit.status != \"complete\""},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var dialog = cti.store.variables.selected_visit.dialog_form_status\nvar safety = cti.store.variables.selected_visit.safety_form_status\nvar lifestyle = cti.store.variables.selected_visit.lifestyle_form_status\n\ncti.store.variables.formStatus = undefined\ncti.store.variables.o_activities = []\n\nif(dialog == \"failed\" || dialog == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Dialog+\"\n  } else {\n    cti.store.variables.formStatus += \", Dialog+\"\n  }\n} else if(dialog == \"complete\") {\n  var dialogObj = {\n    group : undefined,\n    value : \"dialogplus\",\n    label : \"DIALOG+\"\n  }\n    \n  cti.store.variables.o_activities.push(dialogObj)\n}\n\nif(safety == \"failed\" || safety == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"My Safety Plan\"\n  } else {\n    cti.store.variables.formStatus += \", My Safety Plan\"\n  }\n} else if(safety == \"complete\") {\n  var safetyObj = {\n    group : undefined,\n    value : \"msp\",\n    label : \"My Safety Plan\"\n  }\n    \n  cti.store.variables.o_activities.push(safetyObj)\n}\n\nif(lifestyle == \"failed\" || lifestyle == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Lifestyle Assessment Form\"\n  } else {\n    cti.store.variables.formStatus += \", Lifestyle Assessment Form\"\n  }\n} else if(lifestyle == \"complete\") {\n  var lifestyleObj = {\n    group : undefined,\n    value : \"phlifestyl\",\n    label : \"Lifestyle Assessment Form\"\n  }\n    \n  cti.store.variables.o_activities.push(lifestyleObj)\n}\n\nif(cti.store.variables.formStatus == undefined) {\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n} else {\n  $success()\n}"},"_auto_id_":"ca7923db-fb11-47a5-afcd-93510d108480","actions":[{"event":"success","type":"call-component-function","data":{"page":"Documents","componentInstanceId":"9da08882-90a6-46fe-914d-e6458e97c868","function":"toggle"},"_auto_id_":"0073a657-46ac-440a-9ba6-1a6ce09e5e60"}]}],"classes":"default"},{"name":"button_end_date_alert","type":"button","item-type":"button","_auto_id_":"8f2e011e-a0e0-4fa7-9798-380cb66c4867","content":"END DATE ALERT","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"RemoveAlert","isConditional":false},"_auto_id_":"9f8438c9-4b48-486b-9e8f-de9352e8f491"}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode === 'Alerts') || $store.variables.selected_visit.status == \"complete\"","disabled":"$store.variables.alerts === undefined || $store.variables.alerts.length === 0"}}],"_auto_id_":"c0c796fc-ddc5-4a01-b8c3-c41b98e3a833","expressions":{"show":"$store.variables.visit_view_mode != \"Appointments\""}}]},{"start":false,"name":"Allergies","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"a42e02b5-84dd-4264-bb5e-5db351192bcc","content":"","theme":"minimal","left-icon":"fa-home","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_back - page Allergies', \n  'info'\n)\n\ncti.fn_save_appointment()"},"_auto_id_":"d4f55d8b-b7cb-40a5-9a38-60effa113054"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Allergies</h4>","_auto_id_":"9809c300-673c-4b3f-8964-366e1dada64f"},{"name":"button_menu","type":"button","item-type":"button","_auto_id_":"6f2abe3f-f672-41c4-adaa-5a8c526a5e31","content":"","theme":"minimal","expressions":{},"left-icon":"fa-bars","actions":[{"event":"click","type":"call-component-function","data":{"page":"Allergies","componentInstanceId":"aa6bb4de-f659-44ea-b2e8-6e6c2780cf4d","function":"toggle"},"_auto_id_":"9ae8b076-41da-4478-8871-4ee054ed7c96"}]},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"a0c5687d-1356-4c4d-915a-d5777de26e94","attributes":{},"expressions":{}},{"name":"ct_context_menu","type":"component","item-type":"web-component","content":[{"name":"button_logout","type":"button","item-type":"button","_auto_id_":"5d0099e3-e516-4d56-99ed-134298ad8e35","content":"Logout","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"Login","isConditional":false},"_auto_id_":"5cda4094-1bd6-44fc-a053-11c9aa8ceccc"}],"expressions":{}},{"name":"button_bar_menu","type":"area","item-type":"button-bar","_auto_id_":"8668b987-3caf-4a6e-8e79-b666da051a35","extends":{"type":"area","item-type":"row"},"content":[{"name":"html_menu_version","type":"content","item-type":"html","_auto_id_":"caf6d8a7-2588-4718-9218-d1c7bb64946c","content":"Version {{'$store.schema.version' | store}}","expressions":{}}],"expressions":{}}],"componentId":"1fa0aab1-7b03-413d-b3e0-433405059753","_auto_id_":"aa6bb4de-f659-44ea-b2e8-6e6c2780cf4d","attributes":{"Direction":"right","Overlay":true},"expressions":{},"actions":[]}],"_auto_id_":"3241fad2-5a91-4108-977c-13ba05f1ce25","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"049b30f0-c8fc-42a5-9ae7-76b8b23b7eaa","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"e9bcd910-5a23-4a2d-91e3-66088f25505a","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"9a21628c-50b7-423e-9913-6d1163e2b4de","content":"Back to Summary","theme":"minimal","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"54889f07-053a-4cae-a1b2-e9c4f109b6c7"}],"classes":""},{"name":"html_view_mode","type":"content","item-type":"html","_auto_id_":"7a7b51e3-c014-4b6f-a90d-e5c2aca0532c","content":"{{'$store.variables.visit_view_mode' | store}}","expressions":{},"classes":"infoBanner"},{"name":"popupWarning","type":"component","item-type":"web-component","content":[{"name":"html_warning","type":"content","item-type":"html","_auto_id_":"99556e1e-3b2c-4ed3-a0f4-bb90b6e3107f","content":"<h3 style=\"color:black\">Warning: Outstanding Form Data</h3>\n<p style=\"color:black\">The following forms have either outstanding data or have failed to send to RiO: {{'$store.variables.formStatus' | store}}. If you continue then this information will be lost.</p>\n<p style=\"color:black\">Do you want to continue? </p>","expressions":{}},{"name":"button_bar_yesno","type":"area","item-type":"button-bar","_auto_id_":"e94df438-dd5f-482f-b64c-716428738300","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_yes","type":"button","item-type":"button","_auto_id_":"a75ca912-1496-4003-ad4d-ab4bd04c8b1e","content":"YES","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"delete cti.store.variables.formStatus\ncti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n$success()"},"_auto_id_":"dca8eeff-96e1-4ef8-9e49-3765c82ccb03"},{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"18ab2fad-0083-4d95-9bdd-ccf0a96ff03d","function":"toggle"},"_auto_id_":"cff0ef9c-23f5-489f-a505-f8ba05856ca8"}],"classes":"default"},{"name":"button_no","type":"button","item-type":"button","_auto_id_":"171f253b-224c-436e-be5f-5f7e5d1452c9","content":"NO","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"18ab2fad-0083-4d95-9bdd-ccf0a96ff03d","function":"toggle"},"_auto_id_":"43432042-de67-428c-90e2-527c652cecfc"}]}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"18ab2fad-0083-4d95-9bdd-ccf0a96ff03d","attributes":{"id":"popupWarning"},"expressions":{}}],"expressions":{},"classes":"relative"},{"name":"scrollable_results","type":"area","item-type":"scrollable","_auto_id_":"ebb5945c-d7d4-4d4c-a24f-081df39367e0","content":[{"name":"list_allergies","type":"content","item-type":"list","_auto_id_":"fb6016d8-2752-417e-aa26-27a8defd5868","search":"","classes":"","model":"$store.variables.selected_visit.patientData.allergies","theme":"","expressions":{},"actions":[],"dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_allergies_html","_auto_id_":"0a3785e4-03f8-47e3-9f5d-cf3510a9ecc8","content":"<div class=\"card_holder\" >\n    <div class=\"line_after\">   \n        <div class=\"substance\">{{$data.$item.substance}} - {{$data.$item.reactionSeverity}}</div>\n        <div class=\"type\"><span>Type</span>{{$data.$item.reactionType}}</div>\n    </div>\n    <div class=\"{{$data.$item.reaction != '' ? 'line_after' : ''}}\">  \n        <div class=\"year\"><span>Identified in</span>{{$data.$item.yearOfIdentification}}</div>\n        <div class=\"reporter\"><span>Reported by</span>{{$data.$item.reportedBy}}</div>\n    </div>\n    <div class=\"reaction {{$data.$item.reaction != '' ? '' : 'hide'}}\"><span>Reaction</span>{{$data.$item.reaction}}</div>\n</div>","expressions":{}}]},{"name":"image_allergies","type":"media","item-type":"image-viewer","_auto_id_":"7bbd7914-01d7-4cc6-b85d-6f6270811f00","scaleImage":true,"maxWidth":50,"maxHeight":50,"expressions":{"show":"$store.variables.selected_visit.patientData.allergies.length == 0"},"fileName":"thin-0816_microscope_laboratory.png","actions":[],"classes":"no-data-image"},{"type":"content","item-type":"html","name":"list_allergy_nodata_html","_auto_id_":"52f6c374-d5d6-4ddf-9aef-23f242661b18","content":"<!-- HTML Template for tablet size devices and above -->\n<div class=\"row hidden-xs hidden-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Allergies Identified</strong>\n  </div>\n</div>\n\n<!-- HTML Template for smaller mobile devices -->\n<div class=\"row visible-xs visible-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Allergies Identified</strong>\n  </div>\n</div>","expressions":{"show":"$store.variables.selected_visit.patientData.allergies.length == 0"}}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_start_visit","type":"button","item-type":"button","_auto_id_":"6979fc6c-2897-426a-b4ac-711533e3adac","content":"START VISIT","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.selected_visit.arrivalTime = new Date()\ncti.store.variables.selected_visit.status = 'started'\ncti.utils.updatePage()"},"_auto_id_":"c5f4b771-32a7-4538-b4ca-d66d63ef21bc","actions":[]}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime == undefined && $store.variables.visit_view_mode != 'Appointments') && $store.variables.selected_visit.status != \"complete\""},"classes":"default"},{"name":"button_add_note","type":"button","item-type":"button","_auto_id_":"4c1f0ef1-ca7b-4808-916a-865bd7e1129b","content":"ADD NOTE","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') || $store.variables.selected_visit.status == \"complete\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Note","isConditional":false},"_auto_id_":"8b09845d-efcd-4cfe-96f9-3a98537146b0"}]},{"name":"button_add_alert","type":"button","item-type":"button","_auto_id_":"263556da-a3ef-494c-88bc-9c582b484b30","content":"ADD ALERT","theme":"default","expressions":{"show":"$store.variables.selected_visit.arrivalTime != undefined && $store.variables.selected_visit.status != \"new\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Alert","isConditional":false},"_auto_id_":"786c86c5-15cd-405f-bab7-e62e829b57aa"}]},{"name":"button_end_visit","type":"button","item-type":"button","_auto_id_":"704e9868-96bf-4834-a667-2314789f69f2","content":"END VISIT","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') && $store.variables.selected_visit.status != \"complete\""},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var dialog = cti.store.variables.selected_visit.dialog_form_status\nvar safety = cti.store.variables.selected_visit.safety_form_status\nvar lifestyle = cti.store.variables.selected_visit.lifestyle_form_status\n\ncti.store.variables.formStatus = undefined\ncti.store.variables.o_activities = []\n\nif(dialog == \"failed\" || dialog == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Dialog+\"\n  } else {\n    cti.store.variables.formStatus += \", Dialog+\"\n  }\n} else if(dialog == \"complete\") {\n  var dialogObj = {\n    group : undefined,\n    value : \"dialogplus\",\n    label : \"DIALOG+\"\n  }\n    \n  cti.store.variables.o_activities.push(dialogObj)\n}\n\nif(safety == \"failed\" || safety == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"My Safety Plan\"\n  } else {\n    cti.store.variables.formStatus += \", My Safety Plan\"\n  }\n} else if(safety == \"complete\") {\n  var safetyObj = {\n    group : undefined,\n    value : \"msp\",\n    label : \"My Safety Plan\"\n  }\n    \n  cti.store.variables.o_activities.push(safetyObj)\n}\n\nif(lifestyle == \"failed\" || lifestyle == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Lifestyle Assessment Form\"\n  } else {\n    cti.store.variables.formStatus += \", Lifestyle Assessment Form\"\n  }\n} else if(lifestyle == \"complete\") {\n  var lifestyleObj = {\n    group : undefined,\n    value : \"phlifestyl\",\n    label : \"Lifestyle Assessment Form\"\n  }\n    \n  cti.store.variables.o_activities.push(lifestyleObj)\n}\n\nif(cti.store.variables.formStatus == undefined) {\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n} else {\n  $success()\n}"},"_auto_id_":"c977d84c-e6d5-4cfd-8a6d-dd3443b490a5","actions":[{"event":"success","type":"call-component-function","data":{"page":"Allergies","componentInstanceId":"18ab2fad-0083-4d95-9bdd-ccf0a96ff03d","function":"toggle"},"_auto_id_":"3eddfe08-86a2-44d5-b97c-18cdca1d50f3"}]}],"classes":"default"},{"name":"button_end_date_alert","type":"button","item-type":"button","_auto_id_":"9c3448af-8d30-4d3f-a817-291ae88e6532","content":"END DATE ALERT","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"RemoveAlert","isConditional":false},"_auto_id_":"6d0b8dd9-8cfb-4138-afd5-7297fd58651e"}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode === 'Alerts') || $store.variables.selected_visit.status == \"complete\"","disabled":"$store.variables.alerts === undefined || $store.variables.alerts.length === 0"}}],"_auto_id_":"b67d2b6a-37a2-4396-b504-53584c3f001c","expressions":{"show":"$store.variables.visit_view_mode != \"Appointments\""}}]},{"start":false,"name":"Contacts","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"b612b574-d569-43a9-9ede-8cf520738c4e","content":"","theme":"minimal","left-icon":"fa-home","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_back - page Contacts', \n  'info'\n)\n\ncti.fn_save_appointment()"},"_auto_id_":"d1043e78-5a0a-482e-a9f8-62762ed86a96"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Contacts</h4>","_auto_id_":"1f81099d-84ed-4748-8f7c-2bc10c912ff4"},{"name":"button_menu","type":"button","item-type":"button","_auto_id_":"d1e304ee-9107-4b22-8fcc-d3bf1976cb8b","content":"","theme":"minimal","expressions":{},"left-icon":"fa-bars","actions":[{"event":"click","type":"call-component-function","data":{"page":"Contacts","componentInstanceId":"ba852ab9-24db-4b3d-b5df-7a50a54ca5d8","function":"toggle"},"_auto_id_":"703ae853-a95d-46db-a0f0-e2c95ae1f229"}]},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"7693f1ce-5ebc-45e1-8ff0-f408a1e18084","attributes":{},"expressions":{}},{"name":"ct_context_menu","type":"component","item-type":"web-component","content":[{"name":"button_logout","type":"button","item-type":"button","_auto_id_":"548bd622-0145-4035-b2c0-1e374bbd17b1","content":"Logout","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"Login","isConditional":false},"_auto_id_":"daf5e11c-2d48-4cef-a1b2-6e94567e0713"}],"expressions":{}},{"name":"button_bar_menu","type":"area","item-type":"button-bar","_auto_id_":"b9b8ac2d-cee3-4c5e-b849-876110ce64e6","extends":{"type":"area","item-type":"row"},"content":[{"name":"html_menu_version","type":"content","item-type":"html","_auto_id_":"3713b6ca-3c9e-4a13-a271-368951f472ff","content":"Version {{'$store.schema.version' | store}}","expressions":{}}],"expressions":{}}],"componentId":"1fa0aab1-7b03-413d-b3e0-433405059753","_auto_id_":"ba852ab9-24db-4b3d-b5df-7a50a54ca5d8","attributes":{"Direction":"right","Overlay":true},"expressions":{},"actions":[]}],"_auto_id_":"7b261954-f1a9-4867-9069-fa80e3ab7634","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"1b819142-42df-45c8-9469-c44ee324a68d","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"3c0e34c2-0e63-48dc-8d6f-4f213df83d81","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"7732afc2-6a6d-4479-a7a8-5d6930d6046b","content":"Back to Summary","theme":"minimal","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"fc3d9b9a-f6c2-43aa-89c3-b13fafdfb78a"}],"classes":""},{"name":"html_view_mode","type":"content","item-type":"html","_auto_id_":"a36956d6-a9d8-4cce-99b6-69e8fce5a3dd","content":"{{'$store.variables.visit_view_mode' | store}}","expressions":{},"classes":"infoBanner"},{"name":"popupWarning","type":"component","item-type":"web-component","content":[{"name":"html_warning","type":"content","item-type":"html","_auto_id_":"d2db0ac8-5c4d-42a1-859b-dc93e537eeba","content":"<h3 style=\"color:black\">Warning: Outstanding Form Data</h3>\n<p style=\"color:black\">The following forms have either outstanding data or have failed to send to RiO: {{'$store.variables.formStatus' | store}}. If you continue then this information will be lost.</p>\n<p style=\"color:black\">Do you want to continue? </p>","expressions":{}},{"name":"button_bar_yesno","type":"area","item-type":"button-bar","_auto_id_":"8f14d6e3-870e-415d-b3c8-3f85354c3eaf","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_yes","type":"button","item-type":"button","_auto_id_":"fa05ed70-aa29-48d3-9a26-0c1ca7dfc226","content":"YES","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"delete cti.store.variables.formStatus\ncti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n$success()"},"_auto_id_":"318a0733-f097-4c85-aab2-19078917e52b"},{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"793ced63-c4fd-454e-bc8f-7389d13c46ac","function":"toggle"},"_auto_id_":"9033b290-8cfd-4931-a1e6-97ce76ef1153"}],"classes":"default"},{"name":"button_no","type":"button","item-type":"button","_auto_id_":"aea36dea-d930-4f6f-a59f-d369b54c5a1c","content":"NO","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"793ced63-c4fd-454e-bc8f-7389d13c46ac","function":"toggle"},"_auto_id_":"8fc01a7f-9686-4171-b47b-ff68e5209b20"}]}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"793ced63-c4fd-454e-bc8f-7389d13c46ac","attributes":{"id":"popupWarning"},"expressions":{}}],"expressions":{},"classes":"relative"},{"name":"scrollable_results","type":"area","item-type":"scrollable","_auto_id_":"0540b5db-821a-4799-b62f-527abd62f297","content":[{"name":"list_contacts","type":"content","item-type":"list","_auto_id_":"be75969d-68fb-4866-b89f-b9e3aecc4bfa","search":"","classes":"list_contact","model":"$store.variables.selected_visit.patientData.contacts","theme":"","expressions":{},"actions":[],"dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_contacts_html","_auto_id_":"07fde8d4-1868-458e-b423-2ffcc9ef9bcc","content":"<div class=\"card_holder\" >\n  <div class=\"line_after\">   \n    <div class=\"contact_name\">{{$data.$item.name}}</div>\n    <div class=\"relationship\"><span>Relationship</span>{{$data.$item.contactRelationship.value}}</div>\n    <div class=\"type\"><span>Type</span>{{$data.$item.contactType.value}}</div>\n  </div>\n  <div class=\"icon phones {{$data.$item.emailAddress != '' ? 'line_after' : ''}}\" onclick=\"cti.fn_call_contact(this.id)\" id=\"{{$data.$item.mainPhone}}\">\n    <span>Phone</span>{{$data.$item.mainPhone}}\n  </div>\n  <div class=\"{{$data.$item.emailAddress != '' ? '' : 'hide'}}\" >\n    <div class=\"email\"><span>Email</span>{{$data.$item.emailAddress}}</div>\n  </div>\n</div>","expressions":{}}]},{"name":"image_contacts","type":"media","item-type":"image-viewer","_auto_id_":"05a0dca8-b477-49f8-b5d4-81981ce403a7","scaleImage":true,"maxWidth":50,"maxHeight":50,"expressions":{"show":"$store.variables.selected_visit.patientData.contacts.length == 0"},"fileName":"thin-0301_address_book_contacts.png","actions":[],"classes":"no-data-image"},{"type":"content","item-type":"html","name":"list_contacts_nodata_html","_auto_id_":"068b5c99-6f29-498a-954a-5aa4f07df2fa","content":"<!-- HTML Template for tablet size devices and above -->\n<div class=\"row hidden-xs hidden-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Key Contacts</strong>\n  </div>\n</div>\n\n<!-- HTML Template for smaller mobile devices -->\n<div class=\"row visible-xs visible-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Contacts Available</strong>\n  </div>\n</div>","expressions":{"show":"$store.variables.selected_visit.patientData.contacts.length == 0"}}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_start_visit","type":"button","item-type":"button","_auto_id_":"bb358660-031c-4014-a1a7-c1a50c6d992b","content":"START VISIT","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.selected_visit.arrivalTime = new Date()\ncti.store.variables.selected_visit.status = 'started'\ncti.utils.updatePage()"},"_auto_id_":"dd571e7e-068f-4709-b81b-699d49618531","actions":[]}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime == undefined && $store.variables.visit_view_mode != 'Appointments') && $store.variables.selected_visit.status != \"complete\""},"classes":"default"},{"name":"button_add_note","type":"button","item-type":"button","_auto_id_":"c121dead-e0b2-4ed2-b1b4-7c7e3e19a770","content":"ADD NOTE","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') || $store.variables.selected_visit.status == \"complete\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Note","isConditional":false},"_auto_id_":"585b3346-21dd-43b8-89d3-a4d772c7c086"}]},{"name":"button_add_alert","type":"button","item-type":"button","_auto_id_":"000ee38e-1b12-4ac1-8d2f-7d86eb2846fe","content":"ADD ALERT","theme":"default","expressions":{"show":"$store.variables.selected_visit.arrivalTime != undefined && $store.variables.selected_visit.status != \"new\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Alert","isConditional":false},"_auto_id_":"c9b517eb-e2a1-44f8-b764-bb7be540d59c"}]},{"name":"button_end_visit","type":"button","item-type":"button","_auto_id_":"705d2782-9bc0-4d19-8311-624ba71e5102","content":"END VISIT","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') && $store.variables.selected_visit.status != \"complete\""},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var dialog = cti.store.variables.selected_visit.dialog_form_status\nvar safety = cti.store.variables.selected_visit.safety_form_status\nvar lifestyle = cti.store.variables.selected_visit.lifestyle_form_status\n\ncti.store.variables.formStatus = undefined\ncti.store.variables.o_activities = []\n\nif(dialog == \"failed\" || dialog == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Dialog+\"\n  } else {\n    cti.store.variables.formStatus += \", Dialog+\"\n  }\n} else if(dialog == \"complete\") {\n  var dialogObj = {\n    group : undefined,\n    value : \"dialogplus\",\n    label : \"DIALOG+\"\n  }\n    \n  cti.store.variables.o_activities.push(dialogObj)\n}\n\nif(safety == \"failed\" || safety == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"My Safety Plan\"\n  } else {\n    cti.store.variables.formStatus += \", My Safety Plan\"\n  }\n} else if(safety == \"complete\") {\n  var safetyObj = {\n    group : undefined,\n    value : \"msp\",\n    label : \"My Safety Plan\"\n  }\n    \n  cti.store.variables.o_activities.push(safetyObj)\n}\n\nif(lifestyle == \"failed\" || lifestyle == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Lifestyle Assessment Form\"\n  } else {\n    cti.store.variables.formStatus += \", Lifestyle Assessment Form\"\n  }\n} else if(lifestyle == \"complete\") {\n  var lifestyleObj = {\n    group : undefined,\n    value : \"phlifestyl\",\n    label : \"Lifestyle Assessment Form\"\n  }\n    \n  cti.store.variables.o_activities.push(lifestyleObj)\n}\n\nif(cti.store.variables.formStatus == undefined) {\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n} else {\n  $success()\n}"},"_auto_id_":"972e6fc4-a820-4716-9ca7-cc4c46333abc","actions":[{"event":"success","type":"call-component-function","data":{"page":"Contacts","componentInstanceId":"793ced63-c4fd-454e-bc8f-7389d13c46ac","function":"toggle"},"_auto_id_":"6901191b-3d3f-44eb-8fd3-70758f623e41"}]}],"classes":"default"},{"name":"button_end_date_alert","type":"button","item-type":"button","_auto_id_":"58f0ce72-dc86-4319-920d-01dff875d176","content":"END DATE ALERT","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"RemoveAlert","isConditional":false},"_auto_id_":"1fd1cd82-cc9c-4875-b1f2-88f844582d9f"}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode === 'Alerts') || $store.variables.selected_visit.status == \"complete\"","disabled":"$store.variables.alerts === undefined || $store.variables.alerts.length === 0"}}],"_auto_id_":"be110213-8593-4aab-94cf-1db7a17322d4","expressions":{"show":"$store.variables.visit_view_mode != \"Appointments\""}}]},{"start":false,"name":"LifestyleFormOne","config":[{"name":"Page Loaded Event","type":"event","item-type":"onpageloaded","_auto_id_":"d58f7e12-f93b-430c-9821-d3c21daf738b","actions":[{"event":"onpageloaded","type":"inline-function","data":{"sync":true,"code":"var page = cti.store.pages.LifestyleForm\n$success()"},"_auto_id_":"c5ff4001-c454-4f48-8291-7ece8e024c4d"}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"c1dd4c2a-f364-4a4c-8020-e3ff695fc86b","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"c23bd664-e2a2-44e7-96c8-1a75d5a61453","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"a114a932-44f5-4014-a20d-6ce1d68461a7"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Lifestyle Form</h4>","_auto_id_":"7016514e-b8de-4fff-b2f1-f3ecf1e9890f"}],"_auto_id_":"f4a2fa3f-dd86-49bf-a943-2c04ce585c36","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"4128ae5a-b693-4d42-9ce5-9d1efe41ea7b","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"fe9d1e5e-e03f-420b-8114-d02516604930","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"answerAccuratelyBanner","type":"content","item-type":"html","_auto_id_":"3288e0d6-78af-4232-8d29-313f8bf067d6","content":"<p>Please answer this assessment as accurately and completely as possible.</p>","expressions":{},"classes":"banner-dark"}],"expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"f1ad6d24-9b79-4282-a89e-f59d498c7418","content":[{"name":"html_smoking","type":"content","item-type":"html","_auto_id_":"45589ef3-57bf-45cc-92d2-53e0bd136729","content":"<div style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Smoking</h4>\n  <i id=\"smoking\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{}},{"name":"Smoking","type":"area","item-type":"group","_auto_id_":"04dc9a39-2a46-4545-a508-c230fc170a32","content":[{"name":"lssmoked","type":"choice","item-type":"select","_auto_id_":"b82f1e7f-b9a3-4904-9885-9e3314d7ee83","label":"Have you ever smoked?","required":true,"options":[{"label":"Not assessed","value":"SS01"},{"label":"No","value":"SS02"},{"label":"Ex-smoker","value":"SS03"},{"label":"Current smoker","value":"SS04"}],"expressions":{},"classes":"question_primary","message":"This is a required field"},{"name":"Smoker","type":"area","item-type":"group","_auto_id_":"8f49c328-7f44-4d54-bc3d-c3867397f438","content":[{"name":"lscigperday","type":"user-input","item-type":"number","_auto_id_":"6e11079a-c483-4b85-afc8-eaac0d2b915d","label":"Cigarettes per day","required":false,"decimals":2,"expressions":{"show":"$store.pages.LifestyleFormOne.lssmoked.value == \"SS04\""}},{"name":"smokeadvice","type":"choice","item-type":"radio","_auto_id_":"83219983-a8d6-4a7e-a1ed-5f514ca57f1d","label":"Very brief advice given?","required":true,"options":[{"label":"Yes","value":"01"},{"label":"No","value":"02"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{},"message":"This is a required field"},{"name":"Refsmoke","type":"choice","item-type":"select","_auto_id_":"f52d6b76-b195-46e7-85af-4346e85e95ed","label":"Referred to smoking cessation services?","required":true,"options":[{"label":"Intervention not offered","value":"01"},{"label":"Intervention not required","value":"02"},{"label":"Offered and accepted","value":"03"},{"label":"Offered but rejected","value":"04"}],"expressions":{},"description":"","message":"This is a required field"},{"name":"StopSmoke","type":"choice","item-type":"select","_auto_id_":"b9ff5e90-57e6-4b5e-910d-d5cd09bbfb29","label":"Stop smoking medication given?","required":true,"options":[{"label":"Medication not offered","value":"01az"},{"label":"Medication offered & accepted","value":"02az"},{"label":"Medication offered but declined","value":"03az"},{"label":"Not medically appropriate","value":"04az"}],"expressions":{},"message":"This is a required field"},{"name":"smokeintoffer","type":"choice","item-type":"select","_auto_id_":"fd66bf57-4249-4d1b-8495-20286ec661b8","label":"Other intervention offered?","required":true,"options":[{"label":"Intervention not offered","value":"01"},{"label":"Intervention not required","value":"02"},{"label":"Offered and accepted","value":"03"},{"label":"Offered but declined","value":"04"}],"expressions":{},"message":"This is a required field"},{"name":"smokefreetext1","type":"user-input","item-type":"text","_auto_id_":"2668e4e0-0ce6-42f6-b6b1-3292ec5d0755","label":"Details of any other intervention offered","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$store.pages.LifestyleFormOne.smokeintoffer.value == \"03\" || $store.pages.LifestyleFormOne.smokeintoffer.value == \"04\""},"validators":[],"actions":[]}],"repeat":false,"expressions":{}}],"repeat":false,"expressions":{},"classes":"question_group"}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_next","type":"button","item-type":"button","_auto_id_":"21afce7f-b129-4ce9-b360-f943029ac605","content":"NEXT","theme":"default","expressions":{"disabled":"$form.invalid"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var smoked = cti.store.pages.LifestyleFormOne.lssmoked.value\nvar advice = cti.store.pages.LifestyleFormOne.smokeadvice\nvar ref = cti.store.pages.LifestyleFormOne.Refsmoke\nvar stop = cti.store.pages.LifestyleFormOne.StopSmoke\nvar inter = cti.store.pages.LifestyleFormOne.smokeintoffer\n\nif((smoked == \"SS04\" || smoked == \"SS01\") && advice == undefined) {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning: Form Invalid\", \n    \"text\" : \"Please answer if the patient has been given advice.\"\n  })\n  return false\n}\nif((smoked == \"SS04\" || smoked == \"SS01\") && ref == undefined) {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning: Form Invalid\", \n    \"text\" : \"Please answer if the patient has been referred to smoking cessation services.\"\n  })\n  return false\n}\nif((smoked == \"SS04\" || smoked == \"SS01\") && stop == undefined) {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning: Form Invalid\", \n    \"text\" : \"Please answer if the patient has been given stop smoking medication.\"\n  })\n  return false\n}\nif((smoked == \"SS04\" || smoked == \"SS01\") && inter == undefined) {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning: Form Invalid\", \n    \"text\" : \"Please answer if intervention has been offered to the patient.\"\n  })\n  return false\n}\n\ncti.utils.callAction(\"go-to-page\", { name: \"LifestyleFormTwo\" })"},"_auto_id_":"fd1b094a-8923-4526-82a3-99c1a01f8f1a","actions":[]}],"classes":"default"}],"_auto_id_":"a59ef371-78a1-4a14-844c-bc8d013e38a2","expressions":{}}]},{"start":false,"name":"LifestyleFormTwo","config":[{"name":"Page Loaded Event","type":"event","item-type":"onpageloaded","_auto_id_":"1aec4728-3558-4e9c-9837-5ed2eb3d3d3b","actions":[{"event":"onpageloaded","type":"inline-function","data":{"sync":true,"code":"var page = cti.store.pages.LifestyleForm\n$success()"},"_auto_id_":"c05a9387-308f-4db4-9cb1-13e43684b1e8"}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"7e163a77-97dd-45b1-9430-a2a42f190b66","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"aaae6cb2-aab4-471c-8341-1f9bffbd9427","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"fb89d187-dddb-44d1-82c6-f8e6c08f1117"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Lifestyle Form</h4>","_auto_id_":"88a74515-ccf9-4596-a986-a39dded1a7bd"}],"_auto_id_":"900e3361-bd7e-4ea2-bf07-6d804c0d822a","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"31f19b7a-9d5a-46d8-b9f3-93b58a048253","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"0dd5e356-f6f0-4091-9e67-3d2aec119e70","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"answerAccuratelyBanner","type":"content","item-type":"html","_auto_id_":"2b01c17d-6666-4cd3-ad54-27eff6f01045","content":"<p>Please answer this assessment as accurately and completely as possible.</p>","expressions":{},"classes":"banner-dark"}],"expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"c8da77bd-a9af-454f-a932-c253c9e23882","content":[{"name":"html_diet","type":"content","item-type":"html","_auto_id_":"aec6728b-aaf0-4259-949c-e8178411fbba","content":"<div style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Diet</h4>\n  <i id=\"diet\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{}},{"name":"Diet","type":"area","item-type":"group","_auto_id_":"15b6da42-e1ae-43a9-b45c-69179bf0cba7","content":[{"name":"diethealthy","type":"choice","item-type":"select","_auto_id_":"d36b4833-3816-4daf-9910-4caeeb45eb1b","label":"Do you think you eat a healthy diet?","required":true,"options":[{"label":"Not assessed","value":"01"},{"label":"Not at all","value":"02"},{"label":"Some of the time","value":"03"},{"label":"Most of the time","value":"04"},{"label":"Nearly all the time","value":"05"}],"expressions":{},"classes":"question_primary","message":"This is a required field"},{"name":"lsdietcomment","type":"user-input","item-type":"text","_auto_id_":"d6ae3845-9a9e-4947-a118-cf94a0d9dfb7","label":"Please give more detail","required":false,"multiline":true,"debounce":1000,"expressions":{},"validators":[],"actions":[]},{"name":"dietintervention","type":"choice","item-type":"select","_auto_id_":"4f50c7f4-71ff-4dd9-aca7-47f8a7ed1a7e","label":"Intervention offered?","required":true,"options":[{"label":"Intervention not offered","value":"01"},{"label":"Intervention not required","value":"02"},{"label":"Offered and accepted","value":"03"},{"label":"Offered but rejected","value":"04"}],"expressions":{},"message":"This is a required field"},{"name":"dietintdetails","type":"user-input","item-type":"text","_auto_id_":"4a21c9b2-bcc9-4f84-a00c-cf3370891cb1","label":"Details of intervention offered","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$store.pages.LifestyleFormTwo.dietintervention.value == \"03\" || $store.pages.LifestyleFormTwo.dietintervention.value == \"04\""}}],"repeat":false,"expressions":{},"classes":"question_group"}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_previous","type":"button","item-type":"button","_auto_id_":"e37f7b1e-8626-4880-99a6-40023acc3d38","content":"PREVIOUS","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", { name: \"LifestyleFormOne\" });"},"_auto_id_":"f86a9681-f4f6-41aa-8550-12e8cf3caffc","actions":[]}],"classes":"default"},{"name":"button_next","type":"button","item-type":"button","_auto_id_":"e32bf02e-3537-4a6a-88f5-8c5701617fa3","content":"NEXT","theme":"default","expressions":{"disabled":"$form.invalid"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", { name: \"LifestyleFormThree\" })"},"_auto_id_":"0b1002a9-ff86-4675-914f-e029327b7ef6","actions":[]}],"classes":"default"}],"_auto_id_":"4930bf30-e6c6-4341-ae7a-6a8ba278add6","expressions":{}}]},{"start":false,"name":"LifestyleFormThree","config":[{"name":"Page Loaded Event","type":"event","item-type":"onpageloaded","_auto_id_":"0c0460b8-2917-4527-80fa-384637cdc312","actions":[{"event":"onpageloaded","type":"inline-function","data":{"sync":true,"code":"var page = cti.store.pages.LifestyleForm\n$success()"},"_auto_id_":"987f84dc-5ce4-4b00-9e12-457f6573d7cc"}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"3f3e4afd-9213-451e-a457-f711e583d005","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"ab366f32-e5e8-443e-af98-1139371fc0ac","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"b1041858-a157-4684-8185-f7d8da8bd66e"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Lifestyle Form</h4>","_auto_id_":"651b353c-f303-4a56-a0ab-a68f556a5515"}],"_auto_id_":"70e1df1d-07c8-4007-b901-7a8149e86573","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"f9f2607d-3007-45db-8b11-ac3236483a77","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"6d2535ae-bf38-4ae8-84bf-27fb3d89b16c","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"answerAccuratelyBanner","type":"content","item-type":"html","_auto_id_":"540f8112-d1f7-471d-b365-c18686b602ec","content":"<p>Please answer this assessment as accurately and completely as possible.</p>","expressions":{},"classes":"banner-dark"}],"expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"67f06da2-00a8-4030-908a-6e3f0969b456","content":[{"name":"html_exercise","type":"content","item-type":"html","_auto_id_":"53e0eaf6-aa27-4254-82b0-914963c27c9b","content":"<div style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Exercise</h4>\n  <i id=\"exercise\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{}},{"name":"Exercise","type":"area","item-type":"group","_auto_id_":"e84ba7ae-57c2-4139-84cc-5f66cb38db31","content":[{"name":"regularexcercise","type":"choice","item-type":"select","_auto_id_":"87bf42de-83f8-486d-a1f3-c4e4201db452","label":"Do you exercise regularly?","required":true,"options":[{"label":"Not assessed","value":"00"},{"label":"Yes","value":"01"},{"label":"No","value":"02"}],"expressions":{},"classes":"question_primary","message":"This is a required field"},{"name":"exercise_repeater","type":"area","item-type":"group","_auto_id_":"a37e2316-efe3-4150-a892-c8c7e904f2c6","content":[{"name":"Intensity","type":"choice","item-type":"select","_auto_id_":"b1fbe655-14bd-4bf1-9717-8221f6d0b306","label":"Intensity","required":true,"options":[{"label":"Low","value":"01"},{"label":"Medium","value":"02"},{"label":"High","value":"03"}],"expressions":{"default":"5"},"validators":[],"actions":[],"message":"This is a required field"},{"name":"misperweek","type":"user-input","item-type":"number","_auto_id_":"dd2d2316-8f8a-4e8b-9d05-b684cd697820","label":"Minutes per week","required":false,"decimals":2,"expressions":{}}],"repeat":true,"expressions":{"show":"$store.pages.LifestyleFormThree.regularexcercise.value == \"01\""}},{"name":"exercise_repeat_displayer","type":"content","item-type":"list","_auto_id_":"649cae20-51db-44c6-9776-52142c871e06","static":false,"model":"$store.repeater.LifestyleFormThree.exercise_repeater","data":"[]","autoscroll":false,"search":"","order":false,"pagination":false,"content":[{"name":"exercise_displayer","type":"content","item-type":"html","_auto_id_":"adec14c8-b5b9-4c3f-af37-24a59eb82dea","content":"<div id=\"{{ $data.$index }}\" class=\"excercise_item\" onclick=\"cti.store.repeater.LifestyleFormThree.exercise_repeater.splice(this.id,1);cti.utils.updatePage()\">\n  <div class=\"node\">{{ $data.$item.Intensity.label}} intensity</div>\n  <div class=\"node\">{{ $data.$item.misperweek}} minutes</div>\n</div>","expressions":{},"classes":"flex_row"}],"dataSource":"dynamic","expressions":{},"actions":[],"classes":"repeater","listItemClasses":"$store.pages.LifestyleFormThree.regularexcercise.value == \"01\""},{"name":"exintoffer","type":"choice","item-type":"select","_auto_id_":"ee413b52-1594-48c8-ac07-04bd0e3b4e2d","label":"Intervention offered","required":true,"options":[{"label":"Intervention not offered","value":"01"},{"label":"Intervention not required","value":"02"},{"label":"Offered and accepted","value":"03"},{"label":"Offered but declined","value":"04"}],"expressions":{},"message":"This is a required field"},{"name":"intdetails","type":"user-input","item-type":"text","_auto_id_":"179be9e3-e9ec-462a-b3cb-838aae183e66","label":"Details of intervention offered","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$store.pages.LifestyleFormThree.exintoffer.value == \"03\" || $store.pages.LifestyleFormThree.exintoffer.value == \"04\""},"validators":[],"actions":[]}],"repeat":false,"expressions":{},"classes":"question_group"}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_previous","type":"button","item-type":"button","_auto_id_":"17d2789d-640a-4bd6-bc98-6434bafeb7dd","content":"PREVIOUS","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", { name: \"LifestyleFormTwo\" });"},"_auto_id_":"2b85ddf4-7fb5-4d65-a462-34871dd32952","actions":[]}],"classes":"default"},{"name":"button_next","type":"button","item-type":"button","_auto_id_":"461866ea-daa3-4c04-91fe-4015f44558f4","content":"NEXT","theme":"default","expressions":{"disabled":"$form.invalid"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", { name: \"LifestyleFormFour\" })"},"_auto_id_":"a06d3d00-9e52-41c2-a37a-a470e3f6d181","actions":[]}],"classes":"default"}],"_auto_id_":"e36855c2-0361-4a00-aca6-f364feebd4ac","expressions":{}}]},{"start":false,"name":"LifestyleFormFour","config":[{"name":"Page Loaded Event","type":"event","item-type":"onpageloaded","_auto_id_":"63f3c3f7-1459-4e73-8425-e1885ada9235","actions":[{"event":"onpageloaded","type":"inline-function","data":{"sync":true,"code":"var page = cti.store.pages.LifestyleForm\n$success()"},"_auto_id_":"a394d36c-6c0f-4942-84e2-74cdb0576b32"}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"0f1e09d1-781e-4ea3-9bbb-fbf4682f49eb","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"3f405c22-56c8-44d7-9b6c-ed0dd6bccaca","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"494e7314-95c3-4022-8709-fe19373e8b56"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Lifestyle Form</h4>","_auto_id_":"0d440b2e-f276-4f34-8af4-da1a405387f2"}],"_auto_id_":"1333a72d-34a7-4cff-ade2-da10412b8236","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"8179c576-9f10-4041-b606-3e22bf3a5425","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"944d14a1-3f5a-483d-8f9d-95cc1936e488","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"answerAccuratelyBanner","type":"content","item-type":"html","_auto_id_":"6cefcb24-df43-4c9a-ab0f-84321da7917f","content":"<p>Please answer this assessment as accurately and completely as possible.</p>","expressions":{},"classes":"banner-dark"}],"expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"1fd36f75-7d23-493a-a33c-78a016859da2","content":[{"name":"html_alcohol","type":"content","item-type":"html","_auto_id_":"9cc807ea-45ec-40e8-a681-a5fa68266a07","content":"<div style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Alcohol</h4>\n  <i id=\"alcohol\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{}},{"name":"Alcohol","type":"area","item-type":"group","_auto_id_":"7c7c8e79-7f2a-4d33-bd54-f86886ac788e","content":[{"name":"alcCurrentUser","type":"choice","item-type":"radio","_auto_id_":"b04678de-647b-4a95-a5a4-f7421b838d5f","label":"Are you a current alcohol user? ","required":true,"options":[{"label":"Yes","value":"01"},{"label":"No","value":"02"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{},"validators":[],"actions":[],"classes":"question_primary","message":"This is a required field"},{"name":"Drinks","type":"area","item-type":"group","_auto_id_":"b2f5ee2a-e7bd-4e79-9ea0-6b0ebedc12ee","content":[{"name":"withdrawal","type":"choice","item-type":"radio","_auto_id_":"43b618bd-cacf-47ff-a76e-62b71d6964a3","label":"Is there evidence of alcohol withdrawal?","required":false,"options":[{"label":"Yes","value":"1"},{"label":"No","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{},"validators":[]},{"name":"alcHowOften","type":"choice","item-type":"select","_auto_id_":"05f2ccd6-a499-46c4-99a0-b1ad6e09f7f0","label":"How often do you have an alcoholic drink?","required":false,"options":[{"label":"Never","value":"0"},{"label":"Monthly or less","value":"1"},{"label":"2-4 times per month","value":"2"},{"label":"2-3 times per week","value":"3"},{"label":"4+ per week","value":"4"}],"expressions":{}},{"name":"alcHowManyUnits","type":"choice","item-type":"select","_auto_id_":"fad27fc5-b69f-4f17-a206-de6957496f52","label":"How many units of alcohol do you consume on a typical day when drinking?","required":false,"options":[{"label":"1-2","value":"0"},{"label":"3-4","value":"1"},{"label":"5-6","value":"2"},{"label":"7-9","value":"3"},{"label":"10+","value":"4"}],"expressions":{}},{"name":"alcExceedUnits","type":"choice","item-type":"select","_auto_id_":"ee2593dd-809a-4d56-a5d3-07d932af03db","label":"How often do you exceed 6 or more units on a single occasion?","required":false,"options":[{"label":"Never","value":"0"},{"label":"Less than monthly","value":"1"},{"label":"Monthly","value":"2"},{"label":"Weekly","value":"3"},{"label":"Daily or almost daily","value":"4"}],"validators":[],"expressions":{}}],"repeat":false,"expressions":{"show":"$store.pages.LifestyleFormFour.alcCurrentUser == \"01\""}},{"name":"alcIntervention","type":"choice","item-type":"select","_auto_id_":"ca481949-66a4-47a3-9adf-914f4c0de5d1","label":"Intervention","required":true,"options":[{"label":"None required","value":"01az"},{"label":"Brief advice given","value":"02az"},{"label":"Self-referred to alcohol services","value":"03az"},{"label":"Referral to alcohol services made","value":"04az"},{"label":"Referral offered but declined","value":"05az"}],"validators":[],"expressions":{},"actions":[],"message":"This is a required field"},{"name":"alcintdetail","type":"user-input","item-type":"text","_auto_id_":"e99cc197-0148-41f2-a71d-bfcb49470a88","label":"Details of service offered","required":true,"multiline":true,"debounce":1000,"expressions":{},"validators":[],"actions":[],"message":"This is a required field","default":""}],"repeat":false,"expressions":{},"classes":"question_group"}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_previous","type":"button","item-type":"button","_auto_id_":"53ba7268-483b-423b-be21-835909126f1f","content":"PREVIOUS","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", { name: \"LifestyleFormThree\" });"},"_auto_id_":"a1d73851-0c44-411d-92e0-49cfac0ec1ac","actions":[]}],"classes":"default"},{"name":"button_next","type":"button","item-type":"button","_auto_id_":"3b785156-430c-4347-abb8-e7d5885af54a","content":"NEXT","theme":"default","expressions":{"disabled":"$form.invalid"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", { name: \"LifestyleFormFive\" })"},"_auto_id_":"4c75d1eb-e3cb-4a69-aca5-9f7106b62593","actions":[]}],"classes":"default"}],"_auto_id_":"9fd07d46-b4e3-48ea-87fa-e64357c3f5d5","expressions":{}}]},{"start":false,"name":"LifestyleFormFive","config":[{"name":"Page Loaded Event","type":"event","item-type":"onpageloaded","_auto_id_":"683bf410-327c-44ee-b2e6-8eed5ac4ce38","actions":[{"event":"onpageloaded","type":"inline-function","data":{"sync":true,"code":"var page = cti.store.pages.LifestyleForm\n$success()"},"_auto_id_":"fcf7ae4e-f5c2-40d7-9b9a-3cbd21fa1478"}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"33d7cb9b-1489-418d-925b-a2e84b8d6c37","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"bdfc8a04-1e1a-4277-a749-82720db0517a","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"8719ab42-105b-4362-bdfc-0a84cc1ee920"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Lifestyle Form</h4>","_auto_id_":"411dd6b7-9895-4973-b566-d0000a524c06"}],"_auto_id_":"13df67ba-8100-4777-83d4-fd672cacb1db","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"e7d05798-9d1e-4f51-9e80-42e750a3296b","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"495d6b20-6097-409e-98d2-d9706675f866","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"answerAccuratelyBanner","type":"content","item-type":"html","_auto_id_":"96cf6a72-6740-4a1e-bf2f-6ff7373f4583","content":"<p>Please answer this assessment as accurately and completely as possible.</p>","expressions":{},"classes":"banner-dark"}],"expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"133a341d-54ea-4dae-8616-282c9835395f","content":[{"name":"html_drugs","type":"content","item-type":"html","_auto_id_":"994be13e-1a63-4011-83ad-0aee312a4727","content":"<div style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Drugs</h4>\n  <i id=\"drugs\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{}},{"name":"Drugs","type":"area","item-type":"group","_auto_id_":"5e508eef-f86b-4bef-9097-ddf480345fc7","content":[{"name":"recdruguse","type":"choice","item-type":"select","_auto_id_":"abd2e9d8-8a29-4a65-ada3-32d6a5f62a64","label":"Have you ever used recreational drugs?","required":true,"options":[{"label":"Not assessed","value":"1na"},{"label":"No","value":"2no"},{"label":"In the past","value":"3tp"},{"label":"Current user","value":"4cu"}],"expressions":{},"classes":"question_primary","message":"This is a required field"},{"name":"drugs_group","type":"area","item-type":"group","_auto_id_":"a73e49ab-2a7a-4848-8586-101950841439","content":[{"name":"drugname","type":"choice","item-type":"select","_auto_id_":"82ddfb85-4a08-42d8-8778-9f5cdad1412a","label":"Drug name:","required":true,"options":[{"label":"Amphetamines","value":"01"},{"label":"Cannabis","value":"02"},{"label":"Powder cocaine","value":"03"},{"label":"Crack cocaine","value":"04"},{"label":"Heroin","value":"05"},{"label":"Ketamine","value":"08"},{"label":"Legal highs","value":"10"},{"label":"Ecstasy","value":"06"},{"label":"Khat","value":"07"},{"label":"Crystal meth","value":"09"},{"label":"Other","value":"99"}],"expressions":{},"validators":[],"message":"This is a required field"},{"name":"otherdrug","type":"user-input","item-type":"text","_auto_id_":"123f301c-5d7c-4e72-bf83-6f56ae4fbdab","label":"If 'Other' enter name","required":false,"multiline":false,"debounce":250,"expressions":{"show":"$store.pages.LifestyleFormFive.drugname.value == \"99\""},"validators":[],"actions":[]},{"name":"currentuse","type":"choice","item-type":"radio","_auto_id_":"6e1061bf-ed53-4606-ae80-8a769bebbb46","label":"Currently using?","required":false,"options":[{"label":"Yes","value":"1"},{"label":"No","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{}},{"name":"useperweek","type":"user-input","item-type":"text","_auto_id_":"b2d16998-b3e1-44d3-a2ad-cf268d53d67a","label":"Quantity used in average week","required":false,"multiline":false,"debounce":250,"expressions":{}},{"name":"modeofuse","type":"user-input","item-type":"text","_auto_id_":"d112c6ea-f32e-41db-9bd4-c3f6dfe3c188","label":"Mode of user (e.g. smoked, injected)","required":false,"multiline":false,"debounce":250,"expressions":{},"validators":[]}],"repeat":true,"expressions":{"show":"$store.pages.LifestyleFormFive.recdruguse.value == \"4cu\""}},{"name":"drugs_repeat_displayer","type":"content","item-type":"list","_auto_id_":"32fe3e59-3865-4507-b1fe-f70af93e384c","static":false,"model":"$store.repeater.LifestyleFormFive.drugs_group","data":"[]","autoscroll":false,"search":"","order":false,"pagination":false,"content":[{"name":"drug_displayer","type":"content","item-type":"html","_auto_id_":"3f48e29d-42f1-48ce-87a9-3d5f19ab45e8","content":"<div id=\"{{ $data.$index }}\" class=\"repeater_item\" onclick=\"cti.store.repeater.LifestyleFormFive.drugs_group.splice(this.id,1);cti.utils.updatePage()\">\n  <div class=\"node\">{{ $data.$item.otherdrug || $data.$item.drugname.label}}</div>\n  <div class=\"node\">{{ $data.$item.useperweek }}</div>\n  <div class=\"node\">{{ $data.$item.modeofuse }}</div>\n</div>","expressions":{}}],"dataSource":"dynamic","expressions":{},"actions":[],"classes":"repeater","listItemClasses":"$store.pages.LifestyleFormFive.recdruguse == \"4cu\""},{"name":"drugintoffer","type":"choice","item-type":"select","_auto_id_":"a9ec025a-282e-4fd3-af37-0c24957de346","label":"Intervention offered?","required":true,"options":[{"label":"Intervention not offered","value":"01"},{"label":"Intervention not required","value":"02"},{"label":"Offered and accepted","value":"03"},{"label":"Offered but declined","value":"04"}],"expressions":{},"message":"This is a required field"},{"name":"drugintdetails","type":"user-input","item-type":"text","_auto_id_":"af5d8a3f-880d-4c39-bbda-3a7550a64b04","label":"Details of interventions offered","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$store.pages.LifestyleFormFive.drugintoffer.value == \"03\" || $store.pages.LifestyleFormFive.drugintoffer.value == \"04\""}}],"repeat":false,"expressions":{},"classes":"question_group"}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_previous","type":"button","item-type":"button","_auto_id_":"91866450-8011-43a9-9108-0a5f92078866","content":"PREVIOUS","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", { name: \"LifestyleFormFour\" });"},"_auto_id_":"4290e90d-8826-46b9-8921-0a256a0590e3","actions":[]}],"classes":"default"},{"name":"button_next","type":"button","item-type":"button","_auto_id_":"b2a7cced-8c72-4196-9aad-827ec737e10a","content":"NEXT","theme":"default","expressions":{"disabled":"$form.invalid"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", { name: \"LifestyleFormSix\" });"},"_auto_id_":"1605698e-fdf0-4efd-8486-398772ed8d20","actions":[]}],"classes":"default"}],"_auto_id_":"1006aebd-1a4d-493e-b51d-5271d22f18ab","expressions":{}}]},{"start":false,"name":"LifestyleFormSix","config":[{"name":"Page Loaded Event","type":"event","item-type":"onpageloaded","_auto_id_":"0302aaad-aaa6-42b3-a5c7-dee0626e6caa","actions":[{"event":"onpageloaded","type":"inline-function","data":{"sync":true,"code":"var page = cti.store.pages.LifestyleForm\n$success()"},"_auto_id_":"cfe7a3c9-7993-487b-8c55-3e8372ce969c"}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"a724b55b-c270-4707-91ec-5ded744c9c9c","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"16df4457-7610-4379-8caa-03f1cd49a39f","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"17be576f-db09-41b8-9cf0-a18dae6be6cd"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Lifestyle Form</h4>","_auto_id_":"b4f3987e-05e4-4c24-96ce-adbdbb81808b"}],"_auto_id_":"94fff36b-2bda-4c74-a81a-0a365d83135b","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"2ad3c410-f6cf-4f69-a798-3ebf7f7cfad7","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"fe331036-5dc2-4443-858b-347b7d1e04f7","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"answerAccuratelyBanner","type":"content","item-type":"html","_auto_id_":"9737be91-8ee9-463f-b19f-a4f96ed80761","content":"<p>Please answer this assessment as accurately and completely as possible.</p>","expressions":{},"classes":"banner-dark"}],"expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"43654c6c-2456-4cae-aa93-e0e7ed90c7b8","content":[{"name":"html_other","type":"content","item-type":"html","_auto_id_":"908261c2-719f-440c-b697-4f5d09e691ed","content":"<div style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Other</h4>\n  <i id=\"other\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{}},{"name":"Other","type":"area","item-type":"group","_auto_id_":"86fbcf46-31fb-4428-9080-32a1270c899d","content":[{"name":"menwellbeing","type":"choice","item-type":"select","_auto_id_":"bdd94941-736e-49c4-b3e1-fc16b0466a83","label":"5 Ways to Mental Wellbeing","required":true,"options":[{"label":"Intervention not offered","value":"01"},{"label":"Offered and accepted","value":"02"},{"label":"Offered but declined","value":"03"}],"expressions":{},"message":"This is a required field"},{"name":"signpost","type":"choice","item-type":"select","_auto_id_":"7945d616-885c-432b-8c6b-5344ece43163","label":"Signposting for support with debt or housing","required":true,"options":[{"label":"Intervention not offered","value":"01"},{"label":"Intervention not required","value":"02"},{"label":"Offered and accepted","value":"03"},{"label":"Offered but declined","value":"04"}],"expressions":{},"message":"This is a required field"},{"name":"signdetail","type":"user-input","item-type":"text","_auto_id_":"69381c59-3dde-475f-b739-0d9cca97bfbc","label":"Details of intervention offered","required":true,"multiline":true,"debounce":1000,"expressions":{},"message":"This is a required field"},{"name":"addcomm","type":"user-input","item-type":"text","_auto_id_":"a71b7f99-ad5f-4352-aac7-4f24482fcaff","label":"Comments:","required":false,"multiline":true,"debounce":1000,"expressions":{}},{"name":"YNPresent","type":"choice","item-type":"radio","_auto_id_":"4779ad30-c9f9-472a-9d82-ba3c6cca2f0c","label":"Present?","required":false,"options":[{"label":"Yes","value":"v8aa"},{"label":"No","value":"v8ab"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{}},{"name":"admissionassess","type":"choice","item-type":"radio","_auto_id_":"4ca8f0d5-e58a-46d5-aee2-186fd92f6552","label":"Admission assesment: ","required":true,"options":[{"label":"Yes","value":1},{"label":"No","value":2}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{},"message":"This is a required field"},{"name":"SentCopy","type":"choice","item-type":"radio","_auto_id_":"f5e855e9-52d6-499d-8285-69474e1c801d","label":"Copy of CPA sent?","required":false,"options":[{"label":"Yes","value":"V8aa"},{"label":"No","value":"V8ab"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{}},{"name":"assessmentstatus","type":"choice","item-type":"select","_auto_id_":"5aae989c-9c58-4502-8027-6da1fc8cbacd","label":"Status of assessment","required":true,"options":[{"label":"Assessment complete","value":"01"},{"label":"Patient declined entire assessment","value":"02"},{"label":"Patient declined part of assessment","value":"03"},{"label":"Unsafe to conduct assessment","value":"04"},{"label":"Assessment incomplete","value":"01a"},{"label":"Form Entered in Error","value":"99"}],"expressions":{},"message":"This is a required field"}],"repeat":false,"expressions":{}}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_previous","type":"button","item-type":"button","_auto_id_":"b1947c3b-85f9-4ee5-930f-62b70c15e984","content":"PREVIOUS","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", { name: \"LifestyleFormFive\" });"},"_auto_id_":"5f92d7b1-b024-4e11-bd02-2f743d2107b2","actions":[]}],"classes":"default"},{"name":"button_save","type":"button","item-type":"button","_auto_id_":"fb20903e-f42f-4578-ab36-c72716150645","content":"SAVE","theme":"default","expressions":{"disabled":"$form.invalid"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"//cti.store.variables.selected_visit.lifestyle_form_status = true;\n//cti.store.variables.selected_visit.lifestyle_form_object.status = \"complete\";\n//cti.utils.callAction(\"go-to-page\", {\"name\":\"Visit\"});\ncti.utils.callAction(\"call-actionflow\", { name: \"SubmitLifestyleForm\" });"},"_auto_id_":"b590f27a-e1c8-40ad-aa3b-84a82c7761df","actions":[]}],"classes":""}],"_auto_id_":"a2a36716-1b86-4484-9cac-373d983603e7","expressions":{}}]},{"start":false,"name":"DialogFormPre","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"6d1cfae7-63fc-49c6-b9d8-797fc0c9b1fc","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"5ded437f-0af6-467b-abd7-4ca7025a5a95","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"d4a5c00b-cd20-471d-8583-f9eeda847b5f"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Dialog Assessment</h4>","_auto_id_":"6bdbb6ab-9af8-42c5-a63b-b71b62526f43"}],"_auto_id_":"a78307e8-4895-4e21-9311-14295288b781","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"33903b77-3ce2-4cf0-9427-f935db33b263","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"890ffa03-06be-47fc-829c-03d7f05a6bdd","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"gettingStartedBanner","type":"content","item-type":"html","_auto_id_":"f55e2893-8985-4973-8845-40cdc71dfc5e","content":"<p>Getting Started</p>","expressions":{},"classes":"banner-dark"}],"expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"4b8044cf-c51c-4c0f-a0a1-9837511a0c3c","content":[{"name":"preDialogText","type":"content","item-type":"html","_auto_id_":"9821e8b5-f8df-405d-9b3e-cdba3ea36116","content":"<div class=\"PreDialogText\"><p>This form must be completed at point of entry into the service, at regular intervals throughout clinical contact and at discharge.</p>\n<p>In all scenarios the answer to the question 'Does the service user want help?' should be completed by the service user.</p>\n<p>Occasionally the clinician's view may be different to that of the service user or the service user may lack the capacity to decide.<br />\nIn both cases the box most likely to represent the service user's views should be ticked.</p>\n<p>The free text box should then be used to provide reasons for the service user's view followed by the views of the professional or family if different.</p>\n<p>When discussing and creating an action plan please follow steps 1-3 for each area you agree to discuss today:</p>\n<p><strong>Step 1: Understanding</strong> - why this rating and not a lower one? - what is working?</p>\n<p><strong>Step 2: Looking forward</strong> - best case scenario? - smallest improvement?</p>\n<p><strong>Step 3: Considering options</strong> - what can the patient do? - what can the clinician do? - what can others do?</p></div>\n<h4>Pre Assessment Questions</h4>","expressions":{}},{"name":"PreDialogQs","type":"area","item-type":"group","_auto_id_":"14409adb-1272-4703-8ba5-2235860cf2e6","content":[{"name":"StageTreat","type":"choice","item-type":"radio","_auto_id_":"b707b452-5702-473f-87bc-469f4e63a929","label":"Is this a CPA review?","required":true,"options":[{"label":"Yes","value":"03CRP"},{"label":"No","value":"05"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{},"message":"This is a required field"},{"name":"StageTreat1","type":"choice","item-type":"select","_auto_id_":"b6b663f0-57da-4770-bf72-1b21042a5a2f","label":"Stage of Treatment:","required":true,"options":[{"label":"Assessment","value":"01ASS"},{"label":"Review","value":"02Rev"},{"label":"Discharge (From CPA or Trust)","value":"03Dis"}],"expressions":{},"message":"This is a required field"},{"name":"InCareDec","type":"choice","item-type":"select","_auto_id_":"e27389e2-37f8-4c42-9ada-2afc87e690ab","label":"Initial Care Decision","required":false,"options":[{"label":"Short term support to max independence","value":"01az"},{"label":"Long term support -  nursing care","value":"02az"},{"label":"Long term support - residential care","value":"03az"},{"label":"Long term support - community / prison","value":"04az"},{"label":"Ongoing low level support","value":"07az"},{"label":"No services provided - deceased","value":"10az"},{"label":"100% NHS funded care","value":"05az"},{"label":"No services provided","value":"11az"},{"label":"End of life","value":"06az"},{"label":"Signposted to other services","value":"09az"},{"label":"Short term support (other)","value":"08az"}],"expressions":{"show":"$store.pages.DialogFormPre.StageTreat1.value == \"01ASS\""}},{"name":"SUCap","type":"choice","item-type":"select","_auto_id_":"8085606a-baaa-4d0d-90ab-7d71450d3d3c","label":"Service user response","required":true,"options":[{"label":"Service user agreed assessment","value":"01SUA"},{"label":"Service user declined assessment","value":"02SUDA"},{"label":"SU lacks capacity - carer completed","value":"03SULCCARE"},{"label":"SU lacks capacity - clinician completed","value":"04SULCCLIN"},{"label":"SU declined-carer completed(CAMHS only)","value":"05SUDCAMHS"}],"expressions":{},"message":"This is a required field"},{"name":"MHRecovery","type":"user-input","item-type":"text","_auto_id_":"39fceaf6-1cfb-4d97-b382-f27258b2d07a","label":"What recovery means to me? My long term goals.  What I would like to achieve in 12 months time.","required":false,"multiline":true,"debounce":1000,"expressions":{}},{"name":"MHMatters","type":"user-input","item-type":"text","_auto_id_":"c857b503-1150-4021-9276-5af04cf9dc6e","label":"What matters to me?","required":false,"multiline":true,"debounce":1000,"expressions":{}},{"name":"MHSkills","type":"user-input","item-type":"text","_auto_id_":"ca6e43da-d5e8-42d5-8bef-be05ce18924e","label":"My skills, strengths and experiences that will help me achieve my goals","required":false,"multiline":true,"debounce":1000,"expressions":{}}],"repeat":false,"expressions":{}}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_begin","type":"button","item-type":"button","_auto_id_":"7ddf23c9-9912-42fd-ad4c-469ea8a4b11c","content":"BEGIN ASSESSMENT","theme":"default","expressions":{"disabled":"$form.invalid"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogFormOne\"})"},"_auto_id_":"df011c15-e068-47d8-a886-c7e75c17d988","actions":[]}],"classes":"default"}],"_auto_id_":"9a9a0273-ce8b-44a0-8fc2-7ef314243731","expressions":{}}]},{"start":false,"name":"DialogFormOne","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"5ab4e526-9310-47af-978f-f875bbb6593f","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"fc97f743-a411-4c36-abde-b743fc3a6077","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"90b0b838-ee8f-46f0-adea-df0b8ae2113a"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Dialog Form</h4>","_auto_id_":"641b5696-2c55-49e5-b147-07bcc79be220"}],"_auto_id_":"1ceea5eb-1552-495a-9236-a9353daaed47","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"d3f8f3f6-71b7-43a4-84ed-577f36b4500d","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"865763d6-1156-4426-92a9-82d8f68ed3a2","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"03ea014e-af58-4a64-af38-dfec3075e365","content":"Appointment Type: {{'$store.variables.selected_visit.appointmentType.value '|store}}","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""},{"name":"button_page_count","type":"button","item-type":"button","_auto_id_":"d91c2904-b779-438a-b872-f43fe4948e93","content":"Page 1 of 14","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""}],"expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"62ff3488-79e2-43f3-8de1-24a791ab8459","content":[{"name":"mentalHealthTitle","type":"content","item-type":"html","_auto_id_":"a7782be6-4d5a-4f9a-b2c6-f273c58a97a6","content":"<h4>Mental health</h4>\n<div class=\"rio_slider\" id=\"DialogMentalHealthSummary\"></div>","expressions":{},"classes":""},{"name":"mentalHealthGroup","type":"area","item-type":"group","_auto_id_":"8e8b64da-9cd7-4462-89fb-0fa74c773872","content":[{"name":"MSat1Radios","type":"component","item-type":"web-component","content":"","componentId":"48eb4683-12b3-4299-a31e-d2f721d0fa7b","_auto_id_":"9e91ed47-e8d8-478e-9a6e-76948395009f","attributes":{"questionText":"How satisfied are you with your mental health?","selectedValue":"cti.store.pages.DialogFormOne.MHSat1"},"actions":[{"event":"radioPressed","type":"inline-function","data":{"sync":true,"code":"if ($store.pages.DialogFormOne === undefined) $store.pages.DialogFormOne = {};\n$store.pages.DialogFormOne.MHSat1 = $data.detail"},"_auto_id_":"c7871fb3-f0f0-4036-9a1c-d83d90a5c947"}],"expressions":{}},{"name":"MHSatHelp","type":"choice","item-type":"radio","_auto_id_":"b0d778a1-7dea-4093-84ec-e408405b5361","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{},"actions":[],"validators":[]},{"name":"MHSatActions","type":"user-input","item-type":"text","_auto_id_":"0ef4fbb1-5502-4a3c-9965-159648d7afdb","label":"Mental health goals and actions:","required":false,"multiline":true,"debounce":1000,"validators":[],"actions":[],"expressions":{"show":"$store.pages.DialogFormOne.MHSatHelp == '1'"},"placeholder":""}],"repeat":false,"expressions":{},"classes":"accord"}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_previous","type":"button","item-type":"button","_auto_id_":"be6cfe7f-03b1-439e-80eb-dabcc0a16d40","content":"PREVIOUS","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogFormPre\"})"},"_auto_id_":"991b1b75-dda7-4689-8c0e-052e0b978c5c","actions":[]}],"classes":"default"},{"name":"button_next","type":"button","item-type":"button","_auto_id_":"f256749a-9ffe-4b42-9ad6-f6a1d9d150ab","content":"NEXT","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogFormTwo\"})"},"_auto_id_":"fdabf3d5-0066-47fb-acff-3203365b8a57","actions":[]}],"classes":"default"}],"_auto_id_":"b3481e90-57a5-4382-aae5-6134fdf95b6a","expressions":{}}]},{"start":false,"name":"DialogFormTwo","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"80ee9254-9841-40e4-a130-b45277fcb920","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"642f1064-e19e-43cb-ab00-b8094f33f84c","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"951cc60a-3e18-4294-9e5b-4b06927f61c6"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Dialog Form</h4>","_auto_id_":"3c7ec761-b7cb-4f3c-9f4b-3f23cf86ec65"}],"_auto_id_":"d2d43d5a-3ec0-476e-9f66-0ee9a9dd80d4","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"c945afdd-710d-4156-9093-cd96e2746a4b","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"a2129ca3-b9b2-4973-a847-e07464eb5060","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"4bed2ff2-5ac4-4fac-a3db-b5bc72332345","content":"Appointment Type: {{'$store.variables.selected_visit.appointmentType.value '|store}}","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""},{"name":"button_page_count","type":"button","item-type":"button","_auto_id_":"445b01ba-7808-49ed-a245-206eed12553f","content":"Page 2 of 14","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""}],"expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"16c80976-fd58-4e4d-9bbc-29a701a0a294","content":[{"name":"physicalHealthTitle","type":"content","item-type":"html","_auto_id_":"567f6211-c5d2-4e55-b511-303a88c49e2e","content":"<h4>Physical health</h4>\n<div class=\"rio_slider\" id=\"DialogPhysicalHealthSummary\"></div>","expressions":{},"classes":""},{"name":"physicalHealthGroup","type":"area","item-type":"group","_auto_id_":"44013eaf-c400-4583-9493-3ac2f4bc05fc","content":[{"name":"PHSatPLRadios","type":"component","item-type":"web-component","content":"","componentId":"48eb4683-12b3-4299-a31e-d2f721d0fa7b","_auto_id_":"4f1cee70-77ba-4291-bb4c-c66f59d0f6b2","attributes":{"questionText":"How satisfied are you with your physical health?","selectedValue":"cti.store.pages.DialogFormTwo.PHSatPL"},"expressions":{},"actions":[{"event":"radioPressed","type":"inline-function","data":{"sync":true,"code":"if ($store.pages.DialogFormTwo === undefined) $store.pages.DialogFormTwo = {};\n$store.pages.DialogFormTwo.PHSatPL = $data.detail;\n"},"_auto_id_":"a78fef51-fcce-459e-a8b2-dc69d28e4069"}]},{"name":"PHSatHelp","type":"choice","item-type":"radio","_auto_id_":"c3970336-63a6-482a-ad9d-7b8c368f7f59","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{},"validators":[],"actions":[],"classes":""},{"name":"PHSatActions","type":"user-input","item-type":"text","_auto_id_":"8f102035-086e-45ad-a26e-8aba0f3b4333","label":"Physical health goals and actions:","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$store.pages.DialogFormTwo.PHSatHelp == '1'"},"validators":[]}],"repeat":false,"expressions":{},"classes":"accord"}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_previous","type":"button","item-type":"button","_auto_id_":"42df2d1c-a6ab-418e-9c4a-8a45aad21b4a","content":"PREVIOUS","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogFormOne\"})"},"_auto_id_":"7c7a0187-1243-4493-ba0c-58d04f8bb261","actions":[]}],"classes":"default"},{"name":"button_next","type":"button","item-type":"button","_auto_id_":"2b50bc2b-a7bf-4281-ab2d-aeeb7b5d0b8c","content":"NEXT","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogFormThree\"})"},"_auto_id_":"0a76d5ec-c934-4b48-bcaf-fcf308a74902","actions":[]}],"classes":"default"}],"_auto_id_":"76358c09-5d21-4abe-8440-d6bb818c7ede","expressions":{}}]},{"start":false,"name":"DialogFormThree","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"40b5b371-e067-481e-b17f-cc9a02a8a39c","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"0c569911-6baa-42cf-a9bd-54c24a9268cc","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"1c274fed-3eaa-4427-ae08-6387313b6cda"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Dialog Form</h4>","_auto_id_":"f2630b72-2742-493c-9f9d-960b57677c27"}],"_auto_id_":"849feb65-8512-4829-9c5e-be57174b1ac4","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"76501de7-713e-4978-9f47-517177a6d83c","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"3f4e8489-eba3-48ed-abc4-a3e27e39303f","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"3b2eb274-e50a-4486-a381-90ee0ea7216e","content":"Appointment Type: {{'$store.variables.selected_visit.appointmentType.value '|store}}","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""},{"name":"button_page_count","type":"button","item-type":"button","_auto_id_":"da331a9e-f79f-445a-b224-acb724cbdada","content":"Page 3 of 14","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""}],"expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"974f3cf6-549f-4a60-b512-c7b8a982e830","content":[{"name":"jobSituationTitle","type":"content","item-type":"html","_auto_id_":"c020249e-eb4f-4dfd-aab3-e758243d0e9b","content":"<h4>Job situation</h4>\n<div class=\"rio_slider\" id=\"jobSituationSummary\"></div>","expressions":{},"classes":""},{"name":"jobSituationGroup","type":"area","item-type":"group","_auto_id_":"531f19ab-1f8b-49df-ae9d-c0277a283157","content":[{"name":"JSSatPLRadios","type":"component","item-type":"web-component","content":"","componentId":"48eb4683-12b3-4299-a31e-d2f721d0fa7b","_auto_id_":"4e9eb0e6-570c-4bda-ad3b-59a7b8e3407a","attributes":{"questionText":"How satisfied are you with your job situation?","selectedValue":"cti.store.pages.DialogFormThree.JSSatPL"},"expressions":{},"actions":[{"event":"radioPressed","type":"inline-function","data":{"sync":true,"code":"if ($store.pages.DialogFormThree === undefined) $store.pages.DialogFormThree = {};\n$store.pages.DialogFormThree.JSSatPL = $data.detail\n"},"_auto_id_":"989afa2b-f815-496f-ae9e-c3d136ee9de4"}]},{"name":"JSSatHelp","type":"choice","item-type":"radio","_auto_id_":"4519bf65-7638-4bf9-bfea-edd600551858","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{},"validators":[]},{"name":"JSSatActions","type":"user-input","item-type":"text","_auto_id_":"8d95c844-53d4-4ebc-828c-65d6419db560","label":"Job situation goals and actions:","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$store.pages.DialogFormThree.JSSatHelp == '1'"},"validators":[]}],"repeat":false,"expressions":{},"classes":"accord"}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_previous","type":"button","item-type":"button","_auto_id_":"74969114-8092-47bc-8198-943a330a4c3d","content":"PREVIOUS","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogFormTwo\"})"},"_auto_id_":"29f9a275-ca71-4981-bc7f-c6f475b54485","actions":[]}],"classes":"default"},{"name":"button_next","type":"button","item-type":"button","_auto_id_":"029964f9-bc62-4672-91df-059bdae15058","content":"NEXT","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogFormFour\"})"},"_auto_id_":"954c7683-e369-42e0-b183-807131ab5fd9","actions":[]}],"classes":"default"}],"_auto_id_":"59efe954-5ac6-4fd7-9bcf-d5294cd7311e","expressions":{}}]},{"start":false,"name":"DialogFormFour","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"97156d64-022d-4d38-b8da-59e34dff1fbd","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"a5f84b74-5f12-464d-8270-e2d059104ae4","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"a0d477dc-b8ad-45dc-8ddc-762c9bd773ca"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Dialog Form</h4>","_auto_id_":"2d87fdc2-cf06-4b07-a773-4d47d01d7993"}],"_auto_id_":"3f42fb93-3148-41b7-9c19-ec439b8500ba","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"6d46fab4-bc55-409d-a39b-18be673fb998","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"fada5d41-72b3-4cb7-b923-e5e56923297d","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"2ce8200d-3c33-428e-98fb-5a508e39d282","content":"Appointment Type: {{'$store.variables.selected_visit.appointmentType.value '|store}}","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""},{"name":"button_page_count","type":"button","item-type":"button","_auto_id_":"914ee150-0eb4-46f3-ace9-ec54f74da47b","content":"Page 4 of 14","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""}],"expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"8bd9a443-61af-4574-acf9-3656463f94e4","content":[{"name":"accommodationTitle","type":"content","item-type":"html","_auto_id_":"5c08f1d1-65a4-4b9d-956f-a3961de5f9be","content":"<h4>Accommodation</h4>\n<div class=\"rio_slider\" id=\"accommodationSummary\"></div>","expressions":{},"classes":""},{"name":"accommodationGroup","type":"area","item-type":"group","_auto_id_":"9f48f6ec-4511-4950-bd8f-a4a6a91ca925","content":[{"name":"ACSatPLRadios","type":"component","item-type":"web-component","content":"","componentId":"48eb4683-12b3-4299-a31e-d2f721d0fa7b","_auto_id_":"a91bb963-eec2-41c2-a4c9-bcc41cd6c2c4","attributes":{"questionText":"How satisfied are you with your accommodation?","selectedValue":"cti.store.pages.DialogFormFour.ACSatPL"},"actions":[{"event":"radioPressed","type":"inline-function","data":{"sync":true,"code":"if ($store.pages.DialogFormFour === undefined) $store.pages.DialogFormFour = {};\n$store.pages.DialogFormFour.ACSatPL = $data.detail"},"_auto_id_":"859fc742-8174-4eae-b1a3-7030ab829e6d"}],"expressions":{}},{"name":"ACSatHelp","type":"choice","item-type":"radio","_auto_id_":"25d3fb85-4bdf-4cf6-b00b-c0d6e4549f43","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{}},{"name":"ACSatActions","type":"user-input","item-type":"text","_auto_id_":"fd85441e-2ccf-4478-8751-c21d6cb569d0","label":"Accomodation goals and actions:","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$store.pages.DialogFormFour.ACSatHelp == '1'"},"validators":[]}],"repeat":false,"expressions":{},"classes":"accord"}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_previous","type":"button","item-type":"button","_auto_id_":"57b273de-6dd9-4f60-a830-73a8ea41db6d","content":"PREVIOUS","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogFormThree\"})"},"_auto_id_":"27cff80b-a868-48d8-837c-09d3b3f47721","actions":[]}],"classes":"default"},{"name":"button_next","type":"button","item-type":"button","_auto_id_":"b372375a-b7f2-4d3c-81c7-9a6be905f7dd","content":"NEXT","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogFormFive\"})"},"_auto_id_":"03541c84-2414-4f44-b5e8-9206a173ec24","actions":[]}],"classes":"default"}],"_auto_id_":"0c74eb5b-2d76-41db-999a-5186734dbba9","expressions":{}}]},{"start":false,"name":"DialogFormFive","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"c62ca3fc-5412-4d54-a54a-d557cd94a797","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"3e881f34-52f4-4b21-97ca-063e53861d25","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"d1684fac-cb90-45dd-91a0-bc109dc55c4c"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Dialog Form</h4>","_auto_id_":"bc9ca884-5ab1-48d7-8569-1e91e3fa4fce"}],"_auto_id_":"aca09543-33c4-4742-b2cc-27e4c7988e38","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"ac88b422-a17e-4e1f-80e4-ba1a9731705a","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"be902059-0872-4ae4-88fc-b0b3430985ed","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"bfce5539-3f8d-4705-8baf-72da8c694b1f","content":"Appointment Type: {{'$store.variables.selected_visit.appointmentType.value '|store}}","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""},{"name":"button_page_count","type":"button","item-type":"button","_auto_id_":"fa0380f6-d727-4030-911d-b31ec95c6088","content":"Page 5 of 14","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""}],"expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"039c34f6-b37a-4c56-8ba6-bc492f7fceda","content":[{"name":"leisureActivitiesTitle","type":"content","item-type":"html","_auto_id_":"77bc0dba-63e1-48b2-a903-9b19a1246a4d","content":"<h4>Leisure activities</h4>\n<div class=\"rio_slider\" id=\"leisureActivitiesSummary\"></div>","expressions":{},"classes":""},{"name":"leisureActivitiesGroup","type":"area","item-type":"group","_auto_id_":"1c791486-6353-4bab-84a7-bab20bc032b7","content":[{"name":"LASatPLRadios","type":"component","item-type":"web-component","content":"","componentId":"48eb4683-12b3-4299-a31e-d2f721d0fa7b","_auto_id_":"65cd7fbf-7b2f-4b6d-922f-ed16c5dbbc9c","attributes":{"questionText":"How satisfied are you with your leisure activities?","selectedValue":"cti.store.pages.DialogFormFive.LASatPL"},"actions":[{"event":"radioPressed","type":"inline-function","data":{"sync":true,"code":"if ($store.pages.DialogFormFive === undefined) $store.pages.DialogFormFive = {};\n$store.pages.DialogFormFive.LASatPL = $data.detail"},"_auto_id_":"2fc81d54-1bff-4509-94d8-652543908f5d"}],"expressions":{}},{"name":"LASatHelp","type":"choice","item-type":"radio","_auto_id_":"322ed405-ade7-45b1-a81d-0be0ad096aba","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{}},{"name":"LASatActions","type":"user-input","item-type":"text","_auto_id_":"87091c7f-f2b6-44bf-b247-8ae5813c8c72","label":"Leisure activity goals and actions:","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$store.pages.DialogFormFive.LASatHelp == '1'"},"validators":[]}],"repeat":false,"expressions":{},"classes":"accord"}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_previous","type":"button","item-type":"button","_auto_id_":"dd212570-2313-4fe1-8c5a-648dd72e3a88","content":"PREVIOUS","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogFormFour\"})"},"_auto_id_":"1b5547cd-6551-41e0-aa40-1322666af9cb","actions":[]}],"classes":"default"},{"name":"button_next","type":"button","item-type":"button","_auto_id_":"357cc274-e554-4cb8-9d9d-673a84fcb42d","content":"NEXT","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogFormSix\"})"},"_auto_id_":"5f9d0b0a-a70e-4475-bb41-69952a8e10ce","actions":[]}],"classes":"default"}],"_auto_id_":"a557e882-85c3-4426-af28-1f6a0ddf24cd","expressions":{}}]},{"start":false,"name":"DialogFormSix","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"1db0cfd7-2ea3-4c26-b636-01be3d910e64","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"94489e19-4939-4ef0-97b9-188a32efd7cd","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"6d7f295f-3c0e-42f2-9e7f-e6ed0f1ad1b8"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Dialog Form</h4>","_auto_id_":"77c289da-eebb-4727-bd3b-e356862d8f81"}],"_auto_id_":"a6dc4df5-ad69-4e67-81b2-005a80865660","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"60066589-6775-4ef3-a1da-7a7414c8cca3","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"b50daf49-ee15-4369-bfb1-c52cbbdb8db6","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"8ec2d57b-f6cf-4d6b-896f-514d56ebac8b","content":"Appointment Type: {{'$store.variables.selected_visit.appointmentType.value '|store}}","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""},{"name":"button_page_count","type":"button","item-type":"button","_auto_id_":"6915567e-8d90-4713-bf0f-e46d62f3038c","content":"Page 6 of 14","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""}],"expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"cded166e-85f2-4dd2-9e80-44cef9ddf9e6","content":[{"name":"partnerFamilyTitle","type":"content","item-type":"html","_auto_id_":"67426ab3-d9bc-4d9d-bcbe-24d566550f11","content":"<h4>Partner / family</h4>\n<div class=\"rio_slider\" id=\"partnerFamilySummary\"></div>","expressions":{},"classes":""},{"name":"partnerFamilyGroup","type":"area","item-type":"group","_auto_id_":"622d41df-3a67-4411-bccc-546aa6bc648f","content":[{"name":"RSSatPL","type":"component","item-type":"web-component","content":"","componentId":"48eb4683-12b3-4299-a31e-d2f721d0fa7b","_auto_id_":"7770e508-a712-41d5-93b5-c6113842d058","attributes":{"questionText":"How satisfied are you with your relationship with your partner / family?","selectedValue":"cti.store.pages.DialogFormSix.RSSatPL"},"actions":[{"event":"radioPressed","type":"inline-function","data":{"sync":true,"code":"if ($store.pages.DialogFormSix === undefined) $store.pages.DialogFormSix = {};\n$store.pages.DialogFormSix.RSSatPL = $data.detail\n"},"_auto_id_":"fb0635a6-8753-4921-a257-7ceb06f16f6c"}],"expressions":{}},{"name":"RSSatHelp","type":"choice","item-type":"radio","_auto_id_":"2772bc1a-3c5f-4b75-87fe-f875f9024976","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{}},{"name":"RSSatActions","type":"user-input","item-type":"text","_auto_id_":"bd2be921-dbbe-403f-bce4-ccbe53e18fd6","label":"Relationship with partner/family goals and actions:","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$store.pages.DialogFormSix.RSSatHelp == '1'"},"validators":[]}],"repeat":false,"expressions":{},"classes":"accord"}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_previous","type":"button","item-type":"button","_auto_id_":"d8311f95-41e2-485d-b529-709cca366471","content":"PREVIOUS","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogFormFive\"})"},"_auto_id_":"d195bed1-94a3-412f-b312-ffbc003fc688","actions":[]}],"classes":"default"},{"name":"button_next","type":"button","item-type":"button","_auto_id_":"eef0fd5a-9446-4ae9-89bd-81e5f39db3fc","content":"NEXT","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogFormSeven\"})"},"_auto_id_":"8812719f-bb6f-4642-a674-17721345f9ce","actions":[]}],"classes":"default"}],"_auto_id_":"94ca7632-ff15-47d9-85e6-c251b703740e","expressions":{}}]},{"start":false,"name":"DialogFormSeven","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"65a4c6ed-2b2b-453c-960d-502eb053603e","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"17805efb-fa5a-49e3-b169-c514c67cdbcb","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"6b60d849-9da0-4937-b8c4-9d2e1976c3d3"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Dialog Form</h4>","_auto_id_":"94fd97c1-bc23-4018-bf44-0888a2e8750d"}],"_auto_id_":"35f68ee5-b963-4819-8905-613e6e571fe6","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"1c9821f7-6571-46e5-bfe1-e9d14f183d8d","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"c2f99c94-cbb6-4ef2-b386-4bb23999dae2","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"761883f3-928b-4737-a903-82d0cd8a3505","content":"Appointment Type: {{'$store.variables.selected_visit.appointmentType.value '|store}}","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""},{"name":"button_page_count","type":"button","item-type":"button","_auto_id_":"391d2234-c184-43aa-80f3-c9c32f12619d","content":"Page 7 of 14","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""}],"expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"dd7051ce-fe9e-4d9d-b72d-12ce747560de","content":[{"name":"friendshipsTitle","type":"content","item-type":"html","_auto_id_":"9a6fb03c-b5e8-415d-b814-242bd218ebf8","content":"<h4>Friendships</h4>\n<div class=\"rio_slider\" id=\"friendshipsSummary\"></div>","expressions":{},"classes":""},{"name":"friendshipsGroup","type":"area","item-type":"group","_auto_id_":"5f2d7e0c-ac39-48bd-834b-085fd750e897","content":[{"name":"FSSatPL","type":"component","item-type":"web-component","content":"","componentId":"48eb4683-12b3-4299-a31e-d2f721d0fa7b","_auto_id_":"2b35847d-6abf-419e-a592-baff47abc381","attributes":{"questionText":"How satisfied are you with your friendships?","selectedValue":"cti.store.pages.DialogFormSeven.FSSatPL"},"actions":[{"event":"radioPressed","type":"inline-function","data":{"sync":true,"code":"if ($store.pages.DialogFormSeven === undefined) $store.pages.DialogFormSeven = {};\n$store.pages.DialogFormSeven.FSSatPL = $data.detail\n\n"},"_auto_id_":"58cd595e-670a-4ca0-93fc-de74073d5a9a"}],"expressions":{}},{"name":"FSSatHelp","type":"choice","item-type":"radio","_auto_id_":"44aba8cb-77ee-470a-9d6a-e7995e62ed27","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{}},{"name":"FSSatActions","type":"user-input","item-type":"text","_auto_id_":"c12a850a-e568-407b-900f-e48b8a96022c","label":"Friendship goals and actions:","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$store.pages.DialogFormSeven.FSSatHelp == '1'"},"validators":[]}],"repeat":false,"expressions":{},"classes":"accord"}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_previous","type":"button","item-type":"button","_auto_id_":"833a26fb-576b-4cd8-a108-b863b3e74f46","content":"PREVIOUS","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogFormSix\"})"},"_auto_id_":"30f6ecae-e1c4-4e82-8cd8-4054e74548b8","actions":[]}],"classes":"default"},{"name":"button_next","type":"button","item-type":"button","_auto_id_":"b17e5b44-8838-4636-bfc4-d8fe07f2615f","content":"NEXT","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogFormEight\"})"},"_auto_id_":"74757df5-eabd-4986-a4df-5ab705ec2387","actions":[]}],"classes":"default"}],"_auto_id_":"2a6c5e49-0f2f-4961-a958-e544f4c62722","expressions":{}}]},{"start":false,"name":"DialogFormEight","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"9e2b9aef-e699-460d-9fb3-e875388d196c","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"cc4c166b-90a7-4dfa-aebf-504ecdad397b","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"99a2cde7-817a-438f-864a-43d9d534dcb1"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Dialog Form</h4>","_auto_id_":"a4c189eb-4541-465c-adc4-056645e58662"}],"_auto_id_":"e2f966dc-9a87-4b94-b938-32582f1bce2d","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"750eef2a-3ebc-4ded-b8c2-f099a690a672","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"f29970e1-76c1-4ca4-8266-3b74dfaba20c","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"a448853c-a6ac-4581-8bbf-ff52f92d1a92","content":"Appointment Type: {{'$store.variables.selected_visit.appointmentType.value '|store}}","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""},{"name":"button_page_count","type":"button","item-type":"button","_auto_id_":"a515074d-0445-4c96-8412-86d92308d9fa","content":"Page 8 of 14","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""}],"expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"cd9b7af7-62ee-4794-982a-64a9588657f7","content":[{"name":"personalSafetyTitle","type":"content","item-type":"html","_auto_id_":"a5afb497-ace9-4a3c-9350-7d77d7f08b08","content":"<h4>Personal safety</h4>\n<div class=\"rio_slider\" id=\"personalSafetySummary\"></div>","expressions":{},"classes":""},{"name":"personalSafetyGroup","type":"area","item-type":"group","_auto_id_":"cef2a4ca-2508-408b-afca-2136d4085523","content":[{"name":"PSSatPL","type":"component","item-type":"web-component","content":"","componentId":"48eb4683-12b3-4299-a31e-d2f721d0fa7b","_auto_id_":"39f60ba1-cde5-4f54-a7d4-3d32655e4579","attributes":{"questionText":"How satisfied are you with your personal safety?","selectedValue":"cti.store.pages.DialogFormEight.PSSatPL"},"actions":[{"event":"radioPressed","type":"inline-function","data":{"sync":true,"code":"if ($store.pages.DialogFormEight === undefined) $store.pages.DialogFormEight = {};\n$store.pages.DialogFormEight.PSSatPL = $data.detail\n"},"_auto_id_":"143e4920-4c07-41e0-942f-e321ae9fba70"}],"expressions":{}},{"name":"PSSatHelp","type":"choice","item-type":"radio","_auto_id_":"13aa3e1b-832a-4ff1-b420-f8ff2c34f110","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{}},{"name":"PSSatActions","type":"user-input","item-type":"text","_auto_id_":"bcc32c98-dd7d-4d4e-8d01-6ae763e12686","label":"Personal safety goals and actions:","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$store.pages.DialogFormEight.PSSatHelp == '1'"},"validators":[]}],"repeat":false,"expressions":{},"classes":"accord"}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_previous","type":"button","item-type":"button","_auto_id_":"d3655f2f-341e-4b19-b3c3-d2249455057c","content":"PREVIOUS","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogFormSeven\"})"},"_auto_id_":"bbd209c6-2840-491f-800b-211bc50dbb8b","actions":[]}],"classes":"default"},{"name":"button_next","type":"button","item-type":"button","_auto_id_":"c8872236-677e-48b9-9b2c-74df79afd4be","content":"NEXT","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogFormNine\"})"},"_auto_id_":"752be684-7786-496f-acaa-51eedea97377","actions":[]}],"classes":"default"}],"_auto_id_":"3d8457ff-28b1-409b-9cf0-634fe1b1d9a2","expressions":{}}]},{"start":false,"name":"DialogFormNine","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"1fec65bb-c7cd-456b-8cf9-8ee58285b64e","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"5fb34c12-5d4c-4d1a-876d-4a88e7fb239c","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"ca6a0f2a-bbad-4ab1-93f6-ae2754403b01"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Dialog Form</h4>","_auto_id_":"43b1754f-5c6c-4377-a034-db9656f5317e"}],"_auto_id_":"c4d032e0-0e0f-4c65-ab79-069bb2243e0e","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"f1a836bb-2f1a-46f2-be4c-6cc8e7340667","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"bfc47915-1c8c-4e85-8346-c073961d7949","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"641d03fc-ba59-4fcd-bf01-8acd323c2a98","content":"Appointment Type: {{'$store.variables.selected_visit.appointmentType.value '|store}}","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""},{"name":"button_page_count","type":"button","item-type":"button","_auto_id_":"4d572def-0e4d-4675-a0fa-b48ad1c40d46","content":"Page 9 of 14","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""}],"expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"d7322ce6-fd10-467c-a7c0-20cff0ebadf1","content":[{"name":"financesTitle","type":"content","item-type":"html","_auto_id_":"ad6bfe16-3d9c-47c0-9f46-eb608479c366","content":"<h4>Finances</h4>\n<div class=\"rio_slider\" id=\"financesSummary\"></div>","expressions":{},"classes":""},{"name":"financesGroup","type":"area","item-type":"group","_auto_id_":"06927f6c-9783-4c12-b1ca-9628caff2792","content":[{"name":"FISatPL","type":"component","item-type":"web-component","content":"","componentId":"48eb4683-12b3-4299-a31e-d2f721d0fa7b","_auto_id_":"38d4d9b0-ebe1-4d60-aa43-3aa145af13df","attributes":{"questionText":"How satisfied are you with your finances?","selectedValue":"cti.store.pages.DialogFormNine.FISatPL"},"actions":[{"event":"radioPressed","type":"inline-function","data":{"sync":true,"code":"if ($store.pages.DialogFormNine === undefined) $store.pages.DialogFormNine = {};\n$store.pages.DialogFormNine.FISatPL = $data.detail\n"},"_auto_id_":"8538f8bc-5439-405d-a5ed-dce320e4a40a"}],"expressions":{}},{"name":"FISatHelp","type":"choice","item-type":"radio","_auto_id_":"aa63805a-ef45-45d0-a0d6-2b271d0c9aae","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{}},{"name":"FISatActions","type":"user-input","item-type":"text","_auto_id_":"1fd6ca9c-83bc-4f75-a7fa-32fc000676b3","label":"Finance goals and actions:","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$store.pages.DialogFormNine.FISatHelp == '1'"},"validators":[]}],"repeat":false,"expressions":{},"classes":"accord"}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_previous","type":"button","item-type":"button","_auto_id_":"65f75d80-6ee9-40e2-9241-5dddf4fb204b","content":"PREVIOUS","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogFormEight\"})"},"_auto_id_":"3e303ca7-9a00-474c-9801-57df15b5eb9e","actions":[]}],"classes":"default"},{"name":"button_next","type":"button","item-type":"button","_auto_id_":"9fe4f765-d35f-4e5c-9838-97cd1cc36c4a","content":"NEXT","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogFormTen\"})"},"_auto_id_":"0a0105aa-6fbf-4b9c-b627-baac64ce5435","actions":[]}],"classes":"default"}],"_auto_id_":"30b58406-0b34-43e7-9d0c-4687a54ecc53","expressions":{}}]},{"start":false,"name":"DialogFormTen","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"7444eade-8a1d-4d1e-9e97-239a6397be58","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"9558e97e-f1ac-4594-8035-303527f20b1d","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"f56f360e-5670-4e1d-868c-33075220c0fb"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Dialog Form</h4>","_auto_id_":"f1f04499-0107-4276-8f59-7b8757d37742"}],"_auto_id_":"d7f7f62b-3dc8-4bde-ac86-f609e88a4fb4","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"a9f6aaa6-9350-4402-8d37-8deecaf40b24","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"a620e202-29f6-4fd7-a33f-2825b353e4c8","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"2e410b75-00a6-438b-8e9c-cb3f8b9867d7","content":"Appointment Type: {{'$store.variables.selected_visit.appointmentType.value '|store}}","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""},{"name":"button_page_count","type":"button","item-type":"button","_auto_id_":"046cd31b-10f5-49a8-93c5-fcfa68856261","content":"Page 10 of 14","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""}],"expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"6298f21f-a217-453b-8339-74af1480aaae","content":[{"name":"identityTitle","type":"content","item-type":"html","_auto_id_":"7ede98f5-bdce-483a-b2a6-a6c2da9800c6","content":"<h4>Identity</h4>\n<div class=\"rio_slider\" id=\"identitySummary\"></div>","expressions":{},"classes":""},{"name":"identityGroup","type":"area","item-type":"group","_auto_id_":"65794c99-b0c0-4409-9a05-911a35fd540c","content":[{"name":"CNSatPL","type":"component","item-type":"web-component","content":"","componentId":"48eb4683-12b3-4299-a31e-d2f721d0fa7b","_auto_id_":"6a15d231-eaa6-4873-bc5c-61ad838aac34","attributes":{"questionText":"How satisfied are you with your expression of identitiy?","selectedValue":"cti.store.pages.DialogFormTen.CNSatPL"},"actions":[{"event":"radioPressed","type":"inline-function","data":{"sync":true,"code":"if ($store.pages.DialogFormTen === undefined) $store.pages.DialogFormTen = {};\n$store.pages.DialogFormTen.CNSatPL = $data.detail\n"},"_auto_id_":"2d53c657-dd5c-4b3c-a301-b1ef3ce771bc"}],"expressions":{}},{"name":"CNSatHelp","type":"choice","item-type":"radio","_auto_id_":"5a16f3fc-9922-4083-a74a-efe65a5aebef","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{}},{"name":"CNSatActions","type":"user-input","item-type":"text","_auto_id_":"85938e27-3d6d-4098-b823-1ab641213aec","label":"Identity goals and actions:","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$store.pages.DialogFormTen.CNSatHelp == '1'"},"validators":[]}],"repeat":false,"expressions":{},"classes":"accord"}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_previous","type":"button","item-type":"button","_auto_id_":"cecfa45b-db1a-4b19-b78f-3d08e13158f7","content":"PREVIOUS","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogFormNine\"})"},"_auto_id_":"c09ad9b9-5a42-40d8-8c7d-836c37d6edc9","actions":[]}],"classes":"default"},{"name":"button_next","type":"button","item-type":"button","_auto_id_":"4a1e86d1-b094-4993-86e3-c38968f67ba9","content":"NEXT","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogFormEleven\"})"},"_auto_id_":"a3d3c0d2-c82b-40e1-abdb-4f5014172ca0","actions":[]}],"classes":"default"}],"_auto_id_":"a1ea10c9-8325-4800-9e32-674a685239a5","expressions":{}}]},{"start":false,"name":"DialogFormEleven","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"18d17204-cc45-41bd-9b8b-cb3e4db347fc","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"8f76438d-cbc8-41e0-9198-7564eca6e3c8","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"ab1ffd6e-2144-4eb2-974f-b8a11feab6d2"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Dialog Form</h4>","_auto_id_":"f180d52d-08ea-49da-bd6e-924595f8b1ad"}],"_auto_id_":"e4d46783-d1ca-4167-9275-5b8a65a35ea2","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"84cb4d19-e898-4597-8c29-af77353b8fe4","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"3fe0d7a4-1059-4028-bf21-ab2b96b95856","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"939851c0-e4b0-42bd-9130-7c305f579e49","content":"Appointment Type: {{'$store.variables.selected_visit.appointmentType.value '|store}}","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""},{"name":"button_page_count","type":"button","item-type":"button","_auto_id_":"519ebe6a-37a5-45fd-ae42-8590cd8b4e0d","content":"Page 11 of 14","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""}],"expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"a75e9635-9a2f-4c11-a669-bc79fc148697","content":[{"name":"substanceAlcoholTitle","type":"content","item-type":"html","_auto_id_":"99a494c3-fd59-4981-83fc-27e1100357e0","content":"<h4>Substance / alcohol</h4>\n<div class=\"rio_slider\" id=\"substanceAlcoholSummary\"></div>","expressions":{},"classes":""},{"name":"substanceAlcoholGroup","type":"area","item-type":"group","_auto_id_":"3c32aafe-0511-48d3-9da4-fb0c11a66f3c","content":[{"name":"SUSatPL","type":"component","item-type":"web-component","content":"","componentId":"48eb4683-12b3-4299-a31e-d2f721d0fa7b","_auto_id_":"dfb8a77f-d446-4bac-804e-e135d954f7e0","attributes":{"questionText":"How satisfied are you with your alcohol / substance use?","selectedValue":"cti.store.pages.DialogFormEleven.SUSatPL"},"actions":[{"event":"radioPressed","type":"inline-function","data":{"sync":true,"code":"if ($store.pages.DialogFormEleven === undefined) $store.pages.DialogFormEleven = {};\n$store.pages.DialogFormEleven.SUSatPL = $data.detail"},"_auto_id_":"8a8fbf32-0a5f-4782-a8fb-b0deecceaac1"}],"expressions":{}},{"name":"SUSatHelp","type":"choice","item-type":"radio","_auto_id_":"fefb0348-c0e3-4f79-bcf5-e875864b9eb5","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{}},{"name":"SUSatActions","type":"user-input","item-type":"text","_auto_id_":"d0256808-0019-4351-a66a-90ec3a5ec1fe","label":"Substance/alcohol goals and actions:","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$store.pages.DialogFormEleven.SUSatHelp == '1'"},"validators":[]}],"repeat":false,"expressions":{},"classes":"accord"}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_previous","type":"button","item-type":"button","_auto_id_":"6472fe4d-88de-41d8-af5c-a8103cff7515","content":"PREVIOUS","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogFormTen\"})"},"_auto_id_":"f688f92e-49d7-4d3b-9799-b5f6d8f50fa8","actions":[]}],"classes":"default"},{"name":"button_next","type":"button","item-type":"button","_auto_id_":"c430a16e-fde6-401a-be98-19a2f58529e9","content":"NEXT","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogFormTwelve\"})"},"_auto_id_":"14adf943-2dd7-43b8-930f-3cdfebcf383a","actions":[]}],"classes":"default"}],"_auto_id_":"83ce4a98-f25b-4ef6-a366-52924edbd071","expressions":{}}]},{"start":false,"name":"DialogFormTwelve","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"65acdeba-fd9d-4be1-94d2-05e59110a53e","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"dcdc9c6a-ab04-4d54-b674-ffa3e889752a","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"71295d1e-246b-4e7d-b761-00c6da18f465"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Dialog Form</h4>","_auto_id_":"53a64f1e-57c7-4e98-b31c-7fb5262c1ffb"}],"_auto_id_":"c55dfdc7-373b-4d54-bd1e-46ad86a2031e","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"01a93fc2-035f-4e7d-a294-8c3aab6c94bb","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"0d160add-bd36-43d6-9b58-7265431116a5","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"859fec59-2cf1-49a4-b28f-4700f13fd073","content":"Appointment Type: {{'$store.variables.selected_visit.appointmentType.value '|store}}","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""},{"name":"button_page_count","type":"button","item-type":"button","_auto_id_":"29eba02c-64c4-42f2-ab92-d95d3ce1794c","content":"Page 12 of 14","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""}],"expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"7a2657a0-f9d3-4904-9aed-23ea92e421d8","content":[{"name":"medicationTitle","type":"content","item-type":"html","_auto_id_":"6e307ed7-5ba8-43c5-98e5-754addf33b10","content":"<h4>Medication</h4>\n<div class=\"rio_slider\" id=\"medicationSummary\"></div>","expressions":{},"classes":""},{"name":"medicationGroup","type":"area","item-type":"group","_auto_id_":"7d569192-44a0-41c9-9488-12b9fcbf3717","content":[{"name":"MDSatPL","type":"component","item-type":"web-component","content":"","componentId":"48eb4683-12b3-4299-a31e-d2f721d0fa7b","_auto_id_":"f8277327-c88a-465e-ad81-22c203959b77","attributes":{"questionText":"How satisfied are you with your medication?","selectedValue":"cti.store.pages.DialogFormTwelve.MDSatPL"},"actions":[{"event":"radioPressed","type":"inline-function","data":{"sync":true,"code":"if ($store.pages.DialogFormTwelve === undefined) $store.pages.DialogFormTwelve = {};\n$store.pages.DialogFormTwelve.MDSatPL = $data.detail"},"_auto_id_":"9eff9f73-8877-4c06-b4e5-fd136435567e"}],"expressions":{}},{"name":"MDSatHelp","type":"choice","item-type":"radio","_auto_id_":"78393733-4d18-4c41-9734-e2542170855e","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{}},{"name":"MDSatActions","type":"user-input","item-type":"text","_auto_id_":"b0c75dd3-56c9-4f6e-8a92-0763444d2345","label":"Medication goals and actions:","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$store.pages.DialogFormTwelve.MDSatHelp == '1'"},"validators":[]}],"repeat":false,"expressions":{},"classes":"accord"}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_previous","type":"button","item-type":"button","_auto_id_":"b33012dd-8263-4522-93a1-2ee6fc65b04f","content":"PREVIOUS","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogFormEleven\"})"},"_auto_id_":"3e713592-2dc0-47c7-8f80-1987aa715b63","actions":[]}],"classes":"default"},{"name":"button_next","type":"button","item-type":"button","_auto_id_":"68a012b8-8def-4138-ad51-a92a9043cd1a","content":"NEXT","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogFormThirteen\"})"},"_auto_id_":"ae674234-aa07-44c4-905b-6e3e5252a3f0","actions":[]}],"classes":"default"}],"_auto_id_":"055be965-8247-409a-bf5d-5c072cf2f36c","expressions":{}}]},{"start":false,"name":"DialogFormThirteen","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"473be68e-4136-4355-bd97-0c191e8e213a","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"2d6f89ff-254a-4c85-b536-a5ffd523084b","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"bec9c405-0462-4013-b757-98e47ee639c0"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Dialog Form</h4>","_auto_id_":"e5e18a12-2786-4364-9455-cb5ff2ad6f71"}],"_auto_id_":"c2e61f1d-782f-4b87-8f18-9ddc3e225579","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"3c9ab1fb-33ab-4e56-8d19-cf999d3fec4e","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"d2892dea-d9fb-4a2c-ae98-0459f35fea8d","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"c9a416ce-0f46-4d9a-a482-7f761ed0441b","content":"Appointment Type: {{'$store.variables.selected_visit.appointmentType.value '|store}}","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""},{"name":"button_page_count","type":"button","item-type":"button","_auto_id_":"3d61a9e3-25b9-4c9a-9888-a7530db0d6a1","content":"Page 13 of 14","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""}],"expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"f939e576-934a-45f7-bea7-9a11a0d6f8df","content":[{"name":"practicalHelpTitle","type":"content","item-type":"html","_auto_id_":"8c4c9611-da36-4db4-b478-dbcf0f0c0cc0","content":"<h4>Practical Help</h4>\n<div class=\"rio_slider\" id=\"practicalHelpSummary\"></div>","expressions":{},"classes":""},{"name":"practicalHelpGroup","type":"area","item-type":"group","_auto_id_":"0de5a040-b90e-406d-bb8a-9eda3824fa6e","content":[{"name":"PRSatPL","type":"component","item-type":"web-component","content":"","componentId":"48eb4683-12b3-4299-a31e-d2f721d0fa7b","_auto_id_":"61f2578a-fcb0-4ea0-9f39-850ad6614930","attributes":{"questionText":"How satisfied are you with the practical help you receive?","selectedValue":"cti.store.pages.DialogFormThirteen.PRSatPL"},"actions":[{"event":"radioPressed","type":"inline-function","data":{"sync":true,"code":"if ($store.pages.DialogFormThirteen === undefined) $store.pages.DialogFormThirteen = {};\n$store.pages.DialogFormThirteen.PRSatPL = $data.detail"},"_auto_id_":"c4dbeeaf-adcd-4007-ac11-0b450187c51a"}],"expressions":{}},{"name":"PRSatHelp","type":"choice","item-type":"radio","_auto_id_":"18ea8e8f-f924-4e64-8a22-2e64224f4d05","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{}},{"name":"PRSatActions","type":"user-input","item-type":"text","_auto_id_":"3a6e1b16-6f82-4edf-94aa-3479153ca7a9","label":"Practical help goals and actions:","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$store.pages.DialogFormThirteen.PRSatHelp == '1'"},"validators":[]}],"repeat":false,"expressions":{},"classes":"accord"}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_previous","type":"button","item-type":"button","_auto_id_":"189f2616-8327-483c-88af-1ad4da794c1f","content":"PREVIOUS","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogFormTwelve\"})"},"_auto_id_":"364923fd-fa80-4660-b99c-9b4da4600acb","actions":[]}],"classes":"default"},{"name":"button_next","type":"button","item-type":"button","_auto_id_":"e5d070f6-b9fc-4c71-9fda-cf3d59810a1d","content":"NEXT","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogFormFourteen\"})"},"_auto_id_":"ef044b8f-e085-42eb-aa6d-73a8b8fab58d","actions":[]}],"classes":"default"}],"_auto_id_":"f8d73d9f-7e37-4696-9a5a-cae0d513e7c4","expressions":{}}]},{"start":false,"name":"DialogFormFourteen","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"c15998fe-cf8d-4d82-8149-0e11e6f224b5","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"7957b13e-1796-4225-a4ed-0a18b7a557ed","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"1583c43e-2331-4873-bebb-1e0c63b3fd43"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Dialog Form</h4>","_auto_id_":"602cb4d3-3566-47df-a35d-5c0314520c0b"}],"_auto_id_":"76edca62-3fda-466b-80ec-10180d188487","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"95bfa3fd-4e28-4a47-af18-8fc0fae9d8bd","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"47e1f1cf-4223-4bf9-b54a-beea19d46479","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"0c013390-47a7-4f08-aaa1-68ddb31d2833","content":"Appointment Type: {{'$store.variables.selected_visit.appointmentType.value '|store}}","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""},{"name":"button_page_count","type":"button","item-type":"button","_auto_id_":"6190234c-4972-418d-bc09-80dadc084340","content":"Page 14 of 14","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""}],"expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"34a6706f-8391-44fa-ae0b-010439997de2","content":[{"name":"mhpMeetingsTitle","type":"content","item-type":"html","_auto_id_":"36244d98-eddf-4160-9da1-910fecfebf2e","content":"<h4>Meetings</h4>\n<div class=\"rio_slider\" id=\"meetingsSummary\"></div>","expressions":{},"classes":""},{"name":"mhpMeetingsGroup","type":"area","item-type":"group","_auto_id_":"2cbe3764-033b-4da1-8d46-e1cdcdc8233a","content":[{"name":"MPSatPL","type":"component","item-type":"web-component","content":"","componentId":"48eb4683-12b3-4299-a31e-d2f721d0fa7b","_auto_id_":"fd44007a-956f-4459-be18-3128ca20dd3b","attributes":{"questionText":"How satisfied are you with your meetings with mental health professionals?","selectedValue":"cti.store.pages.DialogFormFourteen.MPSatPL"},"actions":[{"event":"radioPressed","type":"inline-function","data":{"sync":true,"code":"if ($store.pages.DialogFormFourteen === undefined) $store.pages.DialogFormFourteen = {};\n$store.pages.DialogFormFourteen.MPSatPL = $data.detail"},"_auto_id_":"dec53859-0c69-425d-8158-9353c6cbc045"}],"expressions":{}},{"name":"MPSatHelp","type":"choice","item-type":"radio","_auto_id_":"b78a1b4d-ca28-4aef-84fa-d66098ea4f23","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{}},{"name":"MPSatActions","type":"user-input","item-type":"text","_auto_id_":"4680a572-d6d5-4ecb-9df3-b09e716051f0","label":"Meetings with mental health professionals goals and actions:","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$store.pages.DialogFormFourteen.MPSatHelp == '1'"},"validators":[],"actions":[]}],"repeat":false,"expressions":{},"classes":"accord"}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_previous","type":"button","item-type":"button","_auto_id_":"4ceddecc-c903-4f54-b292-71e4e0f86fa6","content":"PREVIOUS","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogFormThirteen\"})"},"_auto_id_":"70dc46c3-0890-4d05-bf2e-ded6152870b5","actions":[]}],"classes":"default"},{"name":"button_save","type":"button","item-type":"button","_auto_id_":"9d459321-4cf2-41f8-9919-199a747059ea","content":"SAVE","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"call-actionflow\", { name: \"SubmitDialogForm\" })"},"_auto_id_":"d3b81a17-0541-46c1-ab6c-2d5320d012bf","actions":[]}],"classes":""}],"_auto_id_":"d32ce589-7894-4fe9-8799-7c6f0a85ac71","expressions":{}}]}],"actionflows":[{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'API Call: submitsafetyform - Sending...', \n  'info'\n)\n\ncti.fn_toggle_spinner('open', 'Submitting My Safety Form, please wait...');\n\n// Set payload\nvar payload = {\n  appointmentId : \"\",\n  clientId : {},\n  authorId : null,\n  AssessmentDate : \"\",\n  Triggers : \"\",\n  TriggersAP : \"\",\n  Contact : \"\",\n  ContReach : \"\",\n  OutofCrisis : \"\",\n  EarlyWS : \"\",\n  GetWorseAP : \"\",\n  GetWorse : \"\",\n  EarlyWSAP : \"\",\n  Decisions : \"\",\n  AdvDir : \"\",\n  SUAgree : \"\",\n  CrisisNo : \"\"\n}\n\n// Set variables for the safety form page, current appointment and\n// the payload submission object\nvar safetyForm = cti.store.pages.SafetyForm\nvar appointment = cti.store.variables.selected_visit\n\n// Set the clientId and AssessmentDate elements\npayload.appointmentId = appointment.appointmentId\npayload.clientId = appointment.attendees.attendee.clientId\npayload.AssessmentDate = moment().format('YYYY-MM-DD HH:mm:ss')\n\n// Check that we have a valid page source\nif(safetyForm === undefined) {\n  safetyForm = {}\n}\n\n// Check the Triggers input element\nif(safetyForm.sf_triggers) {\n  payload.Triggers = safetyForm.sf_triggers\n}\n// Check the Triggers Action Plan input element\nif(safetyForm.sf_triggers_actionplan) {\n  payload.TriggersAP = safetyForm.sf_triggers_actionplan\n}\n// Check the Contact input element\nif(safetyForm.sf_contact) {\n  payload.Contact = safetyForm.sf_contact\n}\n// Check the Contact Reachable input element\nif(safetyForm.sf_contactreach) {\n  payload.ContReach = safetyForm.sf_contactreach\n}\n// Check the Out of Crisis input element\nif(safetyForm.sf_outofcrisis) {\n  payload.OutofCrisis = safetyForm.sf_outofcrisis\n}\n// Check the Early Warning input element\nif(safetyForm.sf_earlyws) {\n  payload.EarlyWS = safetyForm.sf_earlyws\n}\n// Check the Getting Worse input element\nif(safetyForm.sf_getworse) {\n  payload.GetWorse = safetyForm.sf_getworse\n}\n// Check the Getting Worse Action Plan input element\nif(safetyForm.sf_getworse_actionplan) {\n  payload.GetWorseAP = safetyForm.sf_getworse_actionplan\n}\n// Check the Early Warnings Action Plan input element\nif(safetyForm.sf_earlyws_actionplan) {\n  payload.EarlyWSAP = safetyForm.sf_earlyws_actionplan\n}\n// Check the Decisions input element\nif(safetyForm.sf_assisteddecision) {\n  payload.Decisions = safetyForm.sf_assisteddecision\n}\n// Check the Advance Directive boolean\nif(safetyForm.sf_advancedirective) {\n  payload.AdvDir = \"True\"\n} else {\n  payload.AdvDir = \"False\"\n}\n// Check the Service User Agreed boolean\nif(safetyForm.sf_serviceuseragreedplan) {\n  payload.SUAgree = \"True\"\n} else {\n  payload.SUAgree = \"False\"\n}\n// Check the Crisis Number input element\nif(safetyForm.sf_crisisnumber) {\n  payload.CrisisNo = safetyForm.sf_crisisnumber\n}\n\n// Set the payload parameter in the store\ncti.store.variables.v_submitSafetyFormPayload = payload\n\nsetTimeout(function(){ \n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Visit\"})\n}, 3000)\n\n$success()"},"_auto_id_":"f0f462db-7d94-4ebc-9377-28d53d109ce7","actions":[]},{"event":"click","type":"call-offline-api","data":{"name":"api_rio_offline","operation":"submitsafetyform","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","payload":"{{$store.variables.v_submitSafetyFormPayload}}"}},"_auto_id_":"990edcc0-a830-43d9-91fa-ac9c39655ea8","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"// Grab response\nvar response = $data.$response\nvar selected_visit = cti.store.variables.selected_visit\n\nif(!response.success) {  \n  cti.fn_toggle_spinner('close')\n\n  window.logManager.consoleLog(\n    'API CALL: submitsafetyform FAILED - Reason: ' + response.message, \n    'error'\n  )\n\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\", \n    \"text\" : \"Unable to submit Safety Form: \" + response.message\n  })\n\n  cti.store.variables.selected_visit.safety_form_status = \"failed\";\n  cti.store.variables.selected_visit.safety_form_status_text = \"Failed to Upload My Safety Plan, tap to retry...\";\n} else {\n  window.logManager.consoleLog(\n    'API CALL: submitsafetyform SUCCESS', \n    'info'\n  )\n\n  var currentFormLength = 0\n\n  if(selected_visit && selected_visit.attendees.attendee.clientId.value == response.clientId.value) {\n    currentFormLength = cti.store.variables.selected_visit.patientData.mySafetyPlanForms.length\n\n    if(response.data != undefined && response.data.length >= currentFormLength) {\n      cti.store.variables.selected_visit.patientData.mySafetyPlanForms = response.data\n    }\n\n    for (var i in cti.store.variables.selected_visit.patientData.mySafetyPlanForms) {\n      var safetyForm = cti.store.variables.selected_visit.patientData.mySafetyPlanForms[i];\n\n      safetyForm.assessmentDate.displayDate = moment(safetyForm.assessmentDate.result).format(\"DD MMM YYYY HH:mm\");\n    }\n\n    cti.store.variables.selected_visit.safety_form_status = \"complete\";\n    cti.store.variables.selected_visit.safety_form_status_text = \"Completed\";\n\n    delete cti.store.variables.selected_visit.safety_form_page\n    cti.store.variables.v_submitSafetyFormPayload_clear = true\n  } else {\n    cti.fn_update_patient_data(response.clientId.value, 'safety', response.data, response.appointmentId)\n  }\n\n  delete cti.store.variables.v_submitSafetyFormPayload\n}\n\ndelete cti.store.api.api_rio.submitsafetyform\ncti.utils.updatePage()"},"_auto_id_":"47b6507d-5dfe-4f48-9053-6f7d482daaa0"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"var response = $data.$response\n\nwindow.logManager.consoleLog(\n  'API CALL: submitsafetyform FAILED - Reason: ' + response.message, \n  'error'\n)\n\n// Notifiy user of failed submission\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\", \n  \"text\" : \"Unable to submit Safety Form: \" + response.message\n})\n\n// Set status to failed\ncti.store.variables.selected_visit.safety_form_status = \"failed\";\ncti.store.variables.selected_visit.safety_form_status_text = \"Failed to Upload My Safety Plan, tap to retry...\";\n\n//cti.fn_toggle_spinner('close')\n//cti.utils.callAction(\"go-to-page\", { \"name\": \"Visit\" })\n\ndelete cti.store.api.api_rio.submitsafetyform\ncti.utils.updatePage()"},"_auto_id_":"29d7700d-cfac-435c-a080-2976fe8521cb"}]}],"name":"SubmitSafetyForm"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'API Call: submitdialogForm - Sending...', \n  'info'\n)\n\ncti.fn_toggle_spinner('open', 'Submitting Dialog+ Form, please wait...');\n\n// Set payload\nvar payload = {\n  appointmentId : \"\",\n  clientId : {},\n  authorId : null,\n  AssessmentDate : \"\",\n  MHSkills :  \"\",\n  SUCap : \"\",\n  RCYN : \"\",\n  SUYN : \"\",\n  MHRecovery : \"\",\n  MHMatters : \"\",\n  MHSatActions : \"\",\n  PHSatActions : \"\",\n  JSSatActions : \"\",\n  LASatActions : \"\",\n  RSSatActions : \"\",\n  FSSatActions : \"\",\n  PSSatActions : \"\",\n  FISatActions : \"\",\n  CNSatActions : \"\",\n  SUSatActions : \"\",\n  MDSatActions : \"\",\n  PRSatActions : \"\",\n  MPSatActions : \"\",\n  JSSatPL : \"\",\n  PHSatPL : \"\",\n  ACSatPL : \"\",\n  LASatPL : \"\",\n  RSSatPL : \"\",\n  FSSatPL : \"\",\n  PSSatPL : \"\",\n  FISatPL : \"\",\n  SUSatPL : \"\",\n  CNSatPL : \"\",\n  MDSatPL : \"\",\n  PRSatPL : \"\",\n  MPSatPL : \"\",\n  MHSat1 : \"\",\n  ACSatActions : \"\",\n  RevUnplan : \"\",\n  CareDecUnplan : \"\",\n  CareDec : \"\",\n  InCareDec : \"\",\n  Funded : \"\",\n  SUDisagree : \"\",\n  StageTreat : \"\",\n  StageTreat1 : \"\",\n  NxtRev : \"\",\n  S117Comm : \"\",\n  CarerView : \"\",\n  MHSatHelp : \"\",\n  JSSatHelp : \"\",\n  ACSatHelp : \"\",\n  LASatHelp : \"\",\n  RSSatHelp : \"\",\n  FSSatHelp : \"\",\n  PSSatHelp : \"\",\n  FISatHelp : \"\",\n  CNSatHelp : \"\",\n  SUSatHelp : \"\",\n  MDSatHelp : \"\",\n  PRSatHelp : \"\",\n  MPSatHelp : \"\",\n  PHSatHelp : \"\",\n  CPAAttend : [\n    {\n      CPAAttendRow : {\n        Design : \"\",\n        Name : \"\",\n        SentCopy : \"\",\n        YNPresent :  \"\"\n      }\n    }\t\n  ]\n}\n\n// Set variables for the form page, current appointment and\n// the payload submission object\nvar dialogForms = []\n\nvar dialogFormPre = cti.store.pages.DialogFormPre || {}\ndialogForms.push(dialogFormPre)\n\nvar dialogFormOne = cti.store.pages.DialogFormOne || {}\ndialogForms.push(dialogFormOne)\n\nvar dialogFormTwo = cti.store.pages.DialogFormTwo || {}\ndialogForms.push(dialogFormTwo)\n\nvar dialogFormThree = cti.store.pages.DialogFormThree || {}\ndialogForms.push(dialogFormThree)\n\nvar dialogFormFour = cti.store.pages.DialogFormFour || {}\ndialogForms.push(dialogFormFour)\n\nvar dialogFormFive = cti.store.pages.DialogFormFive || {}\ndialogForms.push(dialogFormFive)\n\nvar dialogFormSix = cti.store.pages.DialogFormSix || {}\ndialogForms.push(dialogFormSix)\n\nvar dialogFormSeven = cti.store.pages.DialogFormSeven || {}\ndialogForms.push(dialogFormSeven)\n\nvar dialogFormEight = cti.store.pages.DialogFormEight || {}\ndialogForms.push(dialogFormEight)\n\nvar dialogFormNine = cti.store.pages.DialogFormNine || {}\ndialogForms.push(dialogFormNine)\n\nvar dialogFormTen = cti.store.pages.DialogFormTen || {}\ndialogForms.push(dialogFormTen)\n\nvar dialogFormEleven = cti.store.pages.DialogFormEleven || {}\ndialogForms.push(dialogFormEleven)\n\nvar dialogFormTwelve = cti.store.pages.DialogFormTwelve || {}\ndialogForms.push(dialogFormTwelve)\n\nvar dialogFormThirteen = cti.store.pages.DialogFormThirteen || {}\ndialogForms.push(dialogFormThirteen)\n\nvar dialogFormFourteen = cti.store.pages.DialogFormFourteen || {}\ndialogForms.push(dialogFormFourteen)\n\nvar dialogForm = dialogForms.reduce(function(result, currentObject) {\n  for(var key in currentObject) {\n    if (currentObject.hasOwnProperty(key)) {\n      result[key] = currentObject[key]\n    }\n  }\n\n  return result\n}, {})\n\nvar appointment = cti.store.variables.selected_visit\n\n// Set the clientId and AssessmentDate elements\npayload.appointmentId = appointment.appointmentId\npayload.clientId = appointment.attendees.attendee.clientId\npayload.AssessmentDate = moment().format('YYYY-MM-DD HH:mm:ss')\n\n// Check that we have a valid page source\nif(dialogForm === undefined) {\n  dialogForm = {}\n}\n\nif(dialogForm.MHSkills) { payload.MHSkills = dialogForm.MHSkills }\n\nif(dialogForm.SUCap) { payload.SUCap = dialogForm.SUCap.value }\n\nif(dialogForm.RCYN) { payload.RCYN = dialogForm.RCYN }\n\nif(dialogForm.SUYN) { payload.SUYN = dialogForm.SUYN }\n\nif(dialogForm.MHRecovery) { payload.MHRecovery = dialogForm.MHRecovery }\n\nif(dialogForm.MHMatters) { payload.MHMatters = dialogForm.MHMatters }\n\nif(dialogForm.MHSatActions) { payload.MHSatActions = dialogForm.MHSatActions }\n\nif(dialogForm.PHSatActions) { payload.PHSatActions = dialogForm.PHSatActions }\n\nif(dialogForm.JSSatActions) { payload.JSSatActions = dialogForm.JSSatActions }\n\nif(dialogForm.LASatActions) { payload.LASatActions = dialogForm.LASatActions }\n\nif(dialogForm.RSSatActions) { payload.RSSatActions = dialogForm.RSSatActions }\n\nif(dialogForm.FSSatActions) { payload.FSSatActions = dialogForm.FSSatActions }\n\nif(dialogForm.PSSatActions) { payload.PSSatActions = dialogForm.PSSatActions }\n\nif(dialogForm.FISatActions) { payload.FISatActions = dialogForm.FISatActions }\n\nif(dialogForm.CNSatActions) { payload.CNSatActions = dialogForm.CNSatActions }\n\nif(dialogForm.SUSatActions) { payload.SUSatActions = dialogForm.SUSatActions }\n\nif(dialogForm.MDSatActions) { payload.MDSatActions = dialogForm.MDSatActions }\n\nif(dialogForm.PRSatActions) { payload.PRSatActions = dialogForm.PRSatActions }\n\nif(dialogForm.MPSatActions) { payload.MPSatActions = dialogForm.MPSatActions }\n\nif(dialogForm.JSSatPL) { payload.JSSatPL = dialogForm.JSSatPL }\nelse { payload.JSSatPL = \"1\" }\n\nif(dialogForm.PHSatPL) { payload.PHSatPL = dialogForm.PHSatPL }\nelse { payload.PHSatPL = \"1\" }\n\nif(dialogForm.ACSatPL) { payload.ACSatPL = dialogForm.ACSatPL }\nelse { payload.ACSatPL = \"1\" }\n\nif(dialogForm.LASatPL) { payload.LASatPL = dialogForm.LASatPL }\nelse { payload.LASatPL = \"1\" }\n\nif(dialogForm.RSSatPL) { payload.RSSatPL = dialogForm.RSSatPL }\nelse { payload.RSSatPL = \"1\" }\n\nif(dialogForm.FSSatPL) { payload.FSSatPL = dialogForm.FSSatPL }\nelse { payload.FSSatPL = \"1\" }\n\nif(dialogForm.PSSatPL) { payload.PSSatPL = dialogForm.PSSatPL }\nelse { payload.PSSatPL = \"1\" }\n\nif(dialogForm.FISatPL) { payload.FISatPL = dialogForm.FISatPL }\nelse { payload.FISatPL = \"1\" }\n\nif(dialogForm.SUSatPL) { payload.SUSatPL = dialogForm.SUSatPL }\nelse { payload.SUSatPL = \"1\" }\n\nif(dialogForm.CNSatPL) { payload.CNSatPL = dialogForm.CNSatPL }\nelse { payload.CNSatPL = \"1\" }\n\nif(dialogForm.MDSatPL) { payload.MDSatPL = dialogForm.MDSatPL }\nelse { payload.MDSatPL = \"1\" }\n\nif(dialogForm.PRSatPL) { payload.PRSatPL = dialogForm.PRSatPL }\nelse { payload.PRSatPL = \"1\" }\n\nif(dialogForm.MPSatPL) { payload.MPSatPL = dialogForm.MPSatPL }\nelse { payload.MPSatPL = \"1\" }\n\nif(dialogForm.MHSat1) { payload.MHSat1 = dialogForm.MHSat1 }\nelse { payload.MHSat1 = \"1\" }\n\nif(dialogForm.ACSatActions) { payload.ACSatActions = dialogForm.ACSatActions }\n\nif(dialogForm.RevUnplan) { payload.RevUnplan = dialogForm.RevUnplan }\n\nif(dialogForm.CareDecUnplan) { payload.CareDecUnplan = dialogForm.CareDecUnplan }\n\nif(dialogForm.CareDec) { payload.CareDec = dialogForm.CareDec }\n\nif(dialogForm.InCareDec) { payload.InCareDec = dialogForm.InCareDec.value }\n\nif(dialogForm.Funded) { payload.Funded = dialogForm.Funded }\n\nif(dialogForm.SUDisagree) { payload.SUDisagree = dialogForm.SUDisagree }\n\nif(dialogForm.StageTreat) { payload.StageTreat = dialogForm.StageTreat }\n\nif(dialogForm.StageTreat1) { payload.StageTreat1 = dialogForm.StageTreat1.value }\n\nif(dialogForm.NxtRev) { payload.NxtRev = dialogForm.NxtRev }\n\nif(dialogForm.S117Comm) { payload.S117Comm = dialogForm.S117Comm }\n\nif(dialogForm.CarerView) { payload.CarerView = dialogForm.CarerView }\n\nif(dialogForm.MHSatHelp) { payload.MHSatHelp = dialogForm.MHSatHelp }\n\nif(dialogForm.JSSatHelp) { payload.JSSatHelp = dialogForm.JSSatHelp }\n\nif(dialogForm.ACSatHelp) { payload.ACSatHelp = dialogForm.ACSatHelp }\n\nif(dialogForm.LASatHelp) { payload.LASatHelp = dialogForm.LASatHelp }\n\nif(dialogForm.RSSatHelp) { payload.RSSatHelp = dialogForm.RSSatHelp }\n\nif(dialogForm.FSSatHelp) { payload.FSSatHelp = dialogForm.FSSatHelp }\n\nif(dialogForm.PSSatHelp) { payload.PSSatHelp = dialogForm.PSSatHelp }\n\nif(dialogForm.FISatHelp) { payload.FISatHelp = dialogForm.FISatHelp }\n\nif(dialogForm.CNSatHelp) { payload.CNSatHelp = dialogForm.CNSatHelp }\n\nif(dialogForm.SUSatHelp) { payload.SUSatHelp = dialogForm.SUSatHelp }\n\nif(dialogForm.MDSatHelp) { payload.MDSatHelp = dialogForm.MDSatHelp }\n\nif(dialogForm.PRSatHelp) { payload.PRSatHelp = dialogForm.PRSatHelp }\n\nif(dialogForm.MPSatHelp) { payload.MPSatHelp = dialogForm.MPSatHelp }\n\nif(dialogForm.PHSatHelp) { payload.PHSatHelp = dialogForm.PHSatHelp }\n\n// Set the payload parameter in the store\ncti.store.variables.v_submitDialogFormPayload = payload\n\nsetTimeout(function(){ \n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Visit\"})\n}, 3000)\n\n$success()"},"_auto_id_":"b4a9ac90-6907-4dca-8240-1052014ecfb0","actions":[]},{"event":"click","type":"call-offline-api","data":{"name":"api_rio_offline","operation":"submitdialogform","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","payload":"{{$store.variables.v_submitDialogFormPayload}}"}},"_auto_id_":"bfd68fc7-b788-42dd-8fb1-3e46ce090759","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"// Dialog response\nvar response = $data.$response\nvar selected_visit = cti.store.variables.selected_visit\n\nif(!response.success) {  \n  cti.fn_toggle_spinner('close')\n\n  window.logManager.consoleLog(\n    'API CALL: submitdialogform FAILED - Reason: ' + response.message, \n    'error'\n  )\n\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Dialog+ Form Submission Failed\", \n    \"text\" : \"Unable to submit Dialog+ Form: \" + response.message\n  })\n\n  cti.store.variables.selected_visit.dialog_form_status = \"failed\";\n  cti.store.variables.selected_visit.dialog_form_status_text = \"Failed to Upload Dialog+, tap to retry...\";\n} else {\n  window.logManager.consoleLog(\n    'API CALL: submitdialogform SUCCESS', \n    'info'\n  )\n\n  var currentFormLength = 0\n\n  if(selected_visit && selected_visit.attendees.attendee.clientId.value == response.clientId.value) {\n    currentFormLength = cti.store.variables.selected_visit.patientData.dialogPlusForms.length\n\n    if(response.data != undefined && response.data.length >= currentFormLength) {\n      cti.store.variables.selected_visit.patientData.dialogPlusForms = response.data\n    }\n\n    for (var i in cti.store.variables.selected_visit.patientData.dialogPlusForms) {\n      var dialogForm = cti.store.variables.selected_visit.patientData.dialogPlusForms[i];\n\n      dialogForm.assessmentDate.displayDate = moment(dialogForm.assessmentDate.result).format(\"DD MMM YYYY HH:mm\");\n    }\n\n    cti.store.variables.selected_visit.dialog_form_status = \"complete\";\n    cti.store.variables.selected_visit.dialog_form_status_text = \"Completed\";\n\n    delete cti.store.variables.selected_visit.dialog_form_page\n    cti.store.variables.v_submitDialogFormPayload_clear = true\n  } else {\n    cti.fn_update_patient_data(response.clientId.value, 'dialog', response.data, response.appointmentId)\n  }\n\n  delete cti.store.variables.v_submitDialogFormPayload\n}\n\ndelete cti.store.api.api_rio.submitdialogform\n\ncti.utils.updatePage()"},"_auto_id_":"947ab400-e860-4382-b4e9-f689fad177a2"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"var response = $data.$response\n\nwindow.logManager.consoleLog(\n  'API CALL: submitdialogform FAILED - Reason: ' + response.message, \n  'error'\n)\n\n// Notify the user of failed submission\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\", \n  \"text\" : \"Unable to submit Dialog+ Form: \" + response.message\n})\n\n// Set status to failed\ncti.store.variables.selected_visit.dialog_form_status = \"failed\";\ncti.store.variables.selected_visit.dialog_form_status_text = \"Failed to Upload Dialog+, tap to retry...\";\n\n//cti.fn_toggle_spinner('close')\n//cti.utils.callAction(\"go-to-page\", { \"name\": \"Visit\" })\n\ndelete cti.store.api.api_rio.submitdialogform\n\ncti.utils.updatePage()"},"_auto_id_":"1a8b62df-e9f1-45d0-b5dd-7e245aabdc3f"}]}],"name":"SubmitDialogForm"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'API Call: submitlifestyleform - Sending...', \n  'info'\n)\n\ncti.fn_toggle_spinner('open', 'Submitting Lifestyle Form, please wait...');\n\n// Set payload\nvar payload = {\n  appointmentId : \"\",\n  clientId : {},\n  authorId : null,\n  admissionassess : \"\",\n  AssessmentDate : \"\",\n  assessmentstatus : \"\",\n  lssmoked : \"\",\n  lscigperday : \"\",\n  smokeadvice : \"\",\n  Refsmoke : \"\",\n  StopSmoke : \"\",\n  smokeintoffer : \"\",\n  smokefreetext1 : \"\",\n  diethealthy : \"\",\n  lsdietcomment : \"\",\n  dietintervention : \"\",\n  dietintdetails : \"\",\n  regularexercise : \"\",\n  exintoffer : \"\",\n  intdetails : \"\",\n  alcCurrentUser : \"\",\n  withdrawal : \"\",\n  alcHowOften : \"\",\n  alcHowManyUnits : \"\",\n  alcExceedUnits : \"\",\n  alcIntervention : \"\",\n  alcintdetail : \"\",\n  alcFurtherInfo : \"\",\n  recdruguse : \"\",\n  drugintoffer : \"\",\n  drugintdetails : \"\",\n  menwellbeing : \"\",\n  signpost : \"\",\n  signdetail : \"\",\n  addcomm : \"\",\n  exercise: [],\n  recdrugstab: []\n}\n\n// Set variables for the form page, current appointment and\n// the payload submission object\nvar lifestyleForms = []\nvar lifestyleFormOne = cti.store.pages.LifestyleFormOne\nlifestyleForms.push(lifestyleFormOne)\nvar lifestyleFormTwo = cti.store.pages.LifestyleFormTwo\nlifestyleForms.push(lifestyleFormTwo)\nvar lifestyleFormThree = cti.store.pages.LifestyleFormThree\nlifestyleForms.push(lifestyleFormThree)\nvar lifestyleFormFour = cti.store.pages.LifestyleFormFour\nlifestyleForms.push(lifestyleFormFour)\nvar lifestyleFormFive = cti.store.pages.LifestyleFormFive\nlifestyleForms.push(lifestyleFormFive)\nvar lifestyleFormSix = cti.store.pages.LifestyleFormSix\nlifestyleForms.push(lifestyleFormSix)\n\nvar lifestyleForm = lifestyleForms.reduce(function(result, currentObject) {\n    for(var key in currentObject) {\n        if (currentObject.hasOwnProperty(key)) {\n            result[key] = currentObject[key]\n        }\n    }\n  \n    return result\n}, {})\n\nvar appointment = cti.store.variables.selected_visit\nvar repeater = cti.store.repeater\n\nif(repeater && repeater.LifestyleFormThree && repeater.LifestyleFormThree.exercise_repeater) {\n  var lifestyleExerciseRepeater = JSON.parse(JSON.stringify(repeater.LifestyleFormThree.exercise_repeater))\n}\nif(repeater && repeater.LifestyleFormFive && repeater.LifestyleFormFive.drugs_group) {\n  var lifestyleDrugRepeater = JSON.parse(JSON.stringify(repeater.LifestyleFormFive.drugs_group))\n}\n\n// Set the clientId and AssessmentDate elements\npayload.appointmentId = appointment.appointmentId\npayload.clientId = appointment.attendees.attendee.clientId\npayload.AssessmentDate = moment().format('YYYY-MM-DD HH:mm:ss')\n\n// Check that we have a valid page source\nif(lifestyleForm === undefined) {\n  lifestyleForm = {}\n}\n\n// Check the admissionassess input element\nif(lifestyleForm.admissionassess) {\n  payload.admissionassess = lifestyleForm.admissionassess\n}\n// Check the assessmentstatus input element\nif(lifestyleForm.assessmentstatus) {\n  payload.assessmentstatus = lifestyleForm.assessmentstatus.value\n}\n// Check the lssmoked input element\nif(lifestyleForm.lssmoked) {\n  payload.lssmoked = lifestyleForm.lssmoked.value\n}\n// Check the lscigperday input element\nif(lifestyleForm.lscigperday) {\n  payload.lscigperday = lifestyleForm.lscigperday\n}\n// Check the smokeadvice input element\nif(lifestyleForm.smokeadvice) {\n  payload.smokeadvice = lifestyleForm.smokeadvice\n}\n// Check the Refsmoke input element\nif(lifestyleForm.Refsmoke) {\n  payload.Refsmoke = lifestyleForm.Refsmoke.value\n}\n// Check the StopSmoke input element\nif(lifestyleForm.StopSmoke) {\n  payload.StopSmoke = lifestyleForm.StopSmoke.value\n}\n// Check the smokeintoffer input element\nif(lifestyleForm.smokeintoffer) {\n  payload.smokeintoffer = lifestyleForm.smokeintoffer.value\n}\n// Check the smokefreetext1 input element\nif(lifestyleForm.smokefreetext1) {\n  payload.smokefreetext1 = lifestyleForm.smokefreetext1\n}\n// Check the diethealthy input element\nif(lifestyleForm.diethealthy) {\n  payload.diethealthy = lifestyleForm.diethealthy.value\n}\n// Check the lsdietcomment input element\nif(lifestyleForm.lsdietcomment) {\n  payload.lsdietcomment = lifestyleForm.lsdietcomment\n}\n// Check the dietintervention input element\nif(lifestyleForm.dietintervention) {\n  payload.dietintervention = lifestyleForm.dietintervention.value\n}\n// Check the dietintdetails input element\nif(lifestyleForm.dietintdetails) {\n  payload.dietintdetails = lifestyleForm.dietintdetails\n}\n// Check the regularexercise input element\nif(lifestyleForm.regularexcercise) {\n  payload.regularexercise = lifestyleForm.regularexcercise.value\n}\n// Check the exintoffer input element\nif(lifestyleForm.exintoffer) {\n  payload.exintoffer = lifestyleForm.exintoffer.value\n}\n// Check the intdetails input element\nif(lifestyleForm.intdetails) {\n  payload.intdetails = lifestyleForm.intdetails\n}\n// Check the alcCurrentUser input element\nif(lifestyleForm.alcCurrentUser) {\n  payload.alcCurrentUser = lifestyleForm.alcCurrentUser\n}\n// Check the withdrawal input element\nif(lifestyleForm.withdrawal) {\n  payload.withdrawal = lifestyleForm.withdrawal\n}\n// Check the alcHowOften input element\nif(lifestyleForm.alcHowOften) {\n  payload.alcHowOften = lifestyleForm.alcHowOften.value\n}\n// Check the alcHowManyUnits input element\nif(lifestyleForm.alcHowManyUnits) {\n  payload.alcHowManyUnits = lifestyleForm.alcHowManyUnits.value\n}\n// Check the alcExceedUnits input element\nif(lifestyleForm.alcExceedUnits) {\n  payload.alcExceedUnits = lifestyleForm.alcExceedUnits.value\n}\n// Check the alcIntervention input element\nif(lifestyleForm.alcIntervention) {\n  payload.alcIntervention = lifestyleForm.alcIntervention.value\n}\n// Check the alcintdetail input element\nif(lifestyleForm.alcintdetail) {\n  payload.alcintdetail = lifestyleForm.alcintdetail\n}\n// Check the alcFurtherInfo input element\nif(lifestyleForm.alcFurtherInfo) {\n  payload.alcFurtherInfo = lifestyleForm.alcFurtherInfo\n}\n// Check the recdruguse input element\nif(lifestyleForm.recdruguse) {\n  payload.recdruguse = lifestyleForm.recdruguse.value\n}\n// Check the drugintoffer input element\nif(lifestyleForm.drugintoffer) {\n  payload.drugintoffer = lifestyleForm.drugintoffer.value\n}\n// Check the drugintdetails input element\nif(lifestyleForm.drugintdetails) {\n  payload.drugintdetails = lifestyleForm.drugintdetails\n}\n// Check the menwellbeing input element\nif(lifestyleForm.menwellbeing) {\n  payload.menwellbeing = lifestyleForm.menwellbeing.value\n}\n// Check the signpost input element\nif(lifestyleForm.signpost) {\n  payload.signpost = lifestyleForm.signpost.value\n}\n// Check the signdetail input element\nif(lifestyleForm.signdetail) {\n  payload.signdetail = lifestyleForm.signdetail\n}\n// Check the addcomm input element\nif(lifestyleForm.addcomm) {\n  payload.addcomm = lifestyleForm.addcomm\n}\n\n// Have a shufty thru the repeated form elements\nif (lifestyleDrugRepeater && Object.keys(lifestyleDrugRepeater).length  > 0) {\n  for (var i=0, tot=Object.keys(lifestyleDrugRepeater).length; i < tot; i++) {\n    var temp_recdrugstabRow = {}\n    temp_recdrugstabRow.recdrugstabRow = {}\n    temp_recdrugstabRow.recdrugstabRow = lifestyleDrugRepeater[i]\n    //temp_recdrugstabRow.recdrugstabRow.drugname = temp_recdrugstabRow.recdrugstabRow.drugname.value\n    temp_recdrugstabRow.recdrugstabRow.drugname = lifestyleDrugRepeater[i].drugname.value\n        payload.recdrugstab.push(temp_recdrugstabRow)\n  }\n}\n\nif (lifestyleExerciseRepeater && Object.keys(lifestyleExerciseRepeater).length > 0) {\n  for (var i=0, tot=Object.keys(lifestyleExerciseRepeater).length; i < tot; i++) {\n    var temp_exerciseRow = {}\n    temp_exerciseRow.exerciseRow = {}\n    temp_exerciseRow.exerciseRow = lifestyleExerciseRepeater[i]\n    //temp_exerciseRow.exerciseRow.Intensity = temp_exerciseRow.exerciseRow.Intensity.value\n    temp_exerciseRow.exerciseRow.Intensity = lifestyleExerciseRepeater[i].Intensity.value\n        payload.exercise.push(temp_exerciseRow)\n  }\n}\n\n// Set the payload parameter in the store\ncti.store.variables.v_submitlifestyleFormPayload = payload\n\nsetTimeout(function(){ \n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Visit\"})\n}, 3000)\n\n$success()"},"_auto_id_":"ed99101c-c19b-4e4f-b49a-7b8dcb67a365","actions":[]},{"event":"click","type":"call-offline-api","data":{"name":"api_rio_offline","operation":"submitlifestyleform","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","payload":"{{$store.variables.v_submitlifestyleFormPayload}}"}},"_auto_id_":"7b3f526b-93fa-4994-a47b-14286fc2864a","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"// Grab response\nvar response = $data.$response\nvar selected_visit = cti.store.variables.selected_visit\n\nif(!response.success) {  \n  cti.fn_toggle_spinner('close')\n\n  window.logManager.consoleLog(\n    'API CALL: submitlifestyleform FAILED - Reason: ' + response.message, \n    'error'\n  )\n\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\", \n    \"text\" : \"Unable to submit Lifestyle Form: \" + response.message\n  })\n\n  cti.store.variables.selected_visit.lifestyle_form_status = \"failed\";\n  cti.store.variables.selected_visit.lifestyle_form_status_text = \"Failed to Upload Lifestyle Form data, tap to retry...\";\n\n  cti.utils.callAction(\"go-to-page\", { \"name\": \"Visit\" })\n} else {\n  window.logManager.consoleLog(\n    'API CALL: submitlifestyleform SUCCESS', \n    'info'\n  )\n  var currentFormLength = 0\n\n  if(selected_visit && selected_visit.attendees.attendee.clientId.value == response.clientId.value) {\n    currentFormLength = cti.store.variables.selected_visit.patientData.lifestyleAssessmentForms.length\n\n    if(response.data != undefined && response.data.length >= currentFormLength) {\n      cti.store.variables.selected_visit.patientData.lifestyleAssessmentForms = response.data\n    }\n\n    for (var i in cti.store.variables.selected_visit.patientData.lifestyleAssessmentForms) {\n      var lifestyleForm = cti.store.variables.selected_visit.patientData.lifestyleAssessmentForms[i]\n      var date = lifestyleForm.assessmentDate.result\n\n      lifestyleForm.assessmentDate.displayDate = moment(date).format(\"DD MMM YYYY HH:mm\")\n    }\n    cti.store.variables.selected_visit.lifestyle_form_status = \"complete\"\n    cti.store.variables.selected_visit.lifestyle_form_status_text = \"Completed\"\n\n    delete cti.store.variables.selected_visit.lifestyle_form_page_one\n    delete cti.store.variables.selected_visit.lifestyle_form_page_two\n    delete cti.store.variables.selected_visit.lifestyle_form_page_three\n    delete cti.store.variables.selected_visit.lifestyle_form_page_four\n    delete cti.store.variables.selected_visit.lifestyle_form_page_five\n    delete cti.store.variables.selected_visit.lifestyle_form_page_six\n\n    delete cti.store.variables.selected_visit.lifestyle_form_repeater_three\n    delete cti.store.variables.selected_visit.lifestyle_form_repeater_five\n  } else {\n    cti.fn_update_patient_data(response.clientId.value, 'lifestyle', response.data, response.appointmentId)\n  }\n\n  cti.store.variables.v_submitlifestyleFormPayload_clear = true\n\n  delete cti.store.variables.v_submitlifestyleFormPayload\n}\n\ndelete cti.store.api.api_rio.submitlifestyleform\ncti.utils.updatePage()"},"_auto_id_":"a6041f37-338e-49cb-bf97-5bf65573a672"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"var response = $data.$response\n\nwindow.logManager.consoleLog(\n  'API CALL: submitlifestyleform FAILED - Reason: ' + response.message, \n  'error'\n)\n\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\", \n  \"text\" : \"Unable to submit Lifestyle Form: \" + response.message\n})\n\n// Set the status to failed\ncti.store.variables.selected_visit.lifestyle_form_status = \"failed\";\ncti.store.variables.selected_visit.lifestyle_form_status_text = \"Failed to Upload Lifestyle Form data, tap to retry...\";\n\n//cti.fn_toggle_spinner('close')\n//cti.utils.callAction(\"go-to-page\", { \"name\": \"Visit\" })\n\ndelete cti.store.api.api_rio.submitlifestyleform\ncti.utils.updatePage()"},"_auto_id_":"dbdb2978-e9c6-4737-8da3-7a6599a657de"}]}],"name":"SubmitLifestyleForm"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'API Call: pushRegister - Sending...', \n  'info'\n);\n\n// Check for a notification token - can't do anything without it...\nif (!$store.notification.token) {\n  window.logManager.consoleLog(\n    'API Call: pushRegister - Notification token does not exist, cannot register for push...', \n    'info'\n  );\n  \n  cti.fn_toggle_spinner('open', 'Downloading Application Data, please wait...');\n  cti.utils.callAction(\"call-actionflow\", { name: \"GetStaticData\" });\n  \n  return false\n}\n\n$success()"},"_auto_id_":"16ec9883-a2ee-4c54-b78f-084159530fdb"},{"event":"click","type":"call-api","data":{"sync":true,"name":"api_rio_main","operation":"pushRegister","params":{"os":"{{$store.env.platform.name}}","notificationToken":"{{$store.notification.token}}","username":"{{$store.variables.loggedInUser}}","registeredPushId":"{{$store.variables.registeredPushId}}","Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}"}},"_auto_id_":"9e2cc1ad-69bf-45b8-8034-b9dc0e211d42","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"if(!$data.$response.success || !$data.$response.response.RegistrationId){\n  cti.fn_toggle_spinner('close');\n  \n  window.logManager.consoleLog(\n    'API Call: pushRegister FAILED - Reason ' + ($data.$response.message || 'No Message'), \n    'error'\n  );\n  \n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\" , \n    \"text\" : \"Unable to register for push notifications.\"\n  });\n} else {\n  window.logManager.consoleLog(\n    'API Call: pushRegister SUCCESS', \n    'info'\n  );\n\n  cti.store.variables.registeredPushId = $data.$response.response.RegistrationId\n  \n  cti.fn_toggle_spinner('open', 'Downloading Application Data, please wait...');\n  cti.utils.callAction(\"call-actionflow\", { name: \"GetStaticData\" });\n  $success();\n}"},"_auto_id_":"7645ad84-8344-4c78-8af7-a83b0964333f"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'API Call: pushRegister FAILED - Reason ' + ($data.$response.message || 'No Message'), \n  'error'\n);\n\ncti.fn_toggle_spinner('close');\n\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\" , \n  \"text\" : \"Unable to connect to server.\"\n});\n\ncti.fn_toggle_spinner('open', 'Downloading Application Data, please wait...');\ncti.utils.callAction(\"call-actionflow\", { name: \"GetStaticData\" });\n\n$success();"},"_auto_id_":"3de685e6-c18a-4e13-8f2a-ee59d92cfbdf"}]}],"name":"RegisterPush"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'API Call: push/pushDeregister SUCCESS', \n  'info'\n);\n\n$success()"},"_auto_id_":"4e2cae2a-2be5-4091-9cc3-eff883b3e456"},{"event":"click","type":"call-api","data":{"sync":true,"name":"api_rio_main","operation":"pushDeregister","params":{"registeredPushId":"{{$store.variables.registeredPushId}}","tags":"{{$store.variables.temp_user}}","Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}"}},"_auto_id_":"f761a7a6-25a4-4567-97d1-59c62142af03","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'API Call: push/pushDeregister SUCCESS', \n  'info'\n);\n\ncti.store.variables.registeredPushId = ''\ncti.store.variables.temp_user = ''\n\n$success()"},"_auto_id_":"7189ce67-8d7b-49ea-bf06-40e7884e202d"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'API Call: push/pushDeregister FAILED - Reason ' + $data.$response.message, \n  'info'\n);"},"_auto_id_":"d6e33824-15dd-42cd-b93a-a5c0768549a6"}]}],"name":"DeregisterPush"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'API Call: removealert - Sending...', \n  'info'\n)\n\ncti.fn_toggle_spinner('open', 'Removing Alert...')\n\nvar payload = {\n  clientId : {},\n  alertId: null,\n  endDateTime: null,\n  comment: null,\n}\n\npayload.clientId = cti.store.variables.selected_visit.patientData.demographics.clientId\npayload.alertId = cti.store.variables.alertToRemove.id\npayload.endDateTime = moment(cti.store.pages.RemoveAlert.date).format(\"YYYY-MM-DD\")\npayload.comment = cti.store.pages.RemoveAlert.description\n                       \ncti.store.variables.v_alertToRemove = payload\n\nsetTimeout(function(){ \n  cti.store.variables.v_alertToRemove_clear = true\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Visit\"})\n}, 3000)\n\n$success()"},"_auto_id_":"6f765702-c5cc-4a21-8083-6c1af4efb010","actions":[]},{"event":"click","type":"call-offline-api","data":{"name":"api_rio_offline","operation":"removealert","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","payload":"{{$store.variables.v_alertToRemove}}"}},"_auto_id_":"c855ebb9-be4b-403f-a0f2-e40af8827f23","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"//RemoveAlert response\nvar response = $data.$response\nvar selected_visit = cti.store.variables.selected_visit\ndebugger;\nif(!response.success){\n  window.logManager.consoleLog(\n    'API CALL: removealert FAILED - Reason: ' + response.message || \"No message returned\",  \n    'info'\n  )\n\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\", \n    \"text\" : \"Remove Alert Failed: \" + response.message || \"No message returned\" \n  })\n} else {\n  var currentAlerts = []\n\n  if(selected_visit && selected_visit.attendees.attendee.clientId.value == response.clientId.value) {\n    currentAlerts = cti.store.variables.selected_visit.patientData.alerts\n\n    if(response.data != undefined) {\n      if(response.data.patientAlerts != undefined) {\n        if(response.data.patientAlerts.patientAlert != undefined) {\n          if(response.data.patientAlerts.patientAlert instanceof Array) {\n            currentAlerts = response.data.patientAlerts.patientAlert\n          } else {\n            currentAlerts = []\n            currentAlerts.push(response.data.patientAlerts.patientAlert)\n          }\n\n          // Re-order alerts array\n          currentAlerts.sort(function(a, b) {\n            return a.date > b.date ? -1 : a.date < b.date ? 1 : 0;\n          });\n\n          var displayAlerts = JSON.parse(JSON.stringify(currentAlerts))\n          for (var i = displayAlerts.length; i-- > 0;) {\n            var thisAlert = displayAlerts[i]\n\n            if (thisAlert.removalDate) {\n              displayAlerts.splice(i, 1)\n            }\n          }\n\n          // Set open alerts temp variable in the store\n          cti.store.variables.filter = \"open\"\n          cti.store.variables.selected_visit.patientData.displayAlerts = displayAlerts\n\n          // Update patient alerts\n          cti.store.variables.selected_visit.patientData.alerts = currentAlerts\n\n          // Refresh timeline\n          cti.fn_prep_timeline()\n        }\n      }\n    }\n  } else {\n    if(response.data != undefined) {\n      if(response.data.patientAlerts != undefined) {\n        if(response.data.patientAlerts.patientAlert != undefined) {\n          if(response.data.patientAlerts.patientAlert instanceof Array) {\n            currentAlerts = response.data.patientAlerts.patientAlert\n          } else {\n            currentAlerts = []\n            currentAlerts.push(response.data.patientAlerts.patientAlert)\n          }\n        }\n      }\n    }\n\n    if(currentAlerts.length > 0) {\n      cti.fn_update_patient_data(response.clientId.value, 'alerts', currentAlerts)\n    }\n  } \n\n  window.logManager.consoleLog(\n    'API CALL: removealert SUCCESS', \n    'info'\n  )\n\n  cti.store.variables.v_alertToRemove_clear = true\n}\n\ndelete cti.store.variables.v_alertToRemove\ndelete cti.store.variables.alertToRemove\ndelete cti.store.api.api_rio.removealert\n\n$success()"},"_auto_id_":"37fb50ca-db0d-4137-b8d9-8c74030ec183"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"var response = $data.$response;\n\nwindow.logManager.consoleLog(\n  'API CALL: removealert FAILED - Reason: ' + response.message || \"No message returned\", \n  'error'\n)\n\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\", \n  \"text\" : \"Remove Alert Failed: \" + response.message || \"No message returned\" \n})\n\ndelete cti.store.variables.v_alertToRemove\ndelete cti.store.variables.alertToRemove\ndelete cti.store.api.api_rio.removealert\n\n//cti.fn_toggle_spinner('close', '', 1500)\n//cti.utils.callAction(\"go-to-page\", { \"name\": \"Visit\" })\n\n$success()"},"_auto_id_":"f876c54c-b5e4-41df-8427-15045f713b50"}]}],"name":"RemoveAlert"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'API Call: alertsadd - Sending...', \n  'info'\n)\n\ncti.fn_toggle_spinner('open', 'Submitting Alert...')\n\nvar payload = {\n\tclientId: {},\n    date: null,\n    type: {},\n    priority: {},\n    text: null\n}\n\npayload.clientId.type = cti.store.variables.selected_visit.patientData.demographics.clientId.type\npayload.clientId.value = cti.store.variables.selected_visit.patientData.demographics.clientId.value\npayload.date = moment().format(\"YYYY-MM-DD\")\npayload.type = cti.store.pages.Alert.type.value\npayload.priority = cti.store.pages.Alert.priority.value\npayload.text = cti.store.pages.Alert.description\n                       \ncti.store.variables.v_alertToAdd = payload\n\nsetTimeout(function(){ \n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Visit\"})\n}, 3000)\n\n$success()"},"_auto_id_":"84a5b0e4-b07f-4605-943d-f5ec287e1d04","actions":[]},{"event":"click","type":"call-offline-api","data":{"name":"api_rio_offline","operation":"addalert","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","payload":"{{$store.variables.v_alertToAdd}}"}},"_auto_id_":"5f60c659-b276-454c-ac9e-7196dee473cd","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"// Alerts response\nvar response = $data.$response\nvar selected_visit = cti.store.variables.selected_visit\ndebugger;\nif(!response.success){\n  window.logManager.consoleLog(\n    'API CALL: alertsadd FAILED - Reason: ' + response.message, \n    'error'\n  )\n\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\", \n    \"text\" : \"Add Alert Failed: \" + response.message || \"No message returned\"\n  })\n} else {\n  var currentAlerts = []\n\n  if(selected_visit && selected_visit.attendees.attendee.clientId.value == response.clientId.value) {\n    currentAlerts = cti.store.variables.selected_visit.patientData.alerts\n\n    if(response.data != undefined) {\n      if(response.data.patientAlerts != undefined) {\n        if(response.data.patientAlerts.patientAlert != undefined) {\n          if(response.data.patientAlerts.patientAlert instanceof Array) {\n            currentAlerts = response.data.patientAlerts.patientAlert\n          } else {\n            currentAlerts = []\n            currentAlerts.push(response.data.patientAlerts.patientAlert)\n          }\n\n          // Re-order alerts array\n          currentAlerts.sort(function(a, b) {\n            return a.date > b.date ? -1 : a.date < b.date ? 1 : 0\n          });\n\n          var displayAlerts = JSON.parse(JSON.stringify(currentAlerts))\n\n          for (var i = displayAlerts.length; i-- > 0;) {\n            var thisAlert = displayAlerts[i]\n\n            if (thisAlert.removalDate) {\n              displayAlerts.splice(i, 1)\n            }\n          }\n\n          // Set open alerts temp variable in the store\n          cti.store.variables.filter = \"open\"\n          cti.store.variables.selected_visit.patientData.displayAlerts = displayAlerts\n\n          // Update patient alerts\n          cti.store.variables.selected_visit.patientData.alerts = currentAlerts\n\n          // Refresh timeline\n          cti.fn_prep_timeline()\n        }\n      }\n    }\n  } else {\n    if(response.data != undefined) {\n      if(response.data.patientAlerts != undefined) {\n        if(response.data.patientAlerts.patientAlert != undefined) {\n          if(response.data.patientAlerts.patientAlert instanceof Array) {\n            currentAlerts = response.data.patientAlerts.patientAlert\n          } else {\n            currentAlerts = []\n            currentAlerts.push(response.data.patientAlerts.patientAlert)\n          }\n        }\n      }\n    }\n\n    if(currentAlerts.length > 0) {\n      cti.fn_update_patient_data(response.clientId.value, 'alerts', currentAlerts)\n    }\n  } \n\n  window.logManager.consoleLog(\n    'API CALL: alertsadd SUCCESS', \n    'info'\n  );\n\n  cti.store.variables.v_alertToAdd_clear = true\n  \n  if(cti.store.state.currentPage != \"Alert\") {\n    cti.utils.destroyPageData('Alert')\n  }\n}\n\ndelete cti.store.variables.v_alertToAdd\ndelete cti.store.api.api_rio.alertsadd\n\n$success()"},"_auto_id_":"dbceea72-e4b9-41a4-b880-8a1f268b0825"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"var response = $data.$response\n\nwindow.logManager.consoleLog(\n  'API CALL: alertsadd FAILED - Reason: ' + response.message, \n  'error'\n);\n\ncti.utils.callAction(\n  \"show-notification\", {\n    \"name\": \"notification_error\",\n    \"title\": \"Server Error\",\n    \"text\": \"Unable to connect to the server: \" + response.message || \"No message returned\"\n  }\n);\n\ndelete cti.store.variables.v_alertToAdd\ndelete cti.store.api.api_rio.alertsadd\n\n//cti.fn_toggle_spinner('close', '', 1500)\n//cti.utils.callAction(\"go-to-page\", { \"name\": \"Visit\" })\n\n$success()"},"_auto_id_":"5948089e-55a6-4ad6-bc38-5083bfe6a1af"}]}],"name":"AddAlert"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'API Call: addprogressnote - Sending...', \n  'info'\n)\n\nvar payload = {\n  clientId: {},\n  noteDateTime : null,\n  noteText : null,\n  noteType: null,\n  isValidatedNote: null,\n  subNoteType : null,\n  specialty : null,\n  riskType : null,\n  isSignificantEvent : null,\n  isThirdParty : null,\n  isClientConceal : null,\n  document : null,\n  documentName : null,\n  documentType : null\n}\n\npayload.clientId.type = cti.store.variables.selected_visit.patientData.demographics.clientId.type\npayload.clientId.value = cti.store.variables.selected_visit.patientData.demographics.clientId.value\npayload.noteDateTime = moment().format(\"YYYY-MM-DD HH:mm:ss\")\npayload.noteText = cti.store.pages.Note.noteText\n\nif(cti.store.pages.Note.isValidated) {\n  if(cti.store.pages.Note.isValidated.value == \"1\") {\n    payload.isValidatedNote = 'true'\n  } else {\n    payload.isValidatedNote = 'false'\n  }\n} else {\n  payload.isValidatedNote = 'false'\n}\n\nif(cti.store.pages.Note.noteType) {\n  payload.noteType = cti.store.pages.Note.noteType.value\n}\n\nif(cti.store.pages.Note.subType) {\n  payload.subNoteType  = cti.store.pages.Note.subType.value\n} \n\nif(cti.store.pages.Note.specialty != undefined) {\n  payload.specialty = cti.store.pages.Note.specialty.value\n}\n\n/* TODO: Implement when fixed\nif(cti.store.pages.Note.list_riskType != undefined) {\n  var riskTypes = [];\n  for(var i in cti.store.pages.Note.list_riskType) {\n    riskTypes.push(cti.store.pages.Note.list_riskType[i].order.direction);\n  }\n  payload.riskTypes = riskTypes;\n}\n*/\n\nif(cti.store.pages.Note.flagSignificantEvent) {\n  payload.isSignificantEvent = cti.store.pages.Note.flagSignificantEvent\n}\n\nif(cti.store.pages.Note.flagThirdParty) {\n  payload.isThirdParty = cti.store.pages.Note.flagThirdParty\n}\n\nif(cti.store.pages.Note.flagClientConceal) {\n  payload.isClientConceal = cti.store.pages.Note.flagClientConceal\n}\n\nif(cti.store.media && \n   cti.store.media.btnPhoto && \n   cti.store.media.btnPhoto.base64) \n{\n  var base64 = cti.store.media.btnPhoto.base64\n  var fileExtension = cti.store.media.btnPhoto.fileExtension\n  var clientId = cti.store.variables.selected_visit.patientData.demographics.clientId.value\n \n  if(base64 != undefined || base64 != \"\") {\n    payload.document = base64\n    payload.documentName = \"progressnote_photo_\"+clientId+\".\"+fileExtension\n  \tpayload.documentType = cti.store.schema.metadata.imageType || \"V7AA\"\n  }\n}\n\ncti.store.variables.v_progressNoteToAdd = payload\n\nsetTimeout(function(){ \n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Visit\"})\n}, 3000)\n\n$success()"},"_auto_id_":"2b73dcf9-d787-44e9-8108-fb63487e941a","actions":[]},{"event":"click","type":"call-offline-api","data":{"name":"api_rio_offline","operation":"addnote","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","payload":"{{$store.variables.v_progressNoteToAdd}}"}},"_auto_id_":"91b294cd-f3a0-4748-83d5-edc614dae15c","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"// Progress notes response\nvar response = $data.$response\nvar selected_visit = cti.store.variables.selected_visit\n\nif(!response.success){\n  window.logManager.consoleLog(\n    'API CALL: addprogressnote FAILED - Reason: ' + response.message, \n    'error'\n  )\n\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\", \n    \"text\" : \"Add Progress Note Failed: \" + response.message\n  })\n} else {\n  var currentNotes = []\n  if(selected_visit && selected_visit.attendees.attendee.clientId.value == response.clientId.value) {\n    currentNotes = cti.store.variables.selected_visit.patientData.progressNotes\n\n    if(response.data != undefined) {\n      if(response.data.progressNotes != undefined) {\n        if(response.data.progressNotes.progressNote != undefined) {\n          if(response.data.progressNotes.progressNote instanceof Array) {\n            currentNotes = response.data.progressNotes.progressNote\n          } else {\n            currentNotes = []\n            currentNotes.push(response.data.progressNotes.progressNote)\n          }\n\n          cti.store.variables.selected_visit.patientData.progressNotes = currentNotes\n\n          var documents = cti.store.variables.selected_visit.patientData.documents\n\n          for(var i in currentNotes) {\n            var note = currentNotes[i]\n\n            if(note.associatedDocuments && note.associatedDocuments.associatedDocument) {\n              var exists = false\n\n              for(var x in documents) {\n                var document = documents[x]\n\n                if(document.documentId == note.associatedDocuments.associatedDocument.documentId) {\n                  exists = true\n                }\n              }\n\n              if(!exists) {\n                var newDocument = JSON.parse(JSON.stringify(note.associatedDocuments.associatedDocument))\n\n                var dateCreated = newDocument.dateCreated.replace(\"T\", \" \")\n                newDocument.dateCreated = dateCreated\n                var documentDate = newDocument.documentDate.replace(\"T\", \" \")\n                newDocument.documentDate = documentDate\n                var insertedDate = newDocument.insertedDate.replace(\"T\", \" \")\n                newDocument.insertedDate = insertedDate\n\n                documents.push(newDocument)\n              }\n            }\n          }\n\n          cti.fn_prep_timeline()\n        }\n      }\n    }\n  } else {\n    if(response.data != undefined) {\n      if(response.data.progressNotes != undefined) {\n        if(response.data.progressNotes.progressNote != undefined) {\n          if(response.data.progressNotes.progressNote instanceof Array) {\n            currentNotes = response.data.progressNotes.progressNote\n          } else {\n            currentNotes = []\n            currentNotes.push(response.data.progressNotes.progressNote)\n          }\n        }\n      }\n    }\n\n    if(currentNotes.length > 0) {\n      cti.fn_update_patient_data(response.clientId.value, 'notes', currentNotes)\n    }\n  }\n\n\n  window.logManager.consoleLog(\n    'API CALL: addprogressnote SUCCESS', \n    'info'\n  )\n\n  cti.store.variables.v_progressNoteToAdd_clear = true\n  \n  if(cti.store.state.currentPage != \"Note\") {\n    if(cti.store.media && cti.store.media.btnPhoto) {\n      cti.store.media.btnPhoto.images = []\n    }\n    delete cti.store.variables.note\n    delete cti.store.variables.v_progressNoteToAdd_clear\n    delete cti.store.variables.uiSubNoteTypes\n    cti.utils.destroyPageData('Note')\n  }\n}\n\nif(cti.store.media && cti.store.media.btnPhoto) {\n  delete cti.store.media.btnPhoto.base64\n  delete cti.store.media.btnPhoto.fileExtension\n}\n\ndelete cti.store.variables.v_progressNoteToAdd\ndelete cti.store.api.api_rio.addprogressnote\n\n$success()"},"_auto_id_":"146334cf-48ec-419c-ab25-86170ba7caf7"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"var response = $data.$response;\n\nwindow.logManager.consoleLog(\n  'API CALL: addprogressnote FAILED - Reason: ' + response.message, \n  'error'\n);\n\ncti.utils.callAction(\n  \"show-notification\", {\n    \"name\": \"notification_error\",\n    \"title\": \"Server Error: Add Progress Note\",\n    \"text\": \"Unable to connect to the server: \" + response.message || \"No message returned\" \n  }\n);\n\nif(cti.store.media && \n   cti.store.media.btnPhoto && \n   cti.store.media.btnPhoto.base64) \n{\n  delete cti.store.media.btnPhoto.base64\n  delete cti.store.media.btnPhoto.fileExtension\n}\n\ndelete cti.store.api.api_rio.addprogressnote\ndelete cti.store.variables.v_progressNoteToAdd\n\n//cti.fn_toggle_spinner('close', '', 1500)\n//cti.utils.callAction(\"go-to-page\", { \"name\": \"Visit\" });\n\n$success();"},"_auto_id_":"0d4f2aa0-445d-4d8d-8b7c-c8c06df36035"}]}],"name":"AddProgressNote"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var payload = {\n    \"appointmentBooking\": {\n        \"clientId\": {},\n        \"teamId\": null,\n        \"date\": null,\n        \"referralId\": null,\n        \"activities\": {\n            \"string\": []\n        },\n        \"comment\": null,\n        \"bookRepeatAppointments\": null,\n        \"repeatType\": null,\n        \"numberOfRepeats\": null,\n        \"repeatInterval\": null,\n        \"weekDays\": null,\n        \"dateOfMonth\": null,\n        \"monthOfYear\": null,\n        \"weekInMonth\": null,\n        \"authorId\": null\n    }\n}\n\nvar activities = cti.store.repeater.Team_Planner.group_activities;\nvar newActivities = [];\n\nfor (var i in activities) {\n    newActivities.push(activities[i].activity.value);\n}\n\npayload.appointmentBooking.clientId = cti.store.variables.selected_visit.patientData.demographics.clientId;\npayload.appointmentBooking.teamId = cti.store.pages.Team_Planner.select_team.value;\npayload.appointmentBooking.date = cti.store.pages.Team_Planner.date_planner;\npayload.appointmentBooking.referralId = cti.store.pages.Team_Planner.select_referral.value;\npayload.appointmentBooking.activities.string = newActivities;\npayload.appointmentBooking.comment = cti.store.pages.Team_Planner.comments;\n\ncti.store.variables.selected_visit.repeat === undefined ? payload.appointmentBooking.bookRepeatAppointments = false : payload.appointmentBooking.bookRepeatAppointments = true;\n\nif (payload.appointmentBooking.bookRepeatAppointments) {\n    payload.appointmentBooking.repeatType = cti.store.pages.Team_Planner.radio_repeat;\n    payload.appointmentBooking.numberOfRepeats = cti.store.pages.Team_Planner.number_appointments.toString();\n\n    if (payload.appointmentBooking.repeatType === \"Daily\") {\n        if (cti.store.pages.Team_Planner.radio_daily == \"Every weekday\") {\n            payload.appointmentBooking.repeatType = \"WeekDay\";\n        } else {\n            payload.appointmentBooking.repeatInterval = cti.store.pages.Team_Planner.select_daily_interval.value.toString();\n        }\n    } else if (payload.appointmentBooking.repeatType === \"Weekly\") {\n        var p = cti.store.pages.Team_Planner;\n        var bitValue = 0;\n\n        if (p.checkbox_weekly_days[1]) { bitValue += 1; }\n        if (p.checkbox_weekly_days[2]) { bitValue += 2; }\n        if (p.checkbox_weekly_days[3]) { bitValue += 4; }\n        if (p.checkbox_weekly_days[4]) { bitValue += 8; }\n        if (p.checkbox_weekly_days[5]) { bitValue += 16; }\n        if (p.checkbox_weekly_days[6]) { bitValue += 32; }\n        if (p.checkbox_weekly_days[7]) { bitValue += 64; }\n\n        payload.appointmentBooking.weekDays = bitValue.toString();\n        payload.appointmentBooking.repeatInterval = cti.store.pages.Team_Planner.select_weekly_interval.value.toString();\n    } else if (payload.appointmentBooking.repeatType === \"Monthly\") {\n        payload.appointmentBooking.repeatInterval = cti.store.pages.Team_Planner.select_month_interval.value.toString();\n\n        if (cti.store.pages.Team_Planner.select_month_day) {\n            payload.appointmentBooking.dateOfMonth = cti.store.pages.Team_Planner.select_month_day.value.toString();\n        }\n\n        if (cti.store.pages.Team_Planner.select_weekday) {\n            var p = cti.store.pages.Team_Planner;\n            var day = cti.store.pages.Team_Planner.select_weekday.value;\n            var bitValue = 0;\n\n            if (day == \"1\") { bitValue = 1; }\n            if (day == \"2\") { bitValue = 2; }\n            if (day == \"3\") { bitValue = 4; }\n            if (day == \"4\") { bitValue = 8; }\n            if (day == \"5\") { bitValue = 16; }\n            if (day == \"6\") { bitValue = 32; }\n            if (day == \"7\") { bitValue = 64; }\n\n            payload.appointmentBooking.weekDays = bitValue.toString();\n        }\n\n        if (cti.store.pages.Team_Planner.select_position) {\n            if (cti.store.pages.Team_Planner.select_position.value == \"First\") {\n                payload.appointmentBooking.weekInMonth = \"1\";\n            } else if (cti.store.pages.Team_Planner.select_position.value == \"Second\") {\n                payload.appointmentBooking.weekInMonth = \"2\";\n            } else if (cti.store.pages.Team_Planner.select_position.value == \"Third\") {\n                payload.appointmentBooking.weekInMonth = \"3\";\n            } else if (cti.store.pages.Team_Planner.select_position.value == \"Fourth\") {\n                payload.appointmentBooking.weekInMonth = \"4\";\n            } else if (cti.store.pages.Team_Planner.select_position.value == \"Last\") {\n                payload.appointmentBooking.weekInMonth = \"5\";\n            }\n        }\n    } else if (payload.appointmentBooking.repeatType === \"Yearly\") {\n        if (cti.store.pages.Team_Planner.select_weekday) {\n            var p = cti.store.pages.Team_Planner;\n            var day = cti.store.pages.Team_Planner.select_weekday.value;\n            var bitValue = 0;\n\n            if (day == \"1\") { bitValue = 1; }\n            if (day == \"2\") { bitValue = 2; }\n            if (day == \"3\") { bitValue = 4; }\n            if (day == \"4\") { bitValue = 8; }\n            if (day == \"5\") { bitValue = 16; }\n            if (day == \"6\") { bitValue = 32; }\n            if (day == \"7\") { bitValue = 64; }\n\n            payload.appointmentBooking.weekDays = bitValue.toString();\n        }\n\n        if (cti.store.pages.Team_Planner.select_year_month_day) {\n            payload.appointmentBooking.dateOfMonth = cti.store.pages.Team_Planner.select_year_month_day.value.toString();\n        }\n\n        if (cti.store.pages.Team_Planner.select_month) {\n            payload.appointmentBooking.monthOfYear = cti.store.pages.Team_Planner.select_month.value.toString();\n        }\n\n        if (cti.store.pages.Team_Planner.select_position) {\n            if (cti.store.pages.Team_Planner.select_position.value == \"First\") {\n                payload.appointmentBooking.weekInMonth = \"1\";\n            } else if (cti.store.pages.Team_Planner.select_position.value == \"Second\") {\n                payload.appointmentBooking.weekInMonth = \"2\";\n            } else if (cti.store.pages.Team_Planner.select_position.value == \"Third\") {\n                payload.appointmentBooking.weekInMonth = \"3\";\n            } else if (cti.store.pages.Team_Planner.select_position.value == \"Fourth\") {\n                payload.appointmentBooking.weekInMonth = \"4\";\n            } else if (cti.store.pages.Team_Planner.select_position.value == \"Last\") {\n                payload.appointmentBooking.weekInMonth = \"5\";\n            }\n        }\n    }\n}\n\ncti.store.variables.v_teamplannerToAdd = payload;\ncti.store.variables.v_teamplannerToAdd_clear = payload;\n\n$success();"},"_auto_id_":"b6f48280-d8f3-43a9-aca6-e1ad55ba4625","actions":[]},{"event":"click","type":"call-offline-api","data":{"name":"api_rio_offline","operation":"addTPAppointment","params":{"applicationkey":"{{$store.schema.metadata.applicationkey}}","Authorization":"Basic {{$store.variables.auth_header}}","payload":"{{$store.variables.v_teamplannerToAdd}}"}},"_auto_id_":"6ee51849-c9d9-4160-8fe9-1258d9fb7eea","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"if(!$data.$response.success){\n  console.log(\"API CALL: /appointments/teamadd | FAILED\");\n  console.log(\"API FAILURE: \" + $data.$response.message);\n  \n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\", \n    \"text\" : $data.$response.message || \"Add Team Planner Appointment Failed\"});\n} else {\n  console.log(\"API CALL: /appointments/teamadd | SUCCESS\");\n}\n\ndelete cti.store.variables.v_teamplannerToAdd;\n$success();"},"_auto_id_":"981c0ea1-5973-487c-95c9-0e3a8a2b1cc8"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"console.log(\"API CALL: /appointments/teamadd | FAILED\");\nconsole.log(\"API FAILURE: \" + $data.$response.message);\n\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\", \n  \"text\" : $data.$response.message || \"Add Team Planner Appointment Failed\"\n});\n\n$success();"},"_auto_id_":"fd643769-dcd1-4189-a170-3c58ada1cb74"}]},{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"9c89b3c1-4a83-418b-8d9c-3bf70c453491"}],"name":"AddTPAppointment"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var payload = {\n  appointmentDetails : {\n    appointmentDateTime: null,\n    appointmentType: null,\n    authorId: null,\n    bookedDateTime: null,\n    comment: null,\n    healthcareProfessional: null,\n    intendedDuration: null,\n    location: null,\n    isNonClientAppointment: false\n  },\n  appointmentContacts: []\n}\n\n// Add to appointmentDetails\npayload.appointmentDetails.appointmentDateTime = moment(cti.store.pages.HCP_Diary.date_planner).format('YYYY-MM-DD HH:mm:ssZZ');\npayload.appointmentDetails.appointmentType = cti.store.pages.HCP_Diary.select_type.value\npayload.appointmentDetails.bookedDateTime = moment().format('YYYY-MM-DD HH:mm:ssZZ')\npayload.appointmentDetails.comment = cti.store.pages.HCP_Diary.text_comment\npayload.appointmentDetails.healthcareProfessional = cti.store.pages.Login.username\npayload.appointmentDetails.intendedDuration = cti.store.pages.HCP_Diary.select_intended_duration.value\npayload.appointmentDetails.location = cti.store.pages.HCP_Diary.select_location.value\n\nif(cti.store.pages.HCP_Diary.switch_non_client != undefined) {\n  payload.appointmentDetails.isNonClientAppointment = cti.store.pages.HCP_Diary.switch_non_client\n}\n\n//Add to appointmentContacts\n\nvar addContact = function() {\n  let contact = {\n    activities : {\n    \tstring: []\n  \t},\n    clientId : null,\n    comment : null,\n    faceToFace : null,\n    interpreterComment : null,\n    interpreterLanguage : null,\n    interpreterStatus : null,\n    isNonClientAppointment : null,\n    proxyContact : null,\n    referralId : null,\n    transportComment : null,\n    transportStatus : null,\n    proxyContact : null,\n  }\n  contact.clientId = cti.store.variables.selected_visit.patientData.demographics.clientId\n  \n  if(cti.store.pages.HCP_Diary.contact_comment != undefined) {\n    contact.comment = cti.store.pages.HCP_Diary.contact_comment;\n  }\n  if(cti.store.pages.HCP_Diary.switch_f2f_contact != undefined) {\n    contact.faceToFace = cti.store.pages.HCP_Diary.switch_f2f_contact\n  }\n  if(cti.store.pages.HCP_Diary.interpreter_comment != undefined) {\n    contact.interpreterComment = cti.store.pages.HCP_Diary.interpreter_comment\n  }\n  if(cti.store.pages.HCP_Diary.select_interpret_language != undefined) {\n    if(cti.store.pages.HCP_Diary.select_interpret_language.value != undefined) {\n      contact.interpreterLanguage = cti.store.pages.HCP_Diary.select_interpret_language.value\n    }\n  }\n  if(cti.store.pages.HCP_Diary.select_interpret_required != undefined) {\n    if(cti.store.pages.HCP_Diary.select_interpret_required.value != undefined) {\n      contact.interpreterStatus = cti.store.pages.HCP_Diary.select_interpret_required.value\n    }\n  }\n  if(cti.store.pages.HCP_Diary.switch_non_client != undefined) {\n    contact.isNonClientAppointment = cti.store.pages.HCP_Diary.switch_non_client\n  }\n  if(cti.store.pages.HCP_Diary.switch_proxy_contact != undefined) {\n    contact.proxyContact = cti.store.pages.HCP_Diary.switch_proxy_contact\n  }\n  if(cti.store.pages.HCP_Diary.transport_comment != undefined) {\n    contact.transportComment = cti.store.pages.HCP_Diary.transport_comment\n  }\n  if(cti.store.pages.HCP_Diary.select_transport_required != undefined) {\n    if(cti.store.pages.HCP_Diary.select_transport_required.value != undefined) {\n      contact.transportStatus = cti.store.pages.HCP_Diary.select_transport_required.value\n    }\n  }\n\n  contact.referralId = cti.store.variables.selected_visit.attendees.attendee.referral.referralId\n  \n  cti.store.repeater.HCP_Diary.group_activities.forEach(function(a) {\n    contact.activities.string.push(a.activity.value)\n  })\n\n  payload.appointmentContacts.push(contact)\n}\n\naddContact()\n\ncti.store.variables.v_appointmentToAdd = payload\ncti.store.variables.v_appointmentToAdd_clear = true\n\n$success()"},"_auto_id_":"258c8b73-31b1-4379-95fc-ffd4436b5224","actions":[]},{"event":"click","type":"call-offline-api","data":{"name":"api_rio_offline","operation":"addHCPAppointment","params":{"payload":"$store.variables.v_appointmentToAdd","Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}"}},"_auto_id_":"8761a75d-e791-4e35-8a5b-03194faae506","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"console.log('AddHCPAppointment: Success', $data)\n\n$success()"},"_auto_id_":"4feb4e99-fe86-49e0-a4de-02bef3c2c3a4"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"console.log('AddHCPAppointment: Fail', $data)\n\n$success()"},"_auto_id_":"87b4f50e-c24a-4033-8268-5e64fd731e26"}]}],"name":"AddHCPAppointment"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'API Call: outcomesave - Sending...', \n  'info'\n)\n\ncti.fn_toggle_spinner('open', 'Submitting Outcome...');\n\nvar arrivalTime = null, \n    actualTime = null, \n    actualDuration = null\n\nvar payload = {\n  appointmentOutcome: {\n    appointmentId: null,\n    clientId: {},\n    authorId: null,\n    arrivalTime: null,\n    actualTime: null,\n    actualDuration: null,\n    activities: {\n      string: []\n    },\n    consultationMedium: null,\n    outcome: null,\n    comments: null\n  }\n}\n\nvar activities = []\n\nfor(var i in cti.store.variables.o_activities) {\n  activities.push(cti.store.variables.o_activities[i].value)\n}\n\nvar arrivalTimeDt = new Date(cti.store.variables.selected_visit.arrivalTime)\nvar arrivalTimeStr = arrivalTimeDt.toString()\nvar arrivalTimeOffset = (arrivalTimeStr.substring(arrivalTimeStr.indexOf('+'))).substring(0,5)\n\nif (cti.store.pages.Outcome.arrivalTime) {\n  arrivalTime = cti.store.pages.Outcome.arrivalTime + arrivalTimeOffset\n}\n\nif (cti.store.pages.Outcome.actualTime) {\n  actualTime = cti.store.pages.Outcome.actualTime + arrivalTimeOffset\n}\n\nactualDuration = (Number(cti.store.pages.Outcome.duration_hours.value) * 60 +\n                  Number(cti.store.pages.Outcome.duration_minutes.value)\n                 ).toString()\n\npayload.appointmentOutcome.appointmentId = cti.store.variables.selected_visit.appointmentId\npayload.appointmentOutcome.clientId = cti.store.variables.selected_visit.patientData.demographics.clientId\npayload.appointmentOutcome.arrivalTime = arrivalTime\npayload.appointmentOutcome.actualTime = actualTime\npayload.appointmentOutcome.actualDuration = actualDuration\npayload.appointmentOutcome.activities.string = activities\npayload.appointmentOutcome.outcome = cti.store.pages.Outcome.outcome.value\ncti.store.pages.Outcome.comments != undefined ? payload.appointmentOutcome.comments = cti.store.pages.Outcome.comments : null\n\ncti.store.variables.v_outcomePayload = payload\n\n// Set the local appointment with updated information\ncti.store.variables.selected_visit.attendees.attendee.outcome = {\n  code : cti.store.pages.Outcome.outcome.value,\n  value : cti.store.pages.Outcome.outcome.label\n}\n\ncti.store.variables.selected_visit.attendees.attendee.outcomeComment = payload.appointmentOutcome.comments\n\ndelete cti.store.variables.selected_visit.attendees.attendee.possibleActivities\ndelete cti.store.variables.selected_visit.attendees.attendee.possibleOutcomes\n\n// Load appointments from pouch\nwindow.pouchManager.loadFromDatabase('appointments', function (doc) {\n  var appointments = doc.data\n  var appointment = cti.store.variables.selected_visit\n\n  // Check that we have a valid appointment\n  for(var i in appointments) {\n    if(appointments[i].appointmentId == appointment.appointmentId) {\n      // Update the appointment data with the selected appointment\n      appointments[i] = cti.store.variables.selected_visit\n      break;\n    }\n  }\n\n  // Update the pouch DB with new data\n  window.pouchManager.saveToDatabase(\"appointments\", appointments, function(rev) {\n    window.logManager.consoleLog(\n      'Pouch DB: Updated Appointment Data. Revision: ' + rev,\n      'info'\n    )\n\n    setTimeout(function(){ \n      cti.store.variables.v_outcomePayload_clear = true\n      cti.fn_load_appointments()\n    }, 3000)\n\n    $success()\n  }, function(reason, e) {\n    setTimeout(function(){ \n      cti.store.variables.v_outcomePayload_clear = true\n      cti.fn_load_appointments()\n    }, 3000)\n\n    $success()\n\n    window.logManager.consoleLog(\n      'Pouch DB: Failed to Update Appointment Data - ' + reason + e,\n      'error'\n    )\n  });\n}, function (reason, err) {\n  // Reset appointments\n  setTimeout(function(){ \n    cti.store.variables.v_outcomePayload_clear = true\n    cti.fn_load_appointments()\n  }, 3000)\n\n  $success()\n\n  window.logManager.consoleLog(\n    'Pouch DB: Error: Failed retriveing Appointments Data from Pouch - ' + reason + err,\n    'error'\n  )\n})"},"_auto_id_":"2a7c0e7e-6e38-4ced-bce6-d20ddd4c2a83","actions":[]},{"event":"click","type":"call-offline-api","data":{"name":"api_rio_offline","operation":"outcomesave","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","payload":"{{$store.variables.v_outcomePayload}}"}},"_auto_id_":"a12e130f-59df-4df6-b308-b7d05186bd88","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"var response = $data.$response\n\nif(!response.success) {\n  window.logManager.consoleLog(\n    'API Call: outcomesave - FAILED - Reason: ' + response.message, \n    'error'\n  )\n\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\", \n    \"text\" : \"Submit Outcome Failed: \" + response.message || \"No message retured\"\n  });\n\n  // Close spinner\n  cti.fn_toggle_spinner('close');\n} else {\n  window.pouchManager.loadFromDatabase('appointments', function (doc) {\n    var appointments = doc.data;\n\n    for(var i in appointments) {\n      if(appointments[i].appointmentId == cti.store.variables.v_appointmentId) {\n        var outcomeObj = cti.store.variables.v_outcomePayload.appointmentOutcome;\n        var attendeeData = appointments[i].attendees.attendee;\n\n        delete attendeeData.possibleActivites;\n        delete attendeeData.possibleOutcomes;\n\n        attendeeData.actualTime = outcomeObj.actualTime;\n        attendeeData.arrivalTime = outcomeObj.arrivalTime;\n        attendeeData.outcome = outcomeObj.outcome;\n        attendeeData.outcomeComment = outcomeObj.outcomeComment;\n        break;\n      }\n    }\n\n    // Once we've updated and packaged the response appointment data, update and\n    // save to the exisitng pouch DB\n    window.pouchManager.saveToDatabase(\"appointments\", appointments, function(rev) {\n      console.log('Updated Appointment Data. Revision: ' + rev);\n      // On success of the update delete the request payload object...\n      delete cti.store.variables.v_outcomePayload;\n      \n      // ... reset appointment data\n      cti.fn_load_appointments();\n      \n      // Set the clear down flag\n      cti.store.variables.v_outcomePayload_clear = true\n    }, function(reason, e) {\n      console.log('Failed to Update Appointment Data - ' + reason, e);\n      // TODO: Process response if we fail to save the appointment data to pouch DB\n      // and implement offline storage and resubmission process\n      // On fail of the update delete the request payload object...\n      delete cti.store.variables.v_outcomePayload;\n      \n      // ... reset appointment data\n      cti.fn_load_appointments();\n      \n      // Set the clear down flag\n      cti.store.variables.v_outcomePayload_clear = true\n    });\n  }, function (reason, err) {\n    console.log('Error: Failed retriveing Appointments Data from Pouch - ', reason + err);\n    // TODO: Process response if we fail to load the pouch DB\n    // On fail of the update delete the request payload object...\n    delete cti.store.variables.v_outcomePayload;\n\n    // ... reset appointment data\n    cti.fn_load_appointments();\n    \n    // Set the clear down flag\n    cti.store.variables.v_outcomePayload_clear = true\n  });\n  \n  cti.store.variables.selected_visit.status = 'complete';\n  cti.store.variables.v_appointmentId = cti.store.variables.selected_visit.appointmentId;\n\n  window.logManager.consoleLog(\n    'API Call: outcomesave - SUCCESS', \n    'info'\n  )\n}"},"_auto_id_":"a6c1daaa-73f8-4536-adbb-cec7d2ee5e75"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"var response = $data.$response\n\nwindow.logManager.consoleLog(\n  'API Call: outcomesave - FAILED - Reason: ' + response.message, \n  'error'\n)\n\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\", \n  \"text\" : \"Submit Outcome Failed: \" + response.message || \"No message returned\"\n});\n\ncti.fn_toggle_spinner('close')"},"_auto_id_":"f5477a51-ce4e-471e-baa7-75d4b8e728c8"}]}],"name":"SubmitOutcome"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'API Call: getdocument - Sending...', \n  'info'\n)\n\n$success()"},"_auto_id_":"58dcf9d5-5bc7-4c06-a0f7-927c90dd8a51"},{"event":"click","type":"call-api","data":{"sync":true,"name":"api_rio","operation":"getdocument","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","payload":"{{$store.variables.v_documentGetPayload}}"}},"_auto_id_":"ebf017bd-64bf-4ca1-8def-7e93712d034e","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"var response = cti.store.api.api_rio.getdocument;\n\nif(!response.success) {\n  window.logManager.consoleLog(\n    'API Call: getdocument - FAILED - Reason: ' + response.message, \n    'info'\n  )\n  \n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\", \n    \"text\" : \"Get Document Failed: \" + response.message || \"No message returned\"\n  });\n  \n  delete cti.store.variables.v_selectedDocument\n} else {\n  window.logManager.consoleLog(\n    'API Call: getdocument - SUCCESS', \n    'info'\n  )\n  \n  cti.store.variables.v_selectedDocument.base64 = response.data.document.data\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Document\"})\n}\n\ndelete cti.store.variables.v_documentGetPayload\ndelete cti.store.api.api_rio.getdocument\n\ncti.fn_toggle_spinner('close')"},"_auto_id_":"3f491b2d-7a03-4e45-84ef-065b6cf577d3"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"var response = cti.store.api.api_rio.getdocument\n\nwindow.logManager.consoleLog(\n  'API Call: getdocument - FAILED - Reason: ' + response.message, \n  'info'\n)\n\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\", \n  \"text\" : \"Get Document Failed: \" + response.message || \"No message returned\"\n})\n\ndelete cti.store.variables.v_documentGetPayload\ndelete cti.store.variables.v_selectedDocument\ndelete cti.store.api.api_rio.getdocument\n\ncti.fn_toggle_spinner('close')"},"_auto_id_":"58837222-7b43-4d29-a345-a3cd90541ab4"}]}],"name":"GetDocument"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'API Call: getappointment - Sending...', \n  'info'\n)\n\n$success()"},"_auto_id_":"913c18b3-33f6-437c-ba03-8314f1ba2b88"},{"event":"click","type":"call-api","data":{"sync":true,"name":"api_rio","operation":"getappointment","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","appointmentId":"{{$store.variables.getAppointmentPayload}}","pushDataPayload":"{{$store.variables.pushDataPayload}}"}},"_auto_id_":"726b93dd-8f17-4e1f-a0cb-86cab919d44d","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"// GetPushData API Success Response Function\n// Grab response\nvar response = $data.$response\nvar pushDataPayload = cti.store.variables.pushDataPayload\n\n// If unsuccessful clear down data and process the error message\nif(!response.success) {\n  window.logManager.consoleLog(\n    'API CALL: getappointment FAILED - Reason: ' + response.message, \n    'error'\n  )\n\n  cti.fn_toggle_spinner('close')\n} else {\n  if(pushDataPayload.pushType == \"patient\" && pushDataPayload.includeDemographics) {\n    cti.fn_save_to_pouch(\"demographics\", $data.$response, false, pushDataPayload.clientId.value)\n  } else if(pushDataPayload.pushType == \"patient\" && pushDataPayload.includeAllergies) {\n    cti.fn_save_to_pouch(\"allergies\", $data.$response, false, pushDataPayload.clientId.value)\n  } else if(pushDataPayload.pushType == \"patient\" && pushDataPayload.includeAlerts) {\n    cti.fn_save_to_pouch(\"alerts\", $data.$response, false, pushDataPayload.clientId.value)\n  } else if(pushDataPayload.pushType == \"appointment\") {\n    cti.fn_save_to_pouch(\"appointment\", $data.$response, pushDataPayload.appointmentExists, pushDataPayload.appointmentId)\n  }\n\n  window.logManager.consoleLog(\n    'API CALL: getappointment SUCCESS', \n    'info'\n  )\n}\n\ndelete cti.store.api.api_rio.getappointment"},"_auto_id_":"cf5aaabe-2410-4dae-829c-2fcb08e3891a"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"// GetAppointment Offline API Fail Response Function\n// Grab response\nvar response = $data.$response\nvar appointmentPayload = cti.store.variables.getAppointmentPayload\n\nconsole.log('::error:: Push Event failed to retrieve appointment ',appointmentPayload.appointmentId);\nconsole.log('::error:: Error message: ', $data.$response);\n\ndelete cti.store.variables.getAppointmentPayload"},"_auto_id_":"e6a971e0-2250-4a6d-80fb-5f97690eef7e"}]}],"name":"GetPushData"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'API Call: getstaticdata - Sending...', \n  'info'\n);\n\n$success()"},"_auto_id_":"f449ed45-d4a4-4fef-8829-2be76e1e64e9"},{"event":"click","type":"call-api","data":{"sync":true,"name":"api_rio","operation":"getstaticdata","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}"}},"_auto_id_":"2356ff74-0e5d-4f70-97d1-cc58431bf731","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"var rio_api = cti.store.api.api_rio\nvar response = rio_api.getstaticdata\n\nvar dataObject = {\n  alerttypes : {\n    data : []\n  },\n  alertpriorities : {\n    data : []\n  },\n  getnoteconfig : {\n    data : {\n      progressNoteConfiguration : {}\n    }\n  },\n  getnotetypes : {\n    data : {\n      progressNoteTypes : {\n        uiNoteTypes : []\n      }\n    }\n  },\n  getnotespecialites : {\n    data : {\n      userSpecialties : {\n        userSpecialty : []\n      }\n    }\n  },\n  getnoterisktypes : {\n    data : {\n      riskTypes : {\n        riskType : []\n      }\n    }\n  },\n  getbookingrefdata : {\n    data : {\n      appointmentBookingReferenceData : {}\n    }\n  },\n  diarytemplate : {\n    data : []\n  },\n  teamplannerreferencedata : {\n    data : []\n  },\n  busydiaryslots : {\n    data : []\n  }\n}\n\nif(!response.success) {\n  // GetStaticData status set to failed: false\n  cti.store.variables.getStaticDataStatus = false\n  \n  window.logManager.consoleLog(\n    'API CALL: getstaticdata FAILED - Reason: ' + response.message, \n    'error'\n  );\n\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\" , \n    \"text\" : \"Unable to retrieve Alert Priorities Reference data.\"\n  });\n  \n  cti.fn_toggle_spinner('close');\n} else {\n  // GetStaticData status set to success: true\n  cti.store.variables.getStaticDataStatus = true;\n\n  if(response.data.alertTypes) {\n    // cti.store.variables.getAlertTypesStatus = true\n    dataObject.alerttypes.data = response.data.alertTypes\n  }\n  if(response.data.alertPriorities) {\n    // cti.store.variables.getAlertPrioritiesStatus = true\n    dataObject.alertpriorities.data = response.data.alertPriorities\n  }\n  if(response.data.progressNoteConfiguration) {\n    // cti.store.variables.getNoteConfigStatus = true\n    dataObject.getnoteconfig.data.progressNoteConfiguration = response.data.progressNoteConfiguration\n  }\n  if(response.data.progressNoteTypes) {\n    // cti.store.variables.getNoteTypesStatus = true\n    dataObject.getnotetypes.data.progressNoteTypes.uiNoteTypes = response.data.progressNoteTypes\n  }\n  if(response.data.userSpecialties) {\n    // cti.store.variables.getNoteSpecialitesStatus = true\n    dataObject.getnotespecialites.data.userSpecialties.userSpecialty = response.data.userSpecialties\n  }\n  if(response.data.riskTypes) {\n    // cti.store.variables.getNoteRiskTypesStatus = true\n    dataObject.getnoterisktypes.data.riskTypes.riskType = response.data.riskTypes\n  }\n  if(response.data.appointmentBookingReferenceData) {\n    // cti.store.variables.getBookingRefDataStatus = true\n    dataObject.getbookingrefdata.data.appointmentBookingReferenceData = response.data.appointmentBookingReferenceData\n  }\n  if(response.data.diaryTemplates) {\n    // cti.store.variables.getDiaryTemplateStatus = true\n    dataObject.diarytemplate.data = response.data.diaryTemplates\n  }\n  if(response.data.teamPlannerData) {\n    // cti.store.variables.getTeamRefDataStatus = true\n    dataObject.teamplannerreferencedata.data = response.data.teamPlannerData\n  }\n  if(response.data.busyDiarySlots) {\n    // cti.store.variables.getBusyDiarySlotsStatus = true\n    dataObject.busydiaryslots.data = response.data.busyDiarySlots\n  }\n\n  dataObject.authenticate = rio_api.authenticate\n  cti.store.api.api_rio = JSON.parse(JSON.stringify(dataObject))\n\n  window.logManager.consoleLog(\n    'API CALL: getstaticdata SUCCESS', \n    'info'\n  );\n  \n  cti.fn_toggle_spinner('close');\n  cti.fn_toggle_spinner('open', 'Fetching Appointments, please wait...');\n  \n  cti.utils.callAction(\"call-actionflow\", { name: \"GetVisitList\" });\n}"},"_auto_id_":"30d5a501-96cc-47d2-8dfe-9c120aefc211"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"var rio_api = cti.store.api.api_rio\nvar response = rio_api.getstaticdata\n\n// GetStaticData status set to failed: false\ncti.store.variables.getStaticDataStatus = false\n\nwindow.logManager.consoleLog(\n  'API CALL: getstaticdata FAILED - Reason: ' + $data.$response.message, \n  'error'\n);\n\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\" , \n  \"text\" : \"Unable to retrieve Alert Priorities Reference data.\"\n});\n\ncti.fn_toggle_spinner('close');"},"_auto_id_":"98b61313-a24f-4346-b33f-50ddd7963aed"}]}],"name":"GetStaticData"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'API Call: getappointments - Sending...', \n  'info'\n)\n\n//Set the date range to sync -1, +1\ncti.store.variables.v_appointmentSyncFromDate = moment().subtract(1, 'days').format(\"YYYY-MM-DD\")\ncti.store.variables.v_appointmentSyncToDate = moment().add(1, 'days').format(\"YYYY-MM-DD\")\n\n$success()"},"_auto_id_":"8a658f34-3884-4456-83aa-1cf3d99b1c48","actions":[]},{"event":"click","type":"call-api","data":{"sync":true,"name":"api_rio","operation":"getappointments","params":{"id":"{{$store.pages.Login.username}}","Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","fromDate":"{{$store.variables.v_appointmentSyncFromDate}}","toDate":"{{$store.variables.v_appointmentSyncToDate}}"}},"_auto_id_":"60d96450-e4ef-4998-b6f7-0b6b03828eac","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"// Grab response\nvar response = cti.store.api.api_rio.getappointments\n\nif(!response.success){\n  // GetVisitList status set to failed: false\n  cti.store.variables.getVisitListStatus = false\n\n  cti.fn_toggle_spinner('close')\n\n  window.logManager.consoleLog(\n    'API CALL: getappointments FAILED - Reason: ' + response.message, \n    'error'\n  )\n\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\", \n    \"text\" : \"Unable to get Appointments.\"\n  })                           \n} else {\n  // GetVisitList status set to success: true\n  cti.store.variables.getVisitListStatus = true\n\n  window.logManager.consoleLog(\n    'API CALL: getappointments SUCCESS', \n    'info'\n  )\n\n  window.pouchManager.loadFromDatabase('appointments', function (doc) {\n    var appointments = []\n\n    if(doc.data && doc.data.length > 0) {\n      appointments = doc.data\n      var updatedAppointments = []\n\n      for(var i in response.data) {\n        var responseAppointment = {}\n        var responseAppointment = response.data[i]\n        var exists = false\n\n        for(var x in appointments) {\n          var deviceAppointment = {}\n          var deviceAppointment = appointments[x]\n\n          if(deviceAppointment.appointmentId == responseAppointment.appointmentId) {\n            exists = true\n            break\n          } \n        }\n\n        var pushAppointment = {}\n\n        if(exists) {\n          if(deviceAppointment.status != \"started\") {\n            deviceAppointment = responseAppointment\n          } else {\n            deviceAppointment.patientData = responseAppointment.patientData\n          }\n\n          pushAppointment = JSON.parse(JSON.stringify(deviceAppointment))\n        } else {\n          pushAppointment = JSON.parse(JSON.stringify(responseAppointment))\n        }\n\n        updatedAppointments.push(pushAppointment)\n      }\n    } else {\n      updatedAppointments = response.data\n    }\n\n    window.pouchManager.saveToDatabase(\n      \"appointments\", \n      updatedAppointments, function(rev) {\n        window.logManager.consoleLog(\n          'Pouch DB - Saved Appointment Data. Revision: ' + rev, \n          'info'\n        )\n\n        delete cti.store.api.api_rio.getappointments\n\n        if(cti.store.variables.firstLogin) {\n          delete cti.store.variables.firstLogin\n\n          cti.utils.callAction(\"go-to-page\", { name: \"Set_PIN\" })\n        } else {\n          cti.fn_load_appointments()\n        }\n      }, function(reason, e) {\n        window.logManager.consoleLog(\n          'Pouch DB - Failed to save Appointment Data - ' + reason, e, \n          'error'\n        )\n\n        cti.fn_toggle_spinner('close')\n        delete cti.store.api.api_rio.getappointments\n      })\n  }, function (reason, err) {\n    window.logManager.consoleLog(\n      'Pouch DB - Appointments Pouch DB does not exisit, creating new instance... - ' + reason + err,\n      'Info'\n    )\n\n    window.pouchManager.saveToDatabase(\n      \"appointments\", \n      cti.store.api.api_rio.getappointments.data, function(rev) {\n        window.logManager.consoleLog(\n          'Pouch DB - Saved Appointment Data. Revision: ' + rev, \n          'info'\n        )\n\n        delete cti.store.api.api_rio.getappointments\n\n        if(cti.store.variables.firstLogin) {\n          delete cti.store.variables.firstLogin\n\n          cti.utils.callAction(\"go-to-page\", { name: \"Set_PIN\" })\n        } else {\n          cti.fn_load_appointments()\n        }\n      }, function(reason, e) {\n        window.logManager.consoleLog(\n          'Pouch DB - Failed to save Appointment Data - ' + reason, e, \n          'error'\n        )\n\n        cti.fn_toggle_spinner('close')\n        delete cti.store.api.api_rio.getappointments\n      })\n  })\n}"},"_auto_id_":"300cbab3-9eaf-4577-8c03-fd68a7aa92bf","actions":[]},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"// GetVisitList status set to failed: false\ncti.store.variables.getVisitListStatus = false;\n\ncti.fn_toggle_spinner('close');\n\nwindow.logManager.consoleLog(\n  'API CALL - Fail Response: GetVisitList - Reason: ' + $data.$response.message, \n  'error'\n);\n\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\", \n  \"text\" : \"Unable to connect to server.\"\n});                           \n\n$success();"},"_auto_id_":"ee9159a6-14b9-4d14-886e-677ea32c3711","actions":[]}]}],"name":"GetVisitList"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'Action Flow: Login', \n  'info'\n)\n\nvar platform = cti.store.env.platform.name\n\n// if user is authenticated but no pin is set we need to make the user set a PIN\nif (cti.store.variables.v_isAuthenticated && !cti.store.variables.v_userPIN) {\n  var dataDowload = true;\n\n  if(!cti.store.variables.getStaticDataStatus) { dataDowload = false }\n\n  if(dataDowload) {\n    cti.utils.callAction(\"go-to-page\", { \"name\": \"Set_PIN\" });\n    return false;\n  } else {\n    $success();\n    return false;\n  }\n}\n\nfunction isTouchIdAvailable() {\n  if(window.plugins != undefined) {\n    window.plugins.touchid.isAvailable(\n      function () {\n        iOSverifyPrint();\n      },\n      function (msg) {\n        cti.utils.callAction(\"go-to-page\", { \"name\": \"Enter_PIN\" });\n      }\n    );\n  } else {\n    cti.utils.callAction(\"go-to-page\", { \"name\": \"Enter_PIN\" });\n  }\n}\n\n\nfunction isFingerprintAuthAvailable(){\n\n  FingerprintAuth.isAvailable(function (result) {\n\n    console.log(result);\n\n    if (result.isAvailable == true && result.hasEnrolledFingerprints == true) {\n\n      var encryptConfig = {\n        maxAttempts: 3,\n        locale: \"en_US\",\n        dialogTitle: \"Fingerprint scan\",\n        dialogMessage: \"Please scan your fingerprint\"\n      }; // See config object for required parameters\n\n      FingerprintAuth.encrypt(encryptConfig, function (_fingerResult) {\n        //console.log(\"successCallback(): \" + JSON.stringify(_fingerResult));\n        if (_fingerResult.withFingerprint) {\n          //console.log(\"Successfully encrypted credentials.\");\n          //console.log(\"Encrypted credentials: \" + result.token);\n          cti.utils.callAction(\"go-to-page\", { \"name\": \"Visits\" });\n        } else if (_fingerResult.withBackup) {\n          //console.log(\"Authenticated with backup password\");\n          cti.utils.callAction(\"go-to-page\", { \"name\": \"Visits\" });\n        }\n        // Error callback\n      }, function (err) {\n        if (err === \"Cancelled\") {\n          console.log(\"FingerprintAuth Dialog Cancelled!\");\n        } else {\n          console.log(\"FingerprintAuth Error: \" + err);\n          cti.utils.callAction(\"go-to-page\", { \"name\": \"Enter_PIN\" });\n        }\n      });\n\n    }\n\n    else{\n      console.log(\"FingerprintAuth not found\");\n      cti.utils.callAction(\"go-to-page\", {\"name\" : \"Enter_PIN\"});\n    }\n\n  }); \n\n}    \n\nfunction iOSverifyPrint() {\n  window.plugins.touchid.verifyFingerprintWithCustomPasswordFallbackAndEnterPasswordLabel(\n    'Scan your fingerprint please',\n    'Enter App PIN',\n    function (msg) {\n      cti.utils.callAction(\"go-to-page\", { \"name\": \"Visits\" });\n    },\n    function (msg) {\n      /*   \n            *    code: -3 (fallback)\n            *    code: -2 (cancelled)\n            */\n\n      if (msg.code == '-3') {\n        cti.utils.callAction(\"go-to-page\", {\"name\" : \"Enter_PIN\"});\n\n      }\n    }\n  );\n}\n\nswitch (platform) {\n  case \"ios\":\n    isTouchIdAvailable();\n    break;\n  case \"android\":\n    isFingerprintAuthAvailable();\n    break;\n  default:\n    cti.utils.callAction(\"go-to-page\", {\"name\" : \"Enter_PIN\"});\n}"},"_auto_id_":"e0d9fd0d-59c1-404e-aaa3-bbbb3ea3d843","actions":[{"event":"success","type":"call-component-function","data":{"page":"Login","componentInstanceId":"723ae197-d492-49b6-bde1-ca129f5b4626","function":"toggle"},"_auto_id_":"76872d2e-3da3-472d-b180-ea8867eace2f"}]}],"name":"Login"}],"dataflows":[],"config":[{"name":"App Load Event","type":"event","item-type":"onappload","_auto_id_":"f2e5db87-aa36-449f-8128-a4dc77963667","actions":[{"event":"onappload","type":"inline-function","data":{"sync":true,"code":"function storeOrientation(){\n\tswitch(window.orientation) \n    {  \n      case -90:\n      case 90:\n        cti.store.variables.orientation = 'landscape';\n        break; \n      default:\n        if (window.innerWidth > window.innerHeight) {\n          cti.store.variables.orientation = 'landscape';\n        }\n        else\n        {\n          cti.store.variables.orientation = 'portrait';\n        }\n        break; \n    }\n  \tcti.utils.updatePage();\n}\n\nfunction storeOnlineStatus() {\n\tcti.store.variables.online = \"online\";\n  \tcti.utils.updatePage();\n}\n\nfunction storeOfflineStatus() {\n\tcti.store.variables.online = \"offline\";\n  \tcti.utils.updatePage();\n}\n  \n//mobile / desktop\nwindow.addEventListener('orientationchange', storeOrientation);\nwindow.addEventListener('resize', storeOrientation);\n\nwindow.addEventListener('online',  storeOnlineStatus);\nwindow.addEventListener('offline', storeOfflineStatus);\n\nstoreOrientation();\n\ncti.store.variables.online = (navigator.onLine ? \"online\" : \"offline\");\n\n//prevent iOS from highlighting phone numbers!\n$('head').append('<meta name=\"format-detection\" content=\"telephone=no\" />');\n\n$success();"},"_auto_id_":"d53cc595-5d4e-43ab-a1c2-e8d48cd5a9b2"}]},{"name":"js_moment","type":"scripting","item-type":"js-asset","_auto_id_":"202c0252-82ef-4b33-a49d-3fb80b1116db","fileName":"moment.min.js"},{"name":"js_slip","type":"scripting","item-type":"js-asset","_auto_id_":"533d19d5-1713-43ee-b559-1e2fd8e4635f","fileName":"slip.js"},{"name":"pdf","type":"scripting","item-type":"js-asset","_auto_id_":"fd94355c-9a7d-42e8-b227-d30fbb5e5ca4","fileName":"pdf.js"},{"name":"pdf_worker","type":"scripting","item-type":"js-asset","_auto_id_":"4e7bb6e3-b8c1-41ba-bb31-f106e93692e0","fileName":"pdf.worker.js"},{"name":"pouchManager","type":"scripting","item-type":"js-asset","_auto_id_":"3c661861-9777-414e-9cc0-9f9e4e3ad750","fileName":"pouchManager.js"},{"name":"logManager","type":"scripting","item-type":"js-asset","_auto_id_":"93914f96-7ca9-4531-8d5c-4ab8886c95bd","fileName":"logManager.js"},{"name":"testPushResponse","type":"scripting","item-type":"function","_auto_id_":"b25df889-0bf6-406c-8ae0-f82f1015992c","sync":true,"params":[{"name":"notification","required":true}],"content":"window.logManager.consoleLog(\n  'function testPushResponse(notification)', \n  'info'\n);\n\n/*\n{\n  \"event\": \"message\",\n  \"payload\": {\n    \"clientId\": {\n      \"type\": \"MRN\",\n      \"value\": \"RRRiO6MOD0922\"\n    },\n    \"notificationType\": \"AlertAdded\"\n  },\n  \"from\": \"888020801908\",\n  \"message\": \"Patient Updated\",\n  \"service\": \"GCM\"\n}\n*/\n\n// Notifty user we are updating device data\ncti.fn_toggle_spinner('open', 'Update Received, refreshing Appointment list, please wait...');\n\n// Grab the response\nvar pushPayload = JSON.parse(notification)\n// COPY EVERYTHING BELOW THIS LINE TO NOTIFICATION ACTION\nvar notificationType = \"\"\n\nif(pushPayload.payload && pushPayload.payload.notificationType) {\n  notificationType = pushPayload.payload.notificationType\n} else {\n  notificationType = \"Error\"\n}\ndebugger;\nif(notificationType == \"AppointmentCancelled\") {\n  // AppointmentCancelled: Remove the appointment from device, reload the \n  // appointments data and navigate user back to visits page\n\n  // Set the appointment to cancel\n  if(pushPayload.payload.appointmentId) {\n    cti.store.variables.appointmentId = pushPayload.payload.appointmentId\n  } else {\n    cti.fn_toggle_spinner('close', '')\n    return false\n  }\n\n  // Load appointments from pouch\n  window.pouchManager.loadFromDatabase('appointments', function (doc) {\n    // Set the appointments array\n    var appointments = doc.data\n\n    // Find the appointment on device...\n    for(var i in appointments) {\n      if(appointments[i].appointmentId == cti.store.variables.appointmentId) {\n        // ... and remove it from the main array\n        appointments.splice(i, 1)\n        break;\n      }\n    }\n\n    // Check that we aren't the the current visit, and if we are\n    // then remove the data\n    var selectedVisit = cti.store.variables.selected_visit\n\n    if(selectedVisit) {\n      if(selectedVisit.appointmentId == cti.store.variables.appointmentId) {\n        cti.store.variables.return = true\n      }\n    }\n\n    // Update the pouch DB with cancelled appointment\n    window.pouchManager.saveToDatabase(\"appointments\", appointments, function(rev) {\n      var app = cti.store.variables.appointmentId\n      window.logManager.consoleLog(\n        'Pouch DB - Removed appointment '+app+' successfully. Revision: '+rev, \n        'info'\n      );\n\n      if(cti.store.variables.return) {\n        delete cti.store.variables.selected_visit\n        cti.fn_load_appointments()\n      }\n\n      cti.fn_toggle_spinner('close', '')\n      delete cti.store.variables.appointmentId\n    }, function(reason, e) {\n      var app = cti.store.variables.appointmentId\n      window.logManager.consoleLog(\n        'Pouch DB - Error updating pouch for appointment '+app+'. Reason: '+reason+e, \n        'error'\n      );\n\n      cti.fn_toggle_spinner('close')\n      delete cti.store.variables.appointmentId\n    });\n  }, function (reason, err) {\n    window.logManager.consoleLog(\n      'Pouch DB - Failed retriveing Appointments Data from Pouch - ', reason + err, \n      'error'\n    );\n\n    cti.fn_toggle_spinner('close')\n    delete cti.store.variables.appointmentId\n  });\n} else if(notificationType == \"AppointmentUpdated\" || notificationType == \"AppointmentOutcomed\") {\n  // AppointmentUpdated or AppointmentOutcomed: set the global payload to contain \n  // the appointmentId and the exists flag (true in this case)\n\n  // Check that we have a value appointmentId\n  if(pushPayload.payload.appointmentId) {\n    cti.store.variables.pushDataPayload = {\n      pushType: \"appointment\",\n      appointmentId : pushPayload.payload.appointmentId,\n      appointmentExists : true\n    }\n  } else {\n    cti.fn_toggle_spinner('close', '')\n    return false\n  }\n\n  // Call the GetAppointment ActionFlow\n  cti.utils.callAction(\"call-actionflow\", { name: \"GetPushData\" })\n} else if(notificationType == \"AppointmentAdded\") {\n  // AppointmentAdded: set the global payload to contain \n  // the appointmentId and the exists flag (false in this case)\n\n  // Check that we have a value appointmentId\n  if(pushPayload.payload.appointmentId) {\n    cti.store.variables.pushDataPayload = {\n      pushType: \"appointment\",\n      appointmentId : pushPayload.payload.appointmentId,\n      appointmentExists : false\n    }\n  } else {\n    cti.fn_toggle_spinner('close', '')\n    return false\n  }\n\n  // Call the GetAppointment ActionFlow\n  cti.utils.callAction(\"call-actionflow\", { name: \"GetPushData\" })\n} else if(notificationType == \"DemographicUpdated\" || notificationType == \"GPUpdated\" || notificationType == \"AddressUpdated\") {\n  // DemographicUpdated, GPUpdated, AddressUpdated, DeathRegistered: set the global payload to contain \n  // the appointmentId and the exists flag (true for the demographics flag)\n\n  // Check that we have a value appointmentId\n  if(pushPayload.payload.clientId) {\n    cti.store.variables.pushDataPayload = {\n      pushType: \"patient\",\n      clientId : pushPayload.payload.clientId,\n      appointmentExists : false,\n      includeDemographics : true\n    }\n  } else {\n    cti.fn_toggle_spinner('close', '')\n    return false\n  }\n\n  // Call the GetAppointment ActionFlow\n  cti.utils.callAction(\"call-actionflow\", { name: \"GetPushData\" })\n} else if(notificationType == \"DeathRegistered\") {\n  // DeathRegistered: Remove any appointments from device, reload the \n  // appointments data and navigate user back to visits page\n\n  // Set the appointment to cancel\n  if(pushPayload.payload.clientId) {\n    cti.store.variables.clientId = pushPayload.payload.clientId\n  } else {\n    cti.fn_toggle_spinner('close', '')\n    return false\n  }\n\n  // Load appointments from pouch\n  window.pouchManager.loadFromDatabase('appointments', function (doc) {\n    // Set the appointments array\n    var appointments = doc.data\n\n    // Find the appointment on device...\n    for(var i in appointments) {\n      if(appointments[i].attendees.attendee.clientId.value == cti.store.variables.clientId.value) {\n        // ... and remove it from the main array\n        appointments.splice(i, 1)\n      }\n    }\n\n    // Check that we aren't the the current visit, and if we are\n    // then remove the data\n    var selectedVisit = cti.store.variables.selected_visit\n\n    if(selectedVisit) {\n      if(selectedVisit.attendees.attendee.clientId.value == cti.store.variables.clientId.value) {\n        cti.store.variables.return = true\n      }\n    }\n\n    // Update the pouch DB with cancelled appointment\n    window.pouchManager.saveToDatabase(\"appointments\", appointments, function(rev) {\n      var app = cti.store.variables.clientId.value\n      window.logManager.consoleLog(\n        'Pouch DB - Removed patient appointments '+app+' successfully. Revision: '+rev, \n        'info'\n      );\n\n      if(cti.store.variables.return) {\n        delete cti.store.variables.selected_visit\n        cti.fn_load_appointments()\n      }\n\n      cti.fn_toggle_spinner('close', '')\n      delete cti.store.variables.clientId\n    }, function(reason, e) {\n      var app = cti.store.variables.clientId.value\n      window.logManager.consoleLog(\n        'Pouch DB - Error updating pouch for appointment '+app+'. Reason: '+reason+e, \n        'error'\n      );\n\n      cti.fn_toggle_spinner('close')\n      delete cti.store.variables.clientId\n    });\n  }, function (reason, err) {\n    window.logManager.consoleLog(\n      'Pouch DB - Failed retriveing Appointments Data from Pouch - ', reason + err, \n      'error'\n    );\n\n    cti.fn_toggle_spinner('close')\n    delete cti.store.variables.clientId\n  });\n} else if(notificationType == \"AllergyAdded\" || notificationType == \"AllergyRemoved\") {\n  // AllergyAdded, AllergyRemoved: set the global payload to contain \n  // the appointmentId and the exists flag (true for the allergies flag)\n\n  // Check that we have a value appointmentId\n  if(pushPayload.payload.clientId) {\n    cti.store.variables.pushDataPayload = {\n      pushType: \"patient\",\n      clientId : pushPayload.payload.clientId,\n      appointmentExists : false,\n      includeAllergies : true\n    }\n  } else {\n    cti.fn_toggle_spinner('close', '')\n    return false\n  }\n\n  // Call the GetAppointment ActionFlow\n  cti.utils.callAction(\"call-actionflow\", { name: \"GetPushData\" })\n} else if(notificationType == \"AlertAdded\" || notificationType == \"AlertRemoved\") {\n  // AlertAdded, AlertRemoved: set the global payload to contain \n  // the appointmentId and the exists flag (true for the alerts flag)\n\n  // Check that we have a value appointmentId\n  if(pushPayload.payload.clientId) {\n    cti.store.variables.pushDataPayload = {\n      pushType: \"patient\",\n      clientId : pushPayload.payload.clientId,\n      appointmentExists : false,\n      includeAlerts : true\n    }\n  } else {\n    cti.fn_toggle_spinner('close', '')\n    return false\n  }\n\n  // Call the GetAppointment ActionFlow\n  cti.utils.callAction(\"call-actionflow\", { name: \"GetPushData\" })\n} else {\n  cti.fn_toggle_spinner('close')\n}"},{"name":"fn_update_patient_data","type":"scripting","item-type":"function","_auto_id_":"6912f128-f7fd-42af-97d0-fb6069a3a31b","sync":true,"params":[{"name":"clientId"},{"name":"type"},{"name":"data"},{"name":"appointmentId"}],"content":"window.logManager.consoleLog(\n  'function fn_update_patient_data(clientId, type, data)', \n  'info'\n)\n\nwindow.pouchManager.loadFromDatabase('appointments', function (doc) {\n  if(doc.data && doc.data.length > 0) {\n    appointments = doc.data\n\n    for(var i in appointments) {\n      var thisAppointment = appointments[i]\n\n      if(thisAppointment.attendees.attendee.clientId.value == clientId) {\n        if(type == \"alerts\") {\n          thisAppointment.patientData.alerts = data\n        } else if(type == \"notes\") {\n          thisAppointment.patientData.progressNotes = data\n        } else if(type == \"lifestyle\") {\n          thisAppointment.patientData.lifestyleAssessmentForms = data\n          \n          for (var x in thisAppointment.patientData.lifestyleAssessmentForms) {\n            var lifestyleForm = thisAppointment.patientData.lifestyleAssessmentForms[x]\n            var date = lifestyleForm.assessmentDate.result\n\n            lifestyleForm.assessmentDate.displayDate = moment(date).format(\"DD MMM YYYY HH:mm\")\n          }\n\n          if(thisAppointment.appointmentId == appointmentId) {\n            thisAppointment.lifestyle_form_status = \"complete\"\n            thisAppointment.lifestyle_form_status_text = \"Completed\"\n\n            delete thisAppointment.lifestyle_form_page_one\n            delete thisAppointment.lifestyle_form_page_two\n            delete thisAppointment.lifestyle_form_page_three\n            delete thisAppointment.lifestyle_form_page_four\n            delete thisAppointment.lifestyle_form_page_five\n            delete thisAppointment.lifestyle_form_page_six\n          }\n        } else if(type == \"dialog\") {\n          thisAppointment.patientData.dialogPlusForms = data\n          \n          for (var x in thisAppointment.patientData.dialogPlusForms) {\n            var dialogPlusForm = thisAppointment.patientData.dialogPlusForms[x]\n            var date = dialogPlusForm.assessmentDate.result\n\n            dialogPlusForm.assessmentDate.displayDate = moment(date).format(\"DD MMM YYYY HH:mm\")\n          }\n\n          if(thisAppointment.appointmentId == appointmentId) {\n            thisAppointment.dialog_form_status = \"complete\"\n            thisAppointment.dialog_form_status_text = \"Completed\"\n\n            delete thisAppointment.dialog_form_page\n          }\n        } else if(type == \"safety\") {\n          thisAppointment.patientData.mySafetyPlanForms = data\n          \n          for (var x in thisAppointment.patientData.mySafetyPlanForms) {\n            var mySafetyPlanForm = thisAppointment.patientData.mySafetyPlanForms[x]\n            var date = mySafetyPlanForm.assessmentDate.result\n\n            mySafetyPlanForm.assessmentDate.displayDate = moment(date).format(\"DD MMM YYYY HH:mm\")\n          }\n\n          if(thisAppointment.appointmentId == appointmentId) {\n            thisAppointment.safety_form_status = \"complete\"\n            thisAppointment.safety_form_status_text = \"Completed\"\n\n            delete thisAppointment.safety_form_page\n          }\n        }\n      }\n    }\n  }\n\n  window.pouchManager.saveToDatabase(\n    \"appointments\", \n    appointments, function(rev) {\n      window.logManager.consoleLog(\n        'Pouch DB - Saved Appointment Data. Revision: ' + rev, \n        'info'\n      )\n    }, function(reason, e) {\n      window.logManager.consoleLog(\n        'Pouch DB - Failed to save Appointment Data - ' + reason, e, \n        'error'\n      )\n    })\n}, function (reason, err) {\n  window.logManager.consoleLog(\n    'Pouch DB - Appointments Pouch DB does not exisit, creating new instance... - ' + reason + err,\n    'Info'\n  )\n\n})"},{"name":"fn_save_appointment","type":"scripting","item-type":"function","_auto_id_":"c9addaf6-e131-4e49-af12-e74947b7a50e","sync":true,"params":[],"content":"window.logManager.consoleLog(\n  'function fn_save_appointment(selected_visit)', \n  'info'\n)\n\ncti.fn_toggle_spinner('open', 'Returning to Appointments List...')\n\nvar selected_visit = cti.store.variables.selected_visit\nvar dialog = cti.store.variables.selected_visit.dialog_form_status\nvar lifestyle = cti.store.variables.selected_visit.lifestyle_form_status\nvar safety = cti.store.variables.selected_visit.safety_form_status\n\n// Retain any currently inprogress forms for usage later on\nif(dialog == \"inprogress\" || dialog == \"failed\") {\n  selected_visit.dialog_form_page = {\n    dialog_form_page_pre : cti.store.pages.DialogFormPre,\n    dialog_form_page_one : cti.store.pages.DialogFormOne,\n    dialog_form_page_two : cti.store.pages.DialogFormTwo,\n    dialog_form_page_three : cti.store.pages.DialogFormThree,\n    dialog_form_page_four : cti.store.pages.DialogFormFour,\n    dialog_form_page_five : cti.store.pages.DialogFormFive,\n    dialog_form_page_six : cti.store.pages.DialogFormSix,\n    dialog_form_page_seven : cti.store.pages.DialogFormSeven,\n    dialog_form_page_eight : cti.store.pages.DialogFormEight,\n    dialog_form_page_nine : cti.store.pages.DialogFormNine,\n    dialog_form_page_ten : cti.store.pages.DialogFormTen,\n    dialog_form_page_eleven : cti.store.pages.DialogFormEleven,\n    dialog_form_page_twelve : cti.store.pages.DialogFormTwelve,\n    dialog_form_page_thirteen : cti.store.pages.DialogFormThirteen,\n    dialog_form_page_fourteen : cti.store.pages.DialogFormFourteen\n  }\n}\nif(lifestyle == \"inprogress\" || lifestyle == \"failed\") {\n  selected_visit.lifestyle_form_page = {\n    lifestyle_form_page_one : cti.store.pages.LifestyleFormOne,\n    lifestyle_form_page_two : cti.store.pages.LifestyleFormTwo,\n    lifestyle_form_page_three : cti.store.pages.LifestyleFormThree,\n    lifestyle_form_page_four : cti.store.pages.LifestyleFormFour,\n    lifestyle_form_page_five : cti.store.pages.LifestyleFormFive,\n    lifestyle_form_page_six : cti.store.pages.LifestyleFormSix,\n    lifestyle_form_repeater_three : cti.store.repeater.LifestyleFormThree,\n    lifestyle_form_repeater_five : cti.store.repeater.LifestyleForm\n  }\n} \nif(safety == \"inprogress\" || safety == \"failed\") {\n  selected_visit.safety_form_page = cti.store.pages.SafetyForm\n}\n\n// Load appointments from pouch\nwindow.pouchManager.loadFromDatabase('appointments', function (doc) {\n  var appointments = doc.data;\n\n  // Check that we have a valid appointment\n  for(var i in appointments) {\n    if(appointments[i].appointmentId == cti.store.variables.selected_visit.appointmentId) {\n      // Update the appointment data with the selected appointment\n      appointments[i] = cti.store.variables.selected_visit;\n      break;\n    }\n  }\n\n  // Update the pouch DB with new data\n  window.pouchManager.saveToDatabase(\"appointments\", appointments, function(rev) {\n    window.logManager.consoleLog(\n      'Pouch DB: Updated Appointment Data. Revision: ' + rev,\n      'info'\n    )\n    \n    // Clear down dialog form data\n    cti.utils.destroyPageData('DialogFormPre')\n    cti.utils.destroyPageData('DialogFormOne')\n    cti.utils.destroyPageData('DialogFormTwo')\n    cti.utils.destroyPageData('DialogFormThree')\n    cti.utils.destroyPageData('DialogFormFour')\n    cti.utils.destroyPageData('DialogFormFive')\n    cti.utils.destroyPageData('DialogFormSix')\n    cti.utils.destroyPageData('DialogFormSeven')\n    cti.utils.destroyPageData('DialogFormEight')\n    cti.utils.destroyPageData('DialogFormNine')\n    cti.utils.destroyPageData('DialogFormTen')\n    cti.utils.destroyPageData('DialogFormEleven')\n    cti.utils.destroyPageData('DialogFormTwelve')\n    cti.utils.destroyPageData('DialogFormThirteen')\n    cti.utils.destroyPageData('DialogFormFourteen')\n\n    // Clear down lifestyle form data\n    cti.utils.destroyPageData('LifestyleFormOne')\n    cti.utils.destroyPageData('LifestyleFormTwo')\n    cti.utils.destroyPageData('LifestyleFormThree')\n    cti.utils.destroyPageData('LifestyleFormFour')\n    cti.utils.destroyPageData('LifestyleFormFive')\n    cti.utils.destroyPageData('LifestyleFormSix')\n    cti.store.repeater.LifestyleFormThree = {}\n    cti.store.repeater.LifestyleFormFive = {}\n\n    // Clear down safety form data\n    cti.utils.destroyPageData('SafetyForm')\n    \n    // Clear down form views\n    cti.utils.destroyPageData('DialogForm_View')\n    cti.utils.destroyPageData('LifestyleForm_View')\n    cti.utils.destroyPageData('SafetyForm_View')\n    \n    // Clear down submission entry pages\n    cti.utils.destroyPageData('Alert')\n    cti.utils.destroyPageData('RemoveAlert')\n    cti.utils.destroyPageData('Note')\n    cti.utils.destroyPageData('Outcome')\n    \n    // Set clear down variable\n    cti.store.variables.clearDown = true\n\n    // Reset appointments\n    cti.fn_load_appointments()\n  }, function(reason, e) {\n    // Reset appointments\n    cti.fn_load_appointments()\n\n    window.logManager.consoleLog(\n      'Pouch DB: Failed to Update Appointment Data - ' + reason + e,\n      'error'\n    )\n  })\n}, function (reason, err) {\n  // Reset appointments\n  cti.fn_load_appointments()\n  \n  window.logManager.consoleLog(\n    'Pouch DB: Error: Failed retriveing Appointments Data from Pouch - ' + reason + err,\n    'error'\n  )\n})"},{"name":"fn_navigate","type":"scripting","item-type":"function","_auto_id_":"f3d7cea4-1ab7-450e-8624-cdefbbea95bc","sync":true,"params":[{"name":"postcode"}],"content":"window.logManager.consoleLog(\n  'function fn_navigate(postcode)', \n  'info'\n)\n\nif(navigator.appVersion.indexOf('Macintosh') != -1) { \n  cti.utils.callAction(\"call-url\", {\"name\":\"url_google_maps\",\"params\":{\"saddr\":\"current location\",\"daddr\":postcode}})\n} else {\n  var destination = \"geo:0,0?q=\" + postcode.replace(/\\s/g,'')\n  window.open(destination)\n}","actions":[]},{"name":"fn_save_to_pouch","type":"scripting","item-type":"function","_auto_id_":"02ac2616-9ecc-48cb-b08b-1622f4fb42ed","sync":true,"params":[{"name":"type","description":"The type of data we are sending","required":true},{"name":"data","description":"Data payload","required":true},{"name":"exists","description":"Whether we are updating patientData or not"},{"name":"id","description":"Either clientId or appointmentId"}],"content":"window.logManager.consoleLog(\n  'function fn_save_to_pouch(type, data, exists, id)', \n  'info'\n)\n\nif(exists === undefined) { exists = false }\n\nwindow.pouchManager.loadFromDatabase('appointments', function (doc) {\n  var selectedVisit = cti.store.variables.selected_visit\n  var appointments = doc.data\n  \n  if(type == \"demographics\") {\n    for(var i in appointments) {\n      if(appointments[i].attendees.attendee.clientId.value == id) {\n        appointments[i].patientData.demographics = data.data.patientDemographic\n      }\n    }\n    \n    if(selectedVisit) {\n      if(selectedVisit.attendees.attendee.clientId.value == id) {\n        selectedVisit.patientData.demographics = data.data.patientDemographic\n        cti.fn_prep_timeline()\n      }\n    }\n  } else if(type == \"allergies\") {\n    for(var i in appointments) {\n      if(appointments[i].attendees.attendee.clientId.value == id) {\n        appointments[i].patientData.allergies = data.data.allergies\n      }\n    }\n    \n    if(selectedVisit) {\n      if(selectedVisit.attendees.attendee.clientId.value == id) {\n        selectedVisit.patientData.allergies = data.data.allergies\n        cti.fn_prep_timeline()\n      }\n    }\n  } else if(type == \"alerts\") {\n    for(var i in appointments) {\n      if(appointments[i].attendees.attendee.clientId.value == id) {\n        appointments[i].patientData.alerts = data.data.alerts\n      }\n    }\n    \n    if(selectedVisit) {\n      if(selectedVisit.attendees.attendee.clientId.value == id) {\n        selectedVisit.patientData.alerts = data.data.alerts\n        cti.fn_prep_timeline()\n      }\n    }\n  } else if(type == \"appointment\") {\n    if(exists) {\n      for(var i in appointments) {\n        if(appointments[i].appointmentId == id) {\n          appointments[i].appointmentDateTime = data.data.appointment.appointmentDateTime\n          appointments[i].appointmentId = data.data.appointment.appointmentId\n          appointments[i].appointmentType = data.data.appointment.appointmentType\n          appointments[i].attendees = data.data.appointment.attendees\n          appointments[i].createdAtDateTime = data.data.appointment.createdAtDateTime\n          appointments[i].hasPreviousFirstAppointmentOutcome = data.data.appointment.hasPreviousFirstAppointmentOutcome\n          appointments[i].healthcareProfessional = data.data.appointment.healthcareProfessional\n          appointments[i].intendedDuration = data.data.appointment.intendedDuration\n          appointments[i].location = data.data.appointment.location\n          break\n        }\n      }\n\n      // Check that we aren't in an appointment and if we are, update it\n      var selectedVisit = cti.store.variables.selected_visit\n      if(selectedVisit) {\n        if(selectedVisit.appointmentId === id) {\n          selectedVisit.appointmentDateTime = data.data.appointment.appointmentDateTime\n          selectedVisit.appointmentId = data.data.appointment.appointmentId\n          selectedVisit.appointmentType = data.data.appointment.appointmentType\n          selectedVisit.attendees = data.data.appointment.attendees\n          selectedVisit.createdAtDateTime = data.data.appointment.createdAtDateTime\n          selectedVisit.hasPreviousFirstAppointmentOutcome = data.data.appointment.hasPreviousFirstAppointmentOutcome\n          selectedVisit.healthcareProfessional = data.data.appointment.healthcareProfessional\n          selectedVisit.intendedDuration = data.data.appointment.intendedDuration\n          selectedVisit.location = data.data.appointment.location\n          cti.fn_prep_timeline()\n        }\n      }\n    } else {\n      appointments.push(data.data.appointment)\n\n      appointments.sort(function(a,b) { \n        return new Date(a.appointmentDateTime).getTime() - new Date(b.appointmentDateTime).getTime() \n      });\n    }\n  }\n \n  // Update the pouch DB with new data\n  window.pouchManager.saveToDatabase(\"appointments\", appointments, function(rev) {\n    window.logManager.consoleLog(\n      'Pouch DB - Saved Appointment Data. Revision: ' + rev, \n      'info'\n    )\n\n    // Reset appointments\n    delete cti.store.variables.pushDataPayload\n    delete cti.store.api.api_rio.getappointment\n\n    // Reset appointments only if we are on a valid page to do so\n    if(cti.store.state.currentPage == \"Visits\") { \n      cti.fn_load_appointments();\n    }\n    \n    cti.fn_toggle_spinner('close')\n  }, function(reason, e) {\n    window.logManager.consoleLog(\n      'Pouch DB - Failed to update appointment '+id+'. '+reason+e, \n      'error'\n    )\n    \n    cti.fn_toggle_spinner('close')\n  });\n}, function (reason, err) {\n  window.logManager.consoleLog(\n    'Pouch DB - Failed to update appointment '+id+'. '+reason+err, \n    'error'\n  )\n\n  cti.fn_toggle_spinner('close')\n});"},{"name":"fn_toggle_lifestyle","type":"scripting","item-type":"function","_auto_id_":"02cb599e-dd7d-4b8c-aa38-a24abde1cd6a","sync":true,"params":[{"name":"id"}],"content":"window.logManager.consoleLog(\n  'function fn_toggle_lifestyle(id)', \n  'info'\n);\n\nvar elm = document.getElementById(id)\nvar elementClasses = elm.classList\nvar navigateClass = elementClasses[2]\n\nif(navigateClass == \"fa-chevron-up\") {\n  elm.classList.remove(\"fa-chevron-up\")\n  elm.classList.add(\"fa-chevron-down\")\n  \n  if(id == \"smoking\") {\n    cti.store.variables.lifestyleHideFlags.smoking = true\n  } else if(id == \"diet\") {\n    cti.store.variables.lifestyleHideFlags.diet = true\n  } else if(id == \"exercise\") {\n    cti.store.variables.lifestyleHideFlags.exercise = true\n  } else if(id == \"alcohol\") {\n    cti.store.variables.lifestyleHideFlags.alcohol = true\n  } else if(id == \"drugs\") {\n    cti.store.variables.lifestyleHideFlags.drugs = true\n  } else if(id == \"other\") {\n    cti.store.variables.lifestyleHideFlags.other = true\n  }\n} else {\n  elm.classList.add(\"fa-chevron-up\")\n  elm.classList.remove(\"fa-chevron-down\")\n  \n  if(id == \"smoking\") {\n    cti.store.variables.lifestyleHideFlags.smoking = false\n  } else if(id == \"diet\") {\n    cti.store.variables.lifestyleHideFlags.diet = false\n  } else if(id == \"exercise\") {\n    cti.store.variables.lifestyleHideFlags.exercise = false\n  } else if(id == \"alcohol\") {\n    cti.store.variables.lifestyleHideFlags.alcohol = false\n  } else if(id == \"drugs\") {\n    cti.store.variables.lifestyleHideFlags.drugs = false\n  } else if(id == \"other\") {\n    cti.store.variables.lifestyleHideFlags.other = false\n  }\n}\n\ncti.utils.updatePage()"},{"name":"fn_toggle_dialog","type":"scripting","item-type":"function","_auto_id_":"0965d0b3-2e37-436a-88e8-f0da6d76e636","sync":true,"params":[{"name":"id"}],"content":"window.logManager.consoleLog(\n  'function fn_toggle_dialog(id)', \n  'info'\n)\n\nvar elm = document.getElementById(id)\nvar elementClasses = elm.classList\nvar navigateClass = elementClasses[2]\n\nif(navigateClass == \"fa-chevron-up\") {\n  elm.classList.remove(\"fa-chevron-up\")\n  elm.classList.add(\"fa-chevron-down\")\n  \n  if(id == \"assessment\") {\n    cti.store.variables.dialogHideFlags.assessment = true\n  } else if(id == \"mental\") {\n    cti.store.variables.dialogHideFlags.mental = true\n  } else if(id == \"physical\") {\n    cti.store.variables.dialogHideFlags.physical = true\n  } else if(id == \"job\") {\n    cti.store.variables.dialogHideFlags.job = true\n  } else if(id == \"accommodation\") {\n    cti.store.variables.dialogHideFlags.accommodation = true\n  } else if(id == \"leisure\") {\n    cti.store.variables.dialogHideFlags.leisure = true\n  } else if(id == \"family\") {\n    cti.store.variables.dialogHideFlags.family = true\n  } else if(id == \"friendships\") {\n    cti.store.variables.dialogHideFlags.friendships = true\n  } else if(id == \"personal\") {\n    cti.store.variables.dialogHideFlags.personal = true\n  } else if(id == \"finances\") {\n    cti.store.variables.dialogHideFlags.finances = true\n  } else if(id == \"identity\") {\n    cti.store.variables.dialogHideFlags.identity = true\n  } else if(id == \"substance\") {\n    cti.store.variables.dialogHideFlags.substance = true\n  } else if(id == \"medication\") {\n    cti.store.variables.dialogHideFlags.medication = true\n  } else if(id == \"practical\") {\n    cti.store.variables.dialogHideFlags.practical = true\n  } else if(id == \"meetings\") {\n    cti.store.variables.dialogHideFlags.meetings = true\n  }\n} else {\n  elm.classList.add(\"fa-chevron-up\")\n  elm.classList.remove(\"fa-chevron-down\")\n  \n  if(id == \"assessment\") {\n    cti.store.variables.dialogHideFlags.assessment = false\n  } else if(id == \"mental\") {\n    cti.store.variables.dialogHideFlags.mental = false\n  } else if(id == \"physical\") {\n    cti.store.variables.dialogHideFlags.physical = false\n  } else if(id == \"job\") {\n    cti.store.variables.dialogHideFlags.job = false\n  } else if(id == \"accommodation\") {\n    cti.store.variables.dialogHideFlags.accommodation = false\n  } else if(id == \"leisure\") {\n    cti.store.variables.dialogHideFlags.leisure = false\n  } else if(id == \"family\") {\n    cti.store.variables.dialogHideFlags.family = false\n  } else if(id == \"friendships\") {\n    cti.store.variables.dialogHideFlags.friendships = false\n  } else if(id == \"personal\") {\n    cti.store.variables.dialogHideFlags.personal = false\n  } else if(id == \"finances\") {\n    cti.store.variables.dialogHideFlags.finances = false\n  } else if(id == \"identity\") {\n    cti.store.variables.dialogHideFlags.identity = false\n  } else if(id == \"substance\") {\n    cti.store.variables.dialogHideFlags.substance = false\n  } else if(id == \"medication\") {\n    cti.store.variables.dialogHideFlags.medication = false\n  } else if(id == \"practical\") {\n    cti.store.variables.dialogHideFlags.practical = false\n  } else if(id == \"meetings\") {\n    cti.store.variables.dialogHideFlags.meetings = false\n  }\n}\n\ncti.utils.updatePage()"},{"name":"fn_toggle_visit_menu","type":"scripting","item-type":"function","_auto_id_":"fe2fae25-2d57-4d0f-ac78-92d263951060","sync":true,"params":[{"name":"id"}],"content":"window.logManager.consoleLog(\n  'function fn_toggle_visit_menu(id)', \n  'info'\n);\n\nvar idx = JSON.parse(id);\nvar alreadyexpanded = ($('#group_visit_' + idx.$index + ' > div')[0].className.indexOf('row-expanded') > -1);\n$('#list_visits md-group > div').removeClass('row-expanded');\nif (!alreadyexpanded) {\n\t$('#group_visit_' + idx.$index + ' > div').toggleClass('row-expanded');\n}"},{"name":"fn_revoke_cleardown","type":"scripting","item-type":"function","_auto_id_":"97b070e5-ecdf-48ee-b215-7350cc921094","sync":true,"params":[],"content":"window.logManager.consoleLog(\n  'function fn_revoke_cleardown()', \n  'info'\n);\n\n// Clear down appointment specific data\ndelete cti.store.variables.show_advanced_note\ndelete cti.store.variables.show_advanced_appt\n\n// Clear down data success flags\ndelete cti.store.variables.getStaticDataStatus\ndelete cti.store.variables.getVisitListStatus\n\n// Clear down appointment listing data\ndelete cti.store.variables.v_appointmentSyncFromDate\ndelete cti.store.variables.v_appointmentSyncToDate\ndelete cti.store.variables.v_appointmentDate\ndelete cti.store.variables.v_appointmentDateText\ndelete cti.store.variables.v_selectedDayAppointments\ndelete cti.store.variables.v_appointments\ndelete cti.store.variables.v_dialogForms\ndelete cti.store.variables.v_safetyForms\n\n// Clear down user credentials\ndelete cti.store.variables.v_userPIN\ndelete cti.store.variables.v_pinAttempts\ndelete cti.store.variables.auth_header\n\n// Clear down app level data\n// NOTE: Not sure how this will affect the app for now, might need reviewing at some point\ndelete cti.store.variables.v_diary_template\ndelete cti.store.variables.v_planner\ndelete cti.store.variables.duration_minutes\ndelete cti.store.variables.duration_hours\n\nreturn true;"},{"name":"fn_DialogForm_Toggler","type":"scripting","item-type":"function","_auto_id_":"8c019918-0c14-4a22-a90a-5860b5bc081f","sync":true,"params":[{"name":"index","required":true}],"content":"window.logManager.consoleLog(\n  'function fn_DialogForm_Toggler(index)', \n  'info'\n);\n\ncti.store.pages.DialogPlus_Form.active_question = parseInt(index, 10);\ncti.store.pages.DialogPlus_Form.active_question_display = parseInt(index, 10) +1;\ncti.utils.updatePage();","actions":[]},{"name":"fn_call_contact","type":"scripting","item-type":"function","_auto_id_":"a25dd8d1-f5be-4dd4-9f6d-eb7a68d7c325","sync":true,"params":[{"name":"scope","description":"Element of 'this' from the onclick"}],"content":"window.logManager.consoleLog(\n  'function fn_call_contact(scope)', \n  'info'\n)\n\nif(scope) {\n  if(window) {\n  window.open('tel:141'+scope.replace(/\\\\s/g,''),'_system')\n  } else {\n    cti.utils.callAction(\"show-notification\", {\n      \"name\": \"notification_warning\", \n      \"title\" : \"Warning\", \n      \"text\" : \"Cordova is not currently installed, so you may not be running the application on a mobile device.\"\n    })\n  }\n} else {\n  cti.utils.callAction(\"call-component-function\", {\"page\":\"Patient\",\"componentInstanceId\":\"62c798d7-1ba3-458c-a07a-5caefcb56a63\",\"function\":\"toggle\"})\n}","actions":[]},{"name":"fn_load_document","type":"scripting","item-type":"function","_auto_id_":"40232cfd-eb89-490c-977b-0090029628de","sync":true,"params":[{"required":true,"name":"document","description":"The document object"}],"content":"window.logManager.consoleLog(\n  'function fn_load_document(document)', \n  'info'\n)\n\nif(cti.store.variables.online == \"offline\") {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning: Device Offline\", \n    \"text\" : \"You are currently offline, please try again.\"\n  })\n  return false\n}\n\n// Load Spinner\ncti.fn_toggle_spinner('open', 'Downloading Document...')\n\n// Parse the selected document\nvar docObj = JSON.parse(document)\n\n// Package the documentGet payload object ...\nvar documentPayload = {\n  clientId : cti.store.variables.selected_visit.patientData.demographics.clientId,\n  documentId : docObj.documentId,\n  documentSerialNumber : docObj.serialNumber,\n  documentDate : docObj.documentDate\n}\n\n// Remove rouge T if coming from the progress notes\nvar formattedDate = documentPayload.documentDate.replace(\"T\", \" \")\ndocumentPayload.documentDate = formattedDate\n\n// ... also set a global variable so that we can access the doc type on success return\ncti.store.variables.v_selectedDocument = docObj\n\n// Set payload object and kick off GetDocument actionflow\ncti.store.variables.v_documentGetPayload = documentPayload\ncti.utils.callAction(\"call-actionflow\", { name: \"GetDocument\" })"},{"name":"fn_prep_forms","type":"scripting","item-type":"function","_auto_id_":"6e603a4a-7d46-4b0e-98d0-150671c688d8","sync":true,"params":[{"name":"appointment","description":"Appointment object","required":true}],"content":"window.logManager.consoleLog(\n  'function fn_prep_forms(appointment)', \n  'info'\n)\n\nvar activities = []\nvar dialog = false, \n    lifestyle = false, \n    safety = false\n\nif(appointment.attendees) {\n  if(appointment.attendees.attendee) {\n    if(appointment.attendees.attendee.activities) {\n      if(appointment.attendees.attendee.activities.activity) {\n        activities = appointment.attendees.attendee.activities.activity\n      }\n    }\n  }\n}\n\nif(appointment.dialog_form === undefined || appointment.lifestyle_form === undefined || appointment.safety_form === undefined) {\n  for(var i in activities) {\n    var code = activities[i].activityType.code\n    \n    if(code === \"dialogplus\" || code === \"RMDialog\") {\n      dialog = true\n\n      if(appointment.status == \"complete\") {\n        cti.store.variables.selected_visit.dialog_form_status = \"outcomed\"\n        cti.store.variables.selected_visit.dialog_form_status_text = \"Appointment Outcomed\"\n      } else {\n        cti.store.variables.selected_visit.dialog_form_status = \"notcomplete\"\n        cti.store.variables.selected_visit.dialog_form_status_text = \"Not Completed\"\n      }\n    } else if(code === \"phlifestyl\" || code === \"RMLife\") {\n      lifestyle = true\n\n      if(appointment.status == \"complete\") {\n        cti.store.variables.selected_visit.lifestyle_form_status = \"outcomed\"\n        cti.store.variables.selected_visit.lifestyle_form_status_text = \"Appointment Outcomed\"\n      } else {\n        cti.store.variables.selected_visit.lifestyle_form_status = \"notcomplete\"\n        cti.store.variables.selected_visit.lifestyle_form_status_text = \"Not Completed\"\n      }\n    } else if(code === \"msp\" || code === \"RMMSP\") {\n      safety = true\n\n      if(appointment.status == \"complete\") {\n        cti.store.variables.selected_visit.safety_form_status = \"outcomed\"\n        cti.store.variables.selected_visit.safety_form_status_text = \"Appointment Outcomed\"\n      } else {\n        cti.store.variables.selected_visit.safety_form_status = \"notcomplete\"\n        cti.store.variables.selected_visit.safety_form_status_text = \"Not Completed\"\n      }\n    }\n  }\n\n  appointment.dialog_form = dialog;\n  appointment.lifestyle_form = lifestyle;\n  appointment.safety_form = safety;\n} else {\n  if(appointment.dialog_form && appointment.dialog_form_status) {\n    dialog = appointment.dialog_form_status\n  }\n  if(appointment.lifestyle_form && appointment.lifestyle_form_status) {\n    lifestyle = appointment.lifestyle_form_status\n  }\n  if(appointment.safety_form && appointment.safety_form_status) {\n    safety = appointment.safety_form_status\n  }\n\n  if(dialog == \"inprogress\" || dialog == \"failed\") {\n    cti.store.pages.DialogFormPre = appointment.dialog_form_page.dialog_form_page_pre\n    cti.store.pages.DialogFormOne = appointment.dialog_form_page.dialog_form_page_one\n    cti.store.pages.DialogFormTwo = appointment.dialog_form_page.dialog_form_page_two\n    cti.store.pages.DialogFormThree = appointment.dialog_form_page.dialog_form_page_three\n    cti.store.pages.DialogFormFour = appointment.dialog_form_page.dialog_form_page_four\n    cti.store.pages.DialogFormFive = appointment.dialog_form_page.dialog_form_page_five\n    cti.store.pages.DialogFormSix = appointment.dialog_form_page.dialog_form_page_six\n    cti.store.pages.DialogFormSeven = appointment.dialog_form_page.dialog_form_page_seven\n    cti.store.pages.DialogFormEight = appointment.dialog_form_page.dialog_form_page_eight\n    cti.store.pages.DialogFormNine = appointment.dialog_form_page.dialog_form_page_nine\n    cti.store.pages.DialogFormTen = appointment.dialog_form_page.dialog_form_page_ten\n    cti.store.pages.DialogFormEleven = appointment.dialog_form_page.dialog_form_page_eleven\n    cti.store.pages.DialogFormTwelve = appointment.dialog_form_page.dialog_form_page_twelve\n    cti.store.pages.DialogFormThirteen = appointment.dialog_form_page.dialog_form_page_thirteen\n    cti.store.pages.DialogFormFourteen = appointment.dialog_form_page.dialog_form_page_fourteen\n  } else if(appointment.status == \"complete\") {\n    appointment.dialog_form_status = \"outcomed\"\n    appointment.dialog_form_status_text = \"Appointment Outcomed\"\n  }\n\n  if(lifestyle == \"inprogress\" || lifestyle == \"failed\") {\n    cti.store.pages.LifestyleFormOne = appointment.lifestyle_form_page.lifestyle_form_page_one\n    cti.store.pages.LifestyleFormTwo = appointment.lifestyle_form_page.lifestyle_form_page_two\n    cti.store.pages.LifestyleFormThree = appointment.lifestyle_form_page.lifestyle_form_page_three\n    cti.store.pages.LifestyleFormFour = appointment.lifestyle_form_page.lifestyle_form_page_four\n    cti.store.pages.LifestyleFormFive = appointment.lifestyle_form_page.lifestyle_form_page_five\n    cti.store.pages.LifestyleFormSix = appointment.lifestyle_form_page.lifestyle_form_page_six\n\n    cti.store.repeater.LifestyleFormThree = appointment.lifestyle_form_page.lifestyle_form_repeater_three\n    cti.store.repeater.LifestyleFormFive = appointment.lifestyle_form_page.lifestyle_form_repeater_five\n  } else if(appointment.status == \"complete\") {\n    appointment.lifestyle_form_status = \"outcomed\"\n    appointment.lifestyle_form_status_text = \"Appointment Outcomed\"\n  }\n\n  if(safety == \"inprogress\" || safety == \"failed\") {\n    cti.store.pages.SafetyForm = appointment.safety_form_page\n  } else if(appointment.status == \"complete\") {\n    appointment.safety_form_status = \"outcomed\"\n    appointment.safety_form_status_text = \"Appointment Outcomed\"\n  }\n}"},{"name":"fn_load_form","type":"scripting","item-type":"function","_auto_id_":"638888a9-bbad-413f-b335-dcbfaf6e77e8","sync":true,"params":[{"name":"formType","description":"What form we want to load"}],"content":"window.logManager.consoleLog(\n  'function fn_load_form(form)', \n  'info'\n)\n\n// Check that we have started the visit. If not then return false and show warning\nif(cti.store.variables.selected_visit.status != \"complete\" && cti.store.variables.selected_visit.arrivalTime === undefined) {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning: You have not started this Visit\", \n    \"text\" : \"You must start the Visit before you can complete any forms.\"\n  })\n  \n  return false\n}\n\n\n// If we're selecting the dialog form, check that we haven't already started the form\nif(formType === \"dialogplus\") {\n  // If we haven't started the form, set the status to inprogress\n  if(cti.store.variables.selected_visit.dialog_form_status != \"complete\" && cti.store.variables.selected_visit.dialog_form_status != \"outcomed\") {\n    cti.fn_toggle_spinner('open', 'Loading Dialog+ Form...')\n    \n    cti.store.variables.selected_visit.dialog_form_status = \"inprogress\";\n    cti.store.variables.selected_visit.dialog_form_status_text = \"In Progress...\";\n\n    cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogFormPre\"});\n  } else {\n    if(cti.store.variables.selected_visit.patientData.dialogPlusForms && cti.store.variables.selected_visit.patientData.dialogPlusForms.length > 0) {\n      cti.fn_view_dialog(true)\n    } else {\n      cti.utils.callAction(\"show-notification\", {\n        \"name\": \"notification_warning\", \n        \"title\" : \"Warning: There are no Dialog+ Forms\", \n        \"text\" : \"This patient does not currently have any Dialog+ Forms completed.\"\n      })\n      \n      return false\n    }\n  }\n} else if(formType === \"phlifestyl\") {\n  // If we haven't started the form, set the status to inprogress\n  if(cti.store.variables.selected_visit.lifestyle_form_status != \"complete\" && cti.store.variables.selected_visit.lifestyle_form_status != \"outcomed\") {\n    cti.fn_toggle_spinner('open', 'Loading Lifestyle Assessment Form...')\n    \n    cti.store.variables.selected_visit.lifestyle_form_status = \"inprogress\";\n    cti.store.variables.selected_visit.lifestyle_form_status_text = \"In Progress...\";\n\n    cti.utils.callAction(\"go-to-page\", {\"name\":\"LifestyleFormOne\"});\n  } else {\n    if(cti.store.variables.selected_visit.patientData.lifestyleAssessmentForms && cti.store.variables.selected_visit.patientData.lifestyleAssessmentForms.length > 0) {\n      cti.fn_view_lifestyle(true)\n    } else {\n      cti.utils.callAction(\"show-notification\", {\n        \"name\": \"notification_warning\", \n        \"title\" : \"Warning: There are no Lifestyle Forms\", \n        \"text\" : \"This patient does not currently have any Lifestyle Forms completed.\"\n      })\n\n      return false\n    }\n  }\n} else if(formType === \"msp\") {\n  if(cti.store.variables.selected_visit.safety_form_status != \"complete\" && cti.store.variables.selected_visit.safety_form_status != \"outcomed\") {\n    cti.fn_toggle_spinner('open', 'Loading My Safety Plan Form...')\n    \n    cti.store.variables.selected_visit.safety_form_status = \"inprogress\";\n    cti.store.variables.selected_visit.safety_form_status_text = \"In Progress...\";\n\n    cti.utils.callAction(\"go-to-page\", {\"name\":\"SafetyForm\"});\n  } else {\n    if(cti.store.variables.selected_visit.patientData.mySafetyPlanForms && cti.store.variables.selected_visit.patientData.mySafetyPlanForms.length > 0) {\n      cti.fn_view_safety(true)\n    } else {\n      cti.utils.callAction(\"show-notification\", {\n        \"name\": \"notification_warning\", \n        \"title\" : \"Warning: There are no My Safety Forms\", \n        \"text\" : \"This patient does not currently have any My Safety Forms completed.\"\n      })\n\n      return false\n    }\n  }\n} "},{"name":"fn_view_dialog","type":"scripting","item-type":"function","_auto_id_":"7617fa66-f224-4a97-9f71-6bd15c4c2071","sync":true,"params":[{"name":"currentForm"}],"content":"window.logManager.consoleLog(\n  'function fn_view_dialog(currentForm)', \n  'info'\n)\n\ncti.store.variables.v_dialogForms = []\nvar form = []\nvar editForms = []\n\nif(currentForm) {\n  cti.fn_toggle_spinner('open', 'Loading Completed Dialog+ Form...')\n  form = cti.store.variables.selected_visit.patientData.dialogPlusForms[0]\n  var array = []\n  array.push(form)\n  editForms = JSON.parse(JSON.stringify(array))\n} else {\n  cti.fn_toggle_spinner('open', 'Loading Dialog+ Forms...')\n  form = cti.store.variables.selected_visit.patientData.dialogPlusForms\n  editForms = JSON.parse(JSON.stringify(form))\n}\n\nfor(var i in editForms) {\n  var thisForm = editForms[i]\n  var formObject = {}\n\n  var mapping = [\n    { \"destination\" : \"MHSat1\", \"source\" : \"mhSat1\", \"typeOverride\" : \"toInt\" },\n    { \"destination\" : \"PHSatPL\", \"source\" : \"phSatPl\", \"typeOverride\" : \"toInt\" },\n    { \"destination\" : \"JSSatPL\", \"source\" : \"jsSatPl\", \"typeOverride\" : \"toInt\" },\n    { \"destination\" : \"ACSatPL\", \"source\" : \"acSatPl\", \"typeOverride\" : \"toInt\" },\n    { \"destination\" : \"LASatPL\", \"source\" : \"laSatPl\", \"typeOverride\" : \"toInt\" },\n    { \"destination\" : \"RSSatPL\", \"source\" : \"rsSatPl\", \"typeOverride\" : \"toInt\" },\n    { \"destination\" : \"FSSatPL\", \"source\" : \"fsSatPl\", \"typeOverride\" : \"toInt\" },\n    { \"destination\" : \"PSSatPL\", \"source\" : \"psSatPl\", \"typeOverride\" : \"toInt\" },\n    { \"destination\" : \"FISatPL\", \"source\" : \"fiSatPl\", \"typeOverride\" : \"toInt\" },\n    { \"destination\" : \"CNSatPL\", \"source\" : \"cnSatPl\", \"typeOverride\" : \"toInt\" },\n    { \"destination\" : \"SUSatPL\", \"source\" : \"suSatPl\", \"typeOverride\" : \"toInt\" },\n    { \"destination\" : \"MDSatPL\", \"source\" : \"mdSatPl\", \"typeOverride\" : \"toInt\" },\n    { \"destination\" : \"PRSatPL\", \"source\" : \"prSatPl\", \"typeOverride\" : \"toInt\" },\n    { \"destination\" : \"MPSatPL\", \"source\" : \"mpSatPl\", \"typeOverride\" : \"toInt\" },\n    { \"destination\" : \"MHSatHelp\", \"source\" : \"mhSatHelp\", \"typeOverride\" : \"toString\" },\n    { \"destination\" : \"PHSatHelp\", \"source\" : \"phSatHelp\", \"typeOverride\" : \"toString\" },\n    { \"destination\" : \"JSSatHelp\", \"source\" : \"jsSatHelp\", \"typeOverride\" : \"toString\" },\n    { \"destination\" : \"ACSatHelp\", \"source\" : \"acSatHelp\", \"typeOverride\" : \"toString\" },\n    { \"destination\" : \"LASatHelp\", \"source\" : \"laSatHelp\", \"typeOverride\" : \"toString\" },\n    { \"destination\" : \"RSSatHelp\", \"source\" : \"rsSatHelp\", \"typeOverride\" : \"toString\" },\n    { \"destination\" : \"FSSatHelp\", \"source\" : \"fsSatHelp\", \"typeOverride\" : \"toString\" },\n    { \"destination\" : \"PSSatHelp\", \"source\" : \"psSatHelp\", \"typeOverride\" : \"toString\" },\n    { \"destination\" : \"FISatHelp\", \"source\" : \"fiSatHelp\", \"typeOverride\" : \"toString\" },\n    { \"destination\" : \"CNSatHelp\", \"source\" : \"cnSatHelp\", \"typeOverride\" : \"toString\" },\n    { \"destination\" : \"SUSatHelp\", \"source\" : \"suSatHelp\", \"typeOverride\" : \"toString\" },\n    { \"destination\" : \"MDSatHelp\", \"source\" : \"mdSatHelp\", \"typeOverride\" : \"toString\" },\n    { \"destination\" : \"PRSatHelp\", \"source\" : \"prSatHelp\", \"typeOverride\" : \"toString\" },\n    { \"destination\" : \"MPSatHelp\", \"source\" : \"mpSatHelp\", \"typeOverride\" : \"toString\" },\n    { \"destination\" : \"MHSatActions\", \"source\" : \"mhSatActions\" },\n    { \"destination\" : \"PHSatActions\", \"source\" : \"phSatActions\" },\n    { \"destination\" : \"JSSatActions\", \"source\" : \"jsSatActions\" },\n    { \"destination\" : \"ACSatActions\", \"source\" : \"acSatActions\" },\n    { \"destination\" : \"LASatActions\", \"source\" : \"laSatActions\" },\n    { \"destination\" : \"RSSatActions\", \"source\" : \"rsSatActions\" },\n    { \"destination\" : \"FSSatActions\", \"source\" : \"fsSatActions\" },\n    { \"destination\" : \"PSSatActions\", \"source\" : \"psSatActions\" },\n    { \"destination\" : \"FISatActions\", \"source\" : \"fiSatActions\" },\n    { \"destination\" : \"CNSatActions\", \"source\" : \"cnSatActions\" },\n    { \"destination\" : \"SUSatActions\", \"source\" : \"suSatActions\" },\n    { \"destination\" : \"MDSatActions\", \"source\" : \"mdSatActions\" },\n    { \"destination\" : \"PRSatActions\", \"source\" : \"prSatActions\" },\n    { \"destination\" : \"MPSatActions\", \"source\" : \"mpSatActions\" },\n    { \"destination\" : \"MHRecovery\", \"source\" : \"mhRecovery\" },\n    { \"destination\" : \"MHMatters\", \"source\" : \"mhMatters\" },\n    { \"destination\" : \"MHSkills\", \"source\" : \"mhSkills\" },\n    { \"destination\" : \"StageTreat\", \"source\" : \"stageTreat\" },\n    { \"destination\" : \"StageTreat1\", \"source\" : \"stageTreat1\" },\n    { \"destination\" : \"InCareDec\", \"source\" : \"inCareDec\" },\n    { \"destination\" : \"SUCap\", \"source\" : \"suCap\" },\n    { \"destination\" : \"AssessmentDate\", \"source\" : \"assessmentDate\", \"typeOverride\" : \"date\" }\n  ]\n\n  mapping.forEach(element => {\n    var sourceEntry = thisForm[element.source]\n\n    if(sourceEntry != undefined) {\n      if(element.typeOverride && element.typeOverride == \"toString\") {\n        var str = (sourceEntry.result || \"\").toString()\n        if(str == \"\") str = \"2\"\n        formObject[element.destination] = str\n      } else if(element.typeOverride && element.typeOverride == \"toInt\") {\n        if(sourceEntry.result != \"\") {\n          formObject[element.destination] = parseInt(sourceEntry.result)\n        } else {\n          formObject[element.destination] = 0\n        }\n      } else if(element.typeOverride && element.typeOverride == \"date\") {\n        if(sourceEntry.displayDate != \"\" && sourceEntry.displayDate != undefined) {\n          formObject[element.destination] = sourceEntry.displayDate\n        } else {\n          formObject[element.destination] = moment(sourceEntry.result).format('DD MMM YYYY hh:mmA')\n        } \n      } else {\n        if(sourceEntry.type && sourceEntry.type == \"multi\") {\n          formObject[element.destination] = {\n            \"label\" : sourceEntry.resultString,\n            \"value\" : sourceEntry.result\n          }\n        } else {\n          formObject[element.destination] = sourceEntry.result\n        }\n      }\n    } else {\n      formObject[element.destination] = \"\"\n    }\n  })\n\n  cti.store.variables.v_dialogForms.push(formObject)\n}\n\nif(cti.store.variables.v_dialogForms.length === 0) {\n  cti.fn_toggle_spinner('close')\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning: This patient currently has no Dialog+ Forms\", \n    \"text\" : \"The current patient does not have any previously submitted Dialog+ Forms.\"\n  })\n} else {\n  cti.store.variables.dialogHideFlags = {\n    assessment : true,\n    mental : true,\n    physical : true,\n    job: true,\n    accommodation: true,\n    leisure: true,\n    family : true,\n    friendships : true,\n    personal : true,\n    finances: true,\n    identity: true,\n    substance: true,\n    medication : true,\n    practical : true,\n    meetings : true\n  }\n\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogForm_View\"})\n}"},{"name":"fn_view_lifestyle","type":"scripting","item-type":"function","_auto_id_":"70f9b7c7-7fdd-4b1b-84ed-58f753980c22","sync":true,"params":[{"name":"currentForm"}],"content":"window.logManager.consoleLog(\n  'function fn_view_lifestyle(currentForm)', \n  'info'\n)\n\ncti.store.variables.v_lifestyleForms = []\nvar form = []\nvar editForms = []\n\nif(currentForm) {\n  cti.fn_toggle_spinner('open', 'Loading Completed Lifestyle Assessment Form...')\n  form = cti.store.variables.selected_visit.patientData.lifestyleAssessmentForms[0]\n  var array = []\n  array.push(form)\n  editForms = JSON.parse(JSON.stringify(array))\n} else {\n  cti.fn_toggle_spinner('open', 'Loading Lifestyle Assessment Forms...')\n  form = cti.store.variables.selected_visit.patientData.lifestyleAssessmentForms\n  editForms = JSON.parse(JSON.stringify(form))\n}\n\nfor(var i in editForms) {\n  var thisForm = editForms[i]\n  var formObject = {}\n\n  var mapping = [\n    { \"destination\" : \"lssmoked\", \"source\" : \"lssmoked\" },\n    { \"destination\" : \"lscigperday\", \"source\" : \"lscigperday\" },\n    { \"destination\" : \"smokeadvice\", \"source\" : \"smokeadvice\" },\n    { \"destination\" : \"Refsmoke\", \"source\" : \"refsmoke\" },\n    { \"destination\" : \"StopSmoke\", \"source\" : \"stopSmoke\" },\n    { \"destination\" : \"smokeintoffer\", \"source\" : \"smokeintoffer\" },\n    { \"destination\" : \"smokefreetext1\", \"source\" : \"smokefreetext1\" },\n    { \"destination\" : \"diethealthy\", \"source\" : \"diethealthy\" },\n    { \"destination\" : \"lsdietcomment\", \"source\" : \"lsdietcomment\" },\n    { \"destination\" : \"dietintervention\", \"source\" : \"dietintervention\" },\n    { \"destination\" : \"dietintdetails\", \"source\" : \"dietintdetails\" },\n    { \"destination\" : \"regularexercise\", \"source\" : \"regularexercise\", \"typeOverride\" : \"repeater\" },\n    { \"destination\" : \"exintoffer\", \"source\" : \"exintoffer\" },\n    { \"destination\" : \"intdetails\", \"source\" : \"intdetails\" },\n    { \"destination\" : \"alcCurrentUser\", \"source\" : \"alcCurrentUser\" },\n    { \"destination\" : \"withdrawal\", \"source\" : \"withdrawal\" },\n    { \"destination\" : \"alcHowOften\", \"source\" : \"alcHowOften\" },\n    { \"destination\" : \"alcHowManyUnits\", \"source\" : \"alcHowManyUnits\" },\n    { \"destination\" : \"alcExceedUnits\", \"source\" : \"alcExceedUnits\" },\n    { \"destination\" : \"alcIntervention\", \"source\" : \"alcIntervention\" },\n    { \"destination\" : \"alcintdetail\", \"source\" : \"alcintdetail\" },\n    { \"destination\" : \"recdruguse\", \"source\" : \"recdruguse\", \"typeOverride\" : \"repeater\" },\n    { \"destination\" : \"drugintoffer\", \"source\" : \"drugintoffer\" },\n    { \"destination\" : \"drugintdetails\", \"source\" : \"drugintdetails\" },\n    { \"destination\" : \"menwellbeing\", \"source\" : \"menwellbeing\" },\n    { \"destination\" : \"signpost\", \"source\" : \"signpost\" },\n    { \"destination\" : \"signdetail\", \"source\" : \"signdetail\" },\n    { \"destination\" : \"addcomm\", \"source\" : \"addcomm\" },\n    { \"destination\" : \"YNPresent\", \"source\" : \"yhpresent\" },\n    { \"destination\" : \"admissionassess\", \"source\" : \"admissionassess\" },\n    { \"destination\" : \"SentCopy\", \"source\" : \"sentcopy\" },\n    { \"destination\" : \"assessmentstatus\", \"source\" : \"assessmentstatus\" },\n    { \"destination\" : \"assessmentDate\", \"source\" : \"assessmentDate\", \"typeOverride\" : \"date\" }\n  ]\n\n  mapping.forEach(element => {\n    var sourceEntry = thisForm[element.source]\n\n    if(sourceEntry != undefined) {\n      if(element.typeOverride && element.typeOverride == \"toString\") {\n        formObject[element.destination] = (sourceEntry.result || \"\").toString()\n      } else if(element.typeOverride && element.typeOverride == \"toInt\") {\n        if(sourceEntry.result != \"\") {\n          formObject[element.destination] = parseInt(sourceEntry.result)\n        } else {\n          formObject[element.destination] = 0\n        }\n      } else if(element.typeOverride && element.typeOverride == \"date\") {\n        if(sourceEntry.displayDate != \"\" && sourceEntry.displayDate != undefined) {\n          formObject[element.destination] = sourceEntry.displayDate\n        } else {\n          formObject[element.destination] = moment(sourceEntry.result).format('DD MMM YYYY hh:mmA')\n        }\n      } else {\n        if(sourceEntry.type && sourceEntry.type == \"multi\") {\n          formObject[element.destination] = {\n            \"label\" : sourceEntry.resultString,\n            \"value\" : sourceEntry.result\n          }\n\n          if(element.typeOverride && element.typeOverride == \"repeater\") {\n            formObject[element.destination].repeater = sourceEntry.repeater\n          }   \n        } else {\n          formObject[element.destination] = sourceEntry.result\n        }\n      }\n    } else {\n      formObject[element.destination] = \"\"\n    }\n  })\n\n  cti.store.variables.v_lifestyleForms.push(formObject)\n}\n\nif(cti.store.variables.v_lifestyleForms.length === 0) {\n  cti.fn_toggle_spinner('close')\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning: This patient currently has no Lifestyle Assessment Forms\", \n    \"text\" : \"The current patient does not have any previously submitted Lifestyle Assessment Forms.\"\n  })\n} else {\n  cti.store.variables.lifestyleHideFlags = {\n    smoking : true,\n    diet : true,\n    exercise : true,\n    alcohol: true,\n    drugs: true,\n    other: true\n  }\n\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"LifestyleForm_View\"});\n}"},{"name":"fn_view_safety","type":"scripting","item-type":"function","_auto_id_":"e5164d2c-f490-463b-80c9-7e3e3ab50270","sync":false,"params":[{"name":"currentForm"}],"content":"window.logManager.consoleLog(\n  'function fn_view_safety(currentForm)', \n  'info'\n)\n\ncti.store.variables.v_safetyForms = []\nvar form = []\nvar editForms = []\n\nif(currentForm) {\n  cti.fn_toggle_spinner('open', 'Loading Completed My Safety Plan Form...')\n  form = cti.store.variables.selected_visit.patientData.mySafetyPlanForms[0]\n  var array = []\n  array.push(form)\n  editForms = JSON.parse(JSON.stringify(array))\n} else {\n  cti.fn_toggle_spinner('open', 'Loading My Safety Plan Forms...')\n  form = cti.store.variables.selected_visit.patientData.mySafetyPlanForms\n  editForms = JSON.parse(JSON.stringify(form))\n}\n\nfor(var i in editForms) {\n  var thisForm = editForms[i]\n\n  var formObject = {\n    sf_triggers : thisForm.triggers.result || 'No data provided',\n    sf_triggers_actionplan : thisForm.triggersAp.result || 'No data provided',\n    sf_contact : thisForm.contact.result || 'No data provided',\n    sf_contactreach : thisForm.contReach.result || 'No data provided',\n    sf_outofcrisis : thisForm.outofCrisis.result || 'No data provided',\n    sf_earlyws : thisForm.earlyWs.result || 'No data provided',\n    sf_earlyws_actionplan : thisForm.earlyWsap.result || 'No data provided',\n    sf_getworse : thisForm.getWorse.result || 'No data provided',\n    sf_getworse_actionplan : thisForm.getWorseAp.result || 'No data provided',\n    sf_assisteddecision : thisForm.decisions.result || 'No data provided',\n    sf_advancedirective : thisForm.advDir.result == \"1\" ? true : false,\n    sf_serviceuseragreedplan : thisForm.suAgree.result == \"1\" ? true : false,\n    sf_crisisnumber : thisForm.crisisNo.result || 'No data provided',\n    sf_assessmentdate : moment(thisForm.assessmentDate.result).format('DD MMM YYYY hh:mmA') || 'No data provided'\n  }\n\n  cti.store.variables.v_safetyForms.push(formObject)\n}\n\nif(cti.store.variables.v_safetyForms.length === 0) {\n  cti.fn_toggle_spinner('close')\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning: This patient currently has no Safety Forms\", \n    \"text\" : \"The current patient does not have any previously submitted Safety Forms.\"\n  })\n} else {\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"SafetyForm_View\"});\n}"},{"name":"fn_top_scroll","type":"scripting","item-type":"function","_auto_id_":"9aaa5523-e92d-462d-8cf1-3018cf5ed285","sync":true,"params":[{"name":"id"}],"content":"window.logManager.consoleLog(\n  'function fn_top_scroll(id)', \n  'info'\n);\n\nvar objDiv = document.getElementById(id);\nobjDiv.scrollTop = 0;"},{"name":"fn_calc_visit_duration","type":"scripting","item-type":"function","_auto_id_":"093bd40c-2f3d-4643-b59a-d389db3fce6f","sync":true,"params":[],"content":"window.logManager.consoleLog(\n  'function fn_calc_visit_duration()', \n  'info'\n);\n\nif (!cti.store.pages.Outcome) {\n  cti.store.pages.Outcome = {};\n}\n\nvar startDate = cti.store.variables.selected_visit.arrivalTime;\nvar arrivalTime = moment(startDate).format(\"HH:mm\");\nvar arrivalTimeHours = moment(arrivalTime, \"HH:mm\").format(\"HH\");\nvar arrivalTimeMinutes = moment(arrivalTime, \"HH:mm\").format(\"mm\");\nvar minsArrivalTime = parseInt(arrivalTimeMinutes);\nvar arrivalTimeLabel = \"\";\n\nif(minsArrivalTime < 15) { arrivalTimeLabel = arrivalTimeHours+\":00\"; }\nelse if(minsArrivalTime >= 15 && minsArrivalTime < 30) { arrivalTimeLabel = arrivalTimeHours+\":15\"; }\nelse if(minsArrivalTime >= 30 && minsArrivalTime < 45) { arrivalTimeLabel = arrivalTimeHours+\":30\"; } \nelse if(minsArrivalTime >= 45 && minsArrivalTime < 60) { arrivalTimeLabel = arrivalTimeHours+\":45\"; }\n\ncti.store.pages.Outcome.arrivalTime = arrivalTimeLabel;\ncti.store.pages.Outcome.actualTime = arrivalTimeLabel;\n\nvar now = moment().format(\"YYYY-MM-DDTHH:mm:ss\");\nvar time = moment.utc(moment(now,\"YYYY-MM-DDTHH:mm:ss\").diff(moment(startDate,\"YYYY-MM-DDTHH:mm:ss\"))).format(\"HH:mm\");\nvar mins = moment(time, \"HH:mm\").format(\"m\");\nvar hours = moment(time, \"HH:mm\").format(\"h\");\n\ncti.store.pages.Outcome.duration_hours = {\"label\": hours, \"value\": hours };\ncti.store.pages.Outcome.duration_minutes = {\"label\": mins, \"value\": mins };\n\ncti.utils.updatePage();"},{"name":"fn_get_location","type":"scripting","item-type":"function","_auto_id_":"bcd20c8b-3548-41b8-b652-0c61912d9d6a","sync":true,"params":[],"content":"window.logManager.consoleLog(\n  'function fn_get_location()', \n  'info'\n)\n\nfunction setPosition(position){\n  window.logManager.consoleLog(\n    'function setPosition() Callback - Successfully saved current location', \n    'info'\n  )\n  \n  if(position && position.coords && position.coords.latitude) {\n  \tcti.store.variables.latitude = position.coords.latitude.toString()\n  } else {\n    cti.store.variables.latitude = cti.store.schema.metadata.latitude || \"53.3125156\" // Sevelec HQ latitude\n  }\n  if(position && position.coords && position.coords.longitude) {\n  \tcti.store.variables.longitude = position.coords.longitude.toString()\n  } else {\n    cti.store.variables.longitude = cti.store.schema.metadata.longitude || \"-1.3461527\" // Sevelec HQ longitude\n  }\n  \n  return true\n}\n\nif(cti.store.env.platform.name != \"electron\"){\n  navigator.geolocation.getCurrentPosition(setPosition)\n  return true;\n} else {\n  cti.store.variables.latitude = cti.store.schema.metadata.latitude || \"53.3125156\" // Sevelec HQ latitude\n  cti.store.variables.longitude = cti.store.schema.metadata.longitude || \"-1.3461527\" // Sevelec HQ longitude\n  \n  return true\n}"},{"name":"fn_init_google_maps","type":"scripting","item-type":"function","_auto_id_":"db191980-6c00-4996-b0f5-eaa55a198507","sync":true,"params":[{"name":"callback"}],"content":"window.logManager.consoleLog(\n  'function fn_init_google_maps(callback)', \n  'info'\n)\n\n// Grab api key from schema\nvar apiKey = cti.store.schema.metadata.googleMapsApiKey\n// Set Google URL with the cti.fn_render_map as the callback function\nvar url = 'https://maps.googleapis.com/maps/api/js?key=' + apiKey + '&callback=' + callback\n\n// If Google maps is not initiated into the app, create and load it here\nif (cti.store.variables.online === \"online\" && $(\"head script[src='\" + url + \"']\").length == 0) {\n  var s = document.createElement(\"script\")\n  s.type = \"text/javascript\"\n  s.src = url\n\n  // Use any selector\n  s.async = true\n  s.defer = true\n  $(\"head\").append(s)\n  console.log(\"maps loaded\")\n  return true\n} else {\n  return false\n}"},{"name":"fn_render_map","type":"scripting","item-type":"function","_auto_id_":"e3a3f805-5d59-4de6-9885-f18cfa297762","sync":true,"params":[],"content":"window.logManager.consoleLog(\n  'function fn_render_map()', \n  'info'\n)\n\nif (!window.google) {\n  window.logManager.consoleLog(\n    'function fn_render_map() - No Google maps installed on device.', \n    'error'\n  )\n  \n  return false\n}\n\nif (!cti.store.variables.v_selectedDayAppointments) {\n  window.logManager.consoleLog(\n    'function fn_render_map() - No appointment data [cti.store.variables.appointments]', \n    'error'\n  )\n  \n  return false\n}\n\nif(cti.store.variables.latitude == undefined || cti.store.variables.longitude == undefined) {\n  cti.store.variables.latitude = cti.store.schema.metadata.latitude || \"53.3125156\" // Sevelec HQ latitude\n  cti.store.variables.longitude = cti.store.schema.metadata.longitude || \"-1.3461527\" // Sevelec HQ longitude\n  \n  cti.fn_get_location()\n} \n\nvar directionDisplay\nvar directionsService = new google.maps.DirectionsService()\nvar map\nvar start = new google.maps.LatLng(cti.store.variables.latitude, cti.store.variables.longitude)\n\nvar myOptions = {\n  zoom: 8,\n  mapTypeId: google.maps.MapTypeId.ROADMAP,\n  center: start\n}\n\nfunction renderDirections(result) {\n  var rendererOptions = {\n    map: map,\n    suppressMarkers: true\n  }\n  var directionsRenderer = new google.maps.DirectionsRenderer(rendererOptions)\n  directionsRenderer.setDirections(result)\n}\n\nfunction requestDirections(start, end, indx, markerContent) {\n  directionsService.route(\n    {\n      origin: start,\n      destination: end,\n      travelMode: google.maps.DirectionsTravelMode.DRIVING\n    },\n    function(result) {\n      if (!result || !result.status || ['ZERO_RESULTS', 'NO_ROUTES', 'NOT_FOUND'].indexOf(result.status) > -1 || !result.routes) {\n        window.logManager.consoleLog(\n          'function fn_render_map() - Invalid postcode returned.', \n          'error'\n        )\n        \n        return false\n      }\n      \n      var duration = result.routes[0].legs[0].duration\n      var marker = new google.maps.Marker({\n        position: {\n          lat: result.routes[0].legs[0].end_location.lat(),\n          lng: result.routes[0].legs[0].end_location.lng()\n        },\n        map: map,\n        label: (indx + 1).toString(),\n        icon: 'user-assets/pin.png'\n      })\n\n      var step = result.routes[0].legs[0].steps.length - 1\n      var lat = result.routes[0].legs[0].steps[step].start_location.lat()\n      var long = result.routes[0].legs[0].steps[step].start_location.lng()\n\n      txt = new TxtOverlay(new google.maps.LatLng(lat, long), duration.text, 'durationBox', map)\n\n      google.maps.event.addListener(\n        marker,\n        'click',\n        (function(marker, i, duration) {\n          //add the duration to the appointment data\n          cti.store.variables.v_selectedDayAppointments[i].appointmentEta = moment()\n            .add(duration.value, 'seconds')\n            .format('hh:mm')\n\n          return function() {\n            var infowindow = new google.maps.InfoWindow()\n            infowindow.setContent('<p>' + cti.store.variables.v_selectedDayAppointments[i].displayName + '<br/>' + cti.store.variables.v_selectedDayAppointments[i].appointmentType.value + '<br/>Travel Time: ' + duration.text + '</p>')\n            infowindow.open(map, marker)\n          }\n        })(marker, indx, duration)\n      )\n      renderDirections(result)\n    }\n  )\n}\n\nmap = new google.maps.Map(document.getElementById('layersmap'), myOptions)\nwindow.mymap = map\n\n//add destination markers\nvar infowindow = new google.maps.InfoWindow()\nfor (var i = 0; i < cti.store.variables.v_selectedDayAppointments.length; i++) {\n  var a = cti.store.variables.v_selectedDayAppointments[i]\n  var markerContent = a.surname\n  requestDirections(start, a.postCode, i, markerContent)\n}\n\n//add user location marker\nmarkerusr = new google.maps.Marker({\n  position: start,\n  map: map,\n  label: {\n    text: 'Me',\n    color: 'white'\n  }\n})\n\n//add traffic layer\nvar trafficLayer = new google.maps.TrafficLayer()\ntrafficLayer.setMap(map)\n\n//adapted from http://code.google.com/apis/maps/documentation/javascript/overlays.html#CustomOverlays\n//text overlays\nfunction TxtOverlay(pos, txt, cls, map) {\n  // Now initialize all properties.\n  this.pos = pos\n  this.txt_ = txt\n  this.cls_ = cls\n  this.map_ = map\n  // We define a property to hold the image's\n  // div. We'll actually create this div\n  // upon receipt of the add() method so we'll\n  // leave it null for now.\n  this.div_ = null\n  // Explicitly call setMap() on this overlay\n  this.setMap(map)\n}\nTxtOverlay.prototype = new google.maps.OverlayView()\nTxtOverlay.prototype.onAdd = function() {\n  // Note: an overlay's receipt of onAdd() indicates that\n  // the map's panes are now available for attaching\n  // the overlay to the map via the DOM.\n  // Create the DIV and set some basic attributes.\n  var div = document.createElement('DIV')\n  div.className = this.cls_\n  div.innerHTML = this.txt_\n  // Set the overlay's div_ property to this DIV\n  this.div_ = div\n  var overlayProjection = this.getProjection()\n  var position = overlayProjection.fromLatLngToDivPixel(this.pos)\n  div.style.left = position.x + 'px'\n  div.style.top = position.y + 'px'\n  // We add an overlay to a map via one of the map's panes.\n  var panes = this.getPanes()\n  panes.floatPane.appendChild(div)\n}\nTxtOverlay.prototype.draw = function() {\n  var overlayProjection = this.getProjection()\n  // Retrieve the southwest and northeast coordinates of this overlay\n  // in latlngs and convert them to pixels coordinates.\n  // We'll use these coordinates to resize the DIV.\n  var position = overlayProjection.fromLatLngToDivPixel(this.pos)\n  var div = this.div_\n  div.style.left = position.x + 'px'\n  div.style.top = position.y + 'px'\n}\n//Optional: helper methods for removing and toggling the text overlay.\nTxtOverlay.prototype.onRemove = function() {\n  this.div_.parentNode.removeChild(this.div_)\n  this.div_ = null\n}\nTxtOverlay.prototype.hide = function() {\n  if (this.div_) {\n    this.div_.style.visibility = 'hidden'\n  }\n}\nTxtOverlay.prototype.show = function() {\n  if (this.div_) {\n    this.div_.style.visibility = 'visible'\n  }\n}\nTxtOverlay.prototype.toggle = function() {\n  if (this.div_) {\n    if (this.div_.style.visibility == 'hidden') {\n      this.show()\n    } else {\n      this.hide()\n    }\n  }\n}\nTxtOverlay.prototype.toggleDOM = function() {\n  if (this.getMap()) {\n    this.setMap(null)\n  } else {\n    this.setMap(this.map_)\n  }\n}","actions":[]},{"name":"fn_openContentMenu","type":"scripting","item-type":"function","_auto_id_":"335d5190-8fd6-4eaf-ab65-c102e68e9035","sync":true,"params":[],"content":"window.logManager.consoleLog(\n  'function fn_openContentMenu()', \n  'info'\n);\n\nvar contextMenu = document.getElementsByTagName('ct-context-menu')[0];\ncontextMenu.toggle();"},{"name":"fn_populate_duration_dl","type":"scripting","item-type":"function","_auto_id_":"2637d090-0615-4390-9283-e85b89e43506","sync":true,"params":[],"content":"window.logManager.consoleLog(\n  'function fn_populate_duration_dl()', \n  'info'\n);\n\ncti.store.variables.duration_minutes = [];\nfor (var i = 0; i < 61; i++) {\n  cti.store.variables.duration_minutes.push({\"label\":i.toString(),\"value\":i.toString()});\n}\n\ncti.store.variables.duration_hours = [];\nfor (var i = 0; i < 25; i++) {\n  cti.store.variables.duration_hours.push({\"label\":i.toString(),\"value\":i.toString()});\n}"},{"name":"fn_prep_timeline","type":"scripting","item-type":"function","_auto_id_":"72309a2b-0d9d-47b4-b3a4-c582f8a1a202","sync":true,"params":[],"content":"window.logManager.consoleLog(\n  'function fn_prep_timeline()', \n  'info'\n)\n\nvar p = cti.store.variables.selected_visit.patientData\ncti.store.variables.timeline = []\nvar timeline = []\n\n// ##### Documents Preperation Functionality Begin\nif (p.documents == undefined) { \n  p.documents = [] \n}\n\nfor(var a in p.documents) {\n  var patientDocument = p.documents[a]\n  patientDocument.displayDate = moment(patientDocument.dateCreated).format(\"YYYY-MM-DDTHH:mm:ss\")\n\n  var dateCreated = moment(patientDocument.dateCreated).format(\"YYYY-MM-DDTHH:mm:ss\")\n  patientDocument.dateCreated = dateCreated\n  var documentDate = moment(patientDocument.documentDate).format(\"YYYY-MM-DDTHH:mm:ss\")\n  patientDocument.documentDate = documentDate\n}\n\nvar documents = JSON.parse(JSON.stringify(p.documents))\n\nfor(var b in documents) {\n  var timelineDocument = documents[b]\n  var dateString = patientDocument.dateCreated\n\n  timelineDocument.eventDate = new Date(dateString.replace(\" \", \"T\"))\n  timelineDocument.eventType = \"documents\"\n\n  delete timelineDocument.insertedDate\n  delete timelineDocument.documentId\n  delete timelineDocument.serialNumber\n  delete timelineDocument.userId\n  delete timelineDocument.fileSize\n  delete timelineDocument.fileType\n  delete timelineDocument.author\n  delete timelineDocument.description\n  delete timelineDocument.dateCreated\n  delete timelineDocument.documentDate\n  delete timelineDocument.displayDate\n\n  timeline.push(timelineDocument)\n}\n\np.documents.sort(function(a, b) {\n  return a.displayDate > b.displayDate ? -1 : a.displayDate < b.displayDate ? 1 : 0\n})\n// ##### Documents Preperation Functionality End\n\n// ##### Referrals Preperation Functionality Begin\nif (p.referrals == undefined) { \n  p.referrals = [] \n}\n\nfor(var c in p.referrals) {\n  var patientReferral = p.referrals[c]\n  var dateString = moment(patientReferral.referralDate).format(\"YYYY-MM-DDTHH:mm:ss\")\n  patientReferral.referralDate = dateString\n}\n\nvar referrals = JSON.parse(JSON.stringify(p.referrals))\n\nfor (var d in referrals) {\n  var timelineReferral = referrals[d]\n  var dateString = moment(timelineReferral.referralDate).format(\"YYYY-MM-DDTHH:mm:ss\")\n\n  timelineReferral.eventType = \"referral\"\n  timelineReferral.eventDate = new Date(dateString.replace(\" \", \"T\"))\n\n  if (timelineReferral.healthcareProfessional) {\n    timelineReferral.referredToDisplay = timelineReferral.healthcareProfessional.value\n  } else {\n    if (timelineReferral.team != \"\" && timelineReferral.team != undefined) {\n      timelineReferral.referredToDisplay = timelineReferral.team.value\n    } else {\n      timelineReferral.referredToDisplay = \"No Referrer Team/HCP\"\n    }\n  }\n\n  delete timelineReferral.referralId\n  delete timelineReferral.team\n  delete timelineReferral.referralDate\n  delete timelineReferral.associatedDocuments\n\n  timeline.push(timelineReferral)\n}\n\np.referrals.sort(function(a, b) {\n  return a.referralDate > b.referralDate ? -1 : a.referralDate < b.referralDate ? 1 : 0\n})\n// ##### Referrals Preperation Functionality End\n\n// ##### Progress Notes Preperation Functionality Begin\nif(p.progressNotes == undefined) {\n  p.progressNotes = []\n}\n\nfor(var e in p.progressNotes) {\n  var patientNote = p.progressNotes[e]\n  var dateString = moment(patientNote.dateTime).format(\"YYYY-MM-DDTHH:mm:ss\")\n  patientNote.dateTime = dateString\n}\n\nvar notes = JSON.parse(JSON.stringify(p.progressNotes))\n\nfor (var f in notes) {\n  var timelineNote = notes[f]\n  var dateString = timelineNote.dateTime\n\n  timelineNote.eventDate = new Date(dateString.replace(\" \", \"T\"))\n  timelineNote.eventType = \"notes\"\n\n  var risk, validated\n\n  if (timelineNote.isRiskRelated == \"0\") {\n    risk = \"No\"\n  } else {\n    risk = \"Yes\"\n  }\n\n  if (timelineNote.verifyDate == undefined) {\n    validated = \"No\"\n  } else {\n    validated = \"Yes\"\n  }\n\n  var rowOne = \"<p><strong>Added by</strong> \" + timelineNote.enteredBy.value || \"Unknown\" + \"</p>\"\n  var rowTwo = \"<p><strong>Is Risk:</strong> \" + risk + \"</pr>\"\n  var rowThree = \"<p><strong>Validated:</strong> \" + validated + \"</p><br>\"\n\n  timelineNote.timeLineDisplay = rowOne + rowTwo + rowThree + timelineNote.noteText\n\n  delete timelineNote.clientId\n  delete timelineNote.noteId\n  delete timelineNote.noteNumber\n  delete timelineNote.subNoteNumber\n  delete timelineNote.isConcealFromClient\n  delete timelineNote.enteredDateTime\n  delete timelineNote.enteredBy\n  delete timelineNote.isEnteredInError\n  delete timelineNote.isHtmlIncludedFlag\n  delete timelineNote.isAutoSaved\n  delete timelineNote.isSignificant\n  delete timelineNote.isThirdParty\n  delete timelineNote.noteText\n  delete timelineNote.isRiskRelated\n  delete timelineNote.specialty\n  delete timelineNote.associatedDocuments\n  delete timelineNote.date\n  delete timelineNote.dateTime\n\n  timeline.push(timelineNote)\n}\n\np.progressNotes.sort(function(a, b) {\n  return a.dateTime > b.dateTime ? -1 : a.dateTime < b.dateTime ? 1 : 0\n})\n// ##### Progress Notes Preperation Functionality End\n\n// ##### Appointment Preperation Functionality Begin\nif(p.appointmentHistory == undefined) {\n  p.appointmentHistory = []\n}\n\nfor(var g in p.appointmentHistory) {\n  var patientAppointment = p.appointmentHistory[g]\n  var dateString = moment(patientAppointment.date).format(\"YYYY-MM-DDTHH:mm:ss\")\n  patientAppointment.date = dateString\n}\n\nvar appointments = JSON.parse(JSON.stringify(p.appointmentHistory))\n\nfor (var h in appointments) {\n  var timelineAppointment = appointments[h]\n  timelineAppointment.eventType = \"appointments\"\n\n  var dateString = timelineAppointment.date\n  timelineAppointment.eventDate = new Date(dateString.replace(\" \", \"T\"))\n\n  timelineAppointment.displayDate = moment(timelineAppointment.date).format(\"YYYY-MM-DDTHH:mm:ss\")\n  timelineAppointment.timeLineDisplay = \"\"\n\n  if(timelineAppointment.outcome != \"\" || timelineAppointment.outcome != undefined) {\n    var rowOne = \"<p><strong>Outcome:</strong> \" + timelineAppointment.outcome + \"</p>\"\n    timelineAppointment.timeLineDisplay += rowOne\n  }\n\n  if(timelineAppointment.cancellationReason != \"\" || timelineAppointment.cancellationReason != undefined) {\n    var rowTwo = \"<p><strong>Cancelation Reason:</strong> \" + timelineAppointment.cancellationReason + \"</p>\"\n    timelineAppointment.timeLineDisplay += rowTwo\n  }\n\n  if(timelineAppointment.location != \"\" || timelineAppointment.location != undefined) {\n    var rowThree = \"<p><strong>Location:</strong> \" + timelineAppointment.location + \"</p>\"\n    timelineAppointment.timeLineDisplay += rowThree\n  }\n  if(timelineAppointment.clinic != \"\" || timelineAppointment.clinic != undefined) {\n    var rowFour = \"<p><strong>Setting:</strong> \" + timelineAppointment.clinic + \"</p>\"\n    timelineAppointment.timeLineDisplay += rowFour\n  }\n\n  if(timelineAppointment.intendedDuration != \"\" || timelineAppointment.intendedDuration != undefined) {\n    var rowFive = \"<p><strong>Duration:</strong> \" + timelineAppointment.intendedDuration + \"</p>\"\n    timelineAppointment.timeLineDisplay += rowFive\n  }\n\n  if(timelineAppointment.comment != \"\" || timelineAppointment.comment != undefined) {\n    var rowSix = \"<p><strong>Comment:</strong> \" + timelineAppointment.comment + \"</p>\"\n    timelineAppointment.timeLineDisplay += rowSix\n  }\n\n  delete timelineAppointment.clinic\n  delete timelineAppointment.intendedDuration\n  delete timelineAppointment.location\n  delete timelineAppointment.hcpCode\n  delete timelineAppointment.outcome\n  delete timelineAppointment.cancellationReason\n  delete timelineAppointment.displayDate\n  delete timelineAppointment.date\n\n  timeline.push(timelineAppointment)\n}\n\np.appointmentHistory.sort(function(a, b) {\n  return a.date > b.date ? -1 : a.date < b.date ? 1 : 0\n})\n// ##### Appointments Preperation Functionality End\n\n// ##### Alerts Preperation Functionality Begin\ncti.store.variables.selected_visit.hasAlerts = false\ncti.store.variables.selected_visit.openAlerts = 0\n\nif(p.alerts == undefined) {\n  p.alerts = []\n}\n\nfor(var i in p.alerts) {\n  var patientAlert = p.alerts[i]\n  var dateString = moment(patientAlert.date).format(\"YYYY-MM-DDTHH:mm:ss\")\n  patientAlert.date = dateString\n  \n  if (!patientAlert.removalDate) {\n    cti.store.variables.selected_visit.hasAlerts = true\n    cti.store.variables.selected_visit.openAlerts++\n  }\n}\n\nvar alerts = JSON.parse(JSON.stringify(p.alerts))\n\nfor (var j in alerts) {\n  var timelineAlert = alerts[j]\n  var dateString = moment(timelineAlert.date).format(\"YYYY-MM-DDTHH:mm:ss\")\n\n  if (timelineAlert.removalDate) {\n    var endedDateString = moment(timelineAlert.removalDate, \"YYYY-MM-DDTHH:mm:ss\").add(1, 'hours').format(\"YYYY-MM-DDTHH:mm:ss\")\n    var eventDate = new Date(endedDateString.replace(\" \", \"T\"))\n\n    var endedAlert = {\n      eventType: \"alerts-removed\",\n      eventDate: eventDate\n    }\n\n    endedAlert.displayText = timelineAlert.type.value + \" (Created On: \" + moment(timelineAlert.date).format(\"DD MMM YYYY\") + \")\"\n\n    delete timelineAlert.date\n    delete timelineAlert.removalReason\n    delete timelineAlert.removalComment\n    delete timelineAlert.removalDate\n    delete timelineAlert.text\n    delete timelineAlert.priority \n    delete timelineAlert.id \n\n    timelineAlert.eventType = \"alerts-added\"\n    timelineAlert.eventDate = new Date(dateString.replace(\" \", \"T\"))\n\n    timeline.push(timelineAlert)\n    timeline.push(endedAlert)\n  } else {\n    timelineAlert.eventType = \"alerts-added\"\n    timelineAlert.eventDate = new Date(dateString.replace(\" \", \"T\"))\n\n    delete timelineAlert.date\n    delete timelineAlert.removalReason\n    delete timelineAlert.removalComment\n    delete timelineAlert.removalDate\n    delete timelineAlert.text\n    delete timelineAlert.priority \n    delete timelineAlert.id \n\n    timeline.push(timelineAlert)\n  }\n}\n\np.alerts.sort(function(a, b) {\n  return a.date > b.date ? -1 : a.date < b.date ? 1 : 0\n})\n// ##### Alerts Preperation Functionality End\n\n// ##### Allergies Preperation Functionality Begin\nif(p.allergies == undefined) {\n  p.allergies = []\n}\n\nfor(var k in p.allergies) {\n  var patientAllergy = p.allergies[k]\n\n  if(patientAllergy.yearOfIdentification == \"0\" || \n     patientAllergy.yearOfIdentification == \"\" ||\n     patientAllergy.yearOfIdentification == undefined) \n  {\n    var birthDate = p.demographics.birthDate\n    var yearValue = moment(birthDate).format(\"YYYY\")\n\n    patientAllergy.yearOfIdentification = yearValue\n    patientAllergy.dateTime = birthDate+\"T00:00:00\"\n  } else {\n    patientAllergy.dateTime = patientAllergy.yearOfIdentification+\"-01-01T00:00:00\"\n  }\n}\n\nvar allergies = JSON.parse(JSON.stringify(p.allergies))\n\nfor(var l in allergies) {\n  var timelineAllergy = allergies[l]\n\n  timelineAllergy.eventDate = new Date(timelineAllergy.dateTime.replace(\" \", \"T\"))\n  timelineAllergy.eventDateDisplay = \"Year: \" + timelineAllergy.yearOfIdentification\n  timelineAllergy.eventType = \"allergies\"\n\n  delete timelineAllergy.dateTime\n  delete timelineAllergy.reaction\n  delete timelineAllergy.reactionType\n  delete timelineAllergy.reactionSeverity\n  delete timelineAllergy.reportedBy\n\n  timeline.push(timelineAllergy)\n}\n\np.allergies.sort(function(a, b) {\n  return a.dateTime > b.dateTime ? -1 : a.dateTime < b.dateTime ? 1 : 0\n})\n// ##### Allergies Preperation Functionality End\n\n// ##### Contacts Preperation Functionality Begin\nif (p.contacts == undefined) { \n  p.contacts = [] \n}\n// ##### Contacts Preperation Functionality End\n\n// ##### Dialog + Forms Preperation Functionality Begin\nif(p.dialogPlusForms === undefined) {\n  p.dialogPlusForms = []\n}\n\nfor (var i in p.dialogPlusForms) {\n  var dialogForm = p.dialogPlusForms[i]\n\n  dialogForm.assessmentDate.displayDate = moment(dialogForm.assessmentDate.result).format(\"DD MMM YYYY HH:mm\")\n}\n// ##### Dialog + Forms Preperation Functionality End\n\n// ##### Lifestyle Assessment Forms Preperation Functionality Begin\nif(p.lifestyleAssessmentForms === undefined) {\n  p.lifestyleAssessmentForms = []\n}\n\nfor (var i in p.lifestyleAssessmentForms) {\n  var lifestyleForm = p.lifestyleAssessmentForms[i]\n\n  lifestyleForm.assessmentDate.displayDate = moment(lifestyleForm.assessmentDate.result).format(\"DD MMM YYYY HH:mm\")\n}\n// ##### Lifestyle Assessment Forms Preperation Functionality End\n\n// ##### My Safety Plan Forms Preperation Functionality Begin\nif(p.mySafetyPlanForms === undefined) {\n  p.mySafetyPlanForms = []\n}\n\nfor (var i in p.mySafetyPlanForms) {\n  var safetyForm = p.mySafetyPlanForms[i]\n\n  safetyForm.assessmentDate.displayDate = moment(safetyForm.assessmentDate.result).format(\"DD MMM YYYY HH:mm\")\n}\n// ##### My Safety Plan Forms Preperation Functionality End\n\n// Order Timeline by newest entry first\ntimeline.sort(function(a, b) {\n  return a.eventDate > b.eventDate ? -1 : a.eventDate < b.eventDate ? 1 : 0\n})\n\n// Set timeline variable\ncti.store.variables.timeline = timeline"},{"name":"fn_set_appointments","type":"scripting","item-type":"function","_auto_id_":"ccc57943-92fa-499c-9221-07ea1fc01885","sync":true,"params":[{"name":"appointments"}],"content":"window.logManager.consoleLog(\n  'function fn_set_appointments(appointments)', \n  'info'\n)\n\nif(appointments === undefined) { appointments = {} }\n\n//appointments.forEach(function(obj, idx) {\nfor(var i in appointments) {\n  var obj = appointments[i]\n\n  // Check if the appointment has already been completed or not\n  if (obj.attendees && obj.attendees.attendee && obj.attendees.attendee.outcome) {\n    obj['status'] = 'complete'\n  } else {\n    if (obj.status != 'started') {\n      obj['status'] = 'new'\n    }\n  }\n\n  // Create friendly time stamps\n  obj.shortTime = moment(obj.appointmentDateTime).format('HH:mm')\n  obj.shortEndTime = moment(obj.appointmentDateTime)\n    .add(obj.intendedDuration, 'minutes')\n    .format('HH:mm')\n\n  // No patientData means nothing more to process so continue.\n  var patientData = obj.patientData || null\n  if (patientData === null) {\n    obj['patientData'] = {\n      appointmentHistory : [],\n      dialogPlusForms : [],\n      progressNotes : [],\n      contacts : [],\n      allergies : [],\n      demographics : [],\n      alerts : [],\n      documents : [],\n      referrals : [],\n      mySafetyPlanForms : []\n    }\n    return false\n  }\n\n  var demographics = patientData.demographics || null\n\n  if (demographics === null) {\n    return false\n  }\n\n  // Set friendly formatted GP Details\n  var gp = (demographics.healthcareProvider && demographics.healthcareProvider.healthcareProvider && demographics.healthcareProvider.healthcareProvider.generalPractioner && demographics.healthcareProvider.healthcareProvider.generalPractioner.value) || ''\n\n  obj.gpDetails = (gp !== '' ? gp + ' (' : '') + (demographics.healthcareProvider && demographics.healthcareProvider.healthcareProvider && demographics.healthcareProvider.healthcareProvider.practice && demographics.healthcareProvider.healthcareProvider.practice.value) + (gp !== '' ? ')' : '')\n\n  // Set friendly formatted NHS number\n  if (!!demographics.nhsNumber) {\n    obj.nhsNumFormatted = demographics.nhsNumber.substring(0, 3) + ' ' + demographics.nhsNumber.substring(3, 6) + ' ' + demographics.nhsNumber.substring(6, 10)\n  } else {\n    obj.nhsNumFormatted = ''\n  }\n\n  // Set friendly formatted address\n  obj.addressFormatted = [\n    obj.patientData.demographics.address.addressLine1 || '', \n    obj.patientData.demographics.address.addressLine2 || '', \n    obj.patientData.demographics.address.addressLine3 || '', \n    obj.patientData.demographics.address.addressLine4 || ''\n  ].filter(function(e) {\n    return e.length > 0\n  }).join(', ')\n  \n  // Set postcode for navigation\n  obj.postCode = (demographics.address && demographics.address.postCode) || ''\n\n  // Set patients age (note: now using moment for more precision)\n  var now = moment().format('YYYY-MM-DD')\n  obj.age = (demographics.birthDate && moment(now).diff(demographics.birthDate, 'years')) || ''\n}\n\nreturn appointments;"},{"name":"fn_load_appointments","type":"scripting","item-type":"function","_auto_id_":"c70d8079-dd69-4e9c-8609-3a1e5ac7d4b1","sync":true,"params":[],"content":"window.logManager.consoleLog(\n  'function fn_load_appointments(filter)', \n  'info'\n)\n\nif(cti.store.variables.v_appointmentDate === undefined) {\n  cti.store.variables.v_appointmentDate = moment().format(\"YYYY-MM-DD\")\n  cti.store.variables.v_appointmentDateText = 'Today'\n}\n\n// Load appointments from pouch\nwindow.pouchManager.loadFromDatabase('appointments', function (doc) {\n  // Set the appointments variable\n  var appointments = doc.data;\n\n  // Filter the appointments with user friendly data and append\n  // status values to them via the fn_set_appointments function\n  var setAppointments = cti.fn_set_appointments(appointments);\n\n  // Reset the v_selectedDayAppointments array\n  cti.store.variables.v_selectedDayAppointments = []\n\n  // For loop throught the array of appointments\n  for(var i in setAppointments) {\n    var thisAppointment = setAppointments[i]\n\n    // If thisAppointment created date matches our filter date then\n    // push this into the v_selectedDayAppointments array\n    if(moment(thisAppointment.appointmentDateTime).format(\"YYYY-MM-DD\") === cti.store.variables.v_appointmentDate) {\n      var pushAppointment = JSON.parse(JSON.stringify(thisAppointment))\n      cti.store.variables.v_selectedDayAppointments.push(pushAppointment)\n    }\n  }\n\n  // Loop through the selectedDay appointments and create readable\n  // index values for them\n  for(var x in cti.store.variables.v_selectedDayAppointments) {\n    var thisSelectedDayAppointment = cti.store.variables.v_selectedDayAppointments[x]\n    thisSelectedDayAppointment.index = parseInt(x)\n    var title = \"\"\n    \n    if(thisSelectedDayAppointment.patientData.demographics.title != undefined && thisSelectedDayAppointment.patientData.demographics.title != \"\") {\n      title = \" (\"+thisSelectedDayAppointment.patientData.demographics.title+\")\"\n    }\n    \n    var displayName = thisSelectedDayAppointment.patientData.demographics.surname + \n        \", \" +\n        thisSelectedDayAppointment.patientData.demographics.firstname +\n        title\n    thisSelectedDayAppointment.displayName = displayName\n\n    thisSelectedDayAppointment.surname = thisSelectedDayAppointment.patientData.demographics.surname\n    thisSelectedDayAppointment.mobilePhoneNumber = thisSelectedDayAppointment.patientData.demographics.mobilePhoneNumber\n    thisSelectedDayAppointment.eveningPhoneNumber = thisSelectedDayAppointment.patientData.demographics.eveningPhoneNumber\n    thisSelectedDayAppointment.officePhoneNumber = thisSelectedDayAppointment.patientData.demographics.officePhoneNumber\n    \n    // Delete all patientData\n    delete thisSelectedDayAppointment.patientData\n    \n    // Remove additional appointment information\n    delete thisSelectedDayAppointment.addressFormatted\n    delete thisSelectedDayAppointment.age\n    delete thisSelectedDayAppointment.attendees\n    delete thisSelectedDayAppointment.dialog_form\n    delete thisSelectedDayAppointment.gpDetails\n    delete thisSelectedDayAppointment.healthcareProfessional\n    delete thisSelectedDayAppointment.lifestyle_form\n    delete thisSelectedDayAppointment.location\n    delete thisSelectedDayAppointment.safety_form\n    delete thisSelectedDayAppointment.warnings\n    delete thisSelectedDayAppointment.createdAtDateTime\n    delete thisSelectedDayAppointment.intendedDuration\n  }\n\n  // Update the pouch DB with new data\n  window.pouchManager.saveToDatabase(\"appointments\", setAppointments, function(rev) {\n    window.logManager.consoleLog(\n      'Pouch DB - Updated Appointment Data. Revision: ' + rev, \n      'info'\n    )\n    \n    if(cti.store.variables.return) {\n      delete cti.store.variables.return\n      delete cti.store.variables.selected_visit\n    }\n\n    cti.fn_toggle_spinner('close', '', 500)\n    cti.utils.callAction(\"go-to-page\", {\"name\":\"Visits\"})\n  }, function(reason, e) {\n    window.logManager.consoleLog(\n      'Pouch DB - Failed to Update Appointment Data - ' + reason + e, \n      'error'\n    )\n\n    cti.fn_toggle_spinner('close', '', 500)\n  })\n}, function (reason, err) {\n  window.logManager.consoleLog(\n    'Pouch DB - Failed retriveing Appointments Data from Pouch - ' + reason + err, \n    'error'\n  )\n\n  cti.fn_toggle_spinner('close', '', 500)\n})","actions":[]},{"name":"fn_set_view","type":"scripting","item-type":"function","_auto_id_":"37611c81-0396-4a35-a251-859a1c12f244","sync":true,"params":[{"name":"view_name"},{"name":"manual_filter","description":"Passed true when clicked from the filer button"}],"content":"window.logManager.consoleLog(\n  'function fn_set_view(view_name, manualFilter)', \n  'info'\n)\n\nif(view_name == \"Timeline\") {\n  \n  cti.store.variables.visit_view_mode = view_name\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Timeline\"})\n  \n} else if(view_name == \"Patient Demographics\") {\n  \n  var patient = JSON.parse(JSON.stringify(cti.store.variables.selected_visit.patientData.demographics))\n  var array = []\n  patient.allergiesLength = cti.store.variables.selected_visit.patientData.allergies.length\n  patient.alertsLength = cti.store.variables.selected_visit.patientData.alerts.length\n  patient.age = cti.store.variables.selected_visit.age\n  patient.nhsNumFormatted = cti.store.variables.selected_visit.nhsNumFormatted\n  patient.birthDate = cti.store.variables.selected_visit.patientData.demographics.birthDate\n  patient.age = cti.store.variables.selected_visit.age\n  patient.gpDetails = cti.store.variables.selected_visit.gpDetails\n  patient.postCode = cti.store.variables.selected_visit.postCode\n  patient.addressFormatted = cti.store.variables.selected_visit.addressFormatted\n  \n  if(patient.language === undefined) {\n    patient.language = {\n      code : null,\n      value : \"Not Specified\"\n    }\n  }\n  if(patient.nationality === undefined) {\n    patient.nationality = {\n      code : null,\n      value : \"Not Specified\"\n    }\n  }\n  \n\n  array.push(patient)\n  cti.store.variables.selected_visit.patientData.patient = array\n  delete cti.store.variables.selected_visit.patientData.displayAlerts\n  \n  cti.store.variables.visit_view_mode = view_name\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Patient\"})\n  \n} else if(view_name == \"Alerts\") {\n  debugger;\n  var alertsArray = JSON.parse(JSON.stringify(cti.store.variables.selected_visit.patientData.alerts))\n  \n  if(manual_filter) {\n    cti.store.variables.filter = \"open\"\n  } else {\n    if(cti.store.variables.filter === undefined) {\n      cti.store.variables.filter = \"open\"\n    } else if(cti.store.variables.filter === \"open\") {\n      cti.store.variables.filter = \"all\"\n    } else if(cti.store.variables.filter === \"all\") {\n      cti.store.variables.filter = \"open\"\n    }\n  }\n \n  if(cti.store.variables.filter === \"open\") {\n    for (var i = alertsArray.length; i-- > 0;) {\n      var thisAlert = alertsArray[i]\n\n      if (thisAlert.removalDate) {\n        alertsArray.splice(i, 1)\n      }\n    }\n    \n    if(alertsArray.length == 0) {\n      cti.store.variables.filter = \"all\"\n      alertsArray = JSON.parse(JSON.stringify(cti.store.variables.selected_visit.patientData.alerts))\n      cti.store.variables.selected_visit.patientData.displayAlerts = alertsArray\n    } else {\n      cti.store.variables.selected_visit.patientData.displayAlerts = alertsArray\n    }\n  } else {\n    cti.store.variables.selected_visit.patientData.displayAlerts = alertsArray\n  }\n  \n  delete cti.store.variables.selected_visit.patientData.patient\n  cti.store.variables.visit_view_mode = view_name\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Alerts\"})\n  \n} else if(view_name == \"Appointments\") {\n  \n  for(var i in cti.store.variables.selected_visit.patientData.appointmentHistory) {\n    var thisApp = cti.store.variables.selected_visit.patientData.appointmentHistory[i];\n    \n    if(thisApp.cancellationReason != \"\" || thisApp.comment != \"\" || thisApp.outcome != \"\") {\n      thisApp.rowClass = \"middle-row\";\n   \t} else {\n      thisApp.rowClass = \"bottom-row\";\n    }\n  }\n  delete cti.store.variables.selected_visit.patientData.displayAlerts\n  delete cti.store.variables.selected_visit.patientData.patient\n  cti.store.variables.visit_view_mode = view_name\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Appointments\"})\n  \n} else if(view_name == \"Referrals\") {\n  \n  delete cti.store.variables.selected_visit.patientData.displayAlerts\n  delete cti.store.variables.selected_visit.patientData.patient\n  cti.store.variables.visit_view_mode = view_name\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Referrals\"})\n  \n} else if(view_name == \"Progress Notes\") {\n  \n  delete cti.store.variables.selected_visit.patientData.displayAlerts\n  delete cti.store.variables.selected_visit.patientData.patient\n  cti.store.variables.visit_view_mode = view_name\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Notes\"})\n  \n} else if(view_name == \"Documents\") {\n  \n  delete cti.store.variables.selected_visit.patientData.displayAlerts\n  delete cti.store.variables.selected_visit.patientData.patient\n  cti.store.variables.visit_view_mode = view_name\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Documents\"})\n  \n} else if(view_name == \"Allergies\") {\n  \n  delete cti.store.variables.selected_visit.patientData.displayAlerts\n  delete cti.store.variables.selected_visit.patientData.patient\n  cti.store.variables.visit_view_mode = view_name\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Allergies\"})\n  \n} else if(view_name == \"Contacts\") {\n  \n  delete cti.store.variables.selected_visit.patientData.displayAlerts\n  delete cti.store.variables.selected_visit.patientData.patient\n  cti.store.variables.visit_view_mode = view_name\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Contacts\"})\n  \n}\n  \ncti.utils.updatePage()"},{"name":"fn_normalise_diary_templ","type":"scripting","item-type":"function","_auto_id_":"3d7016ce-be17-479a-a7d3-6b7a3843a799","sync":true,"params":[{"name":"importedTemplate","description":"The diary template array from RiO","required":true}],"content":"window.logManager.consoleLog(\n  'function fn_normalise_diary_templ(importedTemplate)', \n  'info'\n);\n\n// importedTemplate = array of template objects\n\n// Servelec days are 1-indexed.\nvar DAY_NUMBER_OFFSET = 1;\n\nvar diaryTemplate = [{\n  name: 'Monday',\n  sessions: []\n}, {\n  name: 'Tuesday',\n  sessions: []\n}, {\n  name: 'Wednesday',\n  sessions: []\n}, {\n  name: 'Thursday',\n  sessions: []\n}, {\n  name: 'Friday',\n  sessions: []\n}, {\n  name: 'Saturday',\n  sessions: []\n}, {\n  name: 'Sunday',\n  sessions: []\n}];\n\n// Normalise diary template data - we're only interested in so much of it.\ndiaryTemplate.forEach(function (dt, i) {\n  // Add all of today's sessions.\n  dt.sessions = importedTemplate.filter(function (e) {\n    var appointmentsAreAllowed = function appointmentsAreAllowed() {\n      return e.noAppointments != true;\n    };\n    var isCorrectDay = function isCorrectDay() {\n      return e.dayNumber === (i + DAY_NUMBER_OFFSET).toString();\n    };\n    var isInMultiRange = function isInMultiRange() {\n      // If this slot only covers one day, it's not multi so exit.\n      if (e.endDayNumber === e.dayNumber) {\n        return false;\n      }\n\n      return i + DAY_NUMBER_OFFSET >= parseInt(e.dayNumber) && i + DAY_NUMBER_OFFSET <= parseInt(e.endDayNumber);\n    };\n\n    return appointmentsAreAllowed() && (isCorrectDay() || isInMultiRange());\n  }).map(function (e) {\n    return {\n      startTime: e.startTime,\n      endTime: e.endTime,\n      slotLength: parseInt(e.slotLength),\n      addedFromDay: e.dayOfWeek\n    };\n  }).sort(function (a, b) {\n    if (a.startTime < b.startTime) {\n      return -1;\n    }\n    if (a.startTime > b.startTime) {\n      return 1;\n    }\n    if (a.endTime < b.endTime) {\n      return -1;\n    }\n    if (a.endTime > b.endTime) {\n      return 1;\n    }\n    return 0;\n  });\n});\n\ncti.store.variables.v_diary_template = diaryTemplate"},{"name":"fn_merge_busy_slots","type":"scripting","item-type":"function","_auto_id_":"3f67456a-b2da-4d14-86ac-3a43410e64d7","sync":true,"params":[{"name":"bookedSlots","description":"Busy / Booked appointment slots","required":true},{"name":"dow","description":"Day of the week to merge (zero-indexed)","required":true}],"content":"window.logManager.consoleLog(\n  'function fn_merge_busy_slots(bookedSlots, dow)', \n  'info'\n);\n\n// Process all sessions on the given day and return a list of free slots which can be booked into.\n\nvar diaryTemplate = cti.store.variables.v_diary_template\n\nvar selectedDay = diaryTemplate[dow] || {}\nbookedSlots = bookedSlots || []\nvar freeSlots = []\n\n// Ensure we've got at least one session to work with - if not, bomb straight out with empty free slots.\nif (!selectedDay.sessions || !selectedDay.sessions[0] || !selectedDay.sessions[0].startTime) {\n  return freeSlots\n}\n\nbookedSlots.sort(function(a, b) {\n  if (!a.startDateTime || !b.startDateTime || !a.endDateTime || !b.endDateTime) {\n    return 0\n  }\n  if (a.startDateTime < b.startDateTime) {\n    return -1\n  }\n  if (a.startDateTime > b.startDateTime) {\n    return 1\n  }\n  if (a.endDateTime < b.endDateTime) {\n    return -1\n  }\n  if (a.endDateTime > b.endDateTime) {\n    return 1\n  }\n  return 0\n})\n\nvar getBusyPointerStartTime = function getBusyPointerStartTime(busyPointerIndex, sessionIndex) {\n  // Ascertain if we have any booked slots to use and if so, do. Otherwise, use the current end of session marker.\n  if (bookedSlots && bookedSlots.length > busyPointerIndex && bookedSlots[busyPointerIndex].startDateTime) {\n    return moment(bookedSlots[busyPointerIndex].startDateTime)\n  } else {\n    return moment(selectedDay.sessions[sessionIndex].endTime, 'HH:mm')\n  }\n}\n\nvar freePointer = moment.duration(selectedDay.sessions[0].startTime)\n\nvar busyPointerIndex = 0\n\nvar busyPointer = moment.duration(moment(getBusyPointerStartTime(busyPointerIndex, 0)).format('HH:mm'))\n\nselectedDay.sessions.forEach(function(session, index) {\n  var sessionEndMins = moment.duration(session.endTime).asMinutes()\n\n  while (freePointer.asMinutes() + session.slotLength <= sessionEndMins) {\n    // Slot conflict checking...\n    //\n    // - Need to move freePointer to the end of each bookedSlot if it meets / overlaps.\n    // - Can add the free slot if the current potential free slot starts before the current busy pointer (either an appt or the end of session marker) and that slot can exist in its entirety - i.e. adding\n    //   slot length to the start time is still within those bounds.\n    if (freePointer.asMinutes() <= busyPointer.asMinutes() && freePointer.asMinutes() + session.slotLength <= busyPointer.asMinutes()) {\n      var hours = Math.floor(freePointer.asHours())\n      var start = (hours < 10 ? '0' : '') + hours + moment.utc(freePointer.asMilliseconds()).format(':mm')\n\n      // const slot = {\n      //   day: `${selectedDay.name}`,\n      //   time: `${start}`,\n      //   duration: session.slotLength\n      // }\n\n      var slot = {\n        code: '' + start,\n        value: '' + start\n      }\n\n      freeSlots.push(slot)\n    }\n\n    // Update the pointers accordingly.\n\n    // If we're at the start of or into the appt, move the free pointer to the end of this appt and move the busyPointer on to the next appt if there is one or alternatively, the end of the session.\n    if ((freePointer.asMinutes() >= busyPointer.asMinutes() || freePointer.asMinutes() + session.slotLength >= busyPointer.asMinutes()) && !!bookedSlots[busyPointerIndex]) {\n      // Set freePointer to be the latter of the end of the blocking appt and the next available slot start - to avoid odd minutes being made available.\n      var busySlotEnd = moment.duration(moment(bookedSlots[busyPointerIndex].endDateTime, 'YYYY-MM-DD HH:mm:ss').format('HH:mm'))\n\n      // Add as many slot lengths as we need to get past the current busy slot.\n      while (freePointer.asMinutes() < busySlotEnd.asMinutes()) {\n        freePointer = freePointer.add(session.slotLength, 'minutes')\n      }\n\n      busyPointerIndex++\n\n      busyPointer = moment.duration(getBusyPointerStartTime(busyPointerIndex, index).format('HH:mm'))\n    } else {\n      freePointer.add(session.slotLength, 'minutes')\n    }\n  }\n\n  // If we've got another session, update the pointer to either its current position or the start of the next session, whichever is later (to account for session overlaps).\n  if (!!selectedDay.sessions[index + 1]) {\n    var nextSessionStart = moment.duration(selectedDay.sessions[index + 1].startTime)\n    if (nextSessionStart.asMinutes() > freePointer.asMinutes()) {\n      freePointer = nextSessionStart\n    }\n  }\n})\n\nreturn freeSlots"},{"name":"fn_toggle_spinner","type":"scripting","item-type":"function","_auto_id_":"aa8f1181-8707-4e01-b5e9-52879149f436","sync":true,"params":[{"name":"orientation","description":"To dictate whether we are opening or closing the spinner","required":true},{"name":"message","description":"Message to display on the spinner"},{"name":"timeout","description":"Timeout period while data loads"}],"actions":[],"content":"window.logManager.consoleLog(\n  'function fn_toggle_spinner(orientation, message, timeout)', \n  'info'\n);\n\nif(orientation === \"open\") {\n  var spinner = document.querySelectorAll('load-spinner');\n\n  if(spinner && spinner.length > 0) {\n    spinner[0].setAttribute(\"message\", message);\n    spinner[0].startSpin();\n    spinner[0].show();\n  }\n} else {\n  if(timeout) {\n    setTimeout(function(){\n      var spinner = document.querySelectorAll('load-spinner');\n\n      if(spinner && spinner.length > 0) {\n        spinner[0].close();\n        spinner[0].stopSpin();\n      }\n  \t}, timeout);\n  } else {\n    var spinner = document.querySelectorAll('load-spinner');\n\n    if(spinner && spinner.length > 0) {\n      spinner[0].close();\n      spinner[0].stopSpin();\n    }\n  }\n}"},{"name":"orientation","type":"scripting","item-type":"variable","_auto_id_":"ff995e12-b350-45d6-bdd4-620a2d80d294","variable-type":"string"},{"name":"visit_view_mode","type":"scripting","item-type":"variable","_auto_id_":"f39581dd-c358-49f0-bb82-d9cb14ac9e18","variable-type":"string"},{"name":"visit_list_view_mode","type":"scripting","item-type":"variable","_auto_id_":"67024457-3ad2-4bc9-848a-7c25bed3ef4c","variable-type":"string","value":"list"},{"name":"show_advanced_note","type":"scripting","item-type":"variable","_auto_id_":"9b8f14a4-8f42-4556-ba09-d5771b1fea4f","variable-type":"boolean","value":"false"},{"name":"show_advanced_appt","type":"scripting","item-type":"variable","_auto_id_":"edf0457a-d580-4667-85f4-18ef943cddff","variable-type":"boolean","value":"false"},{"name":"auth_header","type":"scripting","item-type":"variable","_auto_id_":"fa1c2d7f-0a10-47bc-b92c-9f1b18874197","variable-type":"string"},{"name":"v_free_slots","type":"scripting","item-type":"variable","_auto_id_":"bd3dc03e-1399-422e-8ef1-0f44a69ecad7","variable-type":"string"},{"name":"v_dialog_plus_questions","type":"scripting","item-type":"variable","_auto_id_":"50a9aad3-4046-4321-84d0-5cd98ebd21c5","variable-type":"string"},{"name":"api_rio","type":"integration","item-type":"api","_auto_id_":"ff9cc79e-2ce6-4da5-a512-b85cacffe69d","headers":{},"params":[],"operations":[{"name":"getappointments","method":"POST","path":"/getappointments","summary":"Gets a list of appointments with patient data","params":[{"name":"Authorization","type":"string","description":"Base64 encoded username and password","in":"header","required":true},{"name":"applicationkey","description":"The application key","type":"string","typeConfig":{},"in":"header","required":true},{"name":"id","description":"HCP id","type":"string","typeConfig":{},"in":"body","required":true},{"name":"fromDate","description":"Range of appointments from date","type":"string","typeConfig":{},"in":"body","required":true},{"name":"toDate","description":"Range of appointments to date","type":"string","typeConfig":{},"in":"body","required":true}],"responses":[],"$open":false,"ttlMinutes":60,"content-type":""},{"name":"authenticate","method":"POST","path":"/authenticate","summary":"Authenticates a user","params":[{"name":"Authorization","type":"string","description":"Base64 encoded username and password","in":"header","required":true},{"name":"applicationkey","description":"Used to determine which API to connect to","type":"string","typeConfig":{},"in":"header","required":true}],"responses":[],"$open":false,"ttlMinutes":60,"content-type":""},{"ttlMinutes":60,"name":"setappointmenteta","summary":"Specify an ETA at which the HCP expects to arrive at the appointment location","path":"/setappointmenteta","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Base64 encoded username and password","type":"string","typeConfig":{},"in":"header","required":true},{"name":"applicationkey","description":"application key specific for using our API","type":"string","typeConfig":{},"in":"header","required":true},{"name":"appointmentId","description":"Visit Appointment id","type":"string","typeConfig":{},"in":"body","required":true},{"name":"eta","description":"Arrival ETA","type":"string","typeConfig":{},"in":"body","required":true}]},{"ttlMinutes":60,"name":"alerttypes","summary":"Static Data for Alert Types","path":"/staticdata/alerttypes","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization","type":"string","typeConfig":{},"in":"header","required":true},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header","required":true}],"$open":false},{"ttlMinutes":60,"name":"alertpriorities","summary":"Alert Priorities Static Data","path":"/staticdata/alertpriorities","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization Header","type":"string","typeConfig":{},"in":"header","required":true},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header","required":true}],"$open":false},{"ttlMinutes":60,"path":"/alerts","name":"getalerts","summary":"Refresh Alerts List","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization Header","type":"string","typeConfig":{},"in":"header","required":true},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header","required":true},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body","required":true}],"$open":false},{"ttlMinutes":60,"name":"getbookingrefdata","summary":"Get Static Reference Data for Booking an Appointment","path":"/staticdata/appointmentbookingreferencedata","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization","type":"string","typeConfig":{},"in":"header","required":true},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header","required":true}],"$open":false},{"ttlMinutes":60,"name":"diarytemplate","summary":"Diary Template Static Data","path":"/staticdata/diarytemplate","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization","type":"string","typeConfig":{},"in":"header","required":true},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header","required":true}],"$open":false},{"ttlMinutes":60,"name":"teamplannerreferencedata","summary":"teamplannerreferencedata","path":"/staticdata/teamplannerreferencedata","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization","type":"string","typeConfig":{},"in":"header","required":true},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header","required":true},{"name":"teams","description":"teams","type":"string","typeConfig":{},"in":"body","required":true}]},{"ttlMinutes":60,"name":"busydiaryslots","summary":"Get user's busy slots","path":"/bookings/busydiaryslots","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization","type":"string","typeConfig":{},"in":"header","required":true},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header","required":true},{"name":"fromDate","description":"fromDate","type":"string","typeConfig":{},"in":"body","required":true},{"name":"toDate","description":"toDate","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":60,"name":"getnoteconfig","summary":"Get the Progress Note Configuration","path":"/getprogressnoteconfiguration","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Auth Header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":60,"name":"getnotetypes","summary":"Get Note Types","path":"/getprogressnotetypes","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":60,"name":"getnotespecialites","summary":"Get Note Specialites","path":"/getprogressnotespecialites","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization Header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":60,"name":"getnoterisktypes","summary":"Get Note Risk Types","path":"/getprogressnoterisktypes","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization Header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":60,"name":"outcomesave","summary":"Saves outcome of visit","path":"/appointments/outcomesave","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Auth header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"payload","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":60,"name":"getdocument","summary":"Gets individual document data","path":"/getdocument","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Auth header base64","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body"}]},{"ttlMinutes":60,"name":"getstaticdata","summary":"Pulls back all static data in one call","path":"/staticdata","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Auth header","type":"string","typeConfig":{},"in":"header","required":true},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header","required":true}]},{"ttlMinutes":60,"name":"submitsafetyform","summary":"Submits the safety form","path":"/mysafetyplan/add","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Auth header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":60,"name":"submitdialogform","summary":"Submits dialog+ form","path":"/dialogplus/add","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Auth header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":60,"name":"submitlifestyleform","summary":"Submit lifestyle form","path":"/lifestyleassessment/add","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Auth header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":60,"name":"addprogressnote","summary":"Add a progress note","path":"/addprogressnote","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Auth header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":60,"name":"alertsadd","summary":"Add an alert","path":"/alerts/add","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Auth header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":60,"name":"removealert","path":"/alerts/remove","summary":"Remove single alert","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Auth header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":60,"path":"/getappointment","name":"getappointment","summary":"Gets a single appointment from a PUSH notification call","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Auth header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"pushDataPayload","description":"Appointment ID","type":"string","typeConfig":{},"in":"body"}],"$open":true}],"url":"https://infinity-dev.api.servelechsc.com/api/v3","definitions":{}},{"name":"api_rio_main","type":"integration","item-type":"api","_auto_id_":"33748468-35df-4740-8680-6f451735be13","headers":{},"params":[],"operations":[{"ttlMinutes":60,"name":"pushRegister","summary":"Registers the device for push notifications.","path":"/push/register","method":"POST","content-type":"application/json","$open":false,"params":[{"name":"os","description":"Operating system the request is being sent from","type":"string","typeConfig":{},"in":"body"},{"name":"notificationToken","description":"Device's unique token registered against the relevant service.","type":"string","typeConfig":{},"in":"body"},{"description":"The username of the currently logged in user - for targetted notifications.","name":"username","type":"string","typeConfig":{},"in":"body"},{"description":"If this user / device combo is already registered, the saved ID.","name":"registeredPushId","type":"string","typeConfig":{},"in":"body"},{"name":"Authorization","description":"Auth header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"}]},{"ttlMinutes":60,"name":"pushDeregister","path":"/push/deregister","summary":"Deregisters the user / device from the push notification service.","method":"POST","content-type":"application/json","$open":true,"params":[{"description":"If this user / device combo is already registered, the saved ID.","name":"registeredPushId","type":"string","typeConfig":{},"in":"body","required":true},{"name":"tags","description":"The tags registered by this device - in this case, the username.","type":"string","typeConfig":{},"in":"body"},{"name":"Authorization","description":"Auth header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header","required":true}]}],"url":"https://infinity-dev.api.servelechsc.com/api"},{"name":"api_rio_offline","type":"integration","item-type":"offline-api","_auto_id_":"e3100357-1301-4eee-982a-02d7257ac7ad","headers":{},"params":[],"operations":[{"ttlMinutes":1000,"name":"addHCPAppointment","summary":"Add new HCP appointment","path":"/appointments/add","method":"POST","content-type":"application/json","$open":false,"params":[{"name":"payload","description":"Appointment payload","type":"string","typeConfig":{},"in":"body","required":true},{"name":"Authorization","description":"Auth header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"}]},{"ttlMinutes":60,"name":"addTPAppointment","summary":"Add a new Team Planner appointment","path":"/appointments/teamadd","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Auth Header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":60,"name":"getappointment","summary":"Gets an updated singular appointment without the patientData","path":"/getappointment","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Auth Header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"appointmentId","description":"Appointment ID","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":30,"name":"outcomesave","summary":"End visit","path":"/appointments/outcomesave","method":"POST","content-type":"application/json","$open":true,"params":[{"name":"Authorization","description":"Authorization","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"payload","type":"string","typeConfig":{},"in":"body"}]},{"ttlMinutes":30,"path":"/mysafetyplan/add","name":"submitsafetyform","summary":"Submit safety form","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"payload","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":30,"name":"submitdialogform","summary":"Submit dialog form","path":"/dialogplus/add","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"payload","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":30,"name":"submitlifestyleform","summary":"Submit lifestyle form","path":"/lifestyleassessment/add","method":"POST","content-type":"application/json","$open":true,"params":[{"name":"Authorization","description":"Authorization","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"payload","type":"string","typeConfig":{},"in":"body"}]},{"ttlMinutes":30,"name":"addnote","summary":"Add progress note","path":"/addprogressnote","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"payload","type":"string","typeConfig":{},"in":"body"}],"$open":true},{"ttlMinutes":30,"name":"addalert","summary":"Add alert","path":"/alerts/add","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"payload","type":"string","typeConfig":{},"in":"body"}],"$open":true},{"ttlMinutes":30,"name":"removealert","summary":"Remove alert","path":"/alerts/remove","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"payload","type":"string","typeConfig":{},"in":"body"}],"$open":true}],"url":"https://infinity-dev.api.servelechsc.com/api/v3","definitions":{}},{"name":"api_rio_offline_main","type":"integration","item-type":"offline-api","_auto_id_":"5e944fe4-e097-4c9c-a50b-fc7d414e79c6","headers":{},"params":[],"operations":[{"ttlMinutes":60,"name":"pushRegister","summary":"Registers the device for push notifications.","path":"/push/register","method":"POST","content-type":"application/json","params":[{"name":"os","description":"Operating system the request is being sent from","type":"string","typeConfig":{},"in":"body","required":true},{"name":"notificationToken","description":"Device's unique token registered against the relevant service.","type":"string","typeConfig":{},"in":"body","required":true},{"name":"username","description":"The username of the currently logged in user - for targetted notifications.","type":"string","typeConfig":{},"in":"body","required":true},{"name":"registeredPushId","description":"If this user / device combo is already registered, the saved ID.","type":"string","typeConfig":{},"in":"body"},{"name":"Authorization","description":"Base64 encoded username and password","type":"string","typeConfig":{},"in":"header","required":true},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header","required":true}],"$open":false},{"ttlMinutes":60,"name":"pushDeregister","summary":"Deregisters the user / device from the push notification service.","path":"/push/deregister","method":"POST","content-type":"application/json","$open":true,"params":[{"name":"registeredPushId","description":"If this user / device combo is already registered, the saved ID.","type":"string","typeConfig":{},"in":"body","required":true},{"name":"tags","description":"The tags registered by this device - in this case, the username.","type":"string","typeConfig":{},"in":"body"},{"name":"Authorization","description":"Base64 encoded username and password","type":"string","typeConfig":{},"in":"header","required":true},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header","required":true}]}],"url":"https://infinity-dev.api.servelechsc.com/api"},{"name":"url_google_maps","type":"integration","item-type":"url","_auto_id_":"99606cfa-4927-4aab-92cd-6ab72e962172","params":{},"target":"_system","url":"http://maps.google.com/"},{"name":"notification_error","type":"notification","item-type":"app-notification","_auto_id_":"cf63ce44-16b9-458b-91ea-193c9afb1e24","options":{"autoDismiss":true},"style":"error"},{"name":"notification_info","type":"notification","item-type":"app-notification","_auto_id_":"418171e5-8009-4f8f-a133-497c6b69bb68","options":{"autoDismiss":true},"style":"success"},{"name":"notification_success","type":"notification","item-type":"app-notification","_auto_id_":"8b78ba02-4727-403e-bfa2-4c4b69abdc60","options":{"autoDismiss":true},"style":"success"},{"name":"notification_warning","type":"notification","item-type":"app-notification","_auto_id_":"8b5715bf-9908-40b7-98a4-b5975d10d9a6","options":{"autoDismiss":true},"style":"warning"},{"name":"font_opensans","type":"style","item-type":"font-asset","_auto_id_":"1f8cd6ea-7dcb-4503-8818-9eb7e56c24a0","fileName":"OpenSans-Regular 2.ttf"},{"name":"font_opensans_light","type":"style","item-type":"font-asset","_auto_id_":"49937495-4d70-4dba-bbf8-9c958aa0ef5b","fileName":"OpenSans-Light 2.ttf"},{"name":"css_main","type":"style","item-type":"css-asset","_auto_id_":"488967a5-4bd6-4b52-ba9c-978d74bf588d","fileName":"servelec.css"},{"name":"image_rio_logo","type":"style","item-type":"image-asset","_auto_id_":"89dea4f3-c423-4e7e-a8a8-3b8a40de8e78","fileName":"RiO oceano o Logo.jpg"},{"name":"image_servelec_logo","type":"style","item-type":"image-asset","_auto_id_":"6d030ecb-5ab3-4797-8b4f-ec56a756683c","fileName":"Servelec hsc Logo - RGB.JPG"},{"name":"image_splash","type":"style","item-type":"image-asset","_auto_id_":"6bdf425d-97ca-436f-b8b4-3421db0de522","fileName":"newriopage.png"},{"name":"image_pin","type":"style","item-type":"image-asset","_auto_id_":"62dc3282-89ff-42d3-96ef-b00f8aa908ac","fileName":"pin.png"},{"name":"image_safety","type":"style","item-type":"image-asset","_auto_id_":"7e3576ed-6cb2-4862-8635-8a3ff8d73e15","fileName":"thin-0635_anti_virus_protection_shield.png"},{"name":"image_dialog","type":"style","item-type":"image-asset","_auto_id_":"cb3b2616-5191-4a17-8f7b-6d15d4d4f2c1","fileName":"thin-0064_bullet_list_view.png"},{"name":"image_lifestyle","type":"style","item-type":"image-asset","_auto_id_":"1b232ceb-3f4f-411b-8dc8-6bc1a934288d","fileName":"thin-0842_fitness_running.png"},{"name":"image_medicine","type":"style","item-type":"image-asset","_auto_id_":"e26dc941-01e4-470c-bbf5-040c55051682","fileName":"thin-0820_medicine_drugs_ill_pill.png"},{"name":"image_referral","type":"style","item-type":"image-asset","_auto_id_":"0b1032df-8914-44f4-bc48-adb0e139bd07","fileName":"thin-0825_stetoscope_doctor_hospital_ill.png"},{"name":"image_admission","type":"style","item-type":"image-asset","_auto_id_":"96d37b07-2d9f-4bed-976c-d8860cbf6a37","fileName":"thin-0823_hospital_ill_medicine_doctor_ambulance.png"},{"name":"image_vte","type":"style","item-type":"image-asset","_auto_id_":"d190680f-a104-4679-a2ca-ea06b54dba5a","fileName":"thin-0815_lungs_breathing.png"},{"name":"image_timeline","type":"style","item-type":"image-asset","_auto_id_":"396cdc17-cfe6-4c39-925b-dd71f5f55b34","fileName":"thin-0117_folder_documents_revert_history.png"},{"name":"image_alerts","type":"style","item-type":"image-asset","_auto_id_":"9f0fd3f9-f77a-4044-94ad-e30eae9862fc","fileName":"thin-0550_attention_error_alert_caution.png"},{"name":"image_documents","type":"style","item-type":"image-asset","_auto_id_":"fad17b99-7240-40ec-8f1d-aba5bab2eddf","fileName":"thin-0073_documents_files_paper_text_archive_copy.png"},{"name":"image_appointments","type":"style","item-type":"image-asset","_auto_id_":"ca808029-f4b7-4c03-93c7-ac0622011b4b","fileName":"thin-0023_calendar_month_day_planner_events.png"},{"name":"image_mha","type":"style","item-type":"image-asset","_auto_id_":"7d2f098c-ce28-4e02-9937-6c5a9a5c0f55","fileName":"thin-0026_time_watch_clock.png"},{"name":"image_contacts","type":"style","item-type":"image-asset","_auto_id_":"bb99e399-8591-47bd-a394-3d99f8b61b87","fileName":"thin-0301_address_book_contacts.png"},{"name":"image_progress","type":"style","item-type":"image-asset","_auto_id_":"6a286242-0da6-49e2-8976-07847b05df15","fileName":"thin-0003_write_pencil_new_edit.png"},{"name":"image_allergies","type":"style","item-type":"image-asset","_auto_id_":"34927d85-70a3-46d9-bd8a-e8c988ac0aed","fileName":"thin-0816_microscope_laboratory.png"},{"name":"image_patient","type":"style","item-type":"image-asset","_auto_id_":"92887b73-99fc-4edd-9d2c-652de57cc908","fileName":"thin-0708_user_profile.png"},{"name":"image_tasks","type":"style","item-type":"image-asset","_auto_id_":"379e363f-0905-4ee1-9d24-117247b1b19d","fileName":"thin-0102_notebook_to_do_bullets_list.png"},{"name":"alert_icon","type":"style","item-type":"image-asset","_auto_id_":"2094a016-4438-4992-936e-5e70fa228f6f","fileName":"alert_icon.svg"},{"name":"allergy_icon","type":"style","item-type":"image-asset","_auto_id_":"5dc19083-4d4e-459f-bd7f-705738d94251","fileName":"allergy_icon.svg"},{"name":"handset_icon","type":"style","item-type":"image-asset","_auto_id_":"90d0eec3-c0fb-477c-b9c7-fd906245215e","fileName":"handset_icon.png"},{"name":"location","type":"style","item-type":"image-asset","_auto_id_":"22fc0c57-f15d-465f-92ce-05ecba99d661","fileName":"location.png"},{"name":"checkboxSliderReplacement","type":"style","item-type":"css","_auto_id_":"8c8b0544-35a1-4740-86fc-a7c7898a2f6c","content":".radioButtons input {\n    display:none;\n}\n.radioButtons label {\n    padding: 15px;\n    border: 1px solid;\n}\n\n.radioButtons {\n    width:100%;\n    text-align: center;\n    margin-bottom: 3%;\n}\n\n.radioButtons input[type=radio]:checked + label {\n    background-color:#2C9A42;\n}"},{"name":"image_alerts_semi","type":"style","item-type":"image-asset","_auto_id_":"16418353-b8cc-496c-b2bf-689de97e588e","fileName":"thin-0550_attention_error_alert_caution_semi.png"},{"name":"appt_or_patient_update","type":"notification","item-type":"push-event","_auto_id_":"15e300c3-0df8-4b32-b75d-00b2268be1e0","operations":[],"actions":[{"event":"push-received","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.incomingPush = JSON.stringify($data.$notification);\n$success($data);"},"_auto_id_":"b1ac86c8-f44e-41e9-8c93-992b273facc0","actions":[]},{"event":"push-received","type":"inline-function","data":{"sync":true,"code":"debugger;\nwindow.logManager.consoleLog(\n  'pushNotification - Push Notification Recieved: ' + cti.store.variables.incomingPush, \n  'info'\n);\n\n/*\n  {a\n    \"event\": \"message\",\n    \"payload\": {\na        \"type\": \"MRN\",\n        \"value\": \"RRRiO6MOD0922\"\n      },\n      \"notificationType\": a\"AlertAdded\"\n    },\n    \"from\": \"888020801908\",\n    \"message\": \"Patient Updated\",\n    \"service\": \"GCM\"\n  }\n  */\n\n// Notifty user we are updating device data\ncti.fn_toggle_spinner('open', 'Update Received, refreshing Appointment list, please wait...');\n\n// Grab the response\nvar pushPayload = JSON.parse(cti.store.variables.incomingPush);\n// COPY EVERYTHING BELOW THIS LINE TO testPushResponse\nvar notificationType = \"\"\n\nif (typeof pushPayload.payload !== 'object') {\n    pushPayload.payload = JSON.parse(pushPayload.payload) \n}\n\nif(pushPayload.payload && pushPayload.payload.notificationType) {\n  notificationType = pushPayload.payload.notificationType\n} else {\n  notificationType = \"Error\"\n}\ndebugger;\nif(notificationType == \"AppointmentCancelled\") {\n  // AppointmentCancelled: Remove the appointment from device, reload the \n  // appointments data and navigate user back to visits page\n\n  // Set the appointment to cancel\n  if(pushPayload.payload.appointmentId) {\n    cti.store.variables.appointmentId = pushPayload.payload.appointmentId\n  } else {\n    cti.fn_toggle_spinner('close', '')\n    return false\n  }\n\n  // Load appointments from pouch\n  window.pouchManager.loadFromDatabase('appointments', function (doc) {\n    // Set the appointments array\n    var appointments = doc.data\n\n    // Find the appointment on device...\n    for(var i in appointments) {\n      if(appointments[i].appointmentId == cti.store.variables.appointmentId) {\n        // ... and remove it from the main array\n        appointments.splice(i, 1)\n        break;\n      }\n    }\n\n    // Check that we aren't the the current visit, and if we are\n    // then remove the data\n    var selectedVisit = cti.store.variables.selected_visit\n\n    if(selectedVisit) {\n      if(selectedVisit.appointmentId == cti.store.variables.appointmentId) {\n        cti.store.variables.return = true\n      }\n    }\n\n    // Update the pouch DB with cancelled appointment\n    window.pouchManager.saveToDatabase(\"appointments\", appointments, function(rev) {\n      var app = cti.store.variables.appointmentId\n      window.logManager.consoleLog(\n        'Pouch DB - Removed appointment '+app+' successfully. Revision: '+rev, \n        'info'\n      )\n      \n      if(cti.store.variables.return || cti.store.state.currentPage == \"Visits\") {\n        cti.fn_load_appointments()\n      }\n\n      cti.fn_toggle_spinner('close', '')\n      delete cti.store.variables.appointmentId\n    }, function(reason, e) {\n      var app = cti.store.variables.appointmentId\n      window.logManager.consoleLog(\n        'Pouch DB - Error updating pouch for appointment '+app+'. Reason: '+reason+e, \n        'error'\n      )\n      \n      if(cti.store.variables.return || cti.store.state.currentPage == \"Visits\") {\n        cti.fn_load_appointments()\n      }\n\n      cti.fn_toggle_spinner('close')\n      delete cti.store.variables.appointmentId\n    });\n  }, function (reason, err) {\n    window.logManager.consoleLog(\n      'Pouch DB - Failed retriveing Appointments Data from Pouch - ', reason + err, \n      'error'\n    )\n\n    cti.fn_toggle_spinner('close')\n    delete cti.store.variables.appointmentId\n  })\n} else if(notificationType == \"AppointmentUpdated\" || notificationType == \"AppointmentOutcomed\") {\n  // AppointmentUpdated or AppointmentOutcomed: set the global payload to contain \n  // the appointmentId and the exists flag (true in this case)\n\n  // Check that we have a value appointmentId\n  if(pushPayload.payload.appointmentId) {\n    cti.store.variables.pushDataPayload = {\n      pushType: \"appointment\",\n      appointmentId : pushPayload.payload.appointmentId,\n      appointmentExists : true\n    }\n  } else {\n    cti.fn_toggle_spinner('close', '')\n    return false\n  }\n\n  // Call the GetAppointment ActionFlow\n  cti.utils.callAction(\"call-actionflow\", { name: \"GetPushData\" })\n} else if(notificationType == \"AppointmentAdded\") {\n  // AppointmentAdded: set the global payload to contain \n  // the appointmentId and the exists flag (false in this case)\n\n  // Check that we have a value appointmentId\n  if(pushPayload.payload.appointmentId) {\n    cti.store.variables.pushDataPayload = {\n      pushType: \"appointment\",\n      appointmentId : pushPayload.payload.appointmentId,\n      appointmentExists : false\n    }\n  } else {\n    cti.fn_toggle_spinner('close', '')\n    return false\n  }\n\n  // Call the GetAppointment ActionFlow\n  cti.utils.callAction(\"call-actionflow\", { name: \"GetPushData\" })\n} else if(notificationType == \"DemographicUpdated\" || notificationType == \"GPUpdated\" || notificationType == \"AddressUpdated\") {\n  // DemographicUpdated, GPUpdated, AddressUpdated, DeathRegistered: set the global payload to contain \n  // the appointmentId and the exists flag (true for the demographics flag)\n\n  // Check that we have a value appointmentId\n  if(pushPayload.payload.clientId) {\n    cti.store.variables.pushDataPayload = {\n      pushType: \"patient\",\n      clientId : pushPayload.payload.clientId,\n      appointmentExists : false,\n      includeDemographics : true\n    }\n  } else {\n    cti.fn_toggle_spinner('close', '')\n    return false\n  }\n\n  // Call the GetAppointment ActionFlow\n  cti.utils.callAction(\"call-actionflow\", { name: \"GetPushData\" })\n} else if(notificationType == \"DeathRegistered\") {\n  // DeathRegistered: Remove any appointments from device, reload the \n  // appointments data and navigate user back to visits page\n\n  // Set the patient to remove\n  if(pushPayload.payload.clientId) {\n    cti.store.variables.clientId = pushPayload.payload.clientId\n  } else {\n    cti.fn_toggle_spinner('close', '')\n    return false\n  }\n\n  // Load appointments from pouch\n  window.pouchManager.loadFromDatabase('appointments', function (doc) {\n    // Set the appointments array\n    var appointments = doc.data\n\n    // Find the appointments on device for the patient...\n    for(var i in appointments) {\n      if(appointments[i].attendees.attendee.clientId.value == cti.store.variables.clientId.value) {\n        // ... and remove them from the main array\n        appointments.splice(i, 1)\n      }\n    }\n\n    // Check that we aren't the the current visit, and if we are\n    // then remove the data\n    var selectedVisit = cti.store.variables.selected_visit\n\n    if(selectedVisit) {\n      if(selectedVisit.attendees.attendee.clientId.value == cti.store.variables.clientId.value) {\n        cti.store.variables.return = true\n      }\n    }\n\n    // Update the pouch DB with cancelled appointment\n    window.pouchManager.saveToDatabase(\"appointments\", appointments, function(rev) {\n      var app = cti.store.variables.clientId.value\n      window.logManager.consoleLog(\n        'Pouch DB - Removed patient appointments '+app+' successfully. Revision: '+rev, \n        'info'\n      )\n\n      if(cti.store.variables.return || cti.store.state.currentPage == \"Visits\") {\n        cti.fn_load_appointments()\n      }\n\n      cti.fn_toggle_spinner('close', '')\n      delete cti.store.variables.clientId\n    }, function(reason, e) {\n      var app = cti.store.variables.clientId.value\n      window.logManager.consoleLog(\n        'Pouch DB - Error updating pouch for appointment '+app+'. Reason: '+reason+e, \n        'error'\n      )\n\n      cti.fn_toggle_spinner('close')\n      delete cti.store.variables.clientId\n    })\n  }, function (reason, err) {\n    window.logManager.consoleLog(\n      'Pouch DB - Failed retriveing Appointments Data from Pouch - ', reason + err, \n      'error'\n    )\n\n    cti.fn_toggle_spinner('close')\n    delete cti.store.variables.clientId\n  })\n} else if(notificationType == \"AllergyAdded\" || notificationType == \"AllergyRemoved\") {\n  // AllergyAdded, AllergyRemoved: set the global payload to contain \n  // the appointmentId and the exists flag (true for the allergies flag)\n\n  // Check that we have a value appointmentId\n  if(pushPayload.payload.clientId) {\n    cti.store.variables.pushDataPayload = {\n      pushType: \"patient\",\n      clientId : pushPayload.payload.clientId,\n      appointmentExists : false,\n      includeAllergies : true\n    }\n  } else {\n    cti.fn_toggle_spinner('close', '')\n    return false\n  }\n\n  // Call the GetAppointment ActionFlow\n  cti.utils.callAction(\"call-actionflow\", { name: \"GetPushData\" })\n} else if(notificationType == \"AlertAdded\" || notificationType == \"AlertRemoved\") {\n  // AlertAdded, AlertRemoved: set the global payload to contain \n  // the appointmentId and the exists flag (true for the alerts flag)\n\n  // Check that we have a value appointmentId\n  if(pushPayload.payload.clientId) {\n    cti.store.variables.pushDataPayload = {\n      pushType: \"patient\",\n      clientId : pushPayload.payload.clientId,\n      appointmentExists : false,\n      includeAlerts : true\n    }\n  } else {\n    cti.fn_toggle_spinner('close', '')\n    return false\n  }\n\n  // Call the GetAppointment ActionFlow\n  cti.utils.callAction(\"call-actionflow\", { name: \"GetPushData\" })\n} else {\n  cti.fn_toggle_spinner('close')\n}"},"_auto_id_":"e84bce67-6070-42c0-98ad-0febc6c07714","actions":[]}]}],"components":[{"name":"ct_popup_box","description":"","icon":"fa-puzzle-piece","_auto_id_":"606531b4-9a85-4f06-b7ce-52e3902da20a","tagName":"ct-popup-box","type":"web-component","format":"javascript","typeVersion":"1","annotations":{"attributes":[{"name":"id","description":"","type":"string","enum":null,"required":true}],"functions":[{"name":"toggle","description":"Toggles the menu opened and closed based on the value\nof the this.opened property (initially set to false)","params":[{"name":"containerid","description":"id of container the popup is in","type":"string","enum":null,"required":true}],"returnType":"void","returnEnum":null}]},"userConfig":{},"valid":true,"files":{"original":"ct_popup_box.js","transpiled":"ct_popup_box.output.js"}},{"name":"ct_context_menu","description":"","icon":"fa-puzzle-piece","_auto_id_":"1fa0aab1-7b03-413d-b3e0-433405059753","tagName":"ct-context-menu","type":"web-component","format":"javascript","typeVersion":"1","annotations":{"attributes":[{"name":"MinWidth","description":"","type":"number","enum":null,"required":false},{"name":"Direction","description":"","type":"string","enum":null,"required":false},{"name":"Overlay","description":"","type":"boolean","enum":null,"required":false}],"functions":[{"name":"toggle","description":"Toggles the page opened and closed based on the value\nof the this.opened property (initially set to false)","params":[],"returnType":"void","returnEnum":null}]},"userConfig":{},"valid":true,"files":{"original":"ct_context_menu.js","transpiled":"ct_context_menu.output.js"}},{"name":"activity_spinner","description":"","icon":"fa-puzzle-piece","_auto_id_":"0d99e205-ae61-431d-85d1-6a3702fa694b","tagName":"load-spinner","type":"web-component","format":"javascript","typeVersion":"1","annotations":{"attributes":[{"name":"message","description":"A message to display whilst the spinner is showing","type":"string","enum":null,"required":false}],"functions":[{"name":"show","description":"Invoke the spinner","params":[],"returnType":"void","returnEnum":null},{"name":"close","description":"Remove/hide the spinner","params":[],"returnType":"void","returnEnum":null},{"name":"startSpin","description":"Add the 'spinner' class to start the animation","params":[],"returnType":"void","returnEnum":null},{"name":"stopSpin","description":"Remove the 'spinner' class to prevent animation in the backgroud","params":[],"returnType":"void","returnEnum":null}]},"userConfig":{},"valid":true,"files":{"original":"activity_spinner.js","transpiled":"activity_spinner.output.js"}},{"name":"photo_manager","description":"","icon":"fa-puzzle-piece","_auto_id_":"c909563e-7265-4dea-9113-de3314af7d2e","tagName":"photo-manager","type":"web-component","format":"javascript","typeVersion":"1","annotations":{"attributes":[{"name":"captureWidth","description":"Width restriction on captured photos","type":"number","enum":null,"required":false},{"name":"captureHeight","description":"Height restriction on captured photos","type":"number","enum":null,"required":false},{"name":"captureQuality","description":"QUality setting for captured photos","type":"number","enum":["50","75","90","100"],"required":false},{"name":"captureCategory","description":"Optional category identifier to assign to photos when captured.","type":"string","enum":null,"required":false},{"name":"displayCategory","description":"Optional category on which to filter display of photos","type":"string","enum":null,"required":false},{"name":"maxPhotos","description":"Maximum number of photos that can be captured in this category (default is 3)","type":"number","enum":null,"required":false}],"events":[{"name":"captureComplete","description":"Fired when a photo has been captured","type":"void","enum":null},{"name":"editPhoto","description":"Fired when user selects edit option","type":"void","enum":null},{"name":"maxPhotosTaken","description":"Fired when we have taken the maximum number of photos in this category","type":"void","enum":null}],"functions":[{"name":"takePhoto","description":"Take a photo","params":[{"name":"filename","description":"A filename to allocate to the capture photo","type":"string","enum":null,"required":false}],"returnType":"void","returnEnum":null},{"name":"deletePhoto","description":"Delete a photo","params":[{"name":"id","description":"The internal id of the photo to remove","type":"string","enum":null,"required":true}],"returnType":"void","returnEnum":null},{"name":"clearPhotos","description":"Clear photos","params":[],"returnType":"void","returnEnum":null}]},"userConfig":{},"valid":true,"files":{"original":"photo_manager.js","transpiled":"photo_manager.output.js"}},{"name":"cti_radio_buttons","description":"","icon":"fa-puzzle-piece","_auto_id_":"48eb4683-12b3-4299-a31e-d2f721d0fa7b","tagName":"cti-radio-buttons","type":"web-component","format":"javascript","typeVersion":"1","annotations":{"attributes":[{"name":"questionText","description":"Question description","type":"string","enum":null,"required":false},{"name":"selectedValue","description":"Selected value to allow us to preselect if the value exists in the store","type":"string","enum":null,"required":false}],"events":[{"name":"radioPressed","description":"Emitted when a value changes in the component","type":"void","enum":null},{"name":"connected","description":"Emitted when the element has connected","type":"void","enum":null}]},"userConfig":{},"valid":true,"files":{"original":"cti_radio_buttons.js","transpiled":"cti_radio_buttons.output.js"}}],"lastSchemaUpgradeDate":"2018-01-04 16:58:30","icondata":"rio_logo.png","jwt":"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhcHBfaWQiOiJmZGZkODljYi01NDZjLTQyMTItODVmNy1kODQ4ZGMzN2EwNzUiLCJhcHBfbmFtZSI6IkNvbW11bml0eV9Xb3JrZXIiLCJidWlsZF9pZCI6ImZkNDc1YjU2LTk4NTgtNDA5NS1hMjU0LTY5NzhjZWM1YzZjYSIsImNsaWVudF9pZCI6Ijc3ZGJmY2YyLWQwMWYtNDUwOS05ZTFiLTlhY2E5ZjE1OGM0NCIsImNsaWVudF9zZWNyZXQiOiJOR1UwVGpaV01sVndjMWw2VEdnMlJ6SktURGxLUVQwOSIsImV4cCI6MTUyMDI5NDQwMCwiZnJlcXVlbmN5IjoyMTYwMDAwMDAsImhhc2giOiIzYzM4NzcxNDk3M2RmNjI2YzQ0MTA5MTdmYjQ3YzI0YTY0NzZmNDcyNGU3ZGNjZTQ0MzgyM2I5NDIyNDdkZjAzIiwibGljX2V4cCI6MTUxNzcwMjQwMCwibHBfaWQiOiJkYzNjNmQ5OC1kZjg4LTQ4ZDEtOGRlNi1kOTE5OGU4OGI0ZGQiLCJwYWNrYWdlX2lkIjoiY29tLmNvbW1vbnRpbWUuaW5maW5pdHkuY29tbXVuaXR5d29ya2VyIiwicmVmcmVzaF90b2tlbiI6IlF5dFpPRzA0WVU0clNrOHhaV2RKYWpseGIxQktRekZTYVVSV1oyWjFaRFkzVlhsM1UzazNOaTh2WnowPSIsInR5cGUiOiJmdWxsIiwiaWF0IjoxNTE1MDg1MzU0fQ.HiDQ013VQDlgMA66F3WcHcW6z-ssTIWjT0MqhEnkmifp8AC5KIrJBRSBA3sjUXvtAkv936_8Fu4W0Fmx4EKS3Ifejym1Y2wmMK2w-z-mXJtmiGiEeWmUDpQMXv3TYtqH90V-EjpVHsRFYM3VP9SPf5ip8XmzWlrJJXos0BOUwWvCMijhZXDjaqZI09tJVU4X7HRBYV70Oks6zufCVxVX_JpYekudlWSKmcxigRIxG2Huot3QIZwkdCPGq0enc8mfTb26PTK1SMMgFXH0vANvHyGv77d188O2jLkWPwHcyVEqZs1ncXy14_AXU8fAeo4XoO1TOswQP8Eqqczcp7NXfw","buildId":"fd475b56-9858-4095-a254-6978cec5c6ca","displayName":"Community_Worker","hostContext":0}